/README.md

This is a [Next.js](https://nextjs.org) project bootstrapped with [`create-next-app`](https://nextjs.org/docs/app/api-reference/cli/create-next-app).

## Getting Started

First, run the development server:

```bash
npm run dev
# or
yarn dev
# or
pnpm dev
# or
bun dev
```

Open [http://localhost:3000](http://localhost:3000) with your browser to see the result.

You can start editing the page by modifying `app/page.tsx`. The page auto-updates as you edit the file.

This project uses [`next/font`](https://nextjs.org/docs/app/building-your-application/optimizing/fonts) to automatically optimize and load [Geist](https://vercel.com/font), a new font family for Vercel.

## Learn More

To learn more about Next.js, take a look at the following resources:

- [Next.js Documentation](https://nextjs.org/docs) - learn about Next.js features and API.
- [Learn Next.js](https://nextjs.org/learn) - an interactive Next.js tutorial.

You can check out [the Next.js GitHub repository](https://github.com/vercel/next.js) - your feedback and contributions are welcome!

## Deploy on Vercel

The easiest way to deploy your Next.js app is to use the [Vercel Platform](https://vercel.com/new?utm_medium=default-template&filter=next.js&utm_source=create-next-app&utm_campaign=create-next-app-readme) from the creators of Next.js.

Check out our [Next.js deployment documentation](https://nextjs.org/docs/app/building-your-application/deploying) for more details.



/app/api/telegram/validate/route.ts

// 1. API Route: app/api/telegram/validate/route.ts
import { NextRequest, NextResponse } from 'next/server'
import { validate, parse } from '@telegram-apps/init-data-node'

export async function POST(request: NextRequest) {
    const { initData } = await request.json()
    const botToken = process.env.TELEGRAM_BOT_TOKEN!

    try {
        // Validate the init data (throws if invalid)
        validate(initData, botToken)

        // Parse to get user info
        const data = parse(initData)

        return NextResponse.json({
            valid: true,
            user: data.user
        })
    } catch (error) {
        return NextResponse.json({
            valid: false,
            error: 'Invalid init data'
        }, { status: 401 })
    }
}


/app/globals.css

@import "tailwindcss";

:root {
  --telegram-blue: #0088cc;
}

/* Support Telegram's theme variables */
.light {
  color-scheme: light;
}

.dark {
  color-scheme: dark;
}

/* Custom scrollbar */
::-webkit-scrollbar {
  width: 8px;
  height: 8px;
}

::-webkit-scrollbar-track {
  background: var(--tg-theme-secondary-bg-color);
}

::-webkit-scrollbar-thumb {
  background: var(--tg-theme-hint-color);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb:hover {
  background: var(--tg-theme-text-color);
}

/* Button styles */
@layer components {
  .btn-primary {
    @apply px-4 py-2 rounded-lg font-medium transition-all duration-200 active:scale-95;
    background-color: var(--tg-theme-button-color);
    color: var(--tg-theme-button-text-color);
  }

  .btn-primary:hover {
    opacity: 0.9;
  }

  .btn-primary:disabled {
    opacity: 0.5;
    cursor: not-allowed;
  }

  .btn-secondary {
    @apply px-4 py-2 rounded-lg font-medium transition-all duration-200 active:scale-95;
    background-color: var(--tg-theme-secondary-bg-color);
    color: var(--tg-theme-text-color);
  }
}

/* Animations */
@keyframes pulse {

  0%,
  100% {
    opacity: 1;
  }

  50% {
    opacity: 0.5;
  }
}

.animate-pulse {
  animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite;
}

/* Prevent text selection in game UI */
.game-ui {
  -webkit-user-select: none;
  -moz-user-select: none;
  -ms-user-select: none;
  user-select: none;
  -webkit-touch-callout: none;
}

/* Safe area handling */
.safe-area-top {
  padding-top: env(safe-area-inset-top);
}

.safe-area-bottom {
  padding-bottom: env(safe-area-inset-bottom);
}


/app/layout.tsx

// app/layout.tsx
import type { Metadata, Viewport } from 'next'
import { Inter } from 'next/font/google'
import Script from 'next/script'
import './globals.css'
import { TelegramProvider } from '@/providers/TelegramProvider'
import { Analytics } from '@vercel/analytics/react'

const inter = Inter({ subsets: ['latin'] })

export const metadata: Metadata = {
  title: 'Telegram Mini App Masterclass',
  description: 'Learn to build amazing Telegram Mini App games',
  formatDetection: { telephone: false },
  robots: 'noindex,nofollow',
}

export const viewport: Viewport = {
  width: 'device-width',
  initialScale: 1.0,
  minimumScale: 1.0,
  maximumScale: 1.0,
  userScalable: false,
}

export default function RootLayout({
  children,
}: {
  children: React.ReactNode
}) {
  return (
    <html lang="en" suppressHydrationWarning>
      <head>
        <Script
          src="https://telegram.org/js/telegram-web-app.js"
          strategy="beforeInteractive"
        />
      </head>
      <body className={inter.className}>
        <TelegramProvider>
          {children}
        </TelegramProvider>
        <Analytics />
      </body>
    </html>
  )
}


/app/page.tsx

// app/page.tsx
'use client'

import { useState } from 'react'
import { motion } from 'framer-motion'
import { useTelegram } from '@/providers/TelegramProvider'
import NavigationTabs from '@/components/NavigationTabs'
import CoreApiDemo from '@/components/demos/CoreApiDemo'
import ButtonsDemo from '@/components/demos/ButtonsDemo'
import StorageDemo from '@/components/demos/StorageDemo'
import HapticsDemo from '@/components/demos/HapticsDemo'
import SensorsDemo from '@/components/demos/SensorsDemo'
import BiometricsDemo from '@/components/demos/BiometricsDemo'
import GameFeaturesDemo from '@/components/demos/GameFeaturesDemo'
import PaymentsDemo from '@/components/demos/PaymentsDemo'
import ActivityDemo from '@/components/demos/ActivityDemo'
import EmojiStatusDemo from '@/components/demos/EmojiStatusDemo'
import FileOperationsDemo from '@/components/demos/FileOperationsDemo'
import InitDataDemo from '@/components/demos/InitDataDemo'
import LinksDemo from '@/components/demos/LinksDemo'
import PopupsDemo from '@/components/demos/PopupsDemo'
import ShareStoryDemo from '@/components/demos/ShareStoryDemo'
import HomeScreenDemo from '@/components/demos/HomeScreenDemo'
import QRScannerDemo from '@/components/demos/QRScannerDemo'

export default function Home() {
  const { isReady, user } = useTelegram()
  const [activeTab, setActiveTab] = useState('core')

  if (!isReady) {
    return (
      <div className="min-h-screen flex items-center justify-center">
        <motion.div
          animate={{ rotate: 360 }}
          transition={{ duration: 1, repeat: Infinity, ease: "linear" }}
          className="w-12 h-12 border-4 border-telegram-blue border-t-transparent rounded-full"
        />
      </div>
    )
  }

  return (
    <main className="min-h-screen bg-[var(--tg-theme-bg-color)] text-[var(--tg-theme-text-color)]">
      {/* Header */}
      <header className="bg-[var(--tg-theme-header-bg-color)] p-4 shadow-md">
        <h1 className="text-2xl font-bold text-center">
          Telegram Mini App Masterclass
        </h1>
        {user && (
          <p className="text-center text-sm text-[var(--tg-theme-hint-color)] mt-1">
            Welcome, {user.first_name}!
            {user.is_premium && ' ‚≠ê Premium'}
          </p>
        )}
      </header>

      {/* Navigation */}
      <NavigationTabs activeTab={activeTab} onTabChange={setActiveTab} />

      {/* Content */}
      <div className="p-4 pb-20">
        <motion.div
          key={activeTab}
          initial={{ opacity: 0, y: 20 }}
          animate={{ opacity: 1, y: 0 }}
          transition={{ duration: 0.3 }}
        >
          {activeTab === 'init' && <InitDataDemo />}
          {activeTab === 'core' && <CoreApiDemo />}
          {activeTab === 'buttons' && <ButtonsDemo />}
          {activeTab === 'storage' && <StorageDemo />}
          {activeTab === 'haptics' && <HapticsDemo />}
          {activeTab === 'sensors' && <SensorsDemo />}
          {activeTab === 'biometrics' && <BiometricsDemo />}
          {activeTab === 'game' && <GameFeaturesDemo />}
          {activeTab === 'payments' && <PaymentsDemo />}
          {activeTab === 'emoji' && <EmojiStatusDemo />}
          {activeTab === 'files' && <FileOperationsDemo />}
          {activeTab === 'activity' && <ActivityDemo />}
          {activeTab === 'links' && <LinksDemo />}
          {activeTab === 'popups' && <PopupsDemo />}
          {activeTab === 'qr' && <QRScannerDemo />}
          {activeTab === 'share' && <ShareStoryDemo />}
          {activeTab === 'homescreen' && <HomeScreenDemo />}
        </motion.div>
      </div>
    </main>
  )
}


/components/CodeBlock.tsx

// components/CodeBlock.tsx
import { Highlight, themes } from 'prism-react-renderer'
import { useState } from 'react'
import { motion } from 'framer-motion'

interface CodeBlockProps {
    children: string
    language?: string
}

export default function CodeBlock({ children, language = 'typescript' }: CodeBlockProps) {
    const [copied, setCopied] = useState(false)

    const copyToClipboard = async () => {
        await navigator.clipboard.writeText(children.trim())
        setCopied(true)
        setTimeout(() => setCopied(false), 2000)
    }

    return (
        <div className="relative group">
            <div className="absolute top-2 right-2 flex gap-2 z-10">
                <span className="text-xs text-[var(--tg-theme-hint-color)] opacity-60">
                    {language}
                </span>
                <button
                    onClick={copyToClipboard}
                    className="px-2 py-1 text-xs bg-[var(--tg-theme-bg-color)] rounded opacity-0 group-hover:opacity-100 transition-opacity"
                >
                    {copied ? '‚úì Copied' : 'Copy'}
                </button>
            </div>

            <Highlight
                theme={themes.github} // or themes.github, themes.vsDark, etc.
                code={children.trim()}
                language={language as any}
            >
                {({ className, style, tokens, getLineProps, getTokenProps }) => (
                    <pre
                        className={`${className} p-4 rounded-lg overflow-x-auto text-sm`}
                        style={{
                            ...style,
                            backgroundColor: 'var(--tg-theme-secondary-bg-color)',
                        }}
                    >
                        <code>
                            {tokens.map((line, i) => (
                                <div key={i} {...getLineProps({ line })}>
                                    {line.map((token, key) => (
                                        <span key={key} {...getTokenProps({ token })} />
                                    ))}
                                </div>
                            ))}
                        </code>
                    </pre>
                )}
            </Highlight>
        </div>
    )
}


/components/ColorPicker.tsx

// components/ColorPicker.tsx
import { useState } from 'react'

interface ColorPickerProps {
    label: string
    value: string
    presets: { label: string; value: string }[]
    onChange: (color: string) => void
}

export default function ColorPicker({ label, value, presets, onChange }: ColorPickerProps) {
    const [isCustom, setIsCustom] = useState(false)

    return (
        <div className="space-y-2">
            <label className="text-sm font-medium">{label}</label>
            <div className="flex items-center gap-3">
                <input
                    type="color"
                    value={value}
                    onChange={(e) => {
                        setIsCustom(true)
                        onChange(e.target.value)
                    }}
                    className="w-12 h-10 rounded cursor-pointer border-2 border-[var(--tg-theme-hint-color)]"
                />
                <select
                    value={isCustom ? 'custom' : value}
                    onChange={(e) => {
                        const newValue = e.target.value
                        if (newValue !== 'custom') {
                            setIsCustom(false)
                            onChange(newValue)
                        }
                    }}
                    className="flex-1 px-3 py-2 rounded bg-[var(--tg-theme-bg-color)] text-[var(--tg-theme-text-color)] border border-[var(--tg-theme-hint-color)]"
                >
                    <option value="custom">Custom: {value}</option>
                    {presets.map(preset => (
                        <option key={preset.value} value={preset.value}>
                            {preset.label}
                        </option>
                    ))}
                </select>
                <div
                    className="w-10 h-10 rounded border-2 border-[var(--tg-theme-hint-color)]"
                    style={{ backgroundColor: value }}
                />
            </div>
        </div>
    )
}


/components/DemoSection.tsx

// components/DemoSection.tsx
import { ReactNode } from 'react'
import { motion } from 'framer-motion'

interface DemoSectionProps {
    title: string
    children: ReactNode
}

export default function DemoSection({ title, children }: DemoSectionProps) {
    return (
        <motion.section
            initial={{ opacity: 0, y: 20 }}
            animate={{ opacity: 1, y: 0 }}
            className="space-y-4"
        >
            <h2 className="text-xl font-bold flex items-center gap-2">
                {title}
            </h2>
            <div className="space-y-4">
                {children}
            </div>
        </motion.section>
    )
}


/components/NavigationTabs.tsx

// components/NavigationTabs.tsx
import { motion } from 'framer-motion'

interface Tab {
    id: string
    label: string
    icon: string
}

const tabs: Tab[] = [
    { id: 'init', label: 'Init Data', icon: 'üîê' },
    { id: 'core', label: 'Core API', icon: 'üîß' },
    { id: 'buttons', label: 'Buttons', icon: 'üîò' },
    { id: 'links', label: 'Links', icon: 'üîó' },
    { id: 'popups', label: 'Popups', icon: 'üí¨' },
    { id: 'qr', label: 'QR Scanner', icon: 'üì∑' },
    { id: 'storage', label: 'Storage', icon: 'üíæ' },
    { id: 'haptics', label: 'Haptics', icon: 'üì≥' },
    { id: 'sensors', label: 'Sensors', icon: 'üì±' },
    { id: 'biometrics', label: 'Biometrics', icon: 'üîê' },
    { id: 'share', label: 'Share', icon: 'üì∏' },
    { id: 'homescreen', label: 'Home', icon: 'üè†' },
    { id: 'emoji', label: 'Emoji', icon: 'üòä' },
    { id: 'files', label: 'Files', icon: 'üì•' },
    { id: 'activity', label: 'Activity', icon: 'üìä' },
    { id: 'game', label: 'Game', icon: 'üéÆ' },
    { id: 'payments', label: 'Payments', icon: 'üí∞' },
]

interface NavigationTabsProps {
    activeTab: string
    onTabChange: (tab: string) => void
}

export default function NavigationTabs({ activeTab, onTabChange }: NavigationTabsProps) {
    return (
        <nav className="bg-[var(--tg-theme-secondary-bg-color)] p-2 overflow-x-auto">
            <div className="flex gap-2 min-w-max">
                {tabs.map((tab) => (
                    <motion.button
                        key={tab.id}
                        onClick={() => onTabChange(tab.id)}
                        className={`
              px-4 py-2 rounded-full text-sm font-medium transition-colors
              ${activeTab === tab.id
                                ? 'bg-[var(--tg-theme-button-color)] text-[var(--tg-theme-button-text-color)]'
                                : 'bg-transparent text-[var(--tg-theme-text-color)]'}
            `}
                        whileTap={{ scale: 0.95 }}
                    >
                        <span className="mr-1">{tab.icon}</span>
                        {tab.label}
                    </motion.button>
                ))}
            </div>
        </nav>
    )
}


/components/demos/ActivityDemo.tsx

// components/demos/ActivityDemo.tsx
'use client'

import { useState, useEffect } from 'react'
import { useTelegram } from '@/providers/TelegramProvider'
import DemoSection from '@/components/DemoSection'
import CodeBlock from '@/components/CodeBlock'

export default function ActivityDemo() {
    const { webApp } = useTelegram()
    const [activityData, setActivityData] = useState({
        isActive: true,
        currentDuration: 0,
        previousDuration: 0,
        activatedAt: new Date()
    })

    useEffect(() => {
        if (!webApp) return

        let interval: NodeJS.Timeout

        const handleActivated = () => {
            setActivityData(prev => ({
                ...prev,
                isActive: true,
                activatedAt: new Date()
            }))

            interval = setInterval(() => {
                setActivityData(prev => ({
                    ...prev,
                    currentDuration: Date.now() - prev.activatedAt.getTime()
                }))
            }, 100)
        }

        const handleDeactivated = () => {
            clearInterval(interval)
            setActivityData(prev => ({
                ...prev,
                isActive: false,
                previousDuration: Date.now() - prev.activatedAt.getTime()
            }))
        }

        webApp.onEvent('activated', handleActivated)
        webApp.onEvent('deactivated', handleDeactivated)

        if (webApp.isActive) {
            handleActivated()
        }

        return () => {
            clearInterval(interval)
            webApp.offEvent('activated', handleActivated)
            webApp.offEvent('deactivated', handleDeactivated)
        }
    }, [webApp])

    return (
        <div className="space-y-6">
            <DemoSection title="üìä Activity Tracking">
                <div className="p-4 bg-[var(--tg-theme-secondary-bg-color)] rounded-lg">
                    <div className="space-y-2">
                        <div>
                            Status: <span className="font-bold">
                                {activityData.isActive ? 'üü¢ Active' : 'üî¥ Inactive'}
                            </span>
                        </div>
                        <div>
                            Current Session: {Math.round(activityData.currentDuration / 1000)}s
                        </div>
                        {activityData.previousDuration > 0 && (
                            <div className="text-sm text-[var(--tg-theme-hint-color)]">
                                Previous Session: {Math.round(activityData.previousDuration / 1000)}s
                            </div>
                        )}
                    </div>
                </div>

                <CodeBlock language="typescript">
                    {`// Track user activity
webApp.onEvent('activated', () => {
  console.log('Mini App activated')
  resumeGame()
})

webApp.onEvent('deactivated', () => {
  console.log('Mini App deactivated')
  pauseGame()
  saveProgress()
})

// Check current status
if (webApp.isActive) {
  // App is currently active
}`}
                </CodeBlock>
            </DemoSection>
        </div>
    )
}


/components/demos/BiometricsDemo.tsx

// components/demos/BiometricsDemo.tsx
'use client'

import { useState, useEffect, useCallback } from 'react'
import { useTelegram } from '@/providers/TelegramProvider'
import DemoSection from '@/components/DemoSection'
import CodeBlock from '@/components/CodeBlock'

export default function BiometricsDemo() {
    const { webApp } = useTelegram()
    const [biometricInfo, setBiometricInfo] = useState({
        isInited: false,
        isAvailable: false,
        type: '',
        isAccessRequested: false,
        isAccessGranted: false,
        isTokenSaved: false,
        deviceId: ''
    })
    const [authToken, setAuthToken] = useState<string | null>(null)
    const [showExplanation, setShowExplanation] = useState(true)

    const updateBiometricInfo = useCallback(() => {
        if (!webApp?.BiometricManager) return

        const bm = webApp.BiometricManager
        setBiometricInfo({
            isInited: bm.isInited,
            isAvailable: bm.isBiometricAvailable,
            type: bm.biometricType,
            isAccessRequested: bm.isAccessRequested,
            isAccessGranted: bm.isAccessGranted,
            isTokenSaved: bm.isBiometricTokenSaved,
            deviceId: bm.deviceId
        })
    }, [webApp])

    useEffect(() => {
        if (!webApp) return

        // Listen for biometric manager updates
        webApp.onEvent('biometricManagerUpdated', updateBiometricInfo)

        // Listen for app activation to check permission changes
        const handleActivated = () => {
            // Re-init and update when app becomes active
            if (webApp.BiometricManager) {
                webApp.BiometricManager.init(() => {
                    updateBiometricInfo()
                })
            }
        }

        webApp.onEvent('activated', handleActivated)

        // Only init if webApp is available
        if (webApp.BiometricManager) {
            webApp.BiometricManager.init()
            updateBiometricInfo() // Call it once after init
        }

        // Set up periodic check when app is active
        const intervalId = setInterval(() => {
            if (webApp.isActive) {
                updateBiometricInfo()
            }
        }, 1000) // Check every second while active

        return () => {
            webApp.offEvent('biometricManagerUpdated', updateBiometricInfo)
            webApp.offEvent('activated', handleActivated)
            clearInterval(intervalId)
        }
    }, [webApp, updateBiometricInfo])

    const requestAccess = () => {
        webApp?.BiometricManager.requestAccess(
            { reason: 'To secure your game progress and purchases' },
            (granted: boolean) => {
                webApp.showAlert(`Biometric access ${granted ? 'granted' : 'denied'}`)
                // Force update after callback
                setTimeout(updateBiometricInfo, 100)
            }
        )
    }

    const authenticate = () => {
        // First, let's check if permissions are still valid
        updateBiometricInfo()

        // Small delay to ensure state is updated
        setTimeout(() => {
            if (!biometricInfo.isAccessGranted) {
                webApp?.HapticFeedback.notificationOccurred('error')
                webApp?.showAlert('Biometric access has been revoked. Please grant access again.')
                return
            }

            webApp?.BiometricManager.authenticate(
                { reason: 'Verify your identity to continue' },
                (success: boolean, token?: string) => {
                    if (success && token) {
                        setAuthToken(token)
                        webApp.HapticFeedback.notificationOccurred('success')
                        webApp.showAlert('Authentication successful!')
                    } else {
                        webApp.HapticFeedback.notificationOccurred('error')
                        // Update info in case permissions changed
                        updateBiometricInfo()

                        if (!biometricInfo.isTokenSaved) {
                            webApp.showAlert('Authentication failed. Make sure you have a token saved.')
                        } else {
                            webApp.showAlert('Authentication failed. Please try again.')
                        }
                    }
                }
            )
        }, 100)
    }

    const saveToken = () => {
        // Check permissions before saving
        updateBiometricInfo()

        setTimeout(() => {
            if (!biometricInfo.isAccessGranted) {
                webApp?.HapticFeedback.notificationOccurred('error')
                webApp?.showAlert('Biometric access has been revoked. Please grant access again.')
                return
            }

            const token = Math.random().toString(36).substring(7)
            webApp?.BiometricManager.updateBiometricToken(token, (updated: boolean) => {
                if (updated) {
                    webApp.showAlert('Token saved securely! You can now authenticate.')
                    // Force update the UI
                    setTimeout(updateBiometricInfo, 100)
                } else {
                    // Token save failed - possibly permissions revoked
                    updateBiometricInfo()
                    webApp.HapticFeedback.notificationOccurred('error')
                    webApp.showAlert('Failed to save token. Please check biometric permissions.')
                }
            })
        }, 100)
    }

    const removeToken = () => {
        webApp?.BiometricManager.updateBiometricToken('', (updated: boolean) => {
            if (updated) {
                webApp.showAlert('Token removed')
                setAuthToken(null) // Clear the auth token when removing saved token
                // Force update the UI
                setTimeout(updateBiometricInfo, 100)
            }
        })
    }

    // Add manual refresh button
    const refreshStatus = () => {
        if (webApp?.BiometricManager) {
            webApp.BiometricManager.init(() => {
                updateBiometricInfo()
                webApp.HapticFeedback.notificationOccurred('success')
                webApp.showAlert('Status refreshed')
            })
        }
    }

    return (
        <div className="space-y-6">
            {showExplanation && (
                <div className="p-4 bg-blue-500/10 border border-blue-500/30 rounded-lg">
                    <div className="flex justify-between items-start">
                        <div className="flex-1">
                            <h3 className="font-semibold text-blue-600 dark:text-blue-400 mb-2">
                                üîê How Biometrics Work in Telegram
                            </h3>
                            <ol className="text-sm space-y-2 text-[var(--tg-theme-text-color)]">
                                <li><strong>1. Request Access:</strong> Ask user permission to use biometrics</li>
                                <li><strong>2. Save Token:</strong> Store a secure token that will be used for authentication</li>
                                <li><strong>3. Authenticate:</strong> Verify user's identity against the saved token</li>
                                <li className="text-xs text-[var(--tg-theme-hint-color)] mt-2">
                                    üí° Your biometric data never leaves your device - only secure tokens are used
                                </li>
                                <li className="text-xs text-[var(--tg-theme-hint-color)]">
                                    ‚ö†Ô∏è Important: You must save a token BEFORE you can authenticate!
                                </li>
                            </ol>
                        </div>
                        <button
                            onClick={() => setShowExplanation(false)}
                            className="ml-2 text-[var(--tg-theme-hint-color)] hover:text-[var(--tg-theme-text-color)]"
                        >
                            ‚úï
                        </button>
                    </div>
                </div>
            )}

            <DemoSection title="üîê Biometric Status">
                <div className="space-y-3">
                    <div className="grid grid-cols-2 gap-3 text-sm">
                        <div className="p-3 bg-[var(--tg-theme-secondary-bg-color)] rounded">
                            <div className="font-semibold mb-1">System Status</div>
                            <div className="space-y-1">
                                <div className="flex justify-between">
                                    <span className="text-[var(--tg-theme-hint-color)]">Initialized:</span>
                                    <span>{biometricInfo.isInited ? '‚úÖ' : '‚ùå'}</span>
                                </div>
                                <div className="flex justify-between">
                                    <span className="text-[var(--tg-theme-hint-color)]">Available:</span>
                                    <span>{biometricInfo.isAvailable ? '‚úÖ' : '‚ùå'}</span>
                                </div>
                                <div className="flex justify-between">
                                    <span className="text-[var(--tg-theme-hint-color)]">Type:</span>
                                    <span>{biometricInfo.type === 'face' ? 'üë§ Face' : biometricInfo.type === 'finger' ? 'üëÜ Finger' : 'N/A'}</span>
                                </div>
                            </div>
                        </div>

                        <div className="p-3 bg-[var(--tg-theme-secondary-bg-color)] rounded">
                            <div className="font-semibold mb-1">User Permissions</div>
                            <div className="space-y-1">
                                <div className="flex justify-between">
                                    <span className="text-[var(--tg-theme-hint-color)]">Requested:</span>
                                    <span>{biometricInfo.isAccessRequested ? '‚úÖ' : '‚ùå'}</span>
                                </div>
                                <div className="flex justify-between">
                                    <span className="text-[var(--tg-theme-hint-color)]">Granted:</span>
                                    <span>{biometricInfo.isAccessGranted ? '‚úÖ' : '‚ùå'}</span>
                                </div>
                                <div className="flex justify-between">
                                    <span className="text-[var(--tg-theme-hint-color)]">Token Saved:</span>
                                    <span>{biometricInfo.isTokenSaved ? '‚úÖ' : '‚ùå'}</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div className="flex items-center justify-between gap-2">
                        <div className="text-xs text-[var(--tg-theme-hint-color)] break-all flex-1">
                            Device ID: {biometricInfo.deviceId || 'N/A'}
                        </div>
                        <button
                            onClick={refreshStatus}
                            className="btn-secondary text-xs px-3 py-1"
                            title="Refresh biometric status"
                        >
                            üîÑ Refresh
                        </button>
                    </div>

                    {/* Show settings button only when access was requested but denied */}
                    {biometricInfo.isAccessRequested && !biometricInfo.isAccessGranted && (
                        <button
                            onClick={() => webApp?.BiometricManager.openSettings()}
                            className="btn-secondary w-full"
                        >
                            ‚öôÔ∏è Open Settings
                        </button>
                    )}

                    {/* Show warning if permissions were revoked */}
                    {biometricInfo.isAccessRequested && !biometricInfo.isAccessGranted && biometricInfo.isTokenSaved && (
                        <div className="p-3 bg-red-500/10 border border-red-500/30 rounded">
                            <p className="text-sm text-red-600 dark:text-red-400">
                                ‚ö†Ô∏è Biometric access was revoked. Your saved token is still present but cannot be used until you grant access again.
                            </p>
                        </div>
                    )}
                </div>
            </DemoSection>

            <DemoSection title="üîë Biometric Actions">
                <div className="space-y-4">
                    {/* Step 1: Request Access */}
                    <div className="p-4 bg-[var(--tg-theme-secondary-bg-color)] rounded-lg">
                        <div className="flex items-center justify-between mb-2">
                            <h4 className="font-semibold">Step 1: Request Permission</h4>
                            {biometricInfo.isAccessGranted && <span className="text-green-500">‚úÖ Completed</span>}
                        </div>
                        <p className="text-sm text-[var(--tg-theme-hint-color)] mb-3">
                            First, ask the user for permission to use biometric authentication
                        </p>
                        <button
                            onClick={requestAccess}
                            className="btn-primary w-full"
                            disabled={biometricInfo.isAccessGranted}
                        >
                            {biometricInfo.isAccessGranted ? '‚úÖ Access Already Granted' : 'Request Biometric Access'}
                        </button>
                    </div>

                    {/* Step 2: Save Token */}
                    <div className={`p-4 bg-[var(--tg-theme-secondary-bg-color)] rounded-lg ${!biometricInfo.isAccessGranted ? 'opacity-50' : ''}`}>
                        <div className="flex items-center justify-between mb-2">
                            <h4 className="font-semibold">Step 2: Save Authentication Token</h4>
                            {biometricInfo.isTokenSaved && <span className="text-green-500">‚úÖ Completed</span>}
                        </div>
                        <p className="text-sm text-[var(--tg-theme-hint-color)] mb-3">
                            You must save a token first before you can authenticate. This token will be used to verify your identity.
                        </p>

                        {!biometricInfo.isTokenSaved && biometricInfo.isAccessGranted && (
                            <div className="p-3 mb-3 bg-yellow-500/10 border border-yellow-500/30 rounded">
                                <p className="text-sm text-yellow-600 dark:text-yellow-400">
                                    ‚ö†Ô∏è No token saved yet. Save a token first to enable authentication.
                                </p>
                            </div>
                        )}

                        <div className="grid grid-cols-2 gap-2">
                            <button
                                onClick={saveToken}
                                className="btn-primary"
                                disabled={!biometricInfo.isAccessGranted || biometricInfo.isTokenSaved}
                            >
                                {biometricInfo.isTokenSaved ? '‚úÖ Token Saved' : 'üíæ Save Token'}
                            </button>

                            <button
                                onClick={removeToken}
                                className="btn-primary"
                                disabled={!biometricInfo.isTokenSaved}
                            >
                                üóëÔ∏è Remove Token
                            </button>
                        </div>

                        {biometricInfo.isTokenSaved && (
                            <p className="text-xs text-green-600 dark:text-green-400 mt-2">
                                ‚úÖ Token saved! You can now authenticate using your biometrics.
                            </p>
                        )}
                    </div>

                    {/* Step 3: Authenticate */}
                    <div className={`p-4 bg-[var(--tg-theme-secondary-bg-color)] rounded-lg ${!biometricInfo.isTokenSaved ? 'opacity-50' : ''}`}>
                        <h4 className="font-semibold mb-2">Step 3: Authenticate with Biometrics</h4>
                        <p className="text-sm text-[var(--tg-theme-hint-color)] mb-3">
                            Now verify your identity using your saved biometric token
                        </p>

                        {!biometricInfo.isTokenSaved && biometricInfo.isAccessGranted && (
                            <div className="p-3 mb-3 bg-red-500/10 border border-red-500/30 rounded">
                                <p className="text-sm text-red-600 dark:text-red-400">
                                    ‚ùå Cannot authenticate without a saved token. Complete Step 2 first.
                                </p>
                            </div>
                        )}

                        <button
                            onClick={authenticate}
                            className="btn-primary w-full"
                            disabled={!biometricInfo.isAccessGranted || !biometricInfo.isTokenSaved}
                        >
                            {!biometricInfo.isAccessGranted ? 'üîí Grant Access First' :
                                !biometricInfo.isTokenSaved ? 'üíæ Save Token First' :
                                    'üëÜ Authenticate with Biometrics'}
                        </button>

                        {authToken && (
                            <div className="mt-3 p-3 bg-green-500/20 rounded text-sm">
                                <div className="font-semibold">‚úÖ Authentication Successful!</div>
                                <div className="text-xs mt-1 break-all">Token: {authToken}</div>
                                <p className="text-xs mt-2 text-[var(--tg-theme-hint-color)]">
                                    This token can be used to verify the user on your backend
                                </p>
                            </div>
                        )}
                    </div>

                    {/* Settings Button for denied access - as a separate warning */}
                    {biometricInfo.isAccessRequested && !biometricInfo.isAccessGranted && (
                        <div className="p-4 bg-yellow-500/10 border border-yellow-500/30 rounded-lg">
                            <h4 className="font-semibold text-yellow-600 dark:text-yellow-400 mb-2">
                                ‚ö†Ô∏è Biometric Access Denied
                            </h4>
                            <p className="text-sm mb-3">
                                You previously denied biometric access. To enable biometrics, you need to grant permission in your device settings.
                            </p>
                            <button
                                onClick={() => webApp?.BiometricManager.openSettings()}
                                className="btn-secondary w-full"
                            >
                                ‚öôÔ∏è Open Device Settings
                            </button>
                        </div>
                    )}
                </div>

                <CodeBlock language="typescript">
                    {`// Complete biometric flow with permission monitoring

// 1. Initialize and monitor permissions
webApp.BiometricManager.init()

// Listen for app activation to check permission changes
webApp.onEvent('activated', () => {
    // Re-check biometric status when app becomes active
    webApp.BiometricManager.init(() => {
        checkBiometricStatus()
    })
})

// 2. Request permission (only needed once)
webApp.BiometricManager.requestAccess({
    reason: 'To secure your account'
}, (granted) => {
    if (granted) {
        // Permission granted, now save a token
        saveSecureToken()
    }
})

// 3. Save token with permission check
function saveSecureToken() {
    // Always check permissions before sensitive operations
    if (!webApp.BiometricManager.isAccessGranted) {
        showPermissionRevokedWarning()
        return
    }
    
    const secureToken = generateSecureToken()
    webApp.BiometricManager.updateBiometricToken(
        secureToken,
        (saved) => {
            if (saved) {
                console.log('Token saved successfully')
            } else {
                // Save failed - permissions might have been revoked
                checkBiometricStatus()
            }
        }
    )
}

// 4. Authenticate with permission fallback
function authenticateUser() {
    webApp.BiometricManager.authenticate({
        reason: 'Confirm your identity'
    }, (success, token) => {
        if (success && token) {
            verifyWithBackend(token)
        } else {
            // Check if permissions were revoked
            if (!webApp.BiometricManager.isAccessGranted) {
                showPermissionRevokedDialog()
            }
        }
    })
}

// 5. Handle permission revocation gracefully
function showPermissionRevokedDialog() {
    webApp.showPopup({
        title: 'Biometric Access Required',
        message: 'Biometric permissions have been revoked. Would you like to re-enable them?',
        buttons: [
            { id: 'settings', text: 'Open Settings' },
            { type: 'cancel' }
        ]
    }, (buttonId) => {
        if (buttonId === 'settings') {
            webApp.BiometricManager.openSettings()
        }
    })
}`}
                </CodeBlock>
            </DemoSection>

            <DemoSection title="üí° Understanding the Flow">
                <div className="space-y-3">
                    <div className="p-4 bg-[var(--tg-theme-secondary-bg-color)] rounded">
                        <h4 className="font-semibold mb-2">Why Save Token First?</h4>
                        <p className="text-sm text-[var(--tg-theme-hint-color)]">
                            The biometric authentication in Telegram works by comparing your biometric input
                            against a saved token. Without a saved token, there's nothing to authenticate against!
                        </p>
                        <div className="mt-3 p-3 bg-[var(--tg-theme-bg-color)] rounded">
                            <p className="text-xs font-mono">
                                Saved Token + Biometric Input = Authentication Success ‚úÖ
                            </p>
                            <p className="text-xs font-mono mt-1">
                                No Token + Biometric Input = Authentication Failure ‚ùå
                            </p>
                        </div>
                    </div>

                    <div className="p-4 bg-[var(--tg-theme-secondary-bg-color)] rounded">
                        <h4 className="font-semibold mb-2">Handling Permission Changes</h4>
                        <p className="text-sm text-[var(--tg-theme-hint-color)] mb-3">
                            Users can revoke biometric permissions at any time through system settings. Your app should:
                        </p>
                        <ol className="text-sm text-[var(--tg-theme-hint-color)] space-y-1 list-decimal list-inside">
                            <li>Check permissions when the app becomes active</li>
                            <li>Handle authentication failures gracefully</li>
                            <li>Provide clear instructions to re-enable permissions</li>
                            <li>Keep saved tokens (they'll work once permissions are restored)</li>
                        </ol>
                    </div>

                    <div className="p-4 bg-green-500/10 border border-green-500/30 rounded">
                        <h4 className="font-semibold text-green-600 dark:text-green-400 mb-2">
                            Best Practice: Backend Integration
                        </h4>
                        <p className="text-sm">
                            Always generate tokens on your backend and verify them after authentication.
                            This ensures the biometric flow is secure and integrated with your auth system.
                        </p>
                    </div>

                    <div className="p-4 bg-[var(--tg-theme-secondary-bg-color)] rounded">
                        <h4 className="font-semibold mb-2">When Can You Open Settings?</h4>
                        <p className="text-sm text-[var(--tg-theme-hint-color)]">
                            The <code className="px-1 py-0.5 bg-[var(--tg-theme-bg-color)] rounded text-xs">openSettings()</code> method
                            only works when biometric access has been requested but denied. This opens the system settings
                            where users can manually enable biometric permissions for Telegram.
                        </p>
                    </div>
                </div>
            </DemoSection>
        </div>
    )
}


/components/demos/ButtonsDemo.tsx

// components/demos/ButtonsDemo.tsx
'use client'

import { useState, useEffect } from 'react'
import { useTelegram } from '@/providers/TelegramProvider'
import DemoSection from '@/components/DemoSection'
import CodeBlock from '@/components/CodeBlock'

export default function ButtonsDemo() {
    const { webApp } = useTelegram()
    const [mainButtonClicks, setMainButtonClicks] = useState(0)
    const [isMainButtonVisible, setIsMainButtonVisible] = useState(true)
    const [isProgressVisible, setIsProgressVisible] = useState(false)
    const [isSettingsVisible, setIsSettingsVisible] = useState(false)
    const [isSecondaryVisible, setIsSecondaryVisible] = useState(true)
    const [isBackButtonVisible, setIsBackButtonVisible] = useState(true)
    const [secondaryPosition, setSecondaryPosition] = useState<'left' | 'right' | 'top' | 'bottom'>('bottom')

    useEffect(() => {
        if (!webApp) return

        // Setup Main Button
        webApp.MainButton.setParams({
            text: 'Click Me! üéÆ',
            color: '#FF6B6B',
            has_shine_effect: true,
            is_visible: true,
        })

        const handleMainClick = () => {
            setMainButtonClicks(c => c + 1)
            webApp.HapticFeedback.impactOccurred('medium')
        }

        webApp.MainButton.onClick(handleMainClick)

        // Setup Secondary Button
        webApp.SecondaryButton.setParams({
            text: 'Secondary Action',
            is_visible: true,
        })

        // Setup Back Button
        webApp.BackButton.show()
        webApp.BackButton.onClick(() => {
            webApp.showAlert('Back button pressed!')
        })

        // Initialize states based on actual button visibility
        setIsSecondaryVisible(webApp.SecondaryButton.isVisible)
        setIsBackButtonVisible(webApp.BackButton.isVisible)

        return () => {
            webApp.MainButton.offClick(handleMainClick)
            webApp.MainButton.hide()
            webApp.SecondaryButton.hide()
            webApp.BackButton.hide()
        }
    }, [webApp])

    const toggleMainButton = () => {
        if (webApp?.MainButton.isVisible) {
            webApp?.MainButton.hide()
            setIsMainButtonVisible(false)
        } else {
            webApp?.MainButton.show()
            setIsMainButtonVisible(true)
        }
    }

    const toggleProgress = () => {
        if (webApp?.MainButton.isProgressVisible) {
            webApp?.MainButton.hideProgress()
            setIsProgressVisible(false)
        } else {
            webApp?.MainButton.showProgress()
            setIsProgressVisible(true)
        }
    }

    const changeSecondaryPosition = () => {
        const positions: Array<'left' | 'right' | 'top' | 'bottom'> = ['left', 'top', 'right', 'bottom']
        const currentIndex = positions.indexOf(secondaryPosition)
        const nextPosition = positions[(currentIndex + 1) % positions.length]
        if (webApp?.SecondaryButton) {
            webApp.SecondaryButton.position = nextPosition
            setSecondaryPosition(nextPosition)
        }
    }

    const toggleSettingsButton = () => {
        if (webApp?.SettingsButton.isVisible) {
            webApp.SettingsButton.hide()
            setIsSettingsVisible(false)
        } else {
            webApp?.SettingsButton.show()
            setIsSettingsVisible(true)
        }
    }

    const toggleSecondaryButton = () => {
        if (webApp?.SecondaryButton.isVisible) {
            webApp.SecondaryButton.hide()
            setIsSecondaryVisible(false)
        } else {
            webApp?.SecondaryButton.show()
            setIsSecondaryVisible(true)
        }
    }

    const toggleBackButton = () => {
        if (webApp?.BackButton.isVisible) {
            webApp.BackButton.hide()
            setIsBackButtonVisible(false)
        } else {
            webApp?.BackButton.show()
            setIsBackButtonVisible(true)
        }
    }

    return (
        <div className="space-y-6">
            <DemoSection title="üîò Main Button">
                <div className="space-y-4">
                    <div className="p-3 bg-[var(--tg-theme-secondary-bg-color)] rounded">
                        <p className="text-sm">Main button clicks: <span className="font-bold">{mainButtonClicks}</span></p>
                        <p className="text-sm">Visibility: <span className="font-bold">{isMainButtonVisible ? 'Visible' : 'Hidden'}</span></p>
                        <p className="text-sm">Progress: <span className="font-bold">{isProgressVisible ? 'Showing' : 'Hidden'}</span></p>
                    </div>

                    <div className="grid grid-cols-1 gap-3">
                        <button onClick={toggleMainButton} className="btn-primary w-full">
                            {isMainButtonVisible ? 'üôà Hide' : 'üëÅÔ∏è Show'} Main Button
                        </button>

                        <button onClick={toggleProgress} className="btn-primary w-full">
                            {isProgressVisible ? '‚è∏Ô∏è Hide' : '‚ñ∂Ô∏è Show'} Progress
                        </button>

                        <button
                            onClick={() => webApp?.MainButton.setText(`Clicks: ${mainButtonClicks}`)}
                            className="btn-primary w-full"
                        >
                            üìù Update Text to "Clicks: {mainButtonClicks}"
                        </button>

                        <button
                            onClick={() => {
                                webApp?.MainButton.setText('Loading...')
                                webApp?.MainButton.showProgress()
                                setIsProgressVisible(true)
                                setTimeout(() => {
                                    webApp?.MainButton.hideProgress()
                                    webApp?.MainButton.setText('Done! ‚úÖ')
                                    setIsProgressVisible(false)
                                }, 2000)
                            }}
                            className="btn-primary w-full"
                        >
                            üé¨ Demo Loading State (2s)
                        </button>
                    </div>
                </div>

                <CodeBlock language="typescript">
                    {`// Main Button setup
webApp.MainButton.setParams({
  text: 'Start Game',
  color: '#FF6B6B',
  has_shine_effect: true,
  is_visible: true
})

webApp.MainButton.onClick(() => {
  // Handle click
  startGame()
})

// Show progress
webApp.MainButton.showProgress()

// Update dynamically
webApp.MainButton.setText('Loading...')`}
                </CodeBlock>
            </DemoSection>

            <DemoSection title="üî≤ Secondary Button">
                <div className="space-y-4">
                    <div className="p-3 bg-[var(--tg-theme-secondary-bg-color)] rounded">
                        <p className="text-sm">Visibility: <span className="font-bold">{isSecondaryVisible ? 'Visible' : 'Hidden'}</span></p>
                        <p className="text-sm">Current position: <span className="font-bold">{secondaryPosition}</span></p>
                        <p className="text-xs text-[var(--tg-theme-hint-color)] mt-1">
                            Secondary button appears alongside the main button
                        </p>
                    </div>

                    <div className="grid grid-cols-1 gap-3">
                        <button onClick={changeSecondaryPosition} className="btn-primary w-full">
                            üîÑ Change Position to{' '}
                            {secondaryPosition === 'bottom' ? 'Left' :
                                secondaryPosition === 'left' ? 'Top' :
                                    secondaryPosition === 'top' ? 'Right' : 'Bottom'}
                        </button>

                        <button
                            onClick={toggleSecondaryButton}
                            className="btn-primary w-full"
                        >
                            {isSecondaryVisible ? 'üôà Hide' : 'üëÅÔ∏è Show'} Secondary Button
                        </button>
                    </div>
                </div>

                <CodeBlock language="typescript">
                    {`// Secondary Button with position
webApp.SecondaryButton.setParams({
  text: 'Options',
  is_visible: true
})

// Change position
webApp.SecondaryButton.position = 'left'

webApp.SecondaryButton.onClick(() => {
  showOptions()
})`}
                </CodeBlock>
            </DemoSection>

            <DemoSection title="‚¨ÖÔ∏è Navigation Buttons">
                <div className="space-y-4">
                    <div className="p-3 bg-[var(--tg-theme-secondary-bg-color)] rounded">
                        <p className="text-sm">Settings Button: <span className="font-bold">{isSettingsVisible ? 'Visible' : 'Hidden'}</span></p>
                        <p className="text-sm">Back Button: <span className="font-bold">{isBackButtonVisible ? 'Visible' : 'Hidden'}</span></p>
                        <p className="text-xs text-[var(--tg-theme-hint-color)] mt-2">
                            Navigation buttons appear in the Mini App header
                        </p>
                    </div>

                    <div className="grid grid-cols-1 gap-3">
                        <button
                            onClick={toggleSettingsButton}
                            className="btn-primary w-full"
                        >
                            {isSettingsVisible ? 'üôà Hide' : '‚öôÔ∏è Show'} Settings Button
                        </button>

                        <button
                            onClick={toggleBackButton}
                            className="btn-primary w-full"
                        >
                            {isBackButtonVisible ? 'üôà Hide' : '‚¨ÖÔ∏è Show'} Back Button
                        </button>
                    </div>
                </div>

                <CodeBlock language="typescript">
                    {`// Back Button
webApp.BackButton.show()
webApp.BackButton.onClick(() => {
  navigateBack()
})

// Settings Button  
webApp.SettingsButton.show()
webApp.SettingsButton.onClick(() => {
  openSettings()
})`}
                </CodeBlock>
            </DemoSection>

            <DemoSection title="üí° Button States Demo">
                <div className="space-y-4">
                    <p className="text-sm text-[var(--tg-theme-hint-color)]">
                        Try these button combinations to see how they work together:
                    </p>

                    <div className="grid grid-cols-1 gap-3">
                        <button
                            onClick={() => {
                                // Show loading state
                                webApp?.MainButton.show()
                                webApp?.MainButton.setText('Processing...')
                                webApp?.MainButton.showProgress()
                                webApp?.MainButton.disable()
                                setIsMainButtonVisible(true)
                                setIsProgressVisible(true)
                            }}
                            className="btn-secondary w-full"
                        >
                            üîÑ Set Loading State
                        </button>

                        <button
                            onClick={() => {
                                // Show success state
                                webApp?.MainButton.show()
                                webApp?.MainButton.setText('Success! ‚úÖ')
                                webApp?.MainButton.hideProgress()
                                webApp?.MainButton.enable()
                                webApp?.MainButton.setParams({ color: '#4CAF50' })
                                setIsMainButtonVisible(true)
                                setIsProgressVisible(false)
                            }}
                            className="btn-secondary w-full"
                        >
                            ‚úÖ Set Success State
                        </button>

                        <button
                            onClick={() => {
                                // Reset to default
                                webApp?.MainButton.setParams({
                                    text: 'Click Me! üéÆ',
                                    color: '#FF6B6B',
                                    has_shine_effect: true,
                                    is_visible: true,
                                })
                                webApp?.MainButton.hideProgress()
                                webApp?.MainButton.enable()
                                setIsMainButtonVisible(true)
                                setIsProgressVisible(false)
                            }}
                            className="btn-secondary w-full"
                        >
                            üîÑ Reset to Default
                        </button>
                    </div>
                </div>
            </DemoSection>
        </div>
    )
}


/components/demos/CoreApiDemo.tsx

// components/demos/CoreApiDemo.tsx
'use client'

import { useState, useEffect } from 'react'
import { useTelegram } from '@/providers/TelegramProvider'
import DemoSection from '@/components/DemoSection'
import CodeBlock from '@/components/CodeBlock'
import ColorPicker from '@/components/ColorPicker'

export default function CoreApiDemo() {
    const { webApp } = useTelegram()
    const [clipboardText, setClipboardText] = useState<string | null>(null)
    const [isClosingConfirmationEnabled, setIsClosingConfirmationEnabled] = useState(false)
    const [isFullscreen, setIsFullscreen] = useState(false)
    const [isExpanded, setIsExpanded] = useState(false)
    const [mediaPermissions, setMediaPermissions] = useState({
        video: '',
        audio: '',
        audioVideo: ''
    })

    // Add color states
    const [customColors, setCustomColors] = useState({
        header: webApp?.headerColor || '#000000',
        background: webApp?.backgroundColor || '#ffffff',
        bottomBar: webApp?.bottomBarColor || '#000000'
    })

    // Initialize states and listen for changes
    useEffect(() => {
        if (webApp) {
            // Initialize states
            setIsClosingConfirmationEnabled(webApp.isClosingConfirmationEnabled)
            setIsFullscreen(webApp.isFullscreen)
            setIsExpanded(webApp.isExpanded)

            // Listen for fullscreen changes
            const handleFullscreenChanged = () => {
                setIsFullscreen(webApp.isFullscreen)
            }

            webApp.onEvent('fullscreenChanged', handleFullscreenChanged)

            // Cleanup
            return () => {
                webApp.offEvent('fullscreenChanged', handleFullscreenChanged)
            }
        }
    }, [webApp])

    const toggleClosingConfirmation = () => {
        if (!webApp) return

        if (isClosingConfirmationEnabled) {
            webApp.disableClosingConfirmation()
            setIsClosingConfirmationEnabled(false)
        } else {
            webApp.enableClosingConfirmation()
            setIsClosingConfirmationEnabled(true)
        }
    }

    const toggleFullscreen = () => {
        if (!webApp) return

        if (isFullscreen) {
            webApp.exitFullscreen()
        } else {
            webApp.requestFullscreen()
        }
    }

    const expandApp = () => {
        if (!webApp) return
        webApp.expand()
        setIsExpanded(true)
    }

    const readClipboard = () => {
        // Check if webApp is available
        if (!webApp) {
            console.error('WebApp not available')
            return
        }

        // Check version support
        if (!webApp.isVersionAtLeast('6.9')) {
            webApp.showAlert('Clipboard API requires Telegram version 6.9 or higher. Your version: ' + webApp.version)
            webApp.HapticFeedback.notificationOccurred('error')
            return
        }

        try {
            webApp.readTextFromClipboard((text: string | null) => {
                console.log('Clipboard response:', text)

                // Update state with the clipboard content
                setClipboardText(text === null ? null : text)

                if (text !== null) {
                    // Successfully read clipboard
                    webApp.HapticFeedback.notificationOccurred('success')
                    if (text === '') {
                        webApp.showAlert('Clipboard is empty')
                    } else {
                        webApp.showAlert(`Clipboard content: ${text}`)
                    }
                } else {
                    // Failed to read clipboard
                    webApp.HapticFeedback.notificationOccurred('error')
                    webApp.showAlert('Failed to read clipboard. Please check permissions and try again.')
                }
            })
        } catch (error) {
            console.error('Clipboard read error:', error)
            webApp.HapticFeedback.notificationOccurred('error')
            webApp.showAlert('Clipboard API error. Please try again.')
        }
    }

    const requestWriteAccess = () => {
        webApp?.requestWriteAccess((granted: boolean) => {
            webApp.showAlert(`Write access ${granted ? 'granted' : 'denied'}`)
            webApp.HapticFeedback.notificationOccurred(granted ? 'success' : 'error')
        })
    }

    const requestContact = () => {
        webApp?.requestContact((sent: boolean, event?: any) => {
            webApp.showAlert(`Contact ${sent ? 'sent' : 'cancelled'}`)
            webApp.HapticFeedback.notificationOccurred(sent ? 'success' : 'error')
        })
    }

    const requestVideo = () => {
        if (navigator.mediaDevices && navigator.mediaDevices.getUserMedia) {
            navigator.mediaDevices.getUserMedia({ video: true })
                .then((stream) => {
                    // Important: Stop the stream immediately after getting permission
                    stream.getTracks().forEach(track => track.stop());

                    setMediaPermissions(prev => ({ ...prev, video: 'granted' }))
                    webApp?.HapticFeedback.notificationOccurred('success')
                    webApp?.showAlert('Video permission granted')
                })
                .catch((error) => {
                    console.log('Video permission denied:', error.name, error.message)
                    setMediaPermissions(prev => ({ ...prev, video: 'denied' }))
                    webApp?.HapticFeedback.notificationOccurred('error')

                    // Handle different error types
                    if (error.name === 'NotAllowedError' || error.name === 'PermissionDeniedError') {
                        webApp?.showAlert('Video permission denied by user')
                    } else if (error.name === 'NotFoundError') {
                        webApp?.showAlert('No video device found')
                    } else {
                        webApp?.showAlert('Video permission denied')
                    }
                })
        } else {
            webApp?.showAlert('Media devices not supported')
        }
    }

    const requestAudio = () => {
        if (navigator.mediaDevices && navigator.mediaDevices.getUserMedia) {
            navigator.mediaDevices.getUserMedia({ audio: true })
                .then((stream) => {
                    // Important: Stop the stream immediately after getting permission
                    stream.getTracks().forEach(track => track.stop());

                    setMediaPermissions(prev => ({ ...prev, audio: 'granted' }))
                    webApp?.HapticFeedback.notificationOccurred('success')
                    webApp?.showAlert('Audio permission granted')
                })
                .catch((error) => {
                    console.log('Audio permission denied:', error.name, error.message)
                    setMediaPermissions(prev => ({ ...prev, audio: 'denied' }))
                    webApp?.HapticFeedback.notificationOccurred('error')

                    // Handle different error types
                    if (error.name === 'NotAllowedError' || error.name === 'PermissionDeniedError') {
                        webApp?.showAlert('Audio permission denied by user')
                    } else if (error.name === 'NotFoundError') {
                        webApp?.showAlert('No audio device found')
                    } else {
                        webApp?.showAlert('Audio permission denied')
                    }
                })
        } else {
            webApp?.showAlert('Media devices not supported')
        }
    }

    const requestAudioVideo = () => {
        if (navigator.mediaDevices && navigator.mediaDevices.getUserMedia) {
            navigator.mediaDevices.getUserMedia({ audio: true, video: true })
                .then((stream) => {
                    // Important: Stop the stream immediately after getting permission
                    stream.getTracks().forEach(track => track.stop());

                    setMediaPermissions(prev => ({ ...prev, audioVideo: 'granted' }))
                    webApp?.HapticFeedback.notificationOccurred('success')
                    webApp?.showAlert('Audio and Video permissions granted')
                })
                .catch((error) => {
                    console.log('Audio/Video permission denied:', error.name, error.message)
                    setMediaPermissions(prev => ({ ...prev, audioVideo: 'denied' }))
                    webApp?.HapticFeedback.notificationOccurred('error')

                    // Handle different error types
                    if (error.name === 'NotAllowedError' || error.name === 'PermissionDeniedError') {
                        webApp?.showAlert('Audio and/or Video permissions denied by user')
                    } else if (error.name === 'NotFoundError') {
                        webApp?.showAlert('Audio and/or Video devices not found')
                    } else {
                        webApp?.showAlert('Audio and/or Video permissions denied')
                    }
                })
        } else {
            webApp?.showAlert('Media devices not supported')
        }
    }

    const versions = ['6.0', '6.1', '6.9', '7.0', '7.2', '7.7', '8.0']

    return (
        <div className="space-y-6">
            <DemoSection title="üìã WebApp Information">
                <div className="grid grid-cols-2 gap-2 text-sm">
                    <div>Version: <span className="font-semibold">{webApp?.version}</span></div>
                    <div>Platform: <span className="font-semibold">{webApp?.platform}</span></div>
                    <div>Color Scheme: <span className="font-semibold">{webApp?.colorScheme}</span></div>
                    <div>Is Expanded: <span className="font-semibold">{isExpanded ? 'Yes' : 'No'}</span></div>
                    <div>Is Active: <span className="font-semibold">{webApp?.isActive ? 'Yes' : 'No'}</span></div>
                    <div>Is Fullscreen: <span className="font-semibold">{isFullscreen ? 'Yes' : 'No'}</span></div>
                    <div>Closing Confirmation: <span className="font-semibold">{isClosingConfirmationEnabled ? 'Yes' : 'No'}</span></div>
                </div>

                <CodeBlock language="typescript">
                    {`// Access WebApp info
const { webApp } = useTelegram()
console.log(webApp.version)
console.log(webApp.platform)
console.log(webApp.colorScheme)
console.log(webApp.isExpanded)
console.log(webApp.isActive)
console.log(webApp.isFullscreen)
console.log(webApp.isClosingConfirmationEnabled)`}
                </CodeBlock>
            </DemoSection>

            <DemoSection title="üìê App Control">
                <div className="space-y-4">
                    <button
                        onClick={expandApp}
                        className="btn-primary w-full"
                        disabled={isExpanded}
                    >
                        {isExpanded ? '‚úÖ Already Expanded' : 'üìè Expand WebApp'}
                    </button>

                    <button
                        onClick={toggleFullscreen}
                        className="btn-primary w-full"
                    >
                        {isFullscreen ? 'üî≥ Exit Fullscreen' : 'üî≤ Enter Fullscreen'}
                    </button>

                    <button
                        onClick={toggleClosingConfirmation}
                        className="btn-primary w-full"
                    >
                        {isClosingConfirmationEnabled ? 'üîì Disable' : 'üîí Enable'} Closing Confirmation
                    </button>

                    <button
                        onClick={() => webApp?.close()}
                        className="btn-primary w-full bg-red-500"
                    >
                        ‚ùå Close App (Direct)
                    </button>

                    <div className="p-4 bg-[var(--tg-theme-secondary-bg-color)] rounded">
                        <h4 className="font-semibold mb-2">üì± Testing Closing Confirmation</h4>
                        <p className="text-sm text-[var(--tg-theme-hint-color)] mb-3">
                            The closing confirmation is currently:
                            <span className="font-bold ml-1">{isClosingConfirmationEnabled ? 'Enabled ‚úÖ' : 'Disabled ‚ùå'}</span>
                        </p>
                        <p className="text-sm text-[var(--tg-theme-hint-color)] mb-2">
                            To test the closing confirmation:
                        </p>
                        <ul className="text-sm text-[var(--tg-theme-hint-color)] space-y-1 list-disc list-inside">
                            <li>Try to swipe down from the top of the screen</li>
                            <li>Or press the device's back button</li>
                            <li>Or click the X button in the Mini App header</li>
                        </ul>
                        <p className="text-sm text-[var(--tg-theme-hint-color)] mt-3">
                            <strong>Note:</strong> The "Close App" button above calls webApp.close() directly,
                            which bypasses the confirmation dialog.
                        </p>
                    </div>
                </div>

                <CodeBlock language="typescript">
                    {`// Expand app to full height
webApp.expand()

// Enter fullscreen mode
webApp.requestFullscreen()

// Exit fullscreen mode
webApp.exitFullscreen()

// Check fullscreen state
if (webApp.isFullscreen) {
  console.log('App is in fullscreen mode')
}

// Enable closing confirmation (for swipe/back button)
webApp.enableClosingConfirmation()

// Disable closing confirmation
webApp.disableClosingConfirmation()

// Check current state
if (webApp.isClosingConfirmationEnabled) {
  console.log('User will see confirmation on swipe/back')
}

// Direct close (no confirmation)
webApp.close()

// Listen for fullscreen changes
webApp.onEvent('fullscreenChanged', () => {
  console.log('Fullscreen:', webApp.isFullscreen)
})

// The confirmation only appears when:
// - User swipes down
// - User presses back button
// - User clicks X in header`}
                </CodeBlock>
            </DemoSection>

            <DemoSection title="üé® Theme Management">
                <div className="space-y-4">
                    {/* Color Picker Section */}
                    <div className="p-4 bg-[var(--tg-theme-secondary-bg-color)] rounded-lg space-y-4">
                        <h4 className="font-semibold">Custom Color Picker</h4>

                        <ColorPicker
                            label="Header Color"
                            value={customColors.header}
                            presets={[
                                { label: 'Default (bg_color)', value: 'bg_color' },
                                { label: 'Secondary', value: 'secondary_bg_color' },
                            ]}
                            onChange={(color) => {
                                setCustomColors(prev => ({ ...prev, header: color }))
                                webApp?.setHeaderColor(color)
                            }}
                        />

                        <ColorPicker
                            label="Background Color"
                            value={customColors.background}
                            presets={[
                                { label: 'Default (bg_color)', value: 'bg_color' },
                                { label: 'Secondary', value: 'secondary_bg_color' },
                            ]}
                            onChange={(color) => {
                                setCustomColors(prev => ({ ...prev, background: color }))
                                webApp?.setBackgroundColor(color)
                            }}
                        />

                        <ColorPicker
                            label="Bottom Bar Color"
                            value={customColors.bottomBar}
                            presets={[
                                { label: 'Default (bg_color)', value: 'bg_color' },
                                { label: 'Secondary', value: 'secondary_bg_color' },
                                { label: 'Bottom Bar', value: 'bottom_bar_bg_color' },
                            ]}
                            onChange={(color) => {
                                setCustomColors(prev => ({ ...prev, bottomBar: color }))
                                webApp?.setBottomBarColor(color)
                            }}
                        />
                    </div>

                    {/* Quick Preset Buttons */}
                    <div className="space-y-3">
                        <h4 className="font-semibold">Quick Presets</h4>
                        <div className="grid grid-cols-2 gap-2">
                            <button
                                onClick={() => {
                                    webApp?.setHeaderColor('secondary_bg_color')
                                    webApp?.setBackgroundColor('bg_color')
                                    webApp?.setBottomBarColor('secondary_bg_color')

                                    // Update color pickers with actual theme colors
                                    setCustomColors({
                                        header: webApp?.themeParams.secondary_bg_color || '#f0f0f0',
                                        background: webApp?.themeParams.bg_color || '#ffffff',
                                        bottomBar: webApp?.themeParams.secondary_bg_color || '#f0f0f0'
                                    })
                                }}
                                className="btn-primary"
                            >
                                Default Theme
                            </button>
                            <button
                                onClick={() => {
                                    webApp?.setHeaderColor('#1a1a1a')
                                    webApp?.setBackgroundColor('#000000')
                                    webApp?.setBottomBarColor('#1a1a1a')
                                    setCustomColors({
                                        header: '#1a1a1a',
                                        background: '#000000',
                                        bottomBar: '#1a1a1a'
                                    })
                                }}
                                className="btn-primary"
                            >
                                Dark Theme
                            </button>
                            <button
                                onClick={() => {
                                    webApp?.setHeaderColor('#4CAF50')
                                    webApp?.setBackgroundColor('#E8F5E9')
                                    webApp?.setBottomBarColor('#4CAF50')
                                    setCustomColors({
                                        header: '#4CAF50',
                                        background: '#E8F5E9',
                                        bottomBar: '#4CAF50'
                                    })
                                }}
                                className="btn-primary"
                            >
                                Green Theme
                            </button>
                            <button
                                onClick={() => {
                                    webApp?.setHeaderColor('#2196F3')
                                    webApp?.setBackgroundColor('#E3F2FD')
                                    webApp?.setBottomBarColor('#2196F3')
                                    setCustomColors({
                                        header: '#2196F3',
                                        background: '#E3F2FD',
                                        bottomBar: '#2196F3'
                                    })
                                }}
                                className="btn-primary"
                            >
                                Blue Theme
                            </button>
                        </div>
                    </div>

                    {/* Current Theme Values */}
                    <div className="p-3 bg-[var(--tg-theme-secondary-bg-color)] rounded text-sm space-y-1">
                        <div className="font-semibold mb-2">Current Theme Values:</div>
                        <div className="grid grid-cols-2 gap-2 text-xs">
                            <div>bg_color: <span className="font-mono">{webApp?.themeParams.bg_color}</span></div>
                            <div>text_color: <span className="font-mono">{webApp?.themeParams.text_color}</span></div>
                            <div>hint_color: <span className="font-mono">{webApp?.themeParams.hint_color}</span></div>
                            <div>link_color: <span className="font-mono">{webApp?.themeParams.link_color}</span></div>
                            <div>button_color: <span className="font-mono">{webApp?.themeParams.button_color}</span></div>
                            <div>button_text_color: <span className="font-mono">{webApp?.themeParams.button_text_color}</span></div>
                        </div>
                    </div>
                </div>

                <CodeBlock language="typescript">
                    {`// Theme customization
webApp.setHeaderColor('#4CAF50')
webApp.setBackgroundColor('#E8F5E9')
webApp.setBottomBarColor('#4CAF50')

// Use theme variables
webApp.setHeaderColor('secondary_bg_color')
webApp.setBackgroundColor('bg_color')

// Access theme parameters
const theme = webApp.themeParams
console.log(theme.bg_color)
console.log(theme.button_color)`}
                </CodeBlock>
            </DemoSection>

            <DemoSection title="üîê Permissions">
                <div className="space-y-4">
                    <div className="grid grid-cols-2 gap-2">
                        <button
                            onClick={readClipboard}
                            className="btn-primary"
                            disabled={!webApp?.isVersionAtLeast('6.9')}
                        >
                            Read Clipboard
                        </button>
                        <button onClick={requestWriteAccess} className="btn-primary">
                            Write Access
                        </button>
                    </div>

                    {!webApp?.isVersionAtLeast('6.9') && (
                        <div className="p-2 bg-yellow-500/20 rounded text-xs text-center">
                            Clipboard API requires version 6.9+
                        </div>
                    )}

                    {clipboardText !== null && (
                        <div className="p-3 bg-[var(--tg-theme-secondary-bg-color)] rounded">
                            <div className="font-semibold text-sm mb-1">Clipboard Content:</div>
                            <div className="font-mono text-sm break-all">
                                {clipboardText === '' ? '(clipboard is empty)' : clipboardText}
                            </div>
                        </div>
                    )}

                    <button onClick={requestContact} className="btn-primary w-full">
                        Request Contact
                    </button>

                    <div className="border-t pt-4 mt-4">
                        <h4 className="font-semibold mb-3">Media Permissions</h4>
                        <div className="grid grid-cols-3 gap-2">
                            <button onClick={requestVideo} className="btn-primary">
                                üìπ Video
                            </button>
                            <button onClick={requestAudio} className="btn-primary">
                                üé§ Audio
                            </button>
                            <button onClick={requestAudioVideo} className="btn-primary">
                                üìπ+üé§ Both
                            </button>
                        </div>

                        {(mediaPermissions.video || mediaPermissions.audio || mediaPermissions.audioVideo) && (
                            <div className="mt-3 space-y-1 text-sm">
                                {mediaPermissions.video && (
                                    <div>Video: <span className={mediaPermissions.video === 'granted' ? 'text-green-500' : 'text-red-500'}>
                                        {mediaPermissions.video}
                                    </span></div>
                                )}
                                {mediaPermissions.audio && (
                                    <div>Audio: <span className={mediaPermissions.audio === 'granted' ? 'text-green-500' : 'text-red-500'}>
                                        {mediaPermissions.audio}
                                    </span></div>
                                )}
                                {mediaPermissions.audioVideo && (
                                    <div>Audio+Video: <span className={mediaPermissions.audioVideo === 'granted' ? 'text-green-500' : 'text-red-500'}>
                                        {mediaPermissions.audioVideo}
                                    </span></div>
                                )}
                            </div>
                        )}
                    </div>
                </div>

                <CodeBlock language="typescript">
                    {`// Request permissions
webApp.readTextFromClipboard((text) => {
  console.log('Clipboard text:', text)
})

webApp.requestWriteAccess((granted) => {
  if (granted) {
    // Can now write to messages
  }
})

webApp.requestContact((sent) => {
  if (sent) {
    // Contact shared with bot
  }
})

// Media permissions
navigator.mediaDevices.getUserMedia({ 
  video: true,
  audio: true 
}).then((stream) => {
  // Access granted
}).catch((err) => {
  // Access denied
})`}
                </CodeBlock>
            </DemoSection>

            <DemoSection title="üîç Version Check">
                <div className="space-y-4">
                    <div className="p-4 bg-[var(--tg-theme-secondary-bg-color)] rounded-lg">
                        <h4 className="font-semibold mb-3">Current Version: {webApp?.version}</h4>
                        <div className="space-y-2">
                            {versions.map(version => {
                                const isSupported = webApp?.isVersionAtLeast(version) || false
                                return (
                                    <div key={version} className="flex items-center justify-between text-sm">
                                        <span>Version {version}</span>
                                        <span className={`font-semibold ${isSupported ? 'text-green-500' : 'text-red-500'}`}>
                                            {isSupported ? '‚úÖ Supported' : '‚ùå Not Supported'}
                                        </span>
                                    </div>
                                )
                            })}
                        </div>
                    </div>

                    <div className="p-3 bg-blue-500/10 border border-blue-500/30 rounded">
                        <h4 className="font-semibold text-blue-600 dark:text-blue-400 mb-2">
                            Version Features Guide
                        </h4>
                        <ul className="text-sm space-y-1">
                            <li>‚Ä¢ v6.0: Basic Mini App features</li>
                            <li>‚Ä¢ v6.1: Cloud Storage, Haptic Feedback</li>
                            <li>‚Ä¢ v6.9: QR Scanner, Clipboard API</li>
                            <li>‚Ä¢ v7.0: Biometrics, Story Sharing</li>
                            <li>‚Ä¢ v7.2: Secondary Button, Swipe Control</li>
                            <li>‚Ä¢ v7.7: Home Screen, Emoji Status</li>
                            <li>‚Ä¢ v8.0: Accelerometer, Gyroscope, Location</li>
                        </ul>
                    </div>
                </div>

                <CodeBlock language="typescript">
                    {`// Check version support before using features
if (webApp.isVersionAtLeast('7.0')) {
  // Safe to use biometrics
  webApp.BiometricManager.init()
}

if (webApp.isVersionAtLeast('6.9')) {
  // Safe to use QR scanner
  webApp.showScanQrPopup(...)
}

if (webApp.isVersionAtLeast('8.0')) {
  // Safe to use sensors
  webApp.Accelerometer.start()
  webApp.Gyroscope.start()
}

// Always check version for new features
const canUseBiometrics = webApp.isVersionAtLeast('7.0')
const canUseLocation = webApp.isVersionAtLeast('8.0')`}
                </CodeBlock>
            </DemoSection>
        </div>
    )
}


/components/demos/EmojiStatusDemo.tsx

// components/demos/EmojiStatusDemo.tsx
'use client'

import { useState, useEffect } from 'react'
import { useTelegram } from '@/providers/TelegramProvider'
import DemoSection from '@/components/DemoSection'
import CodeBlock from '@/components/CodeBlock'

export default function EmojiStatusDemo() {
    const { webApp, user } = useTelegram()
    const [emojiId, setEmojiId] = useState('5000569394542078246')
    const [duration, setDuration] = useState(300)
    const [hasAccess, setHasAccess] = useState<boolean | null>(null)
    const [lastSetEmoji, setLastSetEmoji] = useState<string | null>(null)
    const [lastSetTime, setLastSetTime] = useState<Date | null>(null)
    const [lastSetDuration, setLastSetDuration] = useState<number>(300)

    // Fun emoji IDs for quick selection
    // These are actual custom emoji IDs from Telegram's emoji packs
    const popularEmojis = [
        { id: '5213305508034783384', name: 'üóø Moai', preview: 'üóø' },
        { id: '5323753070247552140', name: 'üëª Ghost', preview: 'üëª' },
        { id: '5449505950283078474', name: '‚ù§Ô∏è Red Heart', preview: '‚ù§Ô∏è' }
    ]

    // Load saved state from localStorage
    useEffect(() => {
        const savedEmoji = localStorage.getItem('lastSetEmoji')
        const savedTime = localStorage.getItem('lastSetEmojiTime')
        const savedDuration = localStorage.getItem('lastSetEmojiDuration')
        const savedAccess = localStorage.getItem('emojiStatusAccess')

        if (savedEmoji) setLastSetEmoji(savedEmoji)
        if (savedTime) setLastSetTime(new Date(savedTime))
        if (savedDuration) setLastSetDuration(parseInt(savedDuration))
        if (savedAccess) setHasAccess(savedAccess === 'true')
    }, [])

    const setEmojiStatus = () => {
        if (!webApp?.isVersionAtLeast('7.7')) {
            webApp?.showAlert('Emoji status requires Telegram version 7.7 or higher')
            return
        }

        console.log('Setting emoji status:', emojiId, 'duration:', duration)

        webApp?.setEmojiStatus(
            emojiId,
            duration > 0 ? { duration } : { duration: 0 }, // Explicitly set duration:0 for permanent
            (set: boolean) => {
                console.log('Emoji status set result:', set)
                webApp.HapticFeedback.notificationOccurred(set ? 'success' : 'error')

                if (set) {
                    setLastSetEmoji(emojiId)
                    setLastSetTime(new Date())
                    setLastSetDuration(duration)

                    // Save to localStorage
                    localStorage.setItem('lastSetEmoji', emojiId)
                    localStorage.setItem('lastSetEmojiTime', new Date().toISOString())
                    localStorage.setItem('lastSetEmojiDuration', duration.toString())

                    const selectedEmoji = popularEmojis.find(e => e.id === emojiId)
                    const emojiName = selectedEmoji ? selectedEmoji.name : 'Custom emoji'
                    webApp.showAlert(`${emojiName} status set! It will appear next to your name in chats.`)
                } else {
                    webApp.showAlert('Failed to set status. Make sure you have granted access.')
                }
            }
        )
    }

    const requestAccess = () => {
        console.log('Requesting emoji status access...')
        webApp?.requestEmojiStatusAccess((allowed: boolean) => {
            console.log('Emoji status access result:', allowed)
            setHasAccess(allowed)
            localStorage.setItem('emojiStatusAccess', allowed.toString())
            webApp.showAlert(`Emoji status access ${allowed ? 'granted' : 'denied'}`)

            if (allowed) {
                webApp.HapticFeedback.notificationOccurred('success')
            }
        })
    }

    const formatDuration = (seconds: number) => {
        if (seconds === 0) return 'Permanent'
        if (seconds < 60) return `${seconds} seconds`
        if (seconds < 3600) return `${Math.floor(seconds / 60)} minutes`
        if (seconds < 86400) return `${Math.floor(seconds / 3600)} hours`
        return `${Math.floor(seconds / 86400)} days`
    }

    const getTimeRemaining = () => {
        if (!lastSetTime) return null
        if (lastSetDuration === 0) return 'Permanent status'

        const elapsed = (new Date().getTime() - lastSetTime.getTime()) / 1000
        const remaining = lastSetDuration - elapsed

        if (remaining <= 0) return 'Expired'
        return `Expires in ${formatDuration(Math.floor(remaining))}`
    }

    // Check version support
    const supportsEmojiStatus = webApp?.isVersionAtLeast('7.7') ?? false

    return (
        <div className="space-y-6">
            <DemoSection title="üòä Emoji Status">
                <div className="space-y-4">
                    {/* Version check */}
                    {webApp && !supportsEmojiStatus && (
                        <div className="p-3 bg-yellow-500/20 border border-yellow-500/30 rounded-lg">
                            <p className="text-sm text-yellow-600 dark:text-yellow-400">
                                ‚ö†Ô∏è Emoji status requires Telegram version 7.7 or higher.
                                Your version: {webApp.version}
                            </p>
                        </div>
                    )}

                    {/* User info and current status */}
                    <div className="p-4 bg-[var(--tg-theme-secondary-bg-color)] rounded-lg">
                        <h4 className="font-semibold mb-2">User Info</h4>
                        <div className="space-y-1 text-sm">
                            <p>Name: {user?.first_name} {user?.last_name || ''}</p>
                            <p>Premium: {user?.is_premium ? '‚úÖ Yes' : '‚ùå No'}</p>
                            <p>Access Granted: {hasAccess === null ? '‚ùì Unknown' : hasAccess ? '‚úÖ Yes' : '‚ùå No'}</p>
                        </div>

                        {lastSetEmoji && (
                            <div className="mt-3 pt-3 border-t border-[var(--tg-theme-hint-color)]/20">
                                <p className="text-sm font-semibold">Last Set Status:</p>
                                <div className="flex items-center gap-2 mt-1">
                                    <span className="text-2xl">
                                        {popularEmojis.find(e => e.id === lastSetEmoji)?.preview || '‚ùì'}
                                    </span>
                                    <div>
                                        <p className="text-sm">
                                            {popularEmojis.find(e => e.id === lastSetEmoji)?.name || 'Custom Emoji'}
                                        </p>
                                        <p className="text-xs text-[var(--tg-theme-hint-color)]">
                                            {getTimeRemaining()}
                                        </p>
                                    </div>
                                </div>
                            </div>
                        )}
                    </div>

                    {/* Popular emojis - now in a grid */}
                    <div className="p-4 bg-[var(--tg-theme-secondary-bg-color)] rounded-lg">
                        <h4 className="font-semibold mb-3">Fun Status Emojis</h4>
                        <div className="grid grid-cols-3 gap-2">
                            {popularEmojis.map((emoji) => (
                                <button
                                    key={emoji.id}
                                    onClick={() => setEmojiId(emoji.id)}
                                    className={`p-3 rounded border transition-all ${emojiId === emoji.id
                                            ? 'border-[var(--tg-theme-button-color)] bg-[var(--tg-theme-button-color)]/10 scale-105'
                                            : 'border-[var(--tg-theme-hint-color)]/30 hover:border-[var(--tg-theme-hint-color)]/50'
                                        }`}
                                >
                                    <div className="text-2xl mb-1">{emoji.preview}</div>
                                    <div className="text-xs">{emoji.name.split(' ')[1]}</div>
                                </button>
                            ))}
                        </div>
                    </div>

                    {/* Custom emoji input */}
                    <div>
                        <label className="text-sm text-[var(--tg-theme-hint-color)]">Custom Emoji ID</label>
                        <input
                            type="text"
                            value={emojiId}
                            onChange={(e) => setEmojiId(e.target.value)}
                            placeholder="Enter custom emoji ID"
                            className="w-full p-3 mt-1 rounded bg-[var(--tg-theme-secondary-bg-color)] text-[var(--tg-theme-text-color)]"
                        />
                        <p className="text-xs text-[var(--tg-theme-hint-color)] mt-1">
                            Current: {popularEmojis.find(e => e.id === emojiId)?.name || 'Custom ID'}
                        </p>
                    </div>

                    {/* Duration selector */}
                    <div>
                        <label className="text-sm text-[var(--tg-theme-hint-color)]">
                            Duration: {formatDuration(duration)}
                        </label>
                        <div className="grid grid-cols-4 gap-2 mt-2">
                            <button
                                onClick={() => setDuration(300)}
                                className={`btn-secondary text-sm ${duration === 300 ? 'ring-2 ring-[var(--tg-theme-button-color)]' : ''}`}
                            >
                                5 min
                            </button>
                            <button
                                onClick={() => setDuration(3600)}
                                className={`btn-secondary text-sm ${duration === 3600 ? 'ring-2 ring-[var(--tg-theme-button-color)]' : ''}`}
                            >
                                1 hour
                            </button>
                            <button
                                onClick={() => setDuration(86400)}
                                className={`btn-secondary text-sm ${duration === 86400 ? 'ring-2 ring-[var(--tg-theme-button-color)]' : ''}`}
                            >
                                1 day
                            </button>
                            <button
                                onClick={() => setDuration(0)}
                                className={`btn-secondary text-sm ${duration === 0 ? 'ring-2 ring-[var(--tg-theme-button-color)]' : ''}`}
                            >
                                Forever
                            </button>
                        </div>
                        <input
                            type="range"
                            min="0"
                            max="604800"
                            step="300"
                            value={duration}
                            onChange={(e) => setDuration(parseInt(e.target.value))}
                            className="w-full mt-3"
                        />
                    </div>

                    {/* Action buttons */}
                    <div className="space-y-2">
                        {hasAccess !== true && (
                            <button
                                onClick={requestAccess}
                                className="btn-primary w-full"
                                disabled={!supportsEmojiStatus}
                            >
                                Request Emoji Status Access
                            </button>
                        )}

                        <button
                            onClick={setEmojiStatus}
                            className="btn-primary w-full"
                            disabled={!supportsEmojiStatus || !emojiId}
                        >
                            Set {popularEmojis.find(e => e.id === emojiId)?.preview || ''} Emoji Status
                        </button>
                    </div>

                    {/* Info box */}
                    <div className="p-3 bg-blue-500/10 border border-blue-500/30 rounded-lg">
                        <p className="text-sm text-blue-600 dark:text-blue-400">
                            üí° <strong>Note:</strong> Emoji status appears next to your name in chat lists
                            and messages. Premium users see custom emoji animations.
                        </p>
                    </div>
                </div>

                <CodeBlock language="typescript">
                    {`// Request emoji status access
webApp.requestEmojiStatusAccess((allowed) => {
  if (allowed) {
    // Can now set emoji status
  }
})

// Set emoji status with duration
webApp.setEmojiStatus(
  'custom_emoji_id',
  { duration: 300 }, // 5 minutes (0 for permanent)
  (success) => {
    console.log('Status set:', success)
  }
)`}
                </CodeBlock>
            </DemoSection>

            <DemoSection title="üìù Implementation Notes">
                <div className="space-y-3">
                    <div className="p-3 bg-[var(--tg-theme-secondary-bg-color)] rounded">
                        <h4 className="font-semibold">Finding Custom Emoji IDs</h4>
                        <p className="text-sm text-[var(--tg-theme-hint-color)] mt-1">
                            To get custom emoji IDs, you can use the Bot API's getCustomEmojiStickers
                            method or inspect emoji messages in your bot. Each custom emoji pack has
                            unique IDs for animated emojis.
                        </p>
                    </div>

                    <div className="p-3 bg-[var(--tg-theme-secondary-bg-color)] rounded">
                        <h4 className="font-semibold">Premium Features</h4>
                        <p className="text-sm text-[var(--tg-theme-hint-color)] mt-1">
                            Premium users can see animated custom emojis. Non-premium users will see
                            a static version or fallback emoji.
                        </p>
                    </div>
                </div>
            </DemoSection>
        </div>
    )
}


/components/demos/FileOperationsDemo.tsx

// components/demos/FileOperationsDemo.tsx
'use client'

import { useTelegram } from '@/providers/TelegramProvider'
import DemoSection from '@/components/DemoSection'
import CodeBlock from '@/components/CodeBlock'

export default function FileOperationsDemo() {
    const { webApp } = useTelegram()

    const downloadFile = (url: string, filename: string) => {
        webApp?.downloadFile(
            { url, file_name: filename },
            (downloaded: boolean) => {
                webApp.HapticFeedback.notificationOccurred(downloaded ? 'success' : 'error')
                webApp.showAlert(downloaded ? 'Download started!' : 'Download declined')
            }
        )
    }

    const files = [
        {
            name: 'Sample Image',
            url: 'https://telegra.ph/file/5583ac37c90979f052b7b.png',
            filename: 'sample-image.png'
        },
        {
            name: 'Sample Video',
            url: 'https://telegra.ph/file/61f1dac694c3131a7b4ac.mp4',
            filename: 'sample-video.mp4'
        },
        {
            name: 'Sample PDF',
            url: 'https://pdfobject.com/pdf/sample.pdf',
            filename: 'sample-document.pdf'
        }
    ]

    return (
        <div className="space-y-6">
            <DemoSection title="üì• File Downloads">
                <div className="space-y-3">
                    {files.map((file, index) => (
                        <div
                            key={index}
                            className="flex items-center justify-between p-3 bg-[var(--tg-theme-secondary-bg-color)] rounded"
                        >
                            <span>{file.name}</span>
                            <button
                                onClick={() => downloadFile(file.url, file.filename)}
                                className="btn-primary px-4 py-2"
                            >
                                Download
                            </button>
                        </div>
                    ))}
                </div>

                <CodeBlock language="typescript">
                    {`// Download file
webApp.downloadFile({
  url: 'https://example.com/file.pdf',
  file_name: 'document.pdf'
}, (downloaded) => {
  if (downloaded) {
    console.log('Download started')
  }
})`}
                </CodeBlock>
            </DemoSection>
        </div>
    )
}


/components/demos/GameFeaturesDemo.tsx

// components/demos/GameFeaturesDemo.tsx
'use client'

import { useState, useEffect } from 'react'
import { useTelegram } from '@/providers/TelegramProvider'
import DemoSection from '@/components/DemoSection'
import CodeBlock from '@/components/CodeBlock'

export default function GameFeaturesDemo() {
    const { webApp } = useTelegram()
    const [isFullscreen, setIsFullscreen] = useState(false)
    const [isOrientationLocked, setIsOrientationLocked] = useState(false)
    const [swipesEnabled, setSwipesEnabled] = useState(true)

    useEffect(() => {
        if (!webApp) return

        webApp.onEvent('fullscreenChanged', () => {
            setIsFullscreen(webApp.isFullscreen)
        })

        // Initialize location manager
        webApp.LocationManager.init()

        return () => {
            webApp.offEvent('fullscreenChanged', () => { })
        }
    }, [webApp])

    const toggleFullscreen = () => {
        if (webApp?.isFullscreen) {
            webApp?.exitFullscreen()
        } else {
            webApp?.requestFullscreen()
        }
    }

    const toggleOrientation = () => {
        if (webApp?.isOrientationLocked) {
            webApp?.unlockOrientation()
            setIsOrientationLocked(false)
        } else {
            webApp?.lockOrientation()
            setIsOrientationLocked(true)
        }
    }

    const toggleSwipes = () => {
        if (webApp?.isVerticalSwipesEnabled) {
            webApp?.disableVerticalSwipes()
            setSwipesEnabled(false)
        } else {
            webApp?.enableVerticalSwipes()
            setSwipesEnabled(true)
        }
    }

    return (
        <div className="space-y-6">
            <DemoSection title="üéÆ Game Controls">
                <div className="space-y-4">
                    <button onClick={toggleFullscreen} className="btn-primary w-full">
                        {isFullscreen ? 'Exit' : 'Enter'} Fullscreen
                    </button>

                    <button onClick={toggleOrientation} className="btn-primary w-full">
                        {isOrientationLocked ? 'Unlock' : 'Lock'} Orientation
                    </button>

                    <button onClick={toggleSwipes} className="btn-primary w-full">
                        {swipesEnabled ? 'Disable' : 'Enable'} Vertical Swipes
                        {!swipesEnabled && ' (Good for games!)'}
                    </button>
                </div>

                <CodeBlock language="typescript">
                    {`// Fullscreen for immersive gaming
webApp.requestFullscreen()
webApp.onEvent('fullscreenChanged', () => {
  if (webApp.isFullscreen) {
    showGameUI()
  }
})

// Lock orientation for consistent gameplay
webApp.lockOrientation()

// Disable swipes for game controls
webApp.disableVerticalSwipes()`}
                </CodeBlock>
            </DemoSection>

            <DemoSection title="üéØ Mini Game Example">
                <div className="p-4 bg-[var(--tg-theme-secondary-bg-color)] rounded">
                    <TapGame />
                </div>
            </DemoSection>
        </div>
    )
}

// Mini tap game component
function TapGame() {
    const { webApp } = useTelegram()
    const [score, setScore] = useState(0)
    const [timeLeft, setTimeLeft] = useState(10)
    const [isPlaying, setIsPlaying] = useState(false)

    useEffect(() => {
        if (!isPlaying || timeLeft <= 0) return

        const timer = setTimeout(() => {
            setTimeLeft(timeLeft - 1)
            if (timeLeft === 1) {
                endGame()
            }
        }, 1000)

        return () => clearTimeout(timer)
    }, [isPlaying, timeLeft])

    const startGame = () => {
        setScore(0)
        setTimeLeft(10)
        setIsPlaying(true)
        webApp?.HapticFeedback.notificationOccurred('success')
    }

    const endGame = () => {
        setIsPlaying(false)
        webApp?.HapticFeedback.notificationOccurred('warning')
        webApp?.MainButton.setText(`Score: ${score}`)
        webApp?.MainButton.show()
    }

    const tap = () => {
        if (!isPlaying) return
        setScore(score + 1)
        webApp?.HapticFeedback.impactOccurred('light')
    }

    return (
        <div className="text-center space-y-4">
            <h3 className="text-xl font-bold">Tap Game</h3>

            {!isPlaying ? (
                <button onClick={startGame} className="btn-primary">
                    Start Game
                </button>
            ) : (
                <>
                    <div className="text-3xl font-bold">{timeLeft}s</div>
                    <div className="text-2xl">Score: {score}</div>
                    <button
                        onClick={tap}
                        className="w-32 h-32 bg-[var(--tg-theme-button-color)] rounded-full text-4xl animate-pulse"
                    >
                        üëÜ
                    </button>
                </>
            )}
        </div>
    )
}


/components/demos/HapticsDemo.tsx

// components/demos/HapticsDemo.tsx
'use client'

import { useTelegram } from '@/providers/TelegramProvider'
import DemoSection from '@/components/DemoSection'
import CodeBlock from '@/components/CodeBlock'

export default function HapticsDemo() {
    const { webApp } = useTelegram()

    const impactStyles = ['light', 'medium', 'heavy', 'rigid', 'soft'] as const
    const notificationTypes = ['error', 'success', 'warning'] as const

    return (
        <div className="space-y-6">
            <DemoSection title="üí• Impact Haptics">
                <div className="grid grid-cols-2 gap-2">
                    {impactStyles.map(style => (
                        <button
                            key={style}
                            onClick={() => webApp?.HapticFeedback.impactOccurred(style)}
                            className="btn-primary capitalize"
                        >
                            {style}
                        </button>
                    ))}
                </div>

                <CodeBlock language="typescript">
                    {`// Impact haptics for game events
webApp.HapticFeedback.impactOccurred('light')   // Tap
webApp.HapticFeedback.impactOccurred('medium')  // Button press
webApp.HapticFeedback.impactOccurred('heavy')   // Collision
webApp.HapticFeedback.impactOccurred('rigid')   // Hard stop
webApp.HapticFeedback.impactOccurred('soft')    // Soft bounce`}
                </CodeBlock>
            </DemoSection>

            <DemoSection title="üîî Notification Haptics">
                <div className="grid grid-cols-3 gap-2">
                    {notificationTypes.map(type => (
                        <button
                            key={type}
                            onClick={() => webApp?.HapticFeedback.notificationOccurred(type)}
                            className={`btn-primary capitalize ${type === 'error' ? 'bg-red-500' :
                                type === 'success' ? 'bg-green-500' :
                                    'bg-yellow-500'
                                }`}
                        >
                            {type}
                        </button>
                    ))}
                </div>

                <CodeBlock language="typescript">
                    {`// Notification haptics
webApp.HapticFeedback.notificationOccurred('success') // Level complete
webApp.HapticFeedback.notificationOccurred('error')   // Game over
webApp.HapticFeedback.notificationOccurred('warning') // Low health`}
                </CodeBlock>
            </DemoSection>

            <DemoSection title="üéØ Haptic Patterns">
                <div className="space-y-3">
                    <p className="text-sm text-[var(--tg-theme-hint-color)]">
                        For selection feedback, use light impact:
                    </p>

                    <button
                        onClick={() => webApp?.HapticFeedback.impactOccurred('light')}
                        className="btn-primary w-full"
                    >
                        Selection Feedback (Light Impact)
                    </button>

                    <div className="p-3 bg-[var(--tg-theme-secondary-bg-color)] rounded">
                        <p className="text-sm font-semibold mb-2">Common Patterns:</p>
                        <div className="space-y-2">
                            <button
                                onClick={() => {
                                    // Double tap pattern
                                    webApp?.HapticFeedback.impactOccurred('light')
                                    setTimeout(() => webApp?.HapticFeedback.impactOccurred('light'), 100)
                                }}
                                className="btn-secondary w-full text-sm"
                            >
                                Double Tap Pattern
                            </button>

                            <button
                                onClick={() => {
                                    // Success pattern
                                    webApp?.HapticFeedback.impactOccurred('medium')
                                    setTimeout(() => webApp?.HapticFeedback.notificationOccurred('success'), 200)
                                }}
                                className="btn-secondary w-full text-sm"
                            >
                                Success Action Pattern
                            </button>

                            <button
                                onClick={() => {
                                    // Error pattern
                                    webApp?.HapticFeedback.impactOccurred('heavy')
                                    setTimeout(() => webApp?.HapticFeedback.notificationOccurred('error'), 150)
                                }}
                                className="btn-secondary w-full text-sm"
                            >
                                Error Action Pattern
                            </button>
                        </div>
                    </div>
                </div>

                <CodeBlock language="typescript">
                    {`// Telegram WebApp only supports these haptic methods:

// 1. Impact haptics (5 styles)
webApp.HapticFeedback.impactOccurred('light')
webApp.HapticFeedback.impactOccurred('medium')
webApp.HapticFeedback.impactOccurred('heavy')
webApp.HapticFeedback.impactOccurred('rigid')
webApp.HapticFeedback.impactOccurred('soft')

// 2. Notification haptics (3 types)
webApp.HapticFeedback.notificationOccurred('error')
webApp.HapticFeedback.notificationOccurred('success')
webApp.HapticFeedback.notificationOccurred('warning')

// For selection feedback, use light impact:
items.forEach((item, index) => {
  item.addEventListener('click', () => {
    webApp.HapticFeedback.impactOccurred('light')
    selectItem(index)
  })
})`}
                </CodeBlock>
            </DemoSection>

            <DemoSection title="üéÆ Game Examples">
                <div className="space-y-4 p-4 bg-[var(--tg-theme-secondary-bg-color)] rounded-lg">
                    <div>
                        <h4 className="font-semibold">Clicker Game</h4>
                        <p className="text-sm text-[var(--tg-theme-hint-color)]">
                            Light impact on each tap
                        </p>
                    </div>

                    <div>
                        <h4 className="font-semibold">Puzzle Game</h4>
                        <p className="text-sm text-[var(--tg-theme-hint-color)]">
                            Light impact when selecting/moving pieces
                        </p>
                    </div>

                    <div>
                        <h4 className="font-semibold">Action Game</h4>
                        <p className="text-sm text-[var(--tg-theme-hint-color)]">
                            Heavy impact for explosions, error notification for game over
                        </p>
                    </div>
                </div>
            </DemoSection>
        </div>
    )
}


/components/demos/HomeScreenDemo.tsx

// components/demos/HomeScreenDemo.tsx
'use client'

import { useState, useEffect, useCallback } from 'react'
import { useTelegram } from '@/providers/TelegramProvider'
import DemoSection from '@/components/DemoSection'
import CodeBlock from '@/components/CodeBlock'

export default function HomeScreenDemo() {
    const { webApp } = useTelegram()
    const [status, setStatus] = useState<string>('checking')
    const [isAdded, setIsAdded] = useState(false)
    const [isChecking, setIsChecking] = useState(false)
    const [hasCheckedOnce, setHasCheckedOnce] = useState(false)

    // Use useCallback to memoize the function with proper dependencies
    const checkStatus = useCallback(() => {
        if (!webApp) {
            console.log('WebApp not available')
            return
        }

        // Prevent multiple simultaneous checks
        if (isChecking) {
            console.log('Already checking status...')
            return
        }

        setIsChecking(true)
        console.log('Checking home screen status...')

        // Set a timeout in case the callback never fires
        const timeoutId = setTimeout(() => {
            console.log('Status check timed out, assuming not added')
            setStatus('not-added')
            setIsChecking(false)
            setHasCheckedOnce(true)
        }, 3000) // 3 second timeout

        try {
            webApp.checkHomeScreenStatus((receivedStatus: string) => {
                clearTimeout(timeoutId)
                console.log('Home screen status received:', receivedStatus)
                setStatus(receivedStatus || 'not-added')
                setIsChecking(false)
                setHasCheckedOnce(true)
            })
        } catch (error) {
            clearTimeout(timeoutId)
            console.error('Error checking status:', error)
            setStatus('not-added')
            setIsChecking(false)
            setHasCheckedOnce(true)
        }
    }, [webApp, isChecking])

    useEffect(() => {
        if (!webApp) return

        const handleHomeScreenAdded = () => {
            setIsAdded(true)
            setStatus('added') // Update status immediately
            webApp.HapticFeedback.notificationOccurred('success')
            webApp.showAlert('Successfully added to home screen!')
        }

        webApp.onEvent('homeScreenAdded', handleHomeScreenAdded)

        // Check initial status after a small delay to ensure WebApp is fully initialized
        const timeoutId = setTimeout(() => {
            checkStatus()
        }, 500)

        return () => {
            webApp.offEvent('homeScreenAdded', handleHomeScreenAdded)
            clearTimeout(timeoutId)
        }
    }, [webApp]) // Remove checkStatus from deps to avoid re-running

    const addToHomeScreen = () => {
        if (!webApp) {
            console.log('WebApp not available')
            return
        }

        // Optimistically update UI
        setStatus('checking')
        webApp.addToHomeScreen()
    }

    const getStatusEmoji = () => {
        switch (status) {
            case 'added': return '‚úÖ'
            case 'not-added': return '‚ûï'
            case 'unknown': return '‚ùì'
            case 'checking': return 'üîÑ'
            default: return '‚ùì'
        }
    }

    const getStatusDescription = () => {
        switch (status) {
            case 'added': return 'Mini App is on the home screen'
            case 'not-added': return 'Mini App can be added to home screen'
            case 'unknown': return 'Status cannot be determined'
            case 'checking': return 'Checking status...'
            default: return 'Status unknown'
        }
    }

    // Determine if version supports home screen
    const supportsHomeScreen = webApp?.isVersionAtLeast('7.7') ?? false

    return (
        <div className="space-y-6">
            <DemoSection title="üì± Home Screen Integration">
                <div className="space-y-4">
                    {/* Version check warning */}
                    {webApp && !supportsHomeScreen && (
                        <div className="p-3 bg-yellow-500/20 border border-yellow-500/30 rounded-lg">
                            <p className="text-sm text-yellow-600 dark:text-yellow-400">
                                ‚ö†Ô∏è Home screen features require Telegram version 7.7 or higher.
                                Your version: {webApp.version}
                            </p>
                        </div>
                    )}

                    <div className="p-4 bg-[var(--tg-theme-secondary-bg-color)] rounded-lg">
                        <div className="flex items-center justify-between mb-2">
                            <span className="font-semibold">Status</span>
                            <span className="text-2xl">{getStatusEmoji()}</span>
                        </div>
                        <p className="text-sm text-[var(--tg-theme-hint-color)]">
                            {getStatusDescription()}
                        </p>
                        {status === 'checking' && isChecking && (
                            <p className="text-xs text-[var(--tg-theme-hint-color)] mt-2">
                                This may take a moment...
                            </p>
                        )}
                    </div>

                    <button
                        onClick={checkStatus}
                        className="btn-primary w-full"
                        disabled={isChecking || !supportsHomeScreen}
                    >
                        {isChecking ? 'Checking...' : 'Check Home Screen Status'}
                    </button>

                    <button
                        onClick={addToHomeScreen}
                        className="btn-primary w-full"
                        disabled={status === 'added' || !supportsHomeScreen || isChecking}
                    >
                        {status === 'added' ? 'Already Added' : 'Add to Home Screen'}
                    </button>

                    {/* Info box about the API behavior */}
                    {hasCheckedOnce && status === 'not-added' && (
                        <div className="p-3 bg-blue-500/10 border border-blue-500/30 rounded-lg">
                            <p className="text-sm text-blue-600 dark:text-blue-400">
                                üí° If the status check isn't working, try adding the app to your home screen
                                and then check the status again. The API works more reliably when the app
                                is already on the home screen.
                            </p>
                        </div>
                    )}

                    {isAdded && (
                        <div className="p-3 bg-green-500/20 rounded text-center">
                            <p className="text-sm font-semibold">üéâ Successfully Added!</p>
                            <p className="text-xs text-[var(--tg-theme-hint-color)] mt-1">
                                You can now launch this Mini App from your home screen
                            </p>
                        </div>
                    )}

                    {/* Debug info */}
                    <div className="p-3 bg-[var(--tg-theme-secondary-bg-color)] rounded text-xs font-mono">
                        <p className="font-bold mb-1">Debug Info:</p>
                        <p>WebApp Available: {webApp ? '‚úÖ' : '‚ùå'}</p>
                        <p>Version: {webApp?.version || 'N/A'}</p>
                        <p>Platform: {webApp?.platform || 'N/A'}</p>
                        <p>Supports Home Screen: {supportsHomeScreen ? '‚úÖ' : '‚ùå'}</p>
                        <p>Status: {status}</p>
                        <p>Is Checking: {isChecking ? 'Yes' : 'No'}</p>
                        <p>Has Checked Once: {hasCheckedOnce ? 'Yes' : 'No'}</p>
                    </div>
                </div>

                <CodeBlock language="typescript">
                    {`// Check if app is on home screen
// Note: This API may not respond when app is not on home screen
webApp.checkHomeScreenStatus((status) => {
  // status: 'added' | 'not-added' | 'unknown'
  // May not receive callback if not on home screen
  if (status === 'not-added') {
    showAddToHomePrompt()
  }
})

// Add to home screen
webApp.addToHomeScreen()

// Listen for successful addition
webApp.onEvent('homeScreenAdded', () => {
  console.log('App added to home screen!')
  // Update your UI immediately
  setStatus('added')
})`}
                </CodeBlock>
            </DemoSection>

            <DemoSection title="üí° Implementation Notes">
                <div className="space-y-3">
                    <div className="p-3 bg-[var(--tg-theme-secondary-bg-color)] rounded">
                        <h4 className="font-semibold">‚ö†Ô∏è API Limitations</h4>
                        <p className="text-sm text-[var(--tg-theme-hint-color)]">
                            The <code>checkHomeScreenStatus</code> API may not always respond when the app
                            is not on the home screen. Consider implementing a timeout and assuming "not-added"
                            if no response is received.
                        </p>
                    </div>

                    <div className="p-3 bg-[var(--tg-theme-secondary-bg-color)] rounded">
                        <h4 className="font-semibold">‚úÖ Best Practices</h4>
                        <ul className="text-sm text-[var(--tg-theme-hint-color)] space-y-1 mt-2">
                            <li>‚Ä¢ Always listen for the <code>homeScreenAdded</code> event</li>
                            <li>‚Ä¢ Implement timeouts for status checks</li>
                            <li>‚Ä¢ Provide clear feedback to users</li>
                            <li>‚Ä¢ Cache the status locally if needed</li>
                        </ul>
                    </div>
                </div>
            </DemoSection>

            <DemoSection title="üéØ Benefits">
                <div className="space-y-3">
                    <div className="p-3 bg-[var(--tg-theme-secondary-bg-color)] rounded">
                        <h4 className="font-semibold">üöÄ Quick Access</h4>
                        <p className="text-sm text-[var(--tg-theme-hint-color)]">
                            Launch your Mini App directly without opening Telegram
                        </p>
                    </div>

                    <div className="p-3 bg-[var(--tg-theme-secondary-bg-color)] rounded">
                        <h4 className="font-semibold">üìà Better Retention</h4>
                        <p className="text-sm text-[var(--tg-theme-hint-color)]">
                            Users are more likely to return when the app is on their home screen
                        </p>
                    </div>

                    <div className="p-3 bg-[var(--tg-theme-secondary-bg-color)] rounded">
                        <h4 className="font-semibold">üîî Push Notifications</h4>
                        <p className="text-sm text-[var(--tg-theme-hint-color)]">
                            Enable direct notifications without going through Telegram
                        </p>
                    </div>
                </div>
            </DemoSection>
        </div>
    )
}


/components/demos/InitDataDemo.tsx

// components/demos/InitDataDemo.tsx
'use client'

import { useState } from 'react'
import { useTelegram } from '@/providers/TelegramProvider'
import DemoSection from '@/components/DemoSection'
import CodeBlock from '@/components/CodeBlock'

export default function InitDataDemo() {
  const { webApp } = useTelegram()
  const initData = webApp?.initData || ''
  const initDataUnsafe = webApp?.initDataUnsafe || {}
  const [validationResult, setValidationResult] = useState<{
    isValid: boolean | null
    message: string
  }>({ isValid: null, message: '' })
  const [isValidating, setIsValidating] = useState(false)

  const validateInitData = async () => {
    if (!initData) {
      webApp?.showAlert('No init data available to validate')
      return
    }

    setIsValidating(true)
    try {
      const response = await fetch('/api/telegram/validate', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
        },
        body: JSON.stringify({ initData })
      })

      const result = await response.json()
      setValidationResult({
        isValid: result.valid,
        message: result.valid ? 'Init data is valid!' : 'Init data validation failed'
      })

      webApp?.HapticFeedback.notificationOccurred(result.valid ? 'success' : 'error')
    } catch (error) {
      setValidationResult({
        isValid: false,
        message: 'Error validating init data'
      })
      webApp?.HapticFeedback.notificationOccurred('error')
    } finally {
      setIsValidating(false)
    }
  }

  return (
    <div className="space-y-6">
      <DemoSection title="üîê Init Data">
        <div className="space-y-4">
          <div className="p-3 bg-[var(--tg-theme-secondary-bg-color)] rounded">
            <h4 className="font-semibold mb-2">Raw Init Data</h4>
            <p className="text-xs break-all font-mono">
              {initData || 'No init data available'}
            </p>
          </div>

          <div className="p-3 bg-[var(--tg-theme-secondary-bg-color)] rounded">
            <h4 className="font-semibold mb-2">Parsed Data</h4>
            <pre className="text-xs overflow-auto">
              {JSON.stringify(initDataUnsafe, null, 2)}
            </pre>
          </div>

          <div className="space-y-3">
            <button
              onClick={validateInitData}
              disabled={!initData || isValidating}
              className="btn-primary w-full"
            >
              {isValidating ? 'Validating...' : 'Validate Init Data'}
            </button>

            {validationResult.isValid !== null && (
              <div className={`p-3 rounded text-sm ${validationResult.isValid
                  ? 'bg-green-500/20 text-green-600 dark:text-green-400'
                  : 'bg-red-500/20 text-red-600 dark:text-red-400'
                }`}>
                {validationResult.isValid ? '‚úÖ' : '‚ùå'} {validationResult.message}
              </div>
            )}
          </div>
        </div>

        <CodeBlock language="bash">
          {`# Install the validation package
npm install @telegram-apps/init-data-node
# or
yarn add @telegram-apps/init-data-node`}
        </CodeBlock>

        <CodeBlock language="typescript">
          {`// === SIMPLE VALIDATION EXAMPLE ===

// 1. API Route: app/api/telegram/validate/route.ts
import { NextRequest, NextResponse } from 'next/server'
import { validate, parse } from '@telegram-apps/init-data-node'

export async function POST(request: NextRequest) {
  const { initData } = await request.json()
  const botToken = process.env.TELEGRAM_BOT_TOKEN!
  
  try {
    // Validate the init data (throws if invalid)
    validate(initData, botToken)
    
    // Parse to get user info
    const data = parse(initData)
    
    return NextResponse.json({ 
      valid: true, 
      user: data.user 
    })
  } catch (error) {
    return NextResponse.json({ 
      valid: false, 
      error: 'Invalid init data' 
    }, { status: 401 })
  }
}

// 2. Protected API Route: app/api/user/profile/route.ts
import { NextRequest, NextResponse } from 'next/server'
import { validate, parse } from '@telegram-apps/init-data-node'

export async function GET(request: NextRequest) {
  const initData = request.headers.get('X-Telegram-Init-Data')
  
  if (!initData) {
    return NextResponse.json({ error: 'No auth' }, { status: 401 })
  }
  
  try {
    validate(initData, process.env.TELEGRAM_BOT_TOKEN!)
    const { user } = parse(initData)
    
    // Fetch user data from your database
    const profile = await getUserProfile(user.id)
    
    return NextResponse.json({ profile })
  } catch {
    return NextResponse.json({ error: 'Invalid auth' }, { status: 401 })
  }
}

// 3. Client-side usage
const fetchProfile = async () => {
  const response = await fetch('/api/user/profile', {
    headers: {
      'X-Telegram-Init-Data': webApp.initData
    }
  })
  
  if (response.ok) {
    const data = await response.json()
    console.log('Profile:', data.profile)
  }
}`}
        </CodeBlock>

        <DemoSection title="üõ°Ô∏è With Expiration Check">
          <CodeBlock language="typescript">
            {`// Add expiration check (optional but recommended)
import { validate, parse } from '@telegram-apps/init-data-node'

export async function validateWithExpiry(
  initData: string, 
  maxAge = 3600 // 1 hour default
) {
  const botToken = process.env.TELEGRAM_BOT_TOKEN!
  
  try {
    // This validates the hash
    validate(initData, botToken)
    
    // Parse and check auth_date
    const parsed = parse(initData)
    const authDate = parsed.authDate.getTime() / 1000
    const now = Date.now() / 1000
    
    if (now - authDate > maxAge) {
      throw new Error('Init data expired')
    }
    
    return { valid: true, data: parsed }
  } catch (error) {
    return { valid: false, error: error.message }
  }
}`}
          </CodeBlock>
        </DemoSection>

        <DemoSection title="üìù Environment Setup">
          <CodeBlock language="bash">
            {`# .env.local
TELEGRAM_BOT_TOKEN=123456789:ABCdefGHIjklMNOpqrsTUVwxyz

# Get your bot token from @BotFather in Telegram`}
          </CodeBlock>
        </DemoSection>
      </DemoSection>
    </div>
  )
}


/components/demos/LinksDemo.tsx

// components/demos/LinksDemo.tsx
'use client'

import { useTelegram } from '@/providers/TelegramProvider'
import DemoSection from '@/components/DemoSection'
import CodeBlock from '@/components/CodeBlock'

export default function LinksDemo() {
    const { webApp } = useTelegram()

    const links = [
        {
            title: 'Regular Link',
            description: 'Opens inside webview',
            action: () => window.location.href = 'https://telegram.org',
            code: `window.location.href = 'https://telegram.org'`
        },
        {
            title: 'External Link (target="_blank")',
            description: 'Opens outside webview',
            action: () => {
                const a = document.createElement('a')
                a.href = 'https://telegram.org'
                a.target = '_blank'
                a.click()
            },
            code: `<a href="https://telegram.org" target="_blank">Open</a>`
        },
        {
            title: 'window.open() Link',
            description: 'Opens in external browser',
            action: () => window.open('https://telegram.org'),
            code: `window.open('https://telegram.org')`
        },
        {
            title: 'Telegram Link (t.me)',
            description: 'Opens inside Telegram app',
            action: () => webApp?.openTelegramLink('https://t.me/telegram'),
            code: `webApp.openTelegramLink('https://t.me/telegram')`
        },
        {
            title: 'Instant View Link',
            description: 'Opens with Telegram Instant View',
            action: () => webApp?.openLink('https://telegra.ph/api', { try_instant_view: true }),
            code: `webApp.openLink('https://telegra.ph/api', { try_instant_view: true })`
        },
        {
            title: 'Bot Direct Link',
            description: 'Opens bot with start parameter',
            action: () => webApp?.openTelegramLink('https://t.me/DurgerKingBot/menu'),
            code: `webApp.openTelegramLink('https://t.me/BotName/menu')`
        },
        {
            title: 'Channel Link',
            description: 'Opens Telegram channel',
            action: () => webApp?.openTelegramLink('https://t.me/telegram'),
            code: `webApp.openTelegramLink('https://t.me/channelname')`
        },
        {
            title: 'Sticker Pack',
            description: 'Add sticker pack',
            action: () => webApp?.openTelegramLink('https://t.me/addstickers/fltmp'),
            code: `webApp.openTelegramLink('https://t.me/addstickers/packname')`
        },
        {
            title: 'Share URL',
            description: 'Share URL via Telegram',
            action: () => webApp?.openTelegramLink(`https://t.me/share/url?url=${encodeURIComponent('https://example.com')}&text=${encodeURIComponent('Check this out!')}`),
            code: `webApp.openTelegramLink('https://t.me/share/url?url=...')`
        }
    ]

    const browserOptions = [
        { name: 'Chrome', value: 'chrome' as const },
        { name: 'Safari', value: 'safari' as const },
        { name: 'Firefox', value: 'firefox' as const },
        { name: 'Opera', value: 'opera' as const }
    ]

    return (
        <div className="space-y-6">
            <DemoSection title="üîó Link Types">
                <div className="space-y-3">
                    {links.map((link, index) => (
                        <div key={index} className="p-4 bg-[var(--tg-theme-secondary-bg-color)] rounded-lg">
                            <div className="flex justify-between items-start mb-2">
                                <div className="flex-1">
                                    <h4 className="font-semibold">{link.title}</h4>
                                    <p className="text-sm text-[var(--tg-theme-hint-color)]">{link.description}</p>
                                </div>
                                <button
                                    onClick={link.action}
                                    className="btn-primary px-4 py-2 ml-4"
                                >
                                    Open
                                </button>
                            </div>
                            <div className="mt-2 overflow-x-auto">
                                <code className="text-xs bg-black/10 dark:bg-white/10 px-2 py-1 rounded">
                                    {link.code}
                                </code>
                            </div>
                        </div>
                    ))}
                </div>
            </DemoSection>

            <DemoSection title="üåê Browser Selection">
                <div className="space-y-4">
                    <p className="text-sm text-[var(--tg-theme-hint-color)]">
                        Force links to open in specific browsers:
                    </p>
                    <div className="grid grid-cols-2 gap-2">
                        {browserOptions.map((browser) => (
                            <button
                                key={browser.value}
                                onClick={() => webApp?.openLink('https://telegram.org', { try_browser: browser.value })}
                                className="btn-secondary"
                            >
                                Open in {browser.name}
                            </button>
                        ))}
                    </div>
                </div>

                <CodeBlock language="typescript">
                    {`// Force specific browser
webApp.openLink('https://example.com', {
  try_browser: 'chrome' // or 'safari', 'firefox', 'opera'
})

// Regular external link
webApp.openLink('https://example.com')

// Telegram links must use openTelegramLink
webApp.openTelegramLink('https://t.me/channelname')

// Share URL with text
const shareUrl = 'https://t.me/share/url?' + 
  'url=' + encodeURIComponent('https://myapp.com') +
  '&text=' + encodeURIComponent('Check out my score!')
  
webApp.openTelegramLink(shareUrl)`}
                </CodeBlock>
            </DemoSection>

        </div>
    )
}


/components/demos/PaymentsDemo.tsx

// components/demos/PaymentsDemo.tsx
'use client'

import { useState } from 'react'
import { useTelegram } from '@/providers/TelegramProvider'
import DemoSection from '@/components/DemoSection'
import CodeBlock from '@/components/CodeBlock'

export default function PaymentsDemo() {
    const { webApp, user } = useTelegram()
    const [starBalance, setStarBalance] = useState(0)

    // Create Stars invoice using the NEW Bot API method
    const createStarsInvoice = async (item: string, stars: number) => {
        try {
            // In a real app, this would call your backend to create an invoice
            // The backend would use the Bot API to create a Stars invoice

            // For demo purposes, we'll simulate the invoice creation
            webApp?.showAlert(`Creating invoice for ${stars} Stars...`)

            // The actual implementation would involve:
            // 1. Backend creates invoice via Bot API
            // 2. Returns invoice link
            // 3. Open the invoice in Telegram

            // Example of what the backend would do:
            /*
            const invoice = await bot.createInvoiceLink({
                title: item,
                description: `Purchase ${item} in our Mini App`,
                payload: `item_${Date.now()}`,
                currency: 'XTR', // XTR is the currency code for Telegram Stars
                prices: [{ label: item, amount: stars }]
            })
            */

        } catch (error) {
            webApp?.showAlert('Failed to create invoice')
        }
    }

    const sendGift = () => {
        webApp?.showAlert('Gift sending is now available through Telegram Stars!')
    }

    const premiumFeatures = [
        { id: 'remove_ads', name: 'Remove Ads', stars: 50 },
        { id: 'premium_skins', name: 'Premium Skins', stars: 100 },
        { id: 'double_coins', name: 'Double Coins', stars: 200 },
        { id: 'vip_bundle', name: 'VIP Bundle', stars: 500 },
        { id: 'monthly_sub', name: 'Monthly Subscription', stars: 250 }
    ]

    return (
        <div className="space-y-6">
            <DemoSection title="‚≠ê Telegram Stars Overview">
                <div className="p-4 bg-yellow-500/10 border border-yellow-500/30 rounded-lg">
                    <h4 className="font-semibold text-yellow-600 dark:text-yellow-400 mb-2">
                        Important: Stars are REQUIRED for Digital Goods
                    </h4>
                    <p className="text-sm">
                        Due to App Store and Play Store policies, all digital goods and services
                        must be sold exclusively using Telegram Stars.
                    </p>
                </div>

                <div className="p-4 bg-[var(--tg-theme-secondary-bg-color)] rounded">
                    <div className="space-y-2">
                        <div className="flex items-center justify-between">
                            <span>Telegram Premium</span>
                            <span className="font-bold">
                                {user?.is_premium ? '‚úÖ Active' : '‚ùå Not Active'}
                            </span>
                        </div>
                        <div className="text-sm text-[var(--tg-theme-hint-color)]">
                            Premium users may receive special discounts or bonus Stars
                        </div>
                    </div>
                </div>

                <CodeBlock language="typescript">
                    {`// Bot API method to create Stars invoice (backend)
const invoice = await bot.createInvoiceLink({
  title: 'Premium Upgrade',
  description: 'Unlock all premium features',
  payload: 'premium_upgrade',
  currency: 'XTR', // Telegram Stars currency code
  prices: [{ 
    label: 'Premium Upgrade', 
    amount: 100 // Amount in Stars
  }]
})

// Send invoice to user
await bot.sendMessage(chatId, 'Complete your purchase:', {
  reply_markup: {
    inline_keyboard: [[{
      text: 'Pay 100 Stars',
      url: invoice
    }]]
  }
})`}
                </CodeBlock>
            </DemoSection>

            <DemoSection title="üí´ Digital Products (Stars Only)">
                <div className="space-y-3">
                    {premiumFeatures.map(item => (
                        <div
                            key={item.id}
                            className="flex items-center justify-between p-3 bg-[var(--tg-theme-secondary-bg-color)] rounded"
                        >
                            <div>
                                <div className="font-semibold">{item.name}</div>
                                <div className="text-sm text-[var(--tg-theme-hint-color)]">
                                    ‚≠ê {item.stars} Stars
                                </div>
                            </div>
                            <button
                                onClick={() => createStarsInvoice(item.name, item.stars)}
                                className="btn-primary px-4 py-2"
                            >
                                Buy
                            </button>
                        </div>
                    ))}
                </div>

                <CodeBlock language="typescript">
                    {`// Handle payment result (backend webhook)
bot.on('pre_checkout_query', async (query) => {
  // Validate the payment
  await bot.answerPreCheckoutQuery(query.id, true)
})

bot.on('successful_payment', async (ctx) => {
  const payment = ctx.message.successful_payment
  
  // Payment completed!
  // - Grant digital goods to user
  // - Save to database
  // - Send confirmation
  
  await ctx.reply('Thank you! Your purchase is complete.')
})`}
                </CodeBlock>
            </DemoSection>

            <DemoSection title="üéÅ New Features with Stars">
                <div className="space-y-4">
                    <div className="p-3 bg-[var(--tg-theme-secondary-bg-color)] rounded">
                        <h4 className="font-semibold mb-2">üéÅ Send Gifts</h4>
                        <p className="text-sm text-[var(--tg-theme-hint-color)] mb-3">
                            Mini Apps can use their balance of Telegram Stars to send gifts to their users.
                        </p>
                        <button onClick={sendGift} className="btn-primary w-full">
                            Send Gift to User
                        </button>
                    </div>

                    <div className="p-3 bg-[var(--tg-theme-secondary-bg-color)] rounded">
                        <h4 className="font-semibold mb-2">üîÑ Subscriptions</h4>
                        <p className="text-sm text-[var(--tg-theme-hint-color)]">
                            Mini Apps now support paid subscriptions powered by Telegram Stars ‚Äì monetizing their efforts with multiple tiers of content and features.
                        </p>
                    </div>

                    <div className="p-3 bg-[var(--tg-theme-secondary-bg-color)] rounded">
                        <h4 className="font-semibold mb-2">üí∞ Affiliate Programs</h4>
                        <p className="text-sm text-[var(--tg-theme-hint-color)]">
                            In December 2024, Telegram also introduced Affiliate Programs, allowing users and channels to earn Stars by referring paying users to mini apps (for a percentage of referred users' payments).
                        </p>
                    </div>
                </div>
            </DemoSection>

            <DemoSection title="üí∏ Stars Pricing Reference">
                <div className="p-4 bg-[var(--tg-theme-secondary-bg-color)] rounded">
                    <p className="text-sm text-[var(--tg-theme-hint-color)] mb-3">
                        Common Star packages and approximate USD values:
                    </p>
                    <div className="space-y-2 text-sm">
                        <div>‚≠ê 50 Stars ‚âà $0.99</div>
                        <div>‚≠ê 100 Stars ‚âà $1.99</div>
                        <div>‚≠ê 250 Stars ‚âà $4.99</div>
                        <div>‚≠ê 500 Stars ‚âà $9.99</div>
                        <div>‚≠ê 1000 Stars ‚âà $19.99</div>
                    </div>
                    <p className="text-xs text-[var(--tg-theme-hint-color)] mt-3">
                        * Prices vary by region and may include VAT
                    </p>
                </div>
            </DemoSection>

            <DemoSection title="‚öñÔ∏è Physical vs Digital Goods">
                <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div className="p-4 bg-green-500/10 border border-green-500/30 rounded">
                        <h4 className="font-semibold text-green-600 dark:text-green-400 mb-2">
                            ‚úÖ Physical Goods
                        </h4>
                        <ul className="text-sm space-y-1">
                            <li>‚Ä¢ Can use any payment provider</li>
                            <li>‚Ä¢ Multiple currencies allowed</li>
                            <li>‚Ä¢ Examples: merchandise, books, devices</li>
                        </ul>
                    </div>

                    <div className="p-4 bg-blue-500/10 border border-blue-500/30 rounded">
                        <h4 className="font-semibold text-blue-600 dark:text-blue-400 mb-2">
                            ‚≠ê Digital Goods (Stars Only)
                        </h4>
                        <ul className="text-sm space-y-1">
                            <li>‚Ä¢ Must use Telegram Stars</li>
                            <li>‚Ä¢ Examples: in-app items, subscriptions</li>
                            <li>‚Ä¢ Compliant with app store policies</li>
                        </ul>
                    </div>
                </div>
            </DemoSection>

            <DemoSection title="üîß Implementation Guide">
                <CodeBlock language="typescript">
                    {`// Complete Stars payment flow

// 1. Frontend - Request invoice creation
async function purchaseItem(itemId: string, stars: number) {
  const response = await fetch('/api/create-invoice', {
    method: 'POST',
    headers: {
      'Content-Type': 'application/json',
      'Authorization': \`tma \${webApp.initData}\`
    },
    body: JSON.stringify({ itemId, stars })
  })
  
  const { invoiceUrl } = await response.json()
  
  // Open invoice in Telegram
  webApp.openTelegramLink(invoiceUrl)
}

// 2. Backend - Create Stars invoice
app.post('/api/create-invoice', async (req, res) => {
  const { itemId, stars } = req.body
  
  const invoice = await bot.api.createInvoiceLink({
    title: 'Game Item',
    description: 'Premium game content',
    payload: JSON.stringify({ itemId, userId }),
    provider_token: '', // Empty for Stars
    currency: 'XTR',
    prices: [{ 
      label: 'Item', 
      amount: stars 
    }]
  })
  
  res.json({ invoiceUrl: invoice })
})

// 3. Handle successful payment
bot.on('successful_payment', async (ctx) => {
  const { payload, telegram_payment_charge_id } = 
    ctx.message.successful_payment
  
  const { itemId, userId } = JSON.parse(payload)
  
  // Grant item to user
  await grantItemToUser(userId, itemId)
  
  // Optional: Send gift as reward
  await bot.api.sendGift(userId, giftId)
})`}
                </CodeBlock>
            </DemoSection>

            <DemoSection title="üí° Best Practices">
                <div className="space-y-3">
                    <div className="p-3 bg-[var(--tg-theme-secondary-bg-color)] rounded">
                        <h4 className="font-semibold">Always Use Stars for Digital Content</h4>
                        <p className="text-sm text-[var(--tg-theme-hint-color)]">
                            Any virtual items, premium features, or digital services must use Stars
                        </p>
                    </div>

                    <div className="p-3 bg-[var(--tg-theme-secondary-bg-color)] rounded">
                        <h4 className="font-semibold">Implement Refunds</h4>
                        <p className="text-sm text-[var(--tg-theme-hint-color)]">
                            Use the refundStarPayment method for customer disputes
                        </p>
                    </div>

                    <div className="p-3 bg-[var(--tg-theme-secondary-bg-color)] rounded">
                        <h4 className="font-semibold">Consider Subscriptions</h4>
                        <p className="text-sm text-[var(--tg-theme-hint-color)]">
                            Recurring Stars payments for continuous content access
                        </p>
                    </div>

                    <div className="p-3 bg-[var(--tg-theme-secondary-bg-color)] rounded">
                        <h4 className="font-semibold">Leverage Affiliate Programs</h4>
                        <p className="text-sm text-[var(--tg-theme-hint-color)]">
                            Let users earn Stars by referring others to your Mini App
                        </p>
                    </div>
                </div>
            </DemoSection>
        </div>
    )
}


/components/demos/PopupsDemo.tsx

// components/demos/PopupsDemo.tsx
'use client'

import { useState } from 'react'
import { useTelegram } from '@/providers/TelegramProvider'
import DemoSection from '@/components/DemoSection'
import CodeBlock from '@/components/CodeBlock'

export default function PopupsDemo() {
    const { webApp } = useTelegram()
    const [isPopupOpen, setIsPopupOpen] = useState(false)

    // Helper function to safely show popup
    const safeShowPopup = (params: any, callback?: (buttonId: string | null) => void) => {
        if (isPopupOpen) {
            webApp?.showAlert('Please close the current popup first')
            return
        }

        setIsPopupOpen(true)
        webApp?.showPopup(params, (buttonId) => {
            setIsPopupOpen(false)
            if (callback) {
                // Wrap callback in try-catch to handle any errors
                try {
                    callback(buttonId)
                } catch (e) {
                    console.error('Error in popup callback:', e)
                    // Reset state if error occurs
                    setIsPopupOpen(false)
                }
            }
        })
    }

    const showBasicPopup = () => {
        safeShowPopup({
            title: 'Basic Popup',
            message: 'This is a simple popup message',
            buttons: [{ type: 'ok' }]
        }, (buttonId) => {
            console.log('Button pressed:', buttonId)
        })
    }

    const showMultiButtonPopup = () => {
        safeShowPopup({
            title: 'Save Changes?',
            message: 'You have unsaved changes. What would you like to do?',
            buttons: [
                { id: 'save', type: 'default', text: 'Save' },
                { id: 'discard', type: 'destructive', text: 'Discard' },
                { type: 'cancel' }
            ]
        }, (buttonId) => {
            // Use setTimeout to ensure popup is fully closed
            setTimeout(() => {
                // Reset popup state before showing alert
                setIsPopupOpen(false)
                switch (buttonId) {
                    case 'save':
                        console.log('Changes saved!')
                        webApp?.HapticFeedback.notificationOccurred('success')
                        break
                    case 'discard':
                        console.log('Changes discarded')
                        webApp?.HapticFeedback.notificationOccurred('warning')
                        break
                    default:
                        console.log('Cancelled')
                }
            }, 100)
        })
    }

    const showDestructivePopup = () => {
        safeShowPopup({
            title: 'Delete Account',
            message: 'Are you sure you want to delete your account? This action cannot be undone.',
            buttons: [
                { id: 'delete', type: 'destructive', text: 'Delete Account' },
                { type: 'cancel', text: 'Keep Account' }
            ]
        }, (buttonId) => {
            if (buttonId === 'delete') {
                setTimeout(() => {
                    setIsPopupOpen(false)
                    webApp?.HapticFeedback.notificationOccurred('warning')
                    console.log('Account deletion initiated')
                }, 100)
            }
        })
    }

    const showGameOverPopup = () => {
        safeShowPopup({
            title: 'üéÆ Game Over!',
            message: 'You scored 1,234 points!\n\nThat\'s a new high score! üéâ',
            buttons: [
                { id: 'replay', type: 'default', text: 'üîÑ Play Again' },
                { id: 'share', type: 'default', text: 'üì§ Share Score' },
                { type: 'close', text: 'Exit' }
            ]
        }, (buttonId) => {
            // Use setTimeout to ensure actions happen after popup closes
            setTimeout(() => {
                setIsPopupOpen(false)
                switch (buttonId) {
                    case 'replay':
                        console.log('Starting new game...')
                        webApp?.HapticFeedback.notificationOccurred('success')
                        break
                    case 'share':
                        // Don't try switchInlineQuery unless we're sure it's available
                        if (webApp?.initDataUnsafe?.query_id) {
                            try {
                                webApp.switchInlineQuery('I just scored 1,234 points! Can you beat me?', ['users'])
                            } catch (e) {
                                console.error('Inline query error:', e)
                                // Fallback to URL sharing
                                webApp?.openTelegramLink(`https://t.me/share/url?url=${encodeURIComponent('https://t.me/yourbotname')}&text=${encodeURIComponent('I just scored 1,234 points! Can you beat me?')}`)
                            }
                        } else {
                            // Direct fallback to URL sharing
                            webApp?.openTelegramLink(`https://t.me/share/url?url=${encodeURIComponent('https://t.me/yourbotname')}&text=${encodeURIComponent('I just scored 1,234 points! Can you beat me?')}`)
                        }
                        break
                    default:
                        console.log('Game closed')
                }
            }, 100)
        })
    }

    const showGameMenuPopup = () => {
        safeShowPopup({
            title: 'üéÆ Game Menu',
            message: 'What would you like to do?',
            buttons: [
                { id: 'continue', type: 'default', text: 'Continue Playing' },
                { id: 'options', type: 'default', text: 'Game Options' },
                { id: 'quit', type: 'destructive', text: 'Quit Game' }
            ]
        }, (buttonId) => {
            setTimeout(() => {
                setIsPopupOpen(false)
                switch (buttonId) {
                    case 'continue':
                        console.log('Resuming game...')
                        webApp?.HapticFeedback.notificationOccurred('success')
                        break
                    case 'options':
                        // Add delay before showing next popup
                        setTimeout(() => {
                            showOptionsPopup()
                        }, 200)
                        break
                    case 'quit':
                        // Use setTimeout for confirm dialog too
                        setTimeout(() => {
                            webApp?.showConfirm('Are you sure you want to quit?', (confirmed) => {
                                if (confirmed) {
                                    webApp?.close()
                                }
                            })
                        }, 100)
                        break
                }
            }, 100)
        })
    }

    const showOptionsPopup = () => {
        safeShowPopup({
            title: '‚öôÔ∏è Game Options',
            message: 'Select an option:',
            buttons: [
                { id: 'sound', type: 'default', text: 'üîä Sound Settings' },
                { id: 'controls', type: 'default', text: 'üéÆ Controls' },
                { type: 'cancel', text: 'Back' }
            ]
        }, (buttonId) => {
            setTimeout(() => {
                setIsPopupOpen(false)

                // Use a single alert to confirm the action
                if (buttonId === 'sound') {
                    setTimeout(() => {
                        webApp?.showAlert(
                            'üîä Sound Settings\n\n' +
                            'Master Volume: 80%\n' +
                            'Effects: ON\n' +
                            'Music: ON\n\n' +
                            '(In a real app, this would open a settings screen)'
                        )
                    }, 200)
                } else if (buttonId === 'controls') {
                    setTimeout(() => {
                        webApp?.showAlert(
                            'üéÆ Control Settings\n\n' +
                            'Current: Touch Controls\n' +
                            'Available: Swipe, Tilt\n\n' +
                            '(In a real app, this would open a controls screen)'
                        )
                    }, 200)
                }
            }, 100)
        })
    }

    const compareAlerts = () => {
        // First show native alert
        alert('This is a native JavaScript alert')

        // Then show Telegram alert
        setTimeout(() => {
            webApp?.showAlert('This is a Telegram WebApp alert - much better styled!')
        }, 100)
    }

    const compareConfirms = () => {
        // First show native confirm
        const nativeResult = confirm('Native confirm: Continue?')
        console.log('Native result:', nativeResult)

        // Then show Telegram confirm
        setTimeout(() => {
            webApp?.showConfirm('Telegram confirm: Continue?', (result) => {
                // Log result instead of showing another alert
                console.log(`Telegram confirm result: ${result ? 'Yes' : 'No'}`)
                webApp?.HapticFeedback.notificationOccurred(result ? 'success' : 'warning')
            })
        }, 100)
    }

    // Test inline query availability
    const testInlineQuery = () => {
        safeShowPopup({
            title: 'üì§ Test Inline Query',
            message: 'This will test if inline mode is available',
            buttons: [
                { id: 'test', type: 'default', text: 'Test Inline' },
                { id: 'share', type: 'default', text: 'Alternative Share' },
                { type: 'cancel' }
            ]
        }, (buttonId) => {
            setTimeout(() => {
                setIsPopupOpen(false)
                if (buttonId === 'test') {
                    // Check if inline query is available before trying to use it
                    if (webApp?.initDataUnsafe?.query_id) {
                        try {
                            webApp.switchInlineQuery('Test message', ['users'])
                        } catch (e) {
                            console.error('Inline query error:', e)
                            // Delay the alert to avoid popup conflict
                            setTimeout(() => {
                                webApp.showAlert('Inline mode error. Please check if inline mode is enabled for this bot.')
                            }, 100)
                        }
                    } else {
                        // Don't try to call switchInlineQuery if we know it's not available
                        setTimeout(() => {
                            webApp?.showAlert(
                                'Inline mode is not available in this context.\n\n' +
                                'To enable inline mode:\n' +
                                '1. Go to @BotFather\n' +
                                '2. Send /setinline\n' +
                                '3. Select your bot\n' +
                                '4. Set placeholder text\n\n' +
                                'Note: Inline mode only works when the Mini App is opened from an inline query.'
                            )
                        }, 100)
                    }
                } else if (buttonId === 'share') {
                    // Alternative sharing via URL
                    webApp?.openTelegramLink(`https://t.me/share/url?url=${encodeURIComponent('https://t.me/yourbotname')}&text=${encodeURIComponent('Check out this awesome Mini App!')}`)
                }
            }, 100)
        })
    }

    return (
        <div className="space-y-6">
            <DemoSection title="üîî Popup Types">
                <div className="space-y-3">
                    <button onClick={showBasicPopup} className="btn-primary w-full">
                        Basic Popup (OK button)
                    </button>

                    <button onClick={showMultiButtonPopup} className="btn-primary w-full">
                        Multi-Button Popup (3 buttons)
                    </button>

                    <button onClick={showDestructivePopup} className="btn-primary w-full">
                        Destructive Action Popup
                    </button>

                    <button onClick={showGameOverPopup} className="btn-primary w-full">
                        Game Over Popup (with Share)
                    </button>

                    <button onClick={showGameMenuPopup} className="btn-primary w-full">
                        Game Menu Popup
                    </button>

                    <button onClick={testInlineQuery} className="btn-primary w-full">
                        Test Inline Query
                    </button>
                </div>

                <CodeBlock language="typescript">
                    {`// Safe popup handling - avoid nested popups!
const [isPopupOpen, setIsPopupOpen] = useState(false)

function safeShowPopup(params, callback) {
  if (isPopupOpen) return
  
  setIsPopupOpen(true)
  webApp.showPopup(params, (buttonId) => {
    setIsPopupOpen(false)
    
    // Important: Use console.log instead of showAlert
    // inside popup callbacks to avoid conflicts
    setTimeout(() => {
      try {
        callback(buttonId)
      } catch (e) {
        console.error('Popup callback error:', e)
      }
    }, 100)
  })
}

// Never call showAlert inside a popup callback!
// Use console.log or haptic feedback instead:
webApp.HapticFeedback.notificationOccurred('success')

// If you must show an alert after a popup, delay it:
setTimeout(() => {
  webApp.showAlert('Action completed!')
}, 200)`}
                </CodeBlock>
            </DemoSection>

            <DemoSection title="üÜö Native vs Telegram Alerts">
                <div className="space-y-3">
                    <button onClick={compareAlerts} className="btn-secondary w-full">
                        Compare alert() vs showAlert()
                    </button>

                    <button onClick={compareConfirms} className="btn-secondary w-full">
                        Compare confirm() vs showConfirm()
                    </button>

                    <div className="p-3 bg-[var(--tg-theme-secondary-bg-color)] rounded text-sm">
                        <p className="font-semibold mb-2">Why use Telegram popups?</p>
                        <ul className="space-y-1 text-[var(--tg-theme-hint-color)]">
                            <li>‚Ä¢ Consistent styling with Telegram UI</li>
                            <li>‚Ä¢ Better mobile experience</li>
                            <li>‚Ä¢ Non-blocking (doesn't freeze the app)</li>
                            <li>‚Ä¢ Supports multiple buttons and types</li>
                            <li>‚Ä¢ Proper theme support</li>
                        </ul>
                    </div>
                </div>
            </DemoSection>

            <DemoSection title="‚ö†Ô∏è Important: Avoid Nested Popups">
                <div className="p-4 bg-red-500/10 border border-red-500/30 rounded-lg">
                    <h4 className="font-semibold text-red-600 dark:text-red-400 mb-2">
                        Common Popup Mistakes
                    </h4>
                    <ul className="text-sm space-y-1">
                        <li>‚ùå Don't call showAlert() inside popup callbacks</li>
                        <li>‚ùå Don't call showPopup() immediately after another popup</li>
                        <li>‚ùå Don't call showConfirm() inside popup callbacks</li>
                        <li>‚úÖ Use console.log() for debugging in callbacks</li>
                        <li>‚úÖ Use haptic feedback for user feedback</li>
                        <li>‚úÖ Add delays between consecutive popups (200ms+)</li>
                        <li>‚úÖ Reset state properly after each popup</li>
                    </ul>
                </div>
            </DemoSection>

            <DemoSection title="‚ö†Ô∏è Handling Inline Mode">
                <div className="space-y-3">
                    <div className="p-4 bg-yellow-500/10 border border-yellow-500/30 rounded-lg">
                        <h4 className="font-semibold text-yellow-600 dark:text-yellow-400 mb-2">
                            Inline Mode Alternative
                        </h4>
                        <p className="text-sm mb-3">
                            If inline mode is disabled, use the share URL method instead:
                        </p>
                        <div className="space-y-2">
                            <button
                                onClick={() => {
                                    const shareUrl = `https://t.me/share/url?url=${encodeURIComponent('https://t.me/yourbotname')}&text=${encodeURIComponent('Check out my score: 1000 points! üéÆ')}`
                                    webApp?.openTelegramLink(shareUrl)
                                }}
                                className="btn-secondary w-full text-sm"
                            >
                                Share via URL (Always Works)
                            </button>

                            <button
                                onClick={() => {
                                    webApp?.showAlert(
                                        'To enable inline mode:\n\n' +
                                        '1. Go to @BotFather\n' +
                                        '2. Send /setinline\n' +
                                        '3. Select your bot\n' +
                                        '4. Set placeholder text like "Search..."\n\n' +
                                        'Then inline queries will work!'
                                    )
                                }}
                                className="btn-secondary w-full text-sm"
                            >
                                How to Enable Inline Mode
                            </button>
                        </div>
                    </div>

                    <CodeBlock language="typescript">
                        {`// Always-working share implementation
function shareScore(score) {
  // Method 1: Try inline query (if enabled)
  const useInline = () => {
    // Check if query_id exists first
    if (!webApp?.initDataUnsafe?.query_id) {
      return false
    }
    
    try {
      webApp.switchInlineQuery(
        \`My score: \${score} points!\`,
        ['users', 'groups']
      )
      return true
    } catch (e) {
      return false
    }
  }
  
  // Method 2: Fallback to share URL
  const useShareUrl = () => {
    const text = \`I scored \${score} points! Can you beat me?\`
    const url = 'https://t.me/yourbotname'
    const shareLink = 
      'https://t.me/share/url?' +
      'url=' + encodeURIComponent(url) +
      '&text=' + encodeURIComponent(text)
    
    webApp.openTelegramLink(shareLink)
  }
  
  // Try inline first, fallback to URL
  if (!useInline()) {
    useShareUrl()
  }
}`}
                    </CodeBlock>
                </div>
            </DemoSection>

            <DemoSection title="üìã Common Use Cases">
                <div className="grid grid-cols-1 gap-3">
                    <button
                        onClick={() => {
                            safeShowPopup({
                                title: 'üèÜ Achievement Unlocked!',
                                message: 'Speed Demon\nComplete level in under 30 seconds',
                                buttons: [{ type: 'ok', text: 'Awesome!' }]
                            }, () => {
                                console.log('Achievement acknowledged')
                                webApp?.HapticFeedback.notificationOccurred('success')
                            })
                        }}
                        className="btn-secondary"
                    >
                        Simple Achievement
                    </button>

                    <button
                        onClick={() => {
                            safeShowPopup({
                                title: 'üí∞ Purchase Gems',
                                message: 'Select a package:',
                                buttons: [
                                    { id: 'small', type: 'default', text: '100 üíé - $0.99' },
                                    { id: 'large', type: 'default', text: '500 üíé - $3.99' },
                                    { type: 'cancel' }
                                ]
                            }, (buttonId) => {
                                setTimeout(() => {
                                    setIsPopupOpen(false)
                                    if (buttonId && buttonId !== 'cancel') {
                                        console.log(`Selected package: ${buttonId}`)
                                        webApp?.HapticFeedback.notificationOccurred('success')
                                        // Navigate to payment page instead of showing alert
                                    }
                                }, 100)
                            })
                        }}
                        className="btn-secondary"
                    >
                        In-App Purchase
                    </button>

                    <button
                        onClick={() => {
                            const shareText = 'Join me in this awesome game!'
                            const botUrl = 'https://t.me/yourbotname'
                            webApp?.openTelegramLink(
                                `https://t.me/share/url?url=${encodeURIComponent(botUrl)}&text=${encodeURIComponent(shareText)}`
                            )
                        }}
                        className="btn-secondary"
                    >
                        Direct Share (No Inline Needed)
                    </button>
                </div>
            </DemoSection>
        </div>
    )
}


/components/demos/QRScannerDemo.tsx

// components/demos/QRScannerDemo.tsx
'use client'

import { useState } from 'react'
import { useTelegram } from '@/providers/TelegramProvider'
import DemoSection from '@/components/DemoSection'
import CodeBlock from '@/components/CodeBlock'
import QRCode from 'react-qr-code'

export default function QRScannerDemo() {
    const { webApp } = useTelegram()
    const [scanHistory, setScanHistory] = useState<Array<{
        text: string
        timestamp: Date
        type: string
    }>>([])

    const scanQRCode = () => {
        webApp?.showScanQrPopup(
            { text: 'Scan any QR code' },
            (text: string) => {
                // Detect QR code type
                const type = detectQRType(text)

                // Add to history
                setScanHistory(prev => [{
                    text,
                    timestamp: new Date(),
                    type
                }, ...prev.slice(0, 4)]) // Keep last 5 scans

                // Handle based on type with delay to avoid popup conflicts
                setTimeout(() => {
                    handleQRResult(text, type)
                }, 100)

                // Return true to close scanner
                return true
            }
        )
    }

    const scanQRCodeLinksOnly = () => {
        webApp?.showScanQrPopup(
            { text: 'Scan a QR code containing a URL' },
            (text: string) => {
                // Check if it's a valid URL
                const lowerText = text.toLowerCase()
                if (lowerText.startsWith('http://') || lowerText.startsWith('https://')) {
                    webApp.HapticFeedback.notificationOccurred('success')

                    // Add to history
                    setScanHistory(prev => [{
                        text,
                        timestamp: new Date(),
                        type: 'URL'
                    }, ...prev.slice(0, 4)])

                    // Ask user if they want to open the link with proper delay
                    setTimeout(() => {
                        webApp.showConfirm(
                            `Open this link?\n\n${text}`,
                            (confirmed) => {
                                if (confirmed) {
                                    webApp.openLink(text)
                                }
                            }
                        )
                    }, 100) // Increased delay for safety

                    return true
                } else {
                    // Not a URL, keep scanner open
                    // Only use haptic feedback, no alert while scanner is open
                    webApp.HapticFeedback.notificationOccurred('error')
                    return false
                }
            }
        )
    }

    const scanGameCode = () => {
        webApp?.showScanQrPopup(
            { text: 'Scan game bonus code' },
            (text: string) => {
                // Check if it's a valid game code format
                if (text.match(/^BONUS-[A-Z0-9]{6}$/)) {
                    webApp.HapticFeedback.notificationOccurred('success')

                    setScanHistory(prev => [{
                        text,
                        timestamp: new Date(),
                        type: 'Game Code'
                    }, ...prev.slice(0, 4)])

                    // Delay the success alert to avoid popup conflict
                    setTimeout(() => {
                        webApp.showAlert(`üéâ Bonus code activated!\n\nYou received 100 coins!`)
                    }, 100)

                    return true
                } else {
                    // Invalid code - use haptic feedback only
                    // Don't show alert while scanner is still open
                    webApp.HapticFeedback.notificationOccurred('error')

                    // Optionally, you could show a toast or update UI state
                    // to indicate invalid code without using popups

                    return false // Keep scanner open
                }
            }
        )
    }

    const detectQRType = (text: string): string => {
        const lowerText = text.toLowerCase()

        // URL detection
        if (lowerText.startsWith('http://') || lowerText.startsWith('https://')) {
            return 'URL'
        }

        // Email detection
        if (lowerText.startsWith('mailto:') || text.includes('@')) {
            return 'Email'
        }

        // Phone detection
        if (lowerText.startsWith('tel:') || text.match(/^\+?[\d\s\-\(\)]+$/)) {
            return 'Phone'
        }

        // WiFi detection
        if (lowerText.startsWith('wifi:')) {
            return 'WiFi'
        }

        // Telegram link detection
        if (lowerText.includes('t.me/') || lowerText.includes('telegram.me/')) {
            return 'Telegram'
        }

        // Game code detection
        if (text.match(/^BONUS-[A-Z0-9]{6}$/)) {
            return 'Game Code'
        }

        // vCard detection
        if (lowerText.startsWith('begin:vcard')) {
            return 'Contact'
        }

        // SMS detection
        if (lowerText.startsWith('sms:') || lowerText.startsWith('smsto:')) {
            return 'SMS'
        }

        // Default
        return 'Text'
    }

    const handleQRResult = (text: string, type: string) => {
        // Haptic feedback first (doesn't conflict with popups)
        webApp?.HapticFeedback.notificationOccurred('success')

        switch (type) {
            case 'URL':
                webApp?.showConfirm(
                    `Open this link?\n\n${text}`,
                    (confirmed) => {
                        if (confirmed) {
                            webApp.openLink(text)
                        }
                    }
                )
                break

            case 'Telegram':
                webApp?.showConfirm(
                    `Open in Telegram?\n\n${text}`,
                    (confirmed) => {
                        if (confirmed) {
                            webApp.openTelegramLink(text)
                        }
                    }
                )
                break

            case 'Email':
                const email = text.replace('mailto:', '')
                webApp?.showAlert(`Email address:\n${email}`)
                break

            case 'Phone':
                const phone = text.replace('tel:', '')
                webApp?.showAlert(`Phone number:\n${phone}`)
                break

            case 'WiFi':
                webApp?.showAlert('WiFi network detected!\n\n' + parseWiFiQR(text))
                break

            case 'Game Code':
                // Already handled in scanGameCode with proper delay
                break

            default:
                webApp?.showAlert(`Scanned ${type}:\n\n${text}`)
        }
    }

    const parseWiFiQR = (text: string): string => {
        // Basic WiFi QR code parser
        const parts = text.split(';')
        let result = ''

        parts.forEach(part => {
            if (part.startsWith('S:')) {
                result += `Network: ${part.substring(2)}\n`
            } else if (part.startsWith('T:')) {
                result += `Security: ${part.substring(2)}\n`
            } else if (part.startsWith('P:')) {
                result += `Password: ${part.substring(2)}\n`
            }
        })

        return result || text
    }

    const clearHistory = () => {
        setScanHistory([])
        webApp?.HapticFeedback.notificationOccurred('success')
    }

    // Check version support
    const supportsQRScanner = webApp?.isVersionAtLeast('6.9') ?? false

    return (
        <div className="space-y-6">
            <DemoSection title="üì∑ QR Code Scanner">
                <div className="space-y-4">
                    {/* Version check */}
                    {webApp && !supportsQRScanner && (
                        <div className="p-3 bg-yellow-500/20 border border-yellow-500/30 rounded-lg">
                            <p className="text-sm text-yellow-600 dark:text-yellow-400">
                                ‚ö†Ô∏è QR Scanner requires Telegram version 6.9 or higher.
                                Your version: {webApp.version}
                            </p>
                        </div>
                    )}

                    {/* Main scanner buttons */}
                    <div className="space-y-3">
                        <button
                            onClick={scanQRCode}
                            className="btn-primary w-full"
                            disabled={!supportsQRScanner}
                        >
                            üì∑ Scan Any QR Code
                        </button>

                        <button
                            onClick={scanQRCodeLinksOnly}
                            className="btn-primary w-full"
                            disabled={!supportsQRScanner}
                        >
                            üîó Scan URLs Only
                        </button>

                        <button
                            onClick={scanGameCode}
                            className="btn-primary w-full"
                            disabled={!supportsQRScanner}
                        >
                            üéÆ Scan Game Bonus Code
                        </button>
                    </div>

                    {/* Info box */}
                    <div className="p-3 bg-blue-500/10 border border-blue-500/30 rounded-lg">
                        <p className="text-sm text-blue-600 dark:text-blue-400">
                            üí° <strong>Tip:</strong> The QR scanner can detect different types of QR codes
                            and handle them appropriately. Try scanning URLs, phone numbers, WiFi credentials,
                            or game bonus codes!
                        </p>
                    </div>
                </div>

                <CodeBlock language="typescript">
                    {`// Basic QR scanner
webApp.showScanQrPopup({
  text: 'Scan any QR code'
}, (text) => {
  console.log('Scanned:', text)
  
  // Delay any popups to avoid conflicts
  setTimeout(() => {
    handleScannedData(text)
  }, 100)
  
  // Return true to close scanner
  return true
})

// URL-only scanner with validation
webApp.showScanQrPopup({
  text: 'Scan a URL'
}, (text) => {
  if (text.startsWith('http://') || text.startsWith('https://')) {
    // Valid URL - close scanner first
    setTimeout(() => {
      webApp.openLink(text)
    }, 100)
    return true // Close scanner
  } else {
    // Invalid, keep scanner open
    // Use haptic feedback instead of alert
    webApp.HapticFeedback.notificationOccurred('error')
    return false
  }
})

// Game code scanner with format validation
webApp.showScanQrPopup({
  text: 'Scan bonus code'
}, (text) => {
  if (text.match(/^BONUS-[A-Z0-9]{6}$/)) {
    // Valid code - close scanner first
    setTimeout(() => {
      activateBonusCode(text)
      webApp.showAlert('Code activated!')
    }, 100)
    return true
  } else {
    // Don't show alert while scanner is open!
    webApp.HapticFeedback.notificationOccurred('error')
    return false // Keep scanner open
  }
})

// Best practice: Never show popups when returning false
// Always add delays when showing popups after returning true`}
                </CodeBlock>
            </DemoSection>

            <DemoSection title="üìã Scan History">
                <div className="space-y-3">
                    {scanHistory.length > 0 ? (
                        <>
                            <div className="flex justify-between items-center">
                                <h4 className="font-semibold">Recent Scans</h4>
                                <button
                                    onClick={clearHistory}
                                    className="text-sm text-[var(--tg-theme-hint-color)] hover:text-[var(--tg-theme-text-color)]"
                                >
                                    Clear History
                                </button>
                            </div>

                            {scanHistory.map((scan, index) => (
                                <div
                                    key={index}
                                    className="p-3 bg-[var(--tg-theme-secondary-bg-color)] rounded"
                                >
                                    <div className="flex justify-between items-start mb-1">
                                        <span className="font-semibold text-sm">{scan.type}</span>
                                        <span className="text-xs text-[var(--tg-theme-hint-color)]">
                                            {scan.timestamp.toLocaleTimeString()}
                                        </span>
                                    </div>
                                    <div className="text-sm break-all text-[var(--tg-theme-hint-color)]">
                                        {scan.text}
                                    </div>
                                </div>
                            ))}
                        </>
                    ) : (
                        <p className="text-center text-[var(--tg-theme-hint-color)]">
                            No QR codes scanned yet
                        </p>
                    )}
                </div>
            </DemoSection>

            <DemoSection title="üéØ QR Code Types">
                <div className="grid grid-cols-2 gap-3">
                    <div className="p-3 bg-[var(--tg-theme-secondary-bg-color)] rounded">
                        <div className="font-semibold mb-1">üîó URLs</div>
                        <div className="text-sm text-[var(--tg-theme-hint-color)]">
                            Website links, deep links
                        </div>
                    </div>

                    <div className="p-3 bg-[var(--tg-theme-secondary-bg-color)] rounded">
                        <div className="font-semibold mb-1">üì± Contact Info</div>
                        <div className="text-sm text-[var(--tg-theme-hint-color)]">
                            Phone, email, vCard
                        </div>
                    </div>

                    <div className="p-3 bg-[var(--tg-theme-secondary-bg-color)] rounded">
                        <div className="font-semibold mb-1">üì∂ WiFi</div>
                        <div className="text-sm text-[var(--tg-theme-hint-color)]">
                            Network credentials
                        </div>
                    </div>

                    <div className="p-3 bg-[var(--tg-theme-secondary-bg-color)] rounded">
                        <div className="font-semibold mb-1">üéÆ Game Codes</div>
                        <div className="text-sm text-[var(--tg-theme-hint-color)]">
                            Bonus codes, unlocks
                        </div>
                    </div>
                </div>
            </DemoSection>

            <DemoSection title="üí° Use Cases">
                <div className="space-y-3">
                    <div className="p-3 bg-[var(--tg-theme-secondary-bg-color)] rounded">
                        <h4 className="font-semibold">üéÆ Gaming</h4>
                        <ul className="text-sm text-[var(--tg-theme-hint-color)] mt-1 space-y-1">
                            <li>‚Ä¢ Unlock bonus levels or items</li>
                            <li>‚Ä¢ Share game rooms or lobbies</li>
                            <li>‚Ä¢ Redeem promotional codes</li>
                            <li>‚Ä¢ Transfer items between players</li>
                        </ul>
                    </div>

                    <div className="p-3 bg-[var(--tg-theme-secondary-bg-color)] rounded">
                        <h4 className="font-semibold">üõçÔ∏è E-commerce</h4>
                        <ul className="text-sm text-[var(--tg-theme-hint-color)] mt-1 space-y-1">
                            <li>‚Ä¢ Quick product lookup</li>
                            <li>‚Ä¢ Apply discount codes</li>
                            <li>‚Ä¢ Track shipments</li>
                            <li>‚Ä¢ Verify authenticity</li>
                        </ul>
                    </div>

                    <div className="p-3 bg-[var(--tg-theme-secondary-bg-color)] rounded">
                        <h4 className="font-semibold">üé´ Events</h4>
                        <ul className="text-sm text-[var(--tg-theme-hint-color)] mt-1 space-y-1">
                            <li>‚Ä¢ Check-in attendees</li>
                            <li>‚Ä¢ Validate tickets</li>
                            <li>‚Ä¢ Share contact info</li>
                            <li>‚Ä¢ Access event WiFi</li>
                        </ul>
                    </div>
                </div>
            </DemoSection>

            <DemoSection title="üé≤ Sample QR Codes">
                <div className="space-y-3">
                    <p className="text-sm text-[var(--tg-theme-hint-color)]">
                        Try scanning these sample codes to test the scanner:
                    </p>

                    <div className="grid grid-cols-2 gap-3">
                        <div className="p-3 bg-[var(--tg-theme-secondary-bg-color)] rounded">
                            <div className="bg-white p-2 rounded mb-2">
                                <QRCode
                                    value="BONUS-ABC123"
                                    size={100}
                                    style={{ height: "auto", maxWidth: "100%", width: "100%" }}
                                />
                            </div>
                            <div className="text-xs font-mono text-center">BONUS-ABC123</div>
                            <div className="text-xs text-[var(--tg-theme-hint-color)] text-center">Game Code</div>
                        </div>

                        <div className="p-3 bg-[var(--tg-theme-secondary-bg-color)] rounded">
                            <div className="bg-white p-2 rounded mb-2">
                                <QRCode
                                    value="https://telegram.org"
                                    size={100}
                                    style={{ height: "auto", maxWidth: "100%", width: "100%" }}
                                />
                            </div>
                            <div className="text-xs font-mono text-center">telegram.org</div>
                            <div className="text-xs text-[var(--tg-theme-hint-color)] text-center">URL</div>
                        </div>

                        <div className="p-3 bg-[var(--tg-theme-secondary-bg-color)] rounded">
                            <div className="bg-white p-2 rounded mb-2">
                                <QRCode
                                    value="tel:+1234567890"
                                    size={100}
                                    style={{ height: "auto", maxWidth: "100%", width: "100%" }}
                                />
                            </div>
                            <div className="text-xs font-mono text-center">+1234567890</div>
                            <div className="text-xs text-[var(--tg-theme-hint-color)] text-center">Phone</div>
                        </div>

                        <div className="p-3 bg-[var(--tg-theme-secondary-bg-color)] rounded">
                            <div className="bg-white p-2 rounded mb-2">
                                <QRCode
                                    value="mailto:test@example.com"
                                    size={100}
                                    style={{ height: "auto", maxWidth: "100%", width: "100%" }}
                                />
                            </div>
                            <div className="text-xs font-mono text-center">test@example.com</div>
                            <div className="text-xs text-[var(--tg-theme-hint-color)] text-center">Email</div>
                        </div>
                    </div>

                    {/* Add more complex examples */}
                    <div className="grid grid-cols-2 gap-3 mt-3">
                        <div className="p-3 bg-[var(--tg-theme-secondary-bg-color)] rounded">
                            <div className="bg-white p-2 rounded mb-2">
                                <QRCode
                                    value="WIFI:T:WPA;S:MyNetwork;P:MyPassword;;"
                                    size={100}
                                    style={{ height: "auto", maxWidth: "100%", width: "100%" }}
                                />
                            </div>
                            <div className="text-xs font-mono text-center">WiFi Network</div>
                            <div className="text-xs text-[var(--tg-theme-hint-color)] text-center">Connect to WiFi</div>
                        </div>

                        <div className="p-3 bg-[var(--tg-theme-secondary-bg-color)] rounded">
                            <div className="bg-white p-2 rounded mb-2">
                                <QRCode
                                    value="https://t.me/durov"
                                    size={100}
                                    style={{ height: "auto", maxWidth: "100%", width: "100%" }}
                                />
                            </div>
                            <div className="text-xs font-mono text-center">@durov</div>
                            <div className="text-xs text-[var(--tg-theme-hint-color)] text-center">Telegram Link</div>
                        </div>
                    </div>
                </div>
            </DemoSection>
        </div>
    )
}


/components/demos/SensorsDemo.tsx

// components/demos/SensorsDemo.tsx
'use client'

import { useState, useEffect } from 'react'
import { useTelegram } from '@/providers/TelegramProvider'
import DemoSection from '@/components/DemoSection'
import CodeBlock from '@/components/CodeBlock'
import type { LocationData } from '@/types/telegram'

export default function SensorsDemo() {
    const { webApp } = useTelegram()
    const [accelerometer, setAccelerometer] = useState({ x: 0, y: 0, z: 0 })
    const [gyroscope, setGyroscope] = useState({ x: 0, y: 0, z: 0 })
    const [orientation, setOrientation] = useState({ alpha: 0, beta: 0, gamma: 0 })
    const [locationData, setLocationData] = useState<LocationData | null>(null)

    // Track sensor states
    const [isAccelerometerStarted, setIsAccelerometerStarted] = useState(false)
    const [isGyroscopeStarted, setIsGyroscopeStarted] = useState(false)
    const [isOrientationStarted, setIsOrientationStarted] = useState(false)

    useEffect(() => {
        if (!webApp) return

        // Initialize states
        setIsAccelerometerStarted(webApp.Accelerometer?.isStarted || false)
        setIsGyroscopeStarted(webApp.Gyroscope?.isStarted || false)
        setIsOrientationStarted(webApp.DeviceOrientation?.isStarted || false)

        // Initialize location manager
        webApp.LocationManager?.init()

        // Accelerometer
        const handleAccelerometerChange = () => {
            setAccelerometer({
                x: webApp.Accelerometer.x,
                y: webApp.Accelerometer.y,
                z: webApp.Accelerometer.z
            })
        }

        // Gyroscope
        const handleGyroscopeChange = () => {
            setGyroscope({
                x: webApp.Gyroscope.x,
                y: webApp.Gyroscope.y,
                z: webApp.Gyroscope.z
            })
        }

        // Device Orientation
        const handleOrientationChange = () => {
            setOrientation({
                alpha: webApp.DeviceOrientation.alpha,
                beta: webApp.DeviceOrientation.beta,
                gamma: webApp.DeviceOrientation.gamma
            })
        }

        webApp.onEvent('accelerometerChanged', handleAccelerometerChange)
        webApp.onEvent('gyroscopeChanged', handleGyroscopeChange)
        webApp.onEvent('deviceOrientationChanged', handleOrientationChange)

        // Cleanup
        return () => {
            webApp.offEvent('accelerometerChanged', handleAccelerometerChange)
            webApp.offEvent('gyroscopeChanged', handleGyroscopeChange)
            webApp.offEvent('deviceOrientationChanged', handleOrientationChange)
        }
    }, [webApp])

    const toggleAccelerometer = () => {
        if (webApp?.Accelerometer.isStarted) {
            webApp.Accelerometer.stop()
            setIsAccelerometerStarted(false)
            // Reset values when stopped
            setAccelerometer({ x: 0, y: 0, z: 0 })
        } else {
            webApp?.Accelerometer.start({ refresh_rate: 60 })
            setIsAccelerometerStarted(true)
        }
    }

    const toggleGyroscope = () => {
        if (webApp?.Gyroscope.isStarted) {
            webApp.Gyroscope.stop()
            setIsGyroscopeStarted(false)
            // Reset values when stopped
            setGyroscope({ x: 0, y: 0, z: 0 })
        } else {
            webApp?.Gyroscope.start({ refresh_rate: 60 })
            setIsGyroscopeStarted(true)
        }
    }

    const toggleOrientation = () => {
        if (webApp?.DeviceOrientation.isStarted) {
            webApp.DeviceOrientation.stop()
            setIsOrientationStarted(false)
            // Reset values when stopped
            setOrientation({ alpha: 0, beta: 0, gamma: 0 })
        } else {
            webApp?.DeviceOrientation.start({ refresh_rate: 60 })
            setIsOrientationStarted(true)
        }
    }

    const getLocation = () => {
        webApp?.LocationManager.getLocation((location: LocationData | null) => {
            if (location) {
                setLocationData(location)
                webApp.HapticFeedback.notificationOccurred('success')
            } else {
                webApp.showAlert('Location access denied')
            }
        })
    }

    return (
        <div className="space-y-6">
            <div className="p-3 bg-blue-500/10 border border-blue-500/30 rounded-lg">
                <p className="text-sm text-blue-600 dark:text-blue-400">
                    üí° <strong>Note:</strong> Sensors require Telegram v8.0+ and device permission.
                    Move your device to see values change.
                </p>
            </div>

            <DemoSection title="üìä Accelerometer">
                <div className="space-y-4">
                    <button onClick={toggleAccelerometer} className="btn-primary w-full">
                        {isAccelerometerStarted ? '‚èπÔ∏è Stop' : '‚ñ∂Ô∏è Start'} Accelerometer
                    </button>

                    <div className="p-4 bg-[var(--tg-theme-secondary-bg-color)] rounded-lg font-mono text-sm">
                        <div className={!isAccelerometerStarted ? 'opacity-50' : ''}>
                            <div>X: {accelerometer.x.toFixed(3)}</div>
                            <div>Y: {accelerometer.y.toFixed(3)}</div>
                            <div>Z: {accelerometer.z.toFixed(3)}</div>
                        </div>
                        {!isAccelerometerStarted && (
                            <p className="text-xs text-[var(--tg-theme-hint-color)] mt-2">
                                Press Start to begin reading sensor data
                            </p>
                        )}
                    </div>
                </div>

                <CodeBlock language="typescript">
                    {`// Accelerometer for motion controls
webApp.Accelerometer.start({ refresh_rate: 60 })

webApp.onEvent('accelerometerChanged', () => {
  const { x, y, z } = webApp.Accelerometer
  
  // Use for tilt controls
  player.velocity.x = x * sensitivity
  player.velocity.y = y * sensitivity
})`}
                </CodeBlock>
            </DemoSection>

            <DemoSection title="üåÄ Gyroscope">
                <div className="space-y-4">
                    <button onClick={toggleGyroscope} className="btn-primary w-full">
                        {isGyroscopeStarted ? '‚èπÔ∏è Stop' : '‚ñ∂Ô∏è Start'} Gyroscope
                    </button>

                    <div className="p-4 bg-[var(--tg-theme-secondary-bg-color)] rounded-lg font-mono text-sm">
                        <div className={!isGyroscopeStarted ? 'opacity-50' : ''}>
                            <div>X: {gyroscope.x.toFixed(3)}</div>
                            <div>Y: {gyroscope.y.toFixed(3)}</div>
                            <div>Z: {gyroscope.z.toFixed(3)}</div>
                        </div>
                        {!isGyroscopeStarted && (
                            <p className="text-xs text-[var(--tg-theme-hint-color)] mt-2">
                                Press Start to begin reading sensor data
                            </p>
                        )}
                    </div>
                </div>

                <CodeBlock language="typescript">
                    {`// Gyroscope for rotation
webApp.Gyroscope.start({ refresh_rate: 60 })

webApp.onEvent('gyroscopeChanged', () => {
  const { x, y, z } = webApp.Gyroscope
  
  // Use for 3D rotation
  camera.rotation.x += x * deltaTime
  camera.rotation.y += y * deltaTime
})`}
                </CodeBlock>
            </DemoSection>

            <DemoSection title="üìê Device Orientation">
                <div className="space-y-4">
                    <button onClick={toggleOrientation} className="btn-primary w-full">
                        {isOrientationStarted ? '‚èπÔ∏è Stop' : '‚ñ∂Ô∏è Start'} Orientation
                    </button>

                    <div className="p-4 bg-[var(--tg-theme-secondary-bg-color)] rounded-lg font-mono text-sm">
                        <div className={!isOrientationStarted ? 'opacity-50' : ''}>
                            <div>Alpha: {orientation.alpha.toFixed(1)}¬∞</div>
                            <div>Beta: {orientation.beta.toFixed(1)}¬∞</div>
                            <div>Gamma: {orientation.gamma.toFixed(1)}¬∞</div>
                        </div>
                        {!isOrientationStarted && (
                            <p className="text-xs text-[var(--tg-theme-hint-color)] mt-2">
                                Press Start to begin reading sensor data
                            </p>
                        )}
                    </div>
                </div>

                <CodeBlock language="typescript">
                    {`// Device orientation for AR/VR
webApp.DeviceOrientation.start({ 
  refresh_rate: 60,
  need_absolute: true 
})

webApp.onEvent('deviceOrientationChanged', () => {
  const { alpha, beta, gamma } = webApp.DeviceOrientation
  
  // Use for AR camera view
  arCamera.setRotation(alpha, beta, gamma)
})`}
                </CodeBlock>
            </DemoSection>

            <DemoSection title="üìç Location">
                <div className="space-y-4">
                    <button onClick={getLocation} className="btn-primary w-full">
                        Get Current Location
                    </button>

                    {locationData && (
                        <div className="p-3 bg-[var(--tg-theme-secondary-bg-color)] rounded text-sm">
                            <div className="grid grid-cols-2 gap-2">
                                <div>
                                    <span className="text-[var(--tg-theme-hint-color)]">Latitude:</span>
                                    <div className="font-mono">{locationData.latitude.toFixed(6)}¬∞</div>
                                </div>
                                <div>
                                    <span className="text-[var(--tg-theme-hint-color)]">Longitude:</span>
                                    <div className="font-mono">{locationData.longitude.toFixed(6)}¬∞</div>
                                </div>
                                {locationData.altitude !== undefined && (
                                    <div>
                                        <span className="text-[var(--tg-theme-hint-color)]">Altitude:</span>
                                        <div className="font-mono">{locationData.altitude.toFixed(2)}m</div>
                                    </div>
                                )}
                                {locationData.speed !== undefined && (
                                    <div>
                                        <span className="text-[var(--tg-theme-hint-color)]">Speed:</span>
                                        <div className="font-mono">{locationData.speed.toFixed(2)}m/s</div>
                                    </div>
                                )}
                                {locationData.horizontal_accuracy !== undefined && (
                                    <div>
                                        <span className="text-[var(--tg-theme-hint-color)]">Accuracy:</span>
                                        <div className="font-mono">¬±{locationData.horizontal_accuracy.toFixed(0)}m</div>
                                    </div>
                                )}
                            </div>
                        </div>
                    )}

                    <div className="p-3 bg-[var(--tg-theme-secondary-bg-color)] rounded">
                        <p className="text-sm text-[var(--tg-theme-hint-color)]">
                            Location data can be used for:
                        </p>
                        <ul className="text-sm mt-2 space-y-1">
                            <li>‚Ä¢ Location-based games (AR, geocaching)</li>
                            <li>‚Ä¢ Finding nearby players or items</li>
                            <li>‚Ä¢ Weather-based game mechanics</li>
                            <li>‚Ä¢ Distance tracking and achievements</li>
                        </ul>
                    </div>
                </div>

                <CodeBlock language="typescript">
                    {`// Initialize location manager
webApp.LocationManager.init()

// Get one-time location
webApp.LocationManager.getLocation((location) => {
  if (location) {
    console.log('User location:', {
      lat: location.latitude,
      lng: location.longitude,
      accuracy: location.horizontal_accuracy
    })
    
    // Use for location-based features
    findNearbyPlayers(location)
    loadLocalWeather(location)
  } else {
    console.log('Location access denied')
  }
})

// Check permission status
if (webApp.LocationManager.isLocationAvailable) {
  // Location services are available
  if (webApp.LocationManager.isAccessGranted) {
    // Permission already granted
    getLocation()
  }
}`}
                </CodeBlock>
            </DemoSection>
        </div>
    )
}


/components/demos/ShareStoryDemo.tsx

// components/demos/ShareStoryDemo.tsx
'use client'

import { useState } from 'react'
import { useTelegram } from '@/providers/TelegramProvider'
import DemoSection from '@/components/DemoSection'
import CodeBlock from '@/components/CodeBlock'

export default function ShareStoryDemo() {
    const { webApp } = useTelegram()
    const [customUrl, setCustomUrl] = useState('https://telegra.ph/file/5583ac37c90979f052b7b.png')
    const [storyText, setStoryText] = useState('Check out my achievement! üéÆ')
    const [widgetUrl, setWidgetUrl] = useState('https://t.me/yourgamebot')
    const [widgetName, setWidgetName] = useState('Play Game')

    const sharePresets = [
        {
            title: 'Game Score',
            image: 'https://telegra.ph/file/5583ac37c90979f052b7b.png',
            text: 'üéÆ I just scored 10,000 points!',
            widget: { url: 'https://t.me/yourgamebot', name: 'Beat my score!' }
        },
        {
            title: 'Achievement',
            image: 'https://telegra.ph/file/5583ac37c90979f052b7b.png',
            text: 'üèÜ Level 100 Completed!',
            widget: { url: 'https://t.me/yourgamebot', name: 'Play Now' }
        },
        {
            title: 'Video Moment',
            video: 'https://telegra.ph/file/61f1dac694c3131a7b4ac.mp4',
            text: 'üé¨ Epic gameplay moment!',
            widget: { url: 'https://t.me/yourgamebot', name: 'Watch More' }
        }
    ]

    const shareBasicImage = () => {
        webApp?.shareToStory('https://telegra.ph/file/5583ac37c90979f052b7b.png')
    }

    const shareImageWithText = () => {
        webApp?.shareToStory(
            'https://telegra.ph/file/5583ac37c90979f052b7b.png',
            { text: storyText }
        )
    }

    const shareWithWidget = () => {
        webApp?.shareToStory(
            customUrl,
            {
                text: storyText,
                widget_link: {
                    url: widgetUrl,
                    name: widgetName
                }
            }
        )
    }

    const shareVideo = () => {
        webApp?.shareToStory(
            'https://telegra.ph/file/61f1dac694c3131a7b4ac.mp4',
            {
                text: 'üé• Amazing gameplay footage!',
                widget_link: {
                    url: 'https://t.me/yourgamebot',
                    name: 'Watch Full Video'
                }
            }
        )
    }

    return (
        <div className="space-y-6">
            <DemoSection title="üì∏ Share to Story">
                <div className="space-y-4">
                    <div className="p-4 bg-[var(--tg-theme-secondary-bg-color)] rounded-lg">
                        <h4 className="font-semibold mb-3">Quick Share Options</h4>

                        <div className="space-y-2">
                            <button onClick={shareBasicImage} className="btn-primary w-full">
                                Share Basic Image
                            </button>

                            <button onClick={shareImageWithText} className="btn-primary w-full">
                                Share Image with Caption
                            </button>

                            <button onClick={shareVideo} className="btn-primary w-full">
                                Share Video Story
                            </button>
                        </div>
                    </div>

                    <div className="p-4 bg-[var(--tg-theme-secondary-bg-color)] rounded-lg">
                        <h4 className="font-semibold mb-3">Custom Story Builder</h4>

                        <div className="space-y-3">
                            <div>
                                <label className="text-sm text-[var(--tg-theme-hint-color)]">Media URL</label>
                                <input
                                    type="text"
                                    value={customUrl}
                                    onChange={(e) => setCustomUrl(e.target.value)}
                                    className="w-full p-2 mt-1 rounded bg-[var(--tg-theme-bg-color)] text-[var(--tg-theme-text-color)]"
                                    placeholder="Image or video URL"
                                />
                            </div>

                            <div>
                                <label className="text-sm text-[var(--tg-theme-hint-color)]">Caption Text</label>
                                <input
                                    type="text"
                                    value={storyText}
                                    onChange={(e) => setStoryText(e.target.value)}
                                    className="w-full p-2 mt-1 rounded bg-[var(--tg-theme-bg-color)] text-[var(--tg-theme-text-color)]"
                                    placeholder="Story caption"
                                />
                            </div>

                            <div>
                                <label className="text-sm text-[var(--tg-theme-hint-color)]">Widget Link URL</label>
                                <input
                                    type="text"
                                    value={widgetUrl}
                                    onChange={(e) => setWidgetUrl(e.target.value)}
                                    className="w-full p-2 mt-1 rounded bg-[var(--tg-theme-bg-color)] text-[var(--tg-theme-text-color)]"
                                    placeholder="Link URL"
                                />
                            </div>

                            <div>
                                <label className="text-sm text-[var(--tg-theme-hint-color)]">Widget Button Text</label>
                                <input
                                    type="text"
                                    value={widgetName}
                                    onChange={(e) => setWidgetName(e.target.value)}
                                    className="w-full p-2 mt-1 rounded bg-[var(--tg-theme-bg-color)] text-[var(--tg-theme-text-color)]"
                                    placeholder="Button text"
                                />
                            </div>

                            <button onClick={shareWithWidget} className="btn-primary w-full">
                                Share Custom Story
                            </button>
                        </div>
                    </div>
                </div>

                <CodeBlock language="typescript">
                    {`// Basic image share
webApp.shareToStory('https://example.com/image.png')

// With caption
webApp.shareToStory(imageUrl, {
  text: 'Check out my score! üéÆ'
})

// With interactive widget
webApp.shareToStory(mediaUrl, {
  text: 'Level completed! üèÜ',
  widget_link: {
    url: 'https://t.me/yourgamebot',
    name: 'Play Now'
  }
})

// Video story
webApp.shareToStory('https://example.com/video.mp4', {
  text: 'Epic moment! üé•',
  widget_link: {
    url: 'https://t.me/yourgamebot/replay',
    name: 'Watch Replay'
  }
})`}
                </CodeBlock>
            </DemoSection>

            <DemoSection title="üéÆ Game Integration Examples">
                <div className="space-y-3">
                    {sharePresets.map((preset, index) => (
                        <div
                            key={index}
                            className="p-3 bg-[var(--tg-theme-secondary-bg-color)] rounded flex justify-between items-center"
                        >
                            <div>
                                <div className="font-semibold">{preset.title}</div>
                                <div className="text-sm text-[var(--tg-theme-hint-color)]">{preset.text}</div>
                            </div>
                            <button
                                onClick={() => {
                                    const mediaUrl = preset.image || preset.video || ''
                                    webApp?.shareToStory(mediaUrl, {
                                        text: preset.text,
                                        widget_link: preset.widget
                                    })
                                }}
                                className="btn-primary px-4 py-2"
                            >
                                Share
                            </button>
                        </div>
                    ))}
                </div>
            </DemoSection>

            <DemoSection title="üí° Best Practices">
                <div className="space-y-3">
                    <div className="p-3 bg-[var(--tg-theme-secondary-bg-color)] rounded">
                        <h4 className="font-semibold">üìè Media Requirements</h4>
                        <ul className="text-sm text-[var(--tg-theme-hint-color)] mt-1 space-y-1">
                            <li>‚Ä¢ Images: 1080x1920px (9:16 ratio)</li>
                            <li>‚Ä¢ Videos: Max 30 seconds, MP4 format</li>
                            <li>‚Ä¢ File size: Under 50MB</li>
                        </ul>
                    </div>

                    <div className="p-3 bg-[var(--tg-theme-secondary-bg-color)] rounded">
                        <h4 className="font-semibold">‚ú® Engagement Tips</h4>
                        <ul className="text-sm text-[var(--tg-theme-hint-color)] mt-1 space-y-1">
                            <li>‚Ä¢ Use eye-catching visuals</li>
                            <li>‚Ä¢ Add compelling call-to-action</li>
                            <li>‚Ä¢ Include game achievements or scores</li>
                            <li>‚Ä¢ Make widget links contextual</li>
                        </ul>
                    </div>
                </div>
            </DemoSection>
        </div>
    )
}


/components/demos/StorageDemo.tsx

// components/demos/StorageDemo.tsx
'use client'

import { useState, useEffect } from 'react'
import { useTelegram } from '@/providers/TelegramProvider'
import DemoSection from '@/components/DemoSection'
import CodeBlock from '@/components/CodeBlock'

interface GameData {
    level: number
    score: number
    achievements: string[]
}

export default function StorageDemo() {
    const { webApp } = useTelegram()
    const [gameData, setGameData] = useState<GameData>({
        level: 1,
        score: 0,
        achievements: []
    })
    const [savedKeys, setSavedKeys] = useState<string[]>([])
    const [loading, setLoading] = useState(false)

    const loadGameData = async () => {
        setLoading(true)
        webApp?.CloudStorage.getItem('gameData', (err, value) => {
            if (!err && value) {
                setGameData(JSON.parse(value))
            }
            setLoading(false)
        })
    }

    const saveGameData = async () => {
        const data = JSON.stringify(gameData)
        webApp?.CloudStorage.setItem('gameData', data, (err, stored) => {
            if (stored) {
                webApp.showAlert('Game saved!')
                webApp.HapticFeedback.notificationOccurred('success')
            }
        })
    }

    const loadAllKeys = () => {
        webApp?.CloudStorage.getKeys((err, keys) => {
            if (!err && keys) {
                setSavedKeys(keys)
            }
        })
    }

    useEffect(() => {
        if (webApp) {
            loadGameData()
            loadAllKeys()
        }
    }, [webApp])

    return (
        <div className="space-y-6">
            <DemoSection title="üíæ Cloud Storage">
                <div className="space-y-4">
                    <div className="p-4 bg-[var(--tg-theme-secondary-bg-color)] rounded-lg">
                        <h4 className="font-semibold mb-2">Game Data</h4>
                        <div className="space-y-1 text-sm">
                            <div>Level: {gameData.level}</div>
                            <div>Score: {gameData.score}</div>
                            <div>Achievements: {gameData.achievements.join(', ') || 'None'}</div>
                        </div>
                    </div>

                    <div className="grid grid-cols-2 gap-2">
                        <button
                            onClick={() => setGameData(d => ({ ...d, level: d.level + 1 }))}
                            className="btn-primary"
                        >
                            Level Up
                        </button>

                        <button
                            onClick={() => setGameData(d => ({ ...d, score: d.score + 100 }))}
                            className="btn-primary"
                        >
                            Add Score
                        </button>
                    </div>

                    <button onClick={saveGameData} className="btn-primary w-full">
                        Save Game
                    </button>

                    <button onClick={loadGameData} className="btn-primary w-full" disabled={loading}>
                        {loading ? 'Loading...' : 'Load Game'}
                    </button>
                </div>

                <CodeBlock language="typescript">
                    {`// Save game data
const gameData = {
  level: 5,
  score: 1000,
  achievements: ['first_win', 'speed_run']
}

webApp.CloudStorage.setItem(
  'gameData', 
  JSON.stringify(gameData),
  (err, stored) => {
    if (stored) {
      console.log('Game saved!')
    }
  }
)

// Load game data
webApp.CloudStorage.getItem('gameData', (err, value) => {
  if (!err && value) {
    const gameData = JSON.parse(value)
    restoreGameState(gameData)
  }
})

// Get all saved keys
webApp.CloudStorage.getKeys((err, keys) => {
  console.log('Saved keys:', keys)
})`}
                </CodeBlock>
            </DemoSection>

            <DemoSection title="üîë Saved Keys">
                <div className="space-y-2">
                    {savedKeys.length > 0 ? (
                        savedKeys.map(key => (
                            <div key={key} className="p-2 bg-[var(--tg-theme-secondary-bg-color)] rounded">
                                {key}
                            </div>
                        ))
                    ) : (
                        <p className="text-[var(--tg-theme-hint-color)]">No saved data</p>
                    )}
                </div>
            </DemoSection>
        </div>
    )
}


/hooks/useCloudStorage.ts

// hooks/useCloudStorage.ts
import { useState, useCallback } from 'react'
import { useTelegram } from '@/providers/TelegramProvider'

export function useCloudStorage() {
    const { webApp } = useTelegram()
    const [loading, setLoading] = useState(false)
    const [error, setError] = useState<string | null>(null)

    const setItem = useCallback(async (key: string, value: string): Promise<boolean> => {
        setLoading(true)
        setError(null)

        return new Promise((resolve) => {
            webApp?.CloudStorage.setItem(key, value, (err, stored) => {
                setLoading(false)
                if (err) {
                    setError(err.message)
                    resolve(false)
                } else {
                    resolve(stored || false)
                }
            })
        })
    }, [webApp])

    const getItem = useCallback(async (key: string): Promise<string | null> => {
        setLoading(true)
        setError(null)

        return new Promise((resolve) => {
            webApp?.CloudStorage.getItem(key, (err, value) => {
                setLoading(false)
                if (err) {
                    setError(err.message)
                    resolve(null)
                } else {
                    resolve(value || null)
                }
            })
        })
    }, [webApp])

    const removeItem = useCallback(async (key: string): Promise<boolean> => {
        setLoading(true)
        setError(null)

        return new Promise((resolve) => {
            webApp?.CloudStorage.removeItem(key, (err, removed) => {
                setLoading(false)
                if (err) {
                    setError(err.message)
                    resolve(false)
                } else {
                    resolve(removed || false)
                }
            })
        })
    }, [webApp])

    const getKeys = useCallback(async (): Promise<string[]> => {
        setLoading(true)
        setError(null)

        return new Promise((resolve) => {
            webApp?.CloudStorage.getKeys((err, keys) => {
                setLoading(false)
                if (err) {
                    setError(err.message)
                    resolve([])
                } else {
                    resolve(keys || [])
                }
            })
        })
    }, [webApp])

    return {
        setItem,
        getItem,
        removeItem,
        getKeys,
        loading,
        error
    }
}


/hooks/useHaptic.ts

// hooks/useHaptic.ts
import { useTelegram } from '@/providers/TelegramProvider'

export function useHaptic() {
    const { webApp } = useTelegram()

    const impact = (style: 'light' | 'medium' | 'heavy' | 'rigid' | 'soft' = 'light') => {
        webApp?.HapticFeedback.impactOccurred(style)
    }

    const notification = (type: 'error' | 'success' | 'warning') => {
        webApp?.HapticFeedback.notificationOccurred(type)
    }

    const selection = () => {
        webApp?.HapticFeedback.selectionChanged()
    }

    return { impact, notification, selection }
}


/next-env.d.ts

/// <reference types="next" />
/// <reference types="next/image-types/global" />

// NOTE: This file should not be edited
// see https://nextjs.org/docs/app/api-reference/config/typescript for more information.



/next.config.ts

import type { NextConfig } from "next";

const nextConfig: NextConfig = {
  /* config options here */
};

export default nextConfig;



/package.json

{
  "name": "telekit",
  "version": "0.1.0",
  "private": true,
  "scripts": {
    "dev": "next dev",
    "build": "next build",
    "start": "next start",
    "lint": "next lint",
    "consolidate:ts": "tsx ./scripts/consolidate-code.ts"
  },
  "dependencies": {
    "@telegram-apps/init-data-node": "^2.0.10",
    "@types/react-syntax-highlighter": "^15.5.13",
    "@vercel/analytics": "^1.5.0",
    "clsx": "^2.1.1",
    "framer-motion": "^12.19.2",
    "lucide-react": "^0.525.0",
    "lz-string": "^1.5.0",
    "next": "15.3.4",
    "prettier": "^3.6.2",
    "prettier-plugin-tailwindcss": "^0.6.13",
    "prism-react-renderer": "^2.4.1",
    "react": "^19.0.0",
    "react-dom": "^19.0.0",
    "react-qr-code": "^2.0.16",
    "react-syntax-highlighter": "^15.6.1",
    "react-use": "^17.6.0",
    "shiki": "^3.7.0",
    "sonner": "^2.0.5",
    "zustand": "^5.0.6"
  },
  "devDependencies": {
    "@tailwindcss/postcss": "^4",
    "@types/node": "^20",
    "@types/react": "^19",
    "@types/react-dom": "^19",
    "tailwindcss": "^4",
    "typescript": "^5"
  }
}



/providers/TelegramProvider.tsx

// providers/TelegramProvider.tsx
'use client'

import { createContext, useContext, useEffect, useState, ReactNode } from 'react'
import { useTelegramStore } from '@/store/telegram'
import { TelegramWebApp, WebAppUser } from '@/types/telegram'

interface TelegramContextType {
    webApp: TelegramWebApp | null
    user: WebAppUser | null
    isReady: boolean
}

const TelegramContext = createContext<TelegramContextType>({
    webApp: null,
    user: null,
    isReady: false,
})

export function TelegramProvider({ children }: { children: ReactNode }) {
    const [isReady, setIsReady] = useState(false)
    const [webApp, setWebAppState] = useState<TelegramWebApp | null>(null)
    const [user, setUserState] = useState<WebAppUser | null>(null)
    const { setWebApp, setUser, setTheme } = useTelegramStore()

    useEffect(() => {
        // Only access window in useEffect to ensure it runs on client side
        if (typeof window !== 'undefined' && window.Telegram?.WebApp) {
            const tgWebApp = window.Telegram.WebApp

            // Initialize WebApp
            tgWebApp.ready()
            tgWebApp.expand()

            // Set theme class
            document.documentElement.className = tgWebApp.colorScheme

            // Store in local state
            setWebAppState(tgWebApp)
            setUserState(tgWebApp.initDataUnsafe.user || null)

            // Store in Zustand
            setWebApp(tgWebApp)
            setUser(tgWebApp.initDataUnsafe.user || null)
            setTheme(tgWebApp.themeParams)

            // Listen to theme changes
            tgWebApp.onEvent('themeChanged', () => {
                document.documentElement.className = tgWebApp.colorScheme
                setTheme(tgWebApp.themeParams)
            })

            setIsReady(true)
        }
    }, [setWebApp, setUser, setTheme])

    const value = {
        webApp,
        user,
        isReady,
    }

    return (
        <TelegramContext.Provider value={value}>
            {children}
        </TelegramContext.Provider>
    )
}

export const useTelegram = () => {
    const context = useContext(TelegramContext)
    if (!context) {
        throw new Error('useTelegram must be used within TelegramProvider')
    }
    return context
}


/store/telegram.ts

// store/telegram.ts
import { TelegramWebApp, ThemeParams, WebAppUser } from '@/types/telegram'
import { create } from 'zustand'

interface TelegramStore {
    webApp: TelegramWebApp | null
    user: WebAppUser | null
    theme: ThemeParams | null
    setWebApp: (webApp: TelegramWebApp) => void
    setUser: (user: WebAppUser | null) => void
    setTheme: (theme: ThemeParams) => void
}

export const useTelegramStore = create<TelegramStore>((set) => ({
    webApp: null,
    user: null,
    theme: null,
    setWebApp: (webApp) => set({ webApp }),
    setUser: (user) => set({ user }),
    setTheme: (theme) => set({ theme }),
}))


/tsconfig.json

{
  "compilerOptions": {
    "target": "ES2017",
    "lib": ["dom", "dom.iterable", "esnext"],
    "allowJs": true,
    "skipLibCheck": true,
    "strict": true,
    "noEmit": true,
    "esModuleInterop": true,
    "module": "esnext",
    "moduleResolution": "bundler",
    "resolveJsonModule": true,
    "isolatedModules": true,
    "jsx": "preserve",
    "incremental": true,
    "plugins": [
      {
        "name": "next"
      }
    ],
    "paths": {
      "@/*": ["./*"]
    }
  },
  "include": ["next-env.d.ts", "**/*.ts", "**/*.tsx", ".next/types/**/*.ts"],
  "exclude": ["node_modules"]
}



/types/telegram.d.ts

// types/telegram.d.ts
export interface TelegramWebApp {
    initData: string;
    initDataUnsafe: WebAppInitData;
    version: string;
    platform: string;
    colorScheme: 'light' | 'dark';
    themeParams: ThemeParams;
    isExpanded: boolean;
    viewportHeight: number;
    viewportStableHeight: number;
    headerColor: string;
    backgroundColor: string;
    bottomBarColor: string;
    isClosingConfirmationEnabled: boolean;
    isVerticalSwipesEnabled: boolean;
    isActive: boolean;
    isFullscreen: boolean;
    isOrientationLocked: boolean;

    MainButton: MainButton;
    SecondaryButton: SecondaryButton;
    BackButton: BackButton;
    SettingsButton: SettingsButton;
    HapticFeedback: HapticFeedback;
    CloudStorage: CloudStorage;
    BiometricManager: BiometricManager;
    Accelerometer: Accelerometer;
    DeviceOrientation: DeviceOrientation;
    Gyroscope: Gyroscope;
    LocationManager: LocationManager;

    // Methods
    ready(): void;
    expand(): void;
    close(): void;
    enableClosingConfirmation(): void;
    disableClosingConfirmation(): void;
    enableVerticalSwipes(): void;
    disableVerticalSwipes(): void;
    setHeaderColor(color: string): void;
    setBackgroundColor(color: string): void;
    setBottomBarColor(color: string): void;
    requestFullscreen(): void;
    exitFullscreen(): void;
    lockOrientation(): void;
    unlockOrientation(): void;
    requestWriteAccess(callback?: (granted: boolean) => void): void;
    requestContact(callback?: (sent: boolean, event?: any) => void): void;
    readTextFromClipboard(callback?: (text: string | null) => void): void;
    shareToStory(mediaUrl: string, params?: ShareStoryParams): void;
    downloadFile(params: DownloadFileParams, callback?: (downloaded: boolean) => void): void;
    addToHomeScreen(): void;
    checkHomeScreenStatus(callback?: (status: string) => void): void;
    openLink(url: string, options?: OpenLinkOptions): void;
    openTelegramLink(url: string, options?: any): void;
    openInvoice(url: string, callback?: (status: string) => void): void;
    showPopup(params: PopupParams, callback?: (buttonId: string | null) => void): void;
    showAlert(message: string, callback?: () => void): void;
    showConfirm(message: string, callback?: (confirmed: boolean) => void): void;
    showScanQrPopup(params?: ScanQrPopupParams, callback?: (text: string) => boolean | void): void;
    isVersionAtLeast(version: string): boolean;
    setEmojiStatus(customEmojiId: string, params?: EmojiStatusParams, callback?: (set: boolean) => void): void;
    requestEmojiStatusAccess(callback?: (allowed: boolean) => void): void;
    sendData(data: string): void;
    switchInlineQuery(query: string, chooseChatTypes?: ChatType[]): void;
    invokeCustomMethod(method: string, params?: any, callback?: (err: string | null, result?: any) => void): void;

    onEvent(eventType: string, eventHandler: () => void): void;
    offEvent(eventType: string, eventHandler: () => void): void;
}

export interface WebAppInitData {
    query_id?: string;
    user?: WebAppUser;
    receiver?: WebAppUser;
    chat?: WebAppChat;
    chat_type?: string;
    chat_instance?: string;
    start_param?: string;
    can_send_after?: number;
    auth_date?: number;
    hash?: string;
}

export interface WebAppUser {
    id: number;
    is_bot?: boolean;
    first_name: string;
    last_name?: string;
    username?: string;
    language_code?: string;
    is_premium?: boolean;
    photo_url?: string;
}

export interface WebAppChat {
    id: number;
    type: string;
    title: string;
    username?: string;
    photo_url?: string;
}

export interface ThemeParams {
    bg_color: string;
    text_color: string;
    hint_color: string;
    link_color: string;
    button_color: string;
    button_text_color: string;
    secondary_bg_color: string;
    header_bg_color: string;
    accent_text_color: string;
    section_bg_color: string;
    section_header_text_color: string;
    subtitle_text_color: string;
    destructive_text_color: string;
}

export interface MainButton {
    text: string;
    color: string;
    textColor: string;
    isVisible: boolean;
    isActive: boolean;
    isProgressVisible: boolean;
    hasShineEffect: boolean;

    setText(text: string): MainButton;
    onClick(callback: () => void): MainButton;
    offClick(callback: () => void): MainButton;
    show(): MainButton;
    hide(): MainButton;
    enable(): MainButton;
    disable(): MainButton;
    showProgress(leaveActive?: boolean): MainButton;
    hideProgress(): MainButton;
    setParams(params: MainButtonParams): MainButton;
}

export interface MainButtonParams {
    text?: string;
    color?: string;
    text_color?: string;
    has_shine_effect?: boolean;
    is_active?: boolean;
    is_visible?: boolean;
}

export interface SecondaryButton extends MainButton {
    position: 'left' | 'right' | 'top' | 'bottom';
}

export interface BackButton {
    isVisible: boolean;

    onClick(callback: () => void): BackButton;
    offClick(callback: () => void): BackButton;
    show(): BackButton;
    hide(): BackButton;
}

export interface SettingsButton {
    isVisible: boolean;

    onClick(callback: () => void): SettingsButton;
    offClick(callback: () => void): SettingsButton;
    show(): SettingsButton;
    hide(): SettingsButton;
}

export interface HapticFeedback {
    impactOccurred(style: 'light' | 'medium' | 'heavy' | 'rigid' | 'soft'): void;
    notificationOccurred(type: 'error' | 'success' | 'warning'): void;
    selectionChanged(): void;
}

export interface CloudStorage {
    setItem(key: string, value: string, callback?: (err: Error | null, stored?: boolean) => void): void;
    getItem(key: string, callback?: (err: Error | null, value?: string) => void): void;
    getItems(keys: string[], callback?: (err: Error | null, values?: Record<string, string>) => void): void;
    removeItem(key: string, callback?: (err: Error | null, removed?: boolean) => void): void;
    removeItems(keys: string[], callback?: (err: Error | null, removed?: boolean) => void): void;
    getKeys(callback?: (err: Error | null, keys?: string[]) => void): void;
}

export interface BiometricManager {
    isInited: boolean;
    isBiometricAvailable: boolean;
    biometricType: 'finger' | 'face' | 'unknown';
    isAccessRequested: boolean;
    isAccessGranted: boolean;
    isBiometricTokenSaved: boolean;
    deviceId: string;

    init(callback?: () => void): void;
    requestAccess(params: BiometricRequestAccessParams, callback?: (granted: boolean) => void): void;
    authenticate(params: BiometricAuthenticateParams, callback?: (success: boolean, token?: string) => void): void;
    updateBiometricToken(token: string, callback?: (updated: boolean) => void): void;
    openSettings(): void;
}

export interface BiometricRequestAccessParams {
    reason?: string;
}

export interface BiometricAuthenticateParams {
    reason?: string;
}

export interface Accelerometer {
    isStarted: boolean;
    x: number;
    y: number;
    z: number;

    start(params?: { refresh_rate?: number }): void;
    stop(): void;
}

export interface DeviceOrientation {
    isStarted: boolean;
    absolute: boolean;
    alpha: number;
    beta: number;
    gamma: number;

    start(params?: { refresh_rate?: number; need_absolute?: boolean }): void;
    stop(): void;
}

export interface Gyroscope {
    isStarted: boolean;
    x: number;
    y: number;
    z: number;

    start(params?: { refresh_rate?: number }): void;
    stop(): void;
}

export interface LocationManager {
    isInited: boolean;
    isLocationAvailable: boolean;
    isAccessRequested: boolean;
    isAccessGranted: boolean;

    init(callback?: () => void): void;
    getLocation(callback?: (location: LocationData | null) => void): void;
    openSettings(): void;
}

export interface LocationData {
    latitude: number;
    longitude: number;
    altitude?: number;
    course?: number;
    speed?: number;
    horizontal_accuracy?: number;
    vertical_accuracy?: number;
    course_accuracy?: number;
    speed_accuracy?: number;
}

export interface ShareStoryParams {
    text?: string;
    widget_link?: {
        url: string;
        name?: string;
    };
}

export interface DownloadFileParams {
    url: string;
    file_name: string;
}

export interface OpenLinkOptions {
    try_browser?: 'google-chrome' | 'chrome' | 'firefox' | 'safari' | 'opera';
    try_instant_view?: boolean;
}

export interface PopupParams {
    title?: string;
    message: string;
    buttons?: PopupButton[];
}

export interface PopupButton {
    id?: string;
    type?: 'default' | 'ok' | 'close' | 'cancel' | 'destructive';
    text?: string;
}

export interface ScanQrPopupParams {
    text?: string;
}

export interface EmojiStatusParams {
    duration?: number;
}

export type ChatType = 'users' | 'bots' | 'groups' | 'channels';

declare global {
    interface Window {
        Telegram?: {
            WebApp: TelegramWebApp;
        };
    }
}


/utils/telegram.ts

// utils/telegram.ts
export function validateInitData(initData: string, botToken: string): boolean {
    // This should be done on your backend
    // Example implementation for reference only
    const urlParams = new URLSearchParams(initData)
    const hash = urlParams.get('hash')
    urlParams.delete('hash')

    // Sort parameters
    const params = Array.from(urlParams.entries())
        .sort(([a], [b]) => a.localeCompare(b))
        .map(([key, value]) => `${key}=${value}`)
        .join('\n')

    // In production, verify hash on backend with bot token
    return true // Placeholder
}

export function formatTelegramDate(timestamp: number): string {
    return new Date(timestamp * 1000).toLocaleString()
}

export function isDesktop(platform: string): boolean {
    return ['macos', 'windows', 'linux'].includes(platform.toLowerCase())
}

export function isMobile(platform: string): boolean {
    return ['ios', 'android'].includes(platform.toLowerCase())
}


