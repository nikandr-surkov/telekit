# Project Structure

```
â”œâ”€â”€ ğŸ“ app
â”‚   â”œâ”€â”€ ğŸ“ api
â”‚   â”‚   â””â”€â”€ ğŸ“ telegram
â”‚   â”‚       â””â”€â”€ ğŸ“ validate
â”‚   â”‚           â””â”€â”€ ğŸ“„ route.ts
â”‚   â”œâ”€â”€ ğŸ“„ globals.css
â”‚   â”œâ”€â”€ ğŸ“„ layout.tsx
â”‚   â””â”€â”€ ğŸ“„ page.tsx
â”œâ”€â”€ ğŸ“ components
â”‚   â”œâ”€â”€ ğŸ“ demos
â”‚   â”‚   â”œâ”€â”€ ğŸ“„ AboutDemo.tsx
â”‚   â”‚   â”œâ”€â”€ ğŸ“„ ActivityDemo.tsx
â”‚   â”‚   â”œâ”€â”€ ğŸ“„ BiometricsDemo.tsx
â”‚   â”‚   â”œâ”€â”€ ğŸ“„ ButtonsDemo.tsx
â”‚   â”‚   â”œâ”€â”€ ğŸ“„ CoreApiDemo.tsx
â”‚   â”‚   â”œâ”€â”€ ğŸ“„ EmojiStatusDemo.tsx
â”‚   â”‚   â”œâ”€â”€ ğŸ“„ FileOperationsDemo.tsx
â”‚   â”‚   â”œâ”€â”€ ğŸ“„ GameFeaturesDemo.tsx
â”‚   â”‚   â”œâ”€â”€ ğŸ“„ HapticsDemo.tsx
â”‚   â”‚   â”œâ”€â”€ ğŸ“„ HomeScreenDemo.tsx
â”‚   â”‚   â”œâ”€â”€ ğŸ“„ InitDataDemo.tsx
â”‚   â”‚   â”œâ”€â”€ ğŸ“„ LinksDemo.tsx
â”‚   â”‚   â”œâ”€â”€ ğŸ“„ PaymentsDemo.tsx
â”‚   â”‚   â”œâ”€â”€ ğŸ“„ PopupsDemo.tsx
â”‚   â”‚   â”œâ”€â”€ ğŸ“„ QRScannerDemo.tsx
â”‚   â”‚   â”œâ”€â”€ ğŸ“„ SensorsDemo.tsx
â”‚   â”‚   â”œâ”€â”€ ğŸ“„ ShareStoryDemo.tsx
â”‚   â”‚   â””â”€â”€ ğŸ“„ StorageDemo.tsx
â”‚   â”œâ”€â”€ ğŸ“„ CodeBlock.tsx
â”‚   â”œâ”€â”€ ğŸ“„ ColorPicker.tsx
â”‚   â”œâ”€â”€ ğŸ“„ DemoSection.tsx
â”‚   â””â”€â”€ ğŸ“„ NavigationTabs.tsx
â”œâ”€â”€ ğŸ“ hooks
â”‚   â”œâ”€â”€ ğŸ“„ useCloudStorage.ts
â”‚   â””â”€â”€ ğŸ“„ useHaptic.ts
â”œâ”€â”€ ğŸ“ types
â”‚   â””â”€â”€ ğŸ“„ telegram.d.ts
â”œâ”€â”€ ğŸ“ utils
â”‚   â””â”€â”€ ğŸ“„ telegram.ts
â”œâ”€â”€ ğŸ“„ next-env.d.ts
â”œâ”€â”€ ğŸ“„ next.config.ts
â”œâ”€â”€ ğŸ“„ package.json
â”œâ”€â”€ ğŸ“„ README.md
â””â”€â”€ ğŸ“„ tsconfig.json
```

# Code Files

## /README.md

```md
# ğŸš€ Telegram Mini App Dev Kit

<div align="center">
  <img src="https://img.shields.io/badge/Next.js-15-black?style=for-the-badge&logo=next.js" alt="Next.js 15" />
  <img src="https://img.shields.io/badge/TypeScript-5.0-blue?style=for-the-badge&logo=typescript" alt="TypeScript" />
  <img src="https://img.shields.io/badge/React-19-61DAFB?style=for-the-badge&logo=react" alt="React 19" />
  <img src="https://img.shields.io/badge/Tailwind_CSS-4-38B2AC?style=for-the-badge&logo=tailwind-css" alt="Tailwind CSS" />
  <img src="https://img.shields.io/badge/Telegram-Mini_App-26A5E4?style=for-the-badge&logo=telegram" alt="Telegram Mini App" />
  <img src="https://img.shields.io/badge/License-MIT-green?style=for-the-badge" alt="MIT License" />
</div>

<br />

<div align="center">
  <h3>The most comprehensive open-source playground for Telegram Mini App development</h3>
  <p>17 interactive demos Â· 50+ production-ready code snippets Â· Full TypeScript support</p>
</div>

<br />

<div align="center">
  <a href="#-quick-start">Quick Start</a> â€¢
  <a href="#-features">Features</a> â€¢
  <a href="#-demos">Demos</a> â€¢
  <a href="#-deployment">Deployment</a> â€¢
  <a href="#-contributing">Contributing</a>
</div>

---

## âš¡ Why This Project?

Building a **Telegram Mini App** shouldn't mean guessing how APIs work. This dev kit gives you a **live, interactive reference** for every Telegram WebApp API â€” from haptic feedback and biometric auth to Star payments and sensor access.

Whether you're building a **Telegram bot**, a **Web3 dApp on TON**, a **clicker game**, or a **full-stack SaaS inside Telegram**, this project shows you exactly how every feature works with copy-paste TypeScript code.

**Perfect for:**

- Developers building their first Telegram Mini App
- Teams evaluating Telegram as a distribution platform
- Hackathon participants who need working examples fast
- Anyone who learns best by reading real, working code

---

## ğŸ“¦ Features

### ğŸ”§ Developer Experience

- **Next.js 15 App Router** â€” latest React Server Components architecture
- **Full TypeScript** â€” complete type definitions for the entire Telegram WebApp API
- **Tailwind CSS 4** â€” utility-first styling with Telegram theme integration
- **Zustand** state management â€” lightweight, scalable global state
- **Framer Motion** animations â€” smooth, performant UI transitions
- **Prism syntax highlighting** â€” beautiful code blocks with copy-to-clipboard
- **Hot module replacement** â€” instant feedback during development

### ğŸ“± Telegram API Coverage

| Category | Features |
|----------|----------|
| **Authentication** | Init data validation, HMAC-SHA256 verification, user identity |
| **UI Controls** | Main Button, Secondary Button, Back Button, Settings Button |
| **Payments** | Telegram Stars (XTR), invoices, refunds, webhooks |
| **Biometrics** | Face ID, Touch ID, fingerprint authentication |
| **Sensors** | Accelerometer, gyroscope, device orientation, GPS location |
| **Storage** | Cloud Storage (cross-device sync), key-value persistence |
| **Haptics** | Impact feedback (5 styles), notification feedback (3 types) |
| **Media** | QR code scanner, file downloads, camera/microphone permissions |
| **Sharing** | Story sharing with widgets, inline queries, URL sharing |
| **Theming** | Dynamic header/background/bottom bar colors, dark mode |
| **Game APIs** | Fullscreen, orientation lock, vertical swipe control |
| **Platform** | Home screen install, emoji status, version detection |

---

## ğŸ® Demos

Every demo is interactive â€” open the app in Telegram, tap a button, and see the API in action.

| # | Demo | Description |
|---|------|-------------|
| 1 | **Init Data** | Validate Telegram authentication with HMAC-SHA256 |
| 2 | **Core API** | Platform info, fullscreen, theme, clipboard, permissions |
| 3 | **Buttons** | Main, Secondary, Back, and Settings button management |
| 4 | **Links** | External links, Telegram deep links, Instant View, browser selection |
| 5 | **Popups** | Alerts, confirms, multi-button popups, safe nesting patterns |
| 6 | **QR Scanner** | Scan and parse URLs, contacts, WiFi, game codes |
| 7 | **Storage** | Cloud Storage CRUD with game save/load example |
| 8 | **Haptics** | All impact and notification feedback types with patterns |
| 9 | **Sensors** | Accelerometer, gyroscope, device orientation, GPS |
| 10 | **Biometrics** | Face ID / fingerprint auth flow with token management |
| 11 | **Share Story** | Share images/videos to Telegram Stories with widget links |
| 12 | **Home Screen** | Add-to-home-screen prompt with status checking |
| 13 | **Emoji Status** | Set custom emoji status with duration control |
| 14 | **File Downloads** | Trigger native file downloads (images, videos, PDFs) |
| 15 | **Activity** | Track app activate/deactivate lifecycle events |
| 16 | **Game Features** | Fullscreen, orientation lock, swipe control + tap game |
| 17 | **Payments** | Complete Telegram Stars payment flow with backend examples |

---

## ğŸš€ Quick Start

### Prerequisites

- **Node.js** 18+ 
- **npm** or **yarn**
- A **Telegram account**
- **ngrok** (free) for HTTPS tunneling during development

### 1. Clone and Install

```bash
git clone https://github.com/nikandr-surkov/telegram-mini-app-dev-kit.git
cd telegram-mini-app-dev-kit
npm install
```

### 2. Create a Telegram Bot

1. Open [@BotFather](https://t.me/botfather) in Telegram
2. Send `/newbot` and follow the prompts
3. Save your **bot token**

### 3. Configure Environment

```bash
cp .env.example .env.local
```

```env
# .env.local
TELEGRAM_BOT_TOKEN=your_bot_token_here
```

### 4. Start Development Server

```bash
npm run dev
```

### 5. Start HTTPS Tunnel

Telegram requires HTTPS. In a separate terminal:

```bash
ngrok http 3000
```

Copy the `https://` URL from ngrok output.

### 6. Connect to Telegram

1. Go to [@BotFather](https://t.me/botfather) â†’ `/mybots` â†’ your bot
2. **Bot Settings** â†’ **Menu Button** â†’ **Edit Menu Button**
3. Paste your ngrok HTTPS URL
4. Open your bot in Telegram and tap the Menu button

---

## ğŸ“ Project Structure

```
â”œâ”€â”€ app/
â”‚   â”œâ”€â”€ api/telegram/validate/    # Init data validation endpoint
â”‚   â”œâ”€â”€ globals.css               # Telegram theme-aware styles
â”‚   â”œâ”€â”€ layout.tsx                # Root layout with WebApp script
â”‚   â””â”€â”€ page.tsx                  # Main app with tab navigation
â”œâ”€â”€ components/
â”‚   â”œâ”€â”€ demos/                    # 17 interactive demo components
â”‚   â”‚   â”œâ”€â”€ InitDataDemo.tsx      # Authentication & validation
â”‚   â”‚   â”œâ”€â”€ CoreApiDemo.tsx       # Platform APIs & theming
â”‚   â”‚   â”œâ”€â”€ PaymentsDemo.tsx      # Telegram Stars integration
â”‚   â”‚   â”œâ”€â”€ BiometricsDemo.tsx    # Face ID / fingerprint auth
â”‚   â”‚   â”œâ”€â”€ SensorsDemo.tsx       # Accelerometer, gyroscope, GPS
â”‚   â”‚   â””â”€â”€ ...                   # 12 more demos
â”‚   â”œâ”€â”€ CodeBlock.tsx             # Syntax-highlighted code display
â”‚   â”œâ”€â”€ ColorPicker.tsx           # Theme color picker component
â”‚   â”œâ”€â”€ DemoSection.tsx           # Reusable demo layout wrapper
â”‚   â””â”€â”€ NavigationTabs.tsx        # Horizontal scrollable tabs
â”œâ”€â”€ hooks/
â”‚   â”œâ”€â”€ useCloudStorage.ts        # Async Cloud Storage wrapper
â”‚   â””â”€â”€ useHaptic.ts              # Haptic feedback helper hook
â”œâ”€â”€ providers/
â”‚   â””â”€â”€ TelegramProvider.tsx      # React context for WebApp API
â”œâ”€â”€ store/
â”‚   â””â”€â”€ telegram.ts               # Zustand global state
â”œâ”€â”€ types/
â”‚   â””â”€â”€ telegram.d.ts             # Complete WebApp type definitions
â””â”€â”€ utils/
    â””â”€â”€ telegram.ts               # Validation & platform helpers
```

---

## ğŸ” Init Data Validation

Every Telegram Mini App should validate init data on the backend. This project includes a working example:

```typescript
// app/api/telegram/validate/route.ts
import { validate, parse } from '@telegram-apps/init-data-node'

export async function POST(request: NextRequest) {
  const { initData } = await request.json()
  
  validate(initData, process.env.TELEGRAM_BOT_TOKEN!)
  const data = parse(initData)
  
  return NextResponse.json({ valid: true, user: data.user })
}
```

The `@telegram-apps/init-data-node` package handles HMAC-SHA256 signature verification against your bot token.

---

## ğŸ’³ Telegram Stars Payments

The Payments demo includes complete frontend and backend code for:

- Creating invoices via the Bot API
- Opening the native payment UI with `webApp.openInvoice()`
- Handling `pre_checkout_query` and `successful_payment` webhooks
- Processing refunds via `refundStarPayment`
- Testing strategies with minimal cost

All digital goods in Telegram Mini Apps must use **Telegram Stars** (`XTR` currency) per App Store and Play Store policies.

---

## ğŸŒ Deployment

### Vercel (Recommended)

```bash
# Install Vercel CLI
npm i -g vercel

# Deploy
vercel
```

Or connect your GitHub repo to [vercel.com](https://vercel.com) for automatic deployments on every push.

Set `TELEGRAM_BOT_TOKEN` in your Vercel project's environment variables.

After deploying, update your bot's Menu Button URL in BotFather to your production domain.

### Other Platforms

This is a standard Next.js 15 app â€” deploy anywhere that supports Node.js:

- **Railway** â€” `railway up`
- **Render** â€” connect GitHub repo
- **Fly.io** â€” `fly launch`
- **Docker** â€” `next build && next start`
- **AWS Amplify**, **Google Cloud Run**, **Azure App Service**

---

## ğŸ› ï¸ Tech Stack

| Technology | Purpose |
|------------|---------|
| [Next.js 15](https://nextjs.org) | React framework with App Router |
| [React 19](https://react.dev) | UI library |
| [TypeScript 5](https://typescriptlang.org) | Type safety |
| [Tailwind CSS 4](https://tailwindcss.com) | Utility-first CSS |
| [Zustand](https://zustand-demo.pmnd.rs) | Lightweight state management |
| [Framer Motion](https://motion.dev) | Animation library |
| [Prism React Renderer](https://github.com/FormidableLabs/prism-react-renderer) | Syntax highlighting |
| [react-qr-code](https://github.com/rosskhanas/react-qr-code) | QR code generation |
| [@telegram-apps/init-data-node](https://github.com/Telegram-Mini-Apps/telegram-apps) | Server-side init data validation |

---

## ğŸ¤ Contributing

Contributions are welcome! Here's how you can help:

1. **Fork** the repository
2. **Create** a feature branch: `git checkout -b feature/amazing-feature`
3. **Commit** your changes: `git commit -m 'Add amazing feature'`
4. **Push** to the branch: `git push origin feature/amazing-feature`
5. **Open** a Pull Request

### Ideas for Contributions

- Add new demo components for upcoming Telegram APIs
- Improve TypeScript type definitions
- Add unit tests with Vitest or Jest
- Create a dark/light theme toggle for the code blocks
- Add internationalization (i18n) support
- Write tutorials or blog posts about specific features
- Improve accessibility (a11y)
- Add E2E tests with Playwright

---

## ğŸ“š Resources

**Telegram Documentation:**

- [Telegram Mini Apps Documentation](https://core.telegram.org/bots/webapps)
- [Telegram Bot API](https://core.telegram.org/bots/api)
- [Telegram Stars Payments](https://core.telegram.org/bots/payments)
- [@BotFather](https://t.me/botfather) â€” create and manage bots

**Community & Learning:**

- ğŸŒ [nikandr.com](https://nikandr.com) â€” tutorials and courses
- ğŸ“º [YouTube @NikandrSurkov](https://www.youtube.com/@NikandrSurkov) â€” video guides
- ğŸ’¬ [Telegram @NikandrApps](https://t.me/NikandrApps) â€” community channel
- ğŸ’» [GitHub @nikandr-surkov](https://github.com/nikandr-surkov) â€” open source projects

---

## ğŸ› Troubleshooting

**Mini App not opening?**
- Verify ngrok is running and the HTTPS URL is correct
- Check your bot token in `.env.local`
- Make sure you set the Menu Button URL in BotFather (not just the bot description)

**"WebApp is not defined" error?**
- The app must be opened through Telegram, not a regular browser
- The `telegram-web-app.js` script loads only inside the Telegram client

**Features not working?**
- Some APIs require specific Telegram client versions (check the Version Check demo)
- Sensors require physical device â€” they won't work in Telegram Desktop
- Biometrics require device hardware support (Face ID, fingerprint scanner)

**Payment invoice not opening?**
- Ensure `provider_token` is empty string `""` for Stars payments
- Currency must be `"XTR"` for Telegram Stars
- Bot must have payment capability (check with BotFather)

---

## ğŸ“„ License

This project is licensed under the **MIT License** â€” see the [LICENSE](LICENSE) file for details.

You are free to use, modify, and distribute this code in personal and commercial projects.

---

## â­ Star This Repo

If this project helped you build your Telegram Mini App, please give it a â­ on GitHub â€” it helps other developers discover it!

---

<div align="center">
  <p>Built by <a href="https://nikandr.com"><strong>Nikandr Surkov</strong></a></p>
  <p>
    <a href="https://nikandr.com">Website</a> â€¢
    <a href="https://www.youtube.com/@NikandrSurkov">YouTube</a> â€¢
    <a href="https://t.me/NikandrApps">Telegram</a> â€¢
    <a href="https://github.com/nikandr-surkov">GitHub</a>
  </p>
</div>
```

## /app/api/telegram/validate/route.ts

```ts
// 1. API Route: app/api/telegram/validate/route.ts
import { NextRequest, NextResponse } from 'next/server'
import { validate, parse } from '@telegram-apps/init-data-node'

export async function POST(request: NextRequest) {
    const { initData } = await request.json()
    const botToken = process.env.TELEGRAM_BOT_TOKEN!

    try {
        // Validate the init data (throws if invalid)
        validate(initData, botToken)

        // Parse to get user info
        const data = parse(initData)

        return NextResponse.json({
            valid: true,
            user: data.user
        })
    } catch (error) {
        return NextResponse.json({
            valid: false,
            error: 'Invalid init data'
        }, { status: 401 })
    }
}
```

## /app/globals.css

```css
@import "tailwindcss";

:root {
  --telegram-blue: #0088cc;
}

/* Support Telegram's theme variables */
.light {
  color-scheme: light;
}

.dark {
  color-scheme: dark;
}

/* Custom scrollbar */
::-webkit-scrollbar {
  width: 8px;
  height: 8px;
}

::-webkit-scrollbar-track {
  background: var(--tg-theme-secondary-bg-color);
}

::-webkit-scrollbar-thumb {
  background: var(--tg-theme-hint-color);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb:hover {
  background: var(--tg-theme-text-color);
}

/* Button styles */
@layer components {
  .btn-primary {
    @apply px-4 py-2 rounded-lg font-medium transition-all duration-200 active:scale-95;
    background-color: var(--tg-theme-button-color);
    color: var(--tg-theme-button-text-color);
  }

  .btn-primary:hover {
    opacity: 0.9;
  }

  .btn-primary:disabled {
    opacity: 0.5;
    cursor: not-allowed;
  }

  .btn-secondary {
    @apply px-4 py-2 rounded-lg font-medium transition-all duration-200 active:scale-95;
    background-color: var(--tg-theme-secondary-bg-color);
    color: var(--tg-theme-text-color);
  }
}

/* Animations */
@keyframes pulse {

  0%,
  100% {
    opacity: 1;
  }

  50% {
    opacity: 0.5;
  }
}

.animate-pulse {
  animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite;
}

/* Prevent text selection in game UI */
.game-ui {
  -webkit-user-select: none;
  -moz-user-select: none;
  -ms-user-select: none;
  user-select: none;
  -webkit-touch-callout: none;
}

/* Safe area handling */
.safe-area-top {
  padding-top: env(safe-area-inset-top);
}

.safe-area-bottom {
  padding-bottom: env(safe-area-inset-bottom);
}
```

## /app/layout.tsx

```tsx
// app/layout.tsx

/**
 * Telegram Dev Kit - Copyright (c) 2025 Nikandr Surkov
 * 
 * Proprietary License - This code may ONLY be used if purchased from https://nikandr.com
 * Redistribution, reselling, or public publishing is strictly prohibited.
 * 
 * Full license and contact: https://nikandr.com
 */

import type { Metadata, Viewport } from 'next'
import { Inter } from 'next/font/google'
import Script from 'next/script'
import './globals.css'
import { TelegramProvider } from '@/providers/TelegramProvider'
import { Analytics } from '@vercel/analytics/react'

const inter = Inter({ subsets: ['latin'] })

export const metadata: Metadata = {
  title: 'Telegram Dev Kit by Nikandr Surkov',
  description: 'Interactive playground showcasing all Telegram Mini App capabilities',
  formatDetection: { telephone: false },
  robots: 'noindex,nofollow',
}

export const viewport: Viewport = {
  width: 'device-width',
  initialScale: 1.0,
  minimumScale: 1.0,
  maximumScale: 1.0,
  userScalable: false,
}

export default function RootLayout({
  children,
}: {
  children: React.ReactNode
}) {
  return (
    <html lang="en" suppressHydrationWarning>
      <head>
        <Script
          src="https://telegram.org/js/telegram-web-app.js"
          strategy="beforeInteractive"
        />
      </head>
      <body className={inter.className}>
        <TelegramProvider>
          {children}
        </TelegramProvider>
        <Analytics />
      </body>
    </html>
  )
}
```

## /app/page.tsx

```tsx
// app/page.tsx

/**
 * Telegram Dev Kit - Copyright (c) 2025 Nikandr Surkov
 * 
 * Proprietary License - This code may ONLY be used if purchased from https://nikandr.com
 * Redistribution, reselling, or public publishing is strictly prohibited.
 * 
 * Full license and contact: https://nikandr.com
 */

'use client'

import { useState } from 'react'
import { motion } from 'framer-motion'
import { useTelegram } from '@/providers/TelegramProvider'
import NavigationTabs from '@/components/NavigationTabs'
import CoreApiDemo from '@/components/demos/CoreApiDemo'
import ButtonsDemo from '@/components/demos/ButtonsDemo'
import StorageDemo from '@/components/demos/StorageDemo'
import HapticsDemo from '@/components/demos/HapticsDemo'
import SensorsDemo from '@/components/demos/SensorsDemo'
import BiometricsDemo from '@/components/demos/BiometricsDemo'
import GameFeaturesDemo from '@/components/demos/GameFeaturesDemo'
import PaymentsDemo from '@/components/demos/PaymentsDemo'
import ActivityDemo from '@/components/demos/ActivityDemo'
import EmojiStatusDemo from '@/components/demos/EmojiStatusDemo'
import FileOperationsDemo from '@/components/demos/FileOperationsDemo'
import InitDataDemo from '@/components/demos/InitDataDemo'
import LinksDemo from '@/components/demos/LinksDemo'
import PopupsDemo from '@/components/demos/PopupsDemo'
import ShareStoryDemo from '@/components/demos/ShareStoryDemo'
import HomeScreenDemo from '@/components/demos/HomeScreenDemo'
import QRScannerDemo from '@/components/demos/QRScannerDemo'
import AboutDemo from '@/components/demos/AboutDemo'

export default function Home() {
  const { isReady, user } = useTelegram()
  const [activeTab, setActiveTab] = useState('core')

  if (!isReady) {
    return (
      <div className="min-h-screen flex items-center justify-center">
        <motion.div
          animate={{ rotate: 360 }}
          transition={{ duration: 1, repeat: Infinity, ease: "linear" }}
          className="w-12 h-12 border-4 border-telegram-blue border-t-transparent rounded-full"
        />
      </div>
    )
  }

  return (
    <main className="min-h-screen bg-[var(--tg-theme-bg-color)] text-[var(--tg-theme-text-color)]">
      {/* Header */}
      <header className="bg-gradient-to-br from-[#0088cc] to-[#006ba6]">
        {/* Beautiful animated gradient line */}
        <div className="h-0.5 relative overflow-hidden">
          <div className="absolute inset-0 bg-gradient-to-r from-blue-500 via-purple-500 to-pink-500 animate-gradient-x" />
        </div>

        <div className="px-6 py-4">
          <div className="max-w-2xl mx-auto">
            {/* Title group */}
            <div className="space-y-0.5 text-center">
              <h1 className="text-lg font-semibold tracking-tight text-white">
                Telegram Dev Kit
              </h1>
              <p className="text-xs text-white/70 font-medium tracking-wide uppercase">
                by Nikandr Surkov
              </p>
            </div>

            {/* User badge */}
            {user && (
              <motion.div
                initial={{ scale: 0.9, opacity: 0 }}
                animate={{ scale: 1, opacity: 1 }}
                transition={{ type: "spring", stiffness: 200 }}
                className="mt-3 flex justify-center"
              >
                <div className="inline-flex items-center gap-2 px-3 py-1.5 rounded-full bg-white/10 backdrop-blur-sm border border-white/20">
                  <div className="w-1.5 h-1.5 rounded-full bg-emerald-400 animate-pulse" />
                  <span className="text-sm font-medium text-white">{user.first_name}</span>
                  {user.is_premium && <span className="animate-spin-slow">â­</span>}
                </div>
              </motion.div>
            )}
          </div>
        </div>
      </header>

      {/* Navigation */}
      <NavigationTabs activeTab={activeTab} onTabChange={setActiveTab} />

      {/* Content */}
      <div className="p-4 pb-20">
        <motion.div
          key={activeTab}
          initial={{ opacity: 0, y: 20 }}
          animate={{ opacity: 1, y: 0 }}
          transition={{ duration: 0.3 }}
        >
          {activeTab === 'about' && <AboutDemo />}
          {activeTab === 'init' && <InitDataDemo />}
          {activeTab === 'core' && <CoreApiDemo />}
          {activeTab === 'buttons' && <ButtonsDemo />}
          {activeTab === 'storage' && <StorageDemo />}
          {activeTab === 'haptics' && <HapticsDemo />}
          {activeTab === 'sensors' && <SensorsDemo />}
          {activeTab === 'biometrics' && <BiometricsDemo />}
          {activeTab === 'game' && <GameFeaturesDemo />}
          {activeTab === 'payments' && <PaymentsDemo />}
          {activeTab === 'emoji' && <EmojiStatusDemo />}
          {activeTab === 'files' && <FileOperationsDemo />}
          {activeTab === 'activity' && <ActivityDemo />}
          {activeTab === 'links' && <LinksDemo />}
          {activeTab === 'popups' && <PopupsDemo />}
          {activeTab === 'qr' && <QRScannerDemo />}
          {activeTab === 'share' && <ShareStoryDemo />}
          {activeTab === 'homescreen' && <HomeScreenDemo />}
        </motion.div>
      </div>
    </main>
  )
}
```

## /components/CodeBlock.tsx

```tsx
// components/CodeBlock.tsx

/**
 * Telegram Dev Kit - Copyright (c) 2025 Nikandr Surkov
 * 
 * Proprietary License - This code may ONLY be used if purchased from https://nikandr.com
 * Redistribution, reselling, or public publishing is strictly prohibited.
 * 
 * Full license and contact: https://nikandr.com
 */

import { Highlight, themes } from 'prism-react-renderer'
import { useState } from 'react'
import { motion } from 'framer-motion'

interface CodeBlockProps {
    children: string
    language?: string
}

export default function CodeBlock({ children, language = 'typescript' }: CodeBlockProps) {
    const [copied, setCopied] = useState(false)

    const copyToClipboard = async () => {
        await navigator.clipboard.writeText(children.trim())
        setCopied(true)
        setTimeout(() => setCopied(false), 2000)
    }

    return (
        <div className="relative group">
            <div className="absolute top-2 right-2 flex gap-2 z-10">
                <span className="text-xs text-[var(--tg-theme-hint-color)] opacity-60">
                    {language}
                </span>
                <button
                    onClick={copyToClipboard}
                    className="px-2 py-1 text-xs bg-[var(--tg-theme-bg-color)] rounded opacity-0 group-hover:opacity-100 transition-opacity"
                >
                    {copied ? 'âœ“ Copied' : 'Copy'}
                </button>
            </div>

            <Highlight
                theme={themes.github} // or themes.github, themes.vsDark, etc.
                code={children.trim()}
                language={language as any}
            >
                {({ className, style, tokens, getLineProps, getTokenProps }) => (
                    <pre
                        className={`${className} p-4 rounded-lg overflow-x-auto text-sm`}
                        style={{
                            ...style,
                            backgroundColor: 'var(--tg-theme-secondary-bg-color)',
                        }}
                    >
                        <code>
                            {tokens.map((line, i) => (
                                <div key={i} {...getLineProps({ line })}>
                                    {line.map((token, key) => (
                                        <span key={key} {...getTokenProps({ token })} />
                                    ))}
                                </div>
                            ))}
                        </code>
                    </pre>
                )}
            </Highlight>
        </div>
    )
}
```

## /components/ColorPicker.tsx

```tsx
// components/ColorPicker.tsx

/**
 * Telegram Dev Kit - Copyright (c) 2025 Nikandr Surkov
 * 
 * Proprietary License - This code may ONLY be used if purchased from https://nikandr.com
 * Redistribution, reselling, or public publishing is strictly prohibited.
 * 
 * Full license and contact: https://nikandr.com
 */

import { useState } from 'react'

interface ColorPickerProps {
    label: string
    value: string
    presets: { label: string; value: string }[]
    onChange: (color: string) => void
}

export default function ColorPicker({ label, value, presets, onChange }: ColorPickerProps) {
    const [isCustom, setIsCustom] = useState(false)

    return (
        <div className="space-y-2">
            <label className="text-sm font-medium">{label}</label>
            <div className="flex items-center gap-3">
                <input
                    type="color"
                    value={value}
                    onChange={(e) => {
                        setIsCustom(true)
                        onChange(e.target.value)
                    }}
                    className="w-12 h-10 rounded cursor-pointer border-2 border-[var(--tg-theme-hint-color)]"
                />
                <select
                    value={isCustom ? 'custom' : value}
                    onChange={(e) => {
                        const newValue = e.target.value
                        if (newValue !== 'custom') {
                            setIsCustom(false)
                            onChange(newValue)
                        }
                    }}
                    className="flex-1 px-3 py-2 rounded bg-[var(--tg-theme-bg-color)] text-[var(--tg-theme-text-color)] border border-[var(--tg-theme-hint-color)]"
                >
                    <option value="custom">Custom: {value}</option>
                    {presets.map(preset => (
                        <option key={preset.value} value={preset.value}>
                            {preset.label}
                        </option>
                    ))}
                </select>
                <div
                    className="w-10 h-10 rounded border-2 border-[var(--tg-theme-hint-color)]"
                    style={{ backgroundColor: value }}
                />
            </div>
        </div>
    )
}
```

## /components/DemoSection.tsx

```tsx
// components/DemoSection.tsx

/**
 * Telegram Dev Kit - Copyright (c) 2025 Nikandr Surkov
 * 
 * Proprietary License - This code may ONLY be used if purchased from https://nikandr.com
 * Redistribution, reselling, or public publishing is strictly prohibited.
 * 
 * Full license and contact: https://nikandr.com
 */

import { ReactNode } from 'react'
import { motion } from 'framer-motion'

interface DemoSectionProps {
    title: string
    children: ReactNode
}

export default function DemoSection({ title, children }: DemoSectionProps) {
    return (
        <motion.section
            initial={{ opacity: 0, y: 20 }}
            animate={{ opacity: 1, y: 0 }}
            className="space-y-4"
        >
            <h2 className="text-xl font-bold flex items-center gap-2">
                {title}
            </h2>
            <div className="space-y-4">
                {children}
            </div>
        </motion.section>
    )
}
```

## /components/NavigationTabs.tsx

```tsx
// components/NavigationTabs.tsx

/**
 * Telegram Dev Kit - Copyright (c) 2025 Nikandr Surkov
 * 
 * Proprietary License - This code may ONLY be used if purchased from https://nikandr.com
 * Redistribution, reselling, or public publishing is strictly prohibited.
 * 
 * Full license and contact: https://nikandr.com
 */

import { motion } from 'framer-motion'

interface Tab {
    id: string
    label: string
    icon: string
}

const tabs: Tab[] = [
    { id: 'about', label: 'About', icon: 'ğŸ‘¤' },
    { id: 'init', label: 'Init Data', icon: 'ğŸ”' },
    { id: 'core', label: 'Core API', icon: 'ğŸ”§' },
    { id: 'buttons', label: 'Buttons', icon: 'ğŸ”˜' },
    { id: 'links', label: 'Links', icon: 'ğŸ”—' },
    { id: 'popups', label: 'Popups', icon: 'ğŸ’¬' },
    { id: 'qr', label: 'QR Scanner', icon: 'ğŸ“·' },
    { id: 'storage', label: 'Storage', icon: 'ğŸ’¾' },
    { id: 'haptics', label: 'Haptics', icon: 'ğŸ“³' },
    { id: 'sensors', label: 'Sensors', icon: 'ğŸ“±' },
    { id: 'biometrics', label: 'Biometrics', icon: 'ğŸ”' },
    { id: 'share', label: 'Share', icon: 'ğŸ“¸' },
    { id: 'homescreen', label: 'Home', icon: 'ğŸ ' },
    { id: 'emoji', label: 'Emoji', icon: 'ğŸ˜Š' },
    { id: 'files', label: 'Files', icon: 'ğŸ“¥' },
    { id: 'activity', label: 'Activity', icon: 'ğŸ“Š' },
    { id: 'game', label: 'Game', icon: 'ğŸ®' },
    { id: 'payments', label: 'Payments', icon: 'ğŸ’°' },
]

interface NavigationTabsProps {
    activeTab: string
    onTabChange: (tab: string) => void
}

export default function NavigationTabs({ activeTab, onTabChange }: NavigationTabsProps) {
    return (
        <nav className="bg-[var(--tg-theme-secondary-bg-color)] p-2 overflow-x-auto">
            <div className="flex gap-2 min-w-max">
                {tabs.map((tab) => (
                    <motion.button
                        key={tab.id}
                        onClick={() => onTabChange(tab.id)}
                        className={`
              px-4 py-2 rounded-full text-sm font-medium transition-colors
              ${activeTab === tab.id
                                ? 'bg-[var(--tg-theme-button-color)] text-[var(--tg-theme-button-text-color)]'
                                : 'bg-transparent text-[var(--tg-theme-text-color)]'}
            `}
                        whileTap={{ scale: 0.95 }}
                    >
                        <span className="mr-1">{tab.icon}</span>
                        {tab.label}
                    </motion.button>
                ))}
            </div>
        </nav>
    )
}
```

## /components/demos/AboutDemo.tsx

```tsx
// components/demos/AboutDemo.tsx

/**
 * Telegram Dev Kit - Copyright (c) 2025 Nikandr Surkov
 * 
 * Proprietary License - This code may ONLY be used if purchased from https://nikandr.com
 * Redistribution, reselling, or public publishing is strictly prohibited.
 * 
 * Full license and contact: https://nikandr.com
 */

'use client'

import { motion } from 'framer-motion'
import { useTelegram } from '@/providers/TelegramProvider'
import DemoSection from '@/components/DemoSection'
import CodeBlock from '@/components/CodeBlock'

export default function AboutDemo() {
    const { webApp } = useTelegram()

    const links = [
        {
            title: 'Website',
            url: 'https://nikandr.com',
            icon: 'ğŸŒ',
            description: 'Learn from zero to viral growth'
        },
        {
            title: 'YouTube',
            url: 'https://www.youtube.com/@NikandrSurkov',
            icon: 'ğŸ“º',
            description: 'Latest insights and tutorials'
        },
        {
            title: 'Telegram Channel',
            url: 'https://t.me/NikandrApps',
            icon: 'ğŸ“¢',
            description: 'The best community'
        },
        {
            title: 'GitHub',
            url: 'https://github.com/nikandr-surkov',
            icon: 'ğŸ’»',
            description: 'Open source projects'
        }
    ]

    const achievements = [
        { icon: 'ğŸš€', title: 'Mini Apps with viral growth', description: 'Learn strategies that actually work' },
        { icon: 'ğŸ¤–', title: 'Bots processing millions', description: 'Scale your bots to handle real traffic' },
        { icon: 'â›“ï¸', title: 'TON blockchain integrations', description: 'Build on the fastest blockchain' },
        { icon: 'ğŸ¯', title: 'Production-ready code', description: 'Real projects, not toy examples' }
    ]

    const handleLinkClick = (url: string) => {
        webApp?.HapticFeedback.impactOccurred('light')
        if (url.includes('t.me')) {
            webApp?.openTelegramLink(url)
        } else {
            webApp?.openLink(url)
        }
    }

    return (
        <div className="space-y-6">
            {/* Hero Section */}
            <motion.div
                initial={{ opacity: 0, y: 20 }}
                animate={{ opacity: 1, y: 0 }}
                className="text-center space-y-4 py-8"
            >
                <div className="relative inline-block">
                    <motion.div
                        className="absolute inset-0 bg-gradient-to-r from-blue-500 to-purple-500 rounded-full blur-2xl opacity-50"
                        animate={{
                            scale: [1, 1.2, 1],
                            opacity: [0.5, 0.3, 0.5]
                        }}
                        transition={{
                            duration: 4,
                            repeat: Infinity,
                            ease: "easeInOut"
                        }}
                    />
                    <h1 className="relative text-4xl font-bold bg-gradient-to-r from-blue-500 to-purple-500 bg-clip-text text-transparent">
                        Nikandr Surkov
                    </h1>
                </div>
                <p className="text-xl text-[var(--tg-theme-hint-color)]">
                    Master Telegram & blockchain through video guides that actually work
                </p>
            </motion.div>

            {/* What I Help You Build */}
            <DemoSection title="ğŸš€ What I Help You Build">
                <div className="grid gap-3">
                    {achievements.map((achievement, index) => (
                        <motion.div
                            key={achievement.title}
                            initial={{ opacity: 0, x: -20 }}
                            animate={{ opacity: 1, x: 0 }}
                            transition={{ delay: index * 0.1 }}
                            className="p-4 bg-[var(--tg-theme-secondary-bg-color)] rounded-lg flex gap-4"
                        >
                            <div className="text-3xl">{achievement.icon}</div>
                            <div className="flex-1">
                                <h3 className="font-semibold">{achievement.title}</h3>
                                <p className="text-sm text-[var(--tg-theme-hint-color)]">
                                    {achievement.description}
                                </p>
                            </div>
                        </motion.div>
                    ))}
                </div>
            </DemoSection>

            {/* Links */}
            <DemoSection title="ğŸ”— Connect & Learn">
                <div className="grid gap-3">
                    {links.map((link, index) => (
                        <motion.button
                            key={link.url}
                            initial={{ opacity: 0, y: 20 }}
                            animate={{ opacity: 1, y: 0 }}
                            transition={{ delay: index * 0.1 }}
                            onClick={() => handleLinkClick(link.url)}
                            className="p-4 bg-[var(--tg-theme-secondary-bg-color)] rounded-lg flex items-center gap-4 w-full text-left hover:bg-opacity-80 transition-all"
                        >
                            <div className="text-2xl">{link.icon}</div>
                            <div className="flex-1">
                                <h3 className="font-semibold">{link.title}</h3>
                                <p className="text-sm text-[var(--tg-theme-hint-color)]">
                                    {link.description}
                                </p>
                            </div>
                            <div className="text-[var(--tg-theme-hint-color)]">â†’</div>
                        </motion.button>
                    ))}
                </div>
            </DemoSection>

            {/* About This Project */}
            <DemoSection title="ğŸ“± About Telegram Dev Kit">
                <div className="space-y-4">
                    <div className="p-4 bg-[var(--tg-theme-secondary-bg-color)] rounded-lg">
                        <p className="text-sm leading-relaxed">
                            This interactive playground showcases every Telegram Mini App capability with live demos
                            and production-ready code examples. Built to help developers quickly understand and
                            implement Telegram's powerful APIs.
                        </p>
                    </div>

                    <div className="grid grid-cols-2 gap-3 text-sm">
                        <div className="p-3 bg-[var(--tg-theme-secondary-bg-color)] rounded text-center">
                            <div className="text-2xl mb-1">17+</div>
                            <div className="text-[var(--tg-theme-hint-color)]">API Demos</div>
                        </div>
                        <div className="p-3 bg-[var(--tg-theme-secondary-bg-color)] rounded text-center">
                            <div className="text-2xl mb-1">50+</div>
                            <div className="text-[var(--tg-theme-hint-color)]">Code Examples</div>
                        </div>
                        <div className="p-3 bg-[var(--tg-theme-secondary-bg-color)] rounded text-center">
                            <div className="text-2xl mb-1">100%</div>
                            <div className="text-[var(--tg-theme-hint-color)]">TypeScript</div>
                        </div>
                        <div className="p-3 bg-[var(--tg-theme-secondary-bg-color)] rounded text-center">
                            <div className="text-2xl mb-1">â™¾ï¸</div>
                            <div className="text-[var(--tg-theme-hint-color)]">Limitless Possibilities</div>
                        </div>
                    </div>
                </div>
            </DemoSection>

            {/* Website */}
            <DemoSection title="ğŸ¯ Ready to Build?">
                <div className="space-y-4">
                    <div className="p-6 bg-gradient-to-br from-blue-500/10 to-purple-500/10 border border-blue-500/30 rounded-lg text-center space-y-4">
                        <h3 className="text-xl font-semibold">From zero to deployed app</h3>
                        <p className="text-[var(--tg-theme-hint-color)]">
                            No fluff, just results. Start building something amazing today.
                        </p>
                        <button
                            onClick={() => handleLinkClick('https://nikandr.com')}
                            className="btn-primary px-8 py-3 text-lg"
                        >
                            Start Learning â†’ nikandr.com
                        </button>
                    </div>

                    <div className="p-4 bg-yellow-500/10 border border-yellow-500/30 rounded-lg">
                        <p className="text-sm text-yellow-600 dark:text-yellow-400">
                            <strong>âš ï¸ Important:</strong> This project was developed by Nikandr Surkov.
                            You may use this code only if purchased from the official website nikandr.com.
                            See license for details.
                        </p>
                    </div>
                </div>
            </DemoSection>

            {/* Example Integration */}
            <DemoSection title="ğŸ’¡ Quick Start Example">
                <CodeBlock language="typescript">
                    {`// Get started with Telegram Mini Apps in 3 steps

// 1. Install dependencies
npm install @twa-dev/sdk

// 2. Initialize in your app
import WebApp from '@twa-dev/sdk'

WebApp.ready()
WebApp.expand()

// 3. Start building!
WebApp.MainButton.text = "Click Me!"
WebApp.MainButton.show()
WebApp.MainButton.onClick(() => {
  WebApp.HapticFeedback.notificationOccurred('success')
  console.log('Building something amazing!')
})

// Learn more at nikandr.com`}
                </CodeBlock>
            </DemoSection>
        </div>
    )
}
```

## /components/demos/ActivityDemo.tsx

```tsx
// components/demos/ActivityDemo.tsx

/**
 * Telegram Dev Kit - Copyright (c) 2025 Nikandr Surkov
 * 
 * Proprietary License - This code may ONLY be used if purchased from https://nikandr.com
 * Redistribution, reselling, or public publishing is strictly prohibited.
 * 
 * Full license and contact: https://nikandr.com
 */

'use client'

import { useState, useEffect } from 'react'
import { useTelegram } from '@/providers/TelegramProvider'
import DemoSection from '@/components/DemoSection'
import CodeBlock from '@/components/CodeBlock'

export default function ActivityDemo() {
    const { webApp } = useTelegram()
    const [activityData, setActivityData] = useState({
        isActive: true,
        currentDuration: 0,
        previousDuration: 0,
        activatedAt: new Date()
    })

    useEffect(() => {
        if (!webApp) return

        let interval: NodeJS.Timeout

        const handleActivated = () => {
            setActivityData(prev => ({
                ...prev,
                isActive: true,
                activatedAt: new Date()
            }))

            interval = setInterval(() => {
                setActivityData(prev => ({
                    ...prev,
                    currentDuration: Date.now() - prev.activatedAt.getTime()
                }))
            }, 100)
        }

        const handleDeactivated = () => {
            clearInterval(interval)
            setActivityData(prev => ({
                ...prev,
                isActive: false,
                previousDuration: Date.now() - prev.activatedAt.getTime()
            }))
        }

        webApp.onEvent('activated', handleActivated)
        webApp.onEvent('deactivated', handleDeactivated)

        if (webApp.isActive) {
            handleActivated()
        }

        return () => {
            clearInterval(interval)
            webApp.offEvent('activated', handleActivated)
            webApp.offEvent('deactivated', handleDeactivated)
        }
    }, [webApp])

    return (
        <div className="space-y-6">
            <DemoSection title="ğŸ“Š Activity Tracking">
                <div className="p-4 bg-[var(--tg-theme-secondary-bg-color)] rounded-lg">
                    <div className="space-y-2">
                        <div>
                            Status: <span className="font-bold">
                                {activityData.isActive ? 'ğŸŸ¢ Active' : 'ğŸ”´ Inactive'}
                            </span>
                        </div>
                        <div>
                            Current Session: {Math.round(activityData.currentDuration / 1000)}s
                        </div>
                        {activityData.previousDuration > 0 && (
                            <div className="text-sm text-[var(--tg-theme-hint-color)]">
                                Previous Session: {Math.round(activityData.previousDuration / 1000)}s
                            </div>
                        )}
                    </div>
                </div>

                <CodeBlock language="typescript">
                    {`// Track user activity
webApp.onEvent('activated', () => {
  console.log('Mini App activated')
  resumeGame()
})

webApp.onEvent('deactivated', () => {
  console.log('Mini App deactivated')
  pauseGame()
  saveProgress()
})

// Check current status
if (webApp.isActive) {
  // App is currently active
}`}
                </CodeBlock>
            </DemoSection>
        </div>
    )
}
```

## /components/demos/BiometricsDemo.tsx

```tsx
// components/demos/BiometricsDemo.tsx

/**
 * Telegram Dev Kit - Copyright (c) 2025 Nikandr Surkov
 * 
 * Proprietary License - This code may ONLY be used if purchased from https://nikandr.com
 * Redistribution, reselling, or public publishing is strictly prohibited.
 * 
 * Full license and contact: https://nikandr.com
 */

'use client'

import { useState, useEffect, useCallback } from 'react'
import { useTelegram } from '@/providers/TelegramProvider'
import DemoSection from '@/components/DemoSection'
import CodeBlock from '@/components/CodeBlock'

export default function BiometricsDemo() {
    const { webApp } = useTelegram()
    const [biometricInfo, setBiometricInfo] = useState({
        isInited: false,
        isAvailable: false,
        type: '',
        isAccessRequested: false,
        isAccessGranted: false,
        isTokenSaved: false,
        deviceId: ''
    })
    const [authToken, setAuthToken] = useState<string | null>(null)
    const [showExplanation, setShowExplanation] = useState(true)

    const updateBiometricInfo = useCallback(() => {
        if (!webApp?.BiometricManager) return

        const bm = webApp.BiometricManager
        setBiometricInfo({
            isInited: bm.isInited,
            isAvailable: bm.isBiometricAvailable,
            type: bm.biometricType,
            isAccessRequested: bm.isAccessRequested,
            isAccessGranted: bm.isAccessGranted,
            isTokenSaved: bm.isBiometricTokenSaved,
            deviceId: bm.deviceId
        })
    }, [webApp])

    useEffect(() => {
        if (!webApp) return

        // Listen for biometric manager updates
        webApp.onEvent('biometricManagerUpdated', updateBiometricInfo)

        // Listen for app activation to check permission changes
        const handleActivated = () => {
            // Re-init and update when app becomes active
            if (webApp.BiometricManager) {
                webApp.BiometricManager.init(() => {
                    updateBiometricInfo()
                })
            }
        }

        webApp.onEvent('activated', handleActivated)

        // Only init if webApp is available
        if (webApp.BiometricManager) {
            webApp.BiometricManager.init()
            updateBiometricInfo() // Call it once after init
        }

        // Set up periodic check when app is active
        const intervalId = setInterval(() => {
            if (webApp.isActive) {
                updateBiometricInfo()
            }
        }, 1000) // Check every second while active

        return () => {
            webApp.offEvent('biometricManagerUpdated', updateBiometricInfo)
            webApp.offEvent('activated', handleActivated)
            clearInterval(intervalId)
        }
    }, [webApp, updateBiometricInfo])

    const requestAccess = () => {
        webApp?.BiometricManager.requestAccess(
            { reason: 'To secure your game progress and purchases' },
            (granted: boolean) => {
                webApp.showAlert(`Biometric access ${granted ? 'granted' : 'denied'}`)
                // Force update after callback
                setTimeout(updateBiometricInfo, 100)
            }
        )
    }

    const authenticate = () => {
        // First, let's check if permissions are still valid
        updateBiometricInfo()

        // Small delay to ensure state is updated
        setTimeout(() => {
            if (!biometricInfo.isAccessGranted) {
                webApp?.HapticFeedback.notificationOccurred('error')
                webApp?.showAlert('Biometric access has been revoked. Please grant access again.')
                return
            }

            webApp?.BiometricManager.authenticate(
                { reason: 'Verify your identity to continue' },
                (success: boolean, token?: string) => {
                    if (success && token) {
                        setAuthToken(token)
                        webApp.HapticFeedback.notificationOccurred('success')
                        webApp.showAlert('Authentication successful!')
                    } else {
                        webApp.HapticFeedback.notificationOccurred('error')
                        // Update info in case permissions changed
                        updateBiometricInfo()

                        if (!biometricInfo.isTokenSaved) {
                            webApp.showAlert('Authentication failed. Make sure you have a token saved.')
                        } else {
                            webApp.showAlert('Authentication failed. Please try again.')
                        }
                    }
                }
            )
        }, 100)
    }

    const saveToken = () => {
        // Check permissions before saving
        updateBiometricInfo()

        setTimeout(() => {
            if (!biometricInfo.isAccessGranted) {
                webApp?.HapticFeedback.notificationOccurred('error')
                webApp?.showAlert('Biometric access has been revoked. Please grant access again.')
                return
            }

            const token = Math.random().toString(36).substring(7)
            webApp?.BiometricManager.updateBiometricToken(token, (updated: boolean) => {
                if (updated) {
                    webApp.showAlert('Token saved securely! You can now authenticate.')
                    // Force update the UI
                    setTimeout(updateBiometricInfo, 100)
                } else {
                    // Token save failed - possibly permissions revoked
                    updateBiometricInfo()
                    webApp.HapticFeedback.notificationOccurred('error')
                    webApp.showAlert('Failed to save token. Please check biometric permissions.')
                }
            })
        }, 100)
    }

    const removeToken = () => {
        webApp?.BiometricManager.updateBiometricToken('', (updated: boolean) => {
            if (updated) {
                webApp.showAlert('Token removed')
                setAuthToken(null) // Clear the auth token when removing saved token
                // Force update the UI
                setTimeout(updateBiometricInfo, 100)
            }
        })
    }

    // Add manual refresh button
    const refreshStatus = () => {
        if (webApp?.BiometricManager) {
            webApp.BiometricManager.init(() => {
                updateBiometricInfo()
                webApp.HapticFeedback.notificationOccurred('success')
                webApp.showAlert('Status refreshed')
            })
        }
    }

    return (
        <div className="space-y-6">
            {showExplanation && (
                <div className="p-4 bg-blue-500/10 border border-blue-500/30 rounded-lg">
                    <div className="flex justify-between items-start">
                        <div className="flex-1">
                            <h3 className="font-semibold text-blue-600 dark:text-blue-400 mb-2">
                                ğŸ” How Biometrics Work in Telegram
                            </h3>
                            <ol className="text-sm space-y-2 text-[var(--tg-theme-text-color)]">
                                <li><strong>1. Request Access:</strong> Ask user permission to use biometrics</li>
                                <li><strong>2. Save Token:</strong> Store a secure token that will be used for authentication</li>
                                <li><strong>3. Authenticate:</strong> Verify user's identity against the saved token</li>
                                <li className="text-xs text-[var(--tg-theme-hint-color)] mt-2">
                                    ğŸ’¡ Your biometric data never leaves your device - only secure tokens are used
                                </li>
                                <li className="text-xs text-[var(--tg-theme-hint-color)]">
                                    âš ï¸ Important: You must save a token BEFORE you can authenticate!
                                </li>
                            </ol>
                        </div>
                        <button
                            onClick={() => setShowExplanation(false)}
                            className="ml-2 text-[var(--tg-theme-hint-color)] hover:text-[var(--tg-theme-text-color)]"
                        >
                            âœ•
                        </button>
                    </div>
                </div>
            )}

            <DemoSection title="ğŸ” Biometric Status">
                <div className="space-y-3">
                    <div className="grid grid-cols-2 gap-3 text-sm">
                        <div className="p-3 bg-[var(--tg-theme-secondary-bg-color)] rounded">
                            <div className="font-semibold mb-1">System Status</div>
                            <div className="space-y-1">
                                <div className="flex justify-between">
                                    <span className="text-[var(--tg-theme-hint-color)]">Initialized:</span>
                                    <span>{biometricInfo.isInited ? 'âœ…' : 'âŒ'}</span>
                                </div>
                                <div className="flex justify-between">
                                    <span className="text-[var(--tg-theme-hint-color)]">Available:</span>
                                    <span>{biometricInfo.isAvailable ? 'âœ…' : 'âŒ'}</span>
                                </div>
                                <div className="flex justify-between">
                                    <span className="text-[var(--tg-theme-hint-color)]">Type:</span>
                                    <span>{biometricInfo.type === 'face' ? 'ğŸ‘¤ Face' : biometricInfo.type === 'finger' ? 'ğŸ‘† Finger' : 'N/A'}</span>
                                </div>
                            </div>
                        </div>

                        <div className="p-3 bg-[var(--tg-theme-secondary-bg-color)] rounded">
                            <div className="font-semibold mb-1">User Permissions</div>
                            <div className="space-y-1">
                                <div className="flex justify-between">
                                    <span className="text-[var(--tg-theme-hint-color)]">Requested:</span>
                                    <span>{biometricInfo.isAccessRequested ? 'âœ…' : 'âŒ'}</span>
                                </div>
                                <div className="flex justify-between">
                                    <span className="text-[var(--tg-theme-hint-color)]">Granted:</span>
                                    <span>{biometricInfo.isAccessGranted ? 'âœ…' : 'âŒ'}</span>
                                </div>
                                <div className="flex justify-between">
                                    <span className="text-[var(--tg-theme-hint-color)]">Token Saved:</span>
                                    <span>{biometricInfo.isTokenSaved ? 'âœ…' : 'âŒ'}</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div className="flex items-center justify-between gap-2">
                        <div className="text-xs text-[var(--tg-theme-hint-color)] break-all flex-1">
                            Device ID: {biometricInfo.deviceId || 'N/A'}
                        </div>
                        <button
                            onClick={refreshStatus}
                            className="btn-secondary text-xs px-3 py-1"
                            title="Refresh biometric status"
                        >
                            ğŸ”„ Refresh
                        </button>
                    </div>

                    {/* Show settings button only when access was requested but denied */}
                    {biometricInfo.isAccessRequested && !biometricInfo.isAccessGranted && (
                        <button
                            onClick={() => webApp?.BiometricManager.openSettings()}
                            className="btn-secondary w-full"
                        >
                            âš™ï¸ Open Settings
                        </button>
                    )}

                    {/* Show warning if permissions were revoked */}
                    {biometricInfo.isAccessRequested && !biometricInfo.isAccessGranted && biometricInfo.isTokenSaved && (
                        <div className="p-3 bg-red-500/10 border border-red-500/30 rounded">
                            <p className="text-sm text-red-600 dark:text-red-400">
                                âš ï¸ Biometric access was revoked. Your saved token is still present but cannot be used until you grant access again.
                            </p>
                        </div>
                    )}
                </div>
            </DemoSection>

            <DemoSection title="ğŸ”‘ Biometric Actions">
                <div className="space-y-4">
                    {/* Step 1: Request Access */}
                    <div className="p-4 bg-[var(--tg-theme-secondary-bg-color)] rounded-lg">
                        <div className="flex items-center justify-between mb-2">
                            <h4 className="font-semibold">Step 1: Request Permission</h4>
                            {biometricInfo.isAccessGranted && <span className="text-green-500">âœ… Completed</span>}
                        </div>
                        <p className="text-sm text-[var(--tg-theme-hint-color)] mb-3">
                            First, ask the user for permission to use biometric authentication
                        </p>
                        <button
                            onClick={requestAccess}
                            className="btn-primary w-full"
                            disabled={biometricInfo.isAccessGranted}
                        >
                            {biometricInfo.isAccessGranted ? 'âœ… Access Already Granted' : 'Request Biometric Access'}
                        </button>
                    </div>

                    {/* Step 2: Save Token */}
                    <div className={`p-4 bg-[var(--tg-theme-secondary-bg-color)] rounded-lg ${!biometricInfo.isAccessGranted ? 'opacity-50' : ''}`}>
                        <div className="flex items-center justify-between mb-2">
                            <h4 className="font-semibold">Step 2: Save Authentication Token</h4>
                            {biometricInfo.isTokenSaved && <span className="text-green-500">âœ… Completed</span>}
                        </div>
                        <p className="text-sm text-[var(--tg-theme-hint-color)] mb-3">
                            You must save a token first before you can authenticate. This token will be used to verify your identity.
                        </p>

                        {!biometricInfo.isTokenSaved && biometricInfo.isAccessGranted && (
                            <div className="p-3 mb-3 bg-yellow-500/10 border border-yellow-500/30 rounded">
                                <p className="text-sm text-yellow-600 dark:text-yellow-400">
                                    âš ï¸ No token saved yet. Save a token first to enable authentication.
                                </p>
                            </div>
                        )}

                        <div className="grid grid-cols-2 gap-2">
                            <button
                                onClick={saveToken}
                                className="btn-primary"
                                disabled={!biometricInfo.isAccessGranted || biometricInfo.isTokenSaved}
                            >
                                {biometricInfo.isTokenSaved ? 'âœ… Token Saved' : 'ğŸ’¾ Save Token'}
                            </button>

                            <button
                                onClick={removeToken}
                                className="btn-primary"
                                disabled={!biometricInfo.isTokenSaved}
                            >
                                ğŸ—‘ï¸ Remove Token
                            </button>
                        </div>

                        {biometricInfo.isTokenSaved && (
                            <p className="text-xs text-green-600 dark:text-green-400 mt-2">
                                âœ… Token saved! You can now authenticate using your biometrics.
                            </p>
                        )}
                    </div>

                    {/* Step 3: Authenticate */}
                    <div className={`p-4 bg-[var(--tg-theme-secondary-bg-color)] rounded-lg ${!biometricInfo.isTokenSaved ? 'opacity-50' : ''}`}>
                        <h4 className="font-semibold mb-2">Step 3: Authenticate with Biometrics</h4>
                        <p className="text-sm text-[var(--tg-theme-hint-color)] mb-3">
                            Now verify your identity using your saved biometric token
                        </p>

                        {!biometricInfo.isTokenSaved && biometricInfo.isAccessGranted && (
                            <div className="p-3 mb-3 bg-red-500/10 border border-red-500/30 rounded">
                                <p className="text-sm text-red-600 dark:text-red-400">
                                    âŒ Cannot authenticate without a saved token. Complete Step 2 first.
                                </p>
                            </div>
                        )}

                        <button
                            onClick={authenticate}
                            className="btn-primary w-full"
                            disabled={!biometricInfo.isAccessGranted || !biometricInfo.isTokenSaved}
                        >
                            {!biometricInfo.isAccessGranted ? 'ğŸ”’ Grant Access First' :
                                !biometricInfo.isTokenSaved ? 'ğŸ’¾ Save Token First' :
                                    'ğŸ‘† Authenticate with Biometrics'}
                        </button>

                        {authToken && (
                            <div className="mt-3 p-3 bg-green-500/20 rounded text-sm">
                                <div className="font-semibold">âœ… Authentication Successful!</div>
                                <div className="text-xs mt-1 break-all">Token: {authToken}</div>
                                <p className="text-xs mt-2 text-[var(--tg-theme-hint-color)]">
                                    This token can be used to verify the user on your backend
                                </p>
                            </div>
                        )}
                    </div>

                    {/* Settings Button for denied access - as a separate warning */}
                    {biometricInfo.isAccessRequested && !biometricInfo.isAccessGranted && (
                        <div className="p-4 bg-yellow-500/10 border border-yellow-500/30 rounded-lg">
                            <h4 className="font-semibold text-yellow-600 dark:text-yellow-400 mb-2">
                                âš ï¸ Biometric Access Denied
                            </h4>
                            <p className="text-sm mb-3">
                                You previously denied biometric access. To enable biometrics, you need to grant permission in your device settings.
                            </p>
                            <button
                                onClick={() => webApp?.BiometricManager.openSettings()}
                                className="btn-secondary w-full"
                            >
                                âš™ï¸ Open Device Settings
                            </button>
                        </div>
                    )}
                </div>

                <CodeBlock language="typescript">
                    {`// Complete biometric flow with permission monitoring

// 1. Initialize and monitor permissions
webApp.BiometricManager.init()

// Listen for app activation to check permission changes
webApp.onEvent('activated', () => {
    // Re-check biometric status when app becomes active
    webApp.BiometricManager.init(() => {
        checkBiometricStatus()
    })
})

// 2. Request permission (only needed once)
webApp.BiometricManager.requestAccess({
    reason: 'To secure your account'
}, (granted) => {
    if (granted) {
        // Permission granted, now save a token
        saveSecureToken()
    }
})

// 3. Save token with permission check
function saveSecureToken() {
    // Always check permissions before sensitive operations
    if (!webApp.BiometricManager.isAccessGranted) {
        showPermissionRevokedWarning()
        return
    }
    
    const secureToken = generateSecureToken()
    webApp.BiometricManager.updateBiometricToken(
        secureToken,
        (saved) => {
            if (saved) {
                console.log('Token saved successfully')
            } else {
                // Save failed - permissions might have been revoked
                checkBiometricStatus()
            }
        }
    )
}

// 4. Authenticate with permission fallback
function authenticateUser() {
    webApp.BiometricManager.authenticate({
        reason: 'Confirm your identity'
    }, (success, token) => {
        if (success && token) {
            verifyWithBackend(token)
        } else {
            // Check if permissions were revoked
            if (!webApp.BiometricManager.isAccessGranted) {
                showPermissionRevokedDialog()
            }
        }
    })
}

// 5. Handle permission revocation gracefully
function showPermissionRevokedDialog() {
    webApp.showPopup({
        title: 'Biometric Access Required',
        message: 'Biometric permissions have been revoked. Would you like to re-enable them?',
        buttons: [
            { id: 'settings', text: 'Open Settings' },
            { type: 'cancel' }
        ]
    }, (buttonId) => {
        if (buttonId === 'settings') {
            webApp.BiometricManager.openSettings()
        }
    })
}`}
                </CodeBlock>
            </DemoSection>

            <DemoSection title="ğŸ’¡ Understanding the Flow">
                <div className="space-y-3">
                    <div className="p-4 bg-[var(--tg-theme-secondary-bg-color)] rounded">
                        <h4 className="font-semibold mb-2">Why Save Token First?</h4>
                        <p className="text-sm text-[var(--tg-theme-hint-color)]">
                            The biometric authentication in Telegram works by comparing your biometric input
                            against a saved token. Without a saved token, there's nothing to authenticate against!
                        </p>
                        <div className="mt-3 p-3 bg-[var(--tg-theme-bg-color)] rounded">
                            <p className="text-xs font-mono">
                                Saved Token + Biometric Input = Authentication Success âœ…
                            </p>
                            <p className="text-xs font-mono mt-1">
                                No Token + Biometric Input = Authentication Failure âŒ
                            </p>
                        </div>
                    </div>

                    <div className="p-4 bg-[var(--tg-theme-secondary-bg-color)] rounded">
                        <h4 className="font-semibold mb-2">Handling Permission Changes</h4>
                        <p className="text-sm text-[var(--tg-theme-hint-color)] mb-3">
                            Users can revoke biometric permissions at any time through system settings. Your app should:
                        </p>
                        <ol className="text-sm text-[var(--tg-theme-hint-color)] space-y-1 list-decimal list-inside">
                            <li>Check permissions when the app becomes active</li>
                            <li>Handle authentication failures gracefully</li>
                            <li>Provide clear instructions to re-enable permissions</li>
                            <li>Keep saved tokens (they'll work once permissions are restored)</li>
                        </ol>
                    </div>

                    <div className="p-4 bg-green-500/10 border border-green-500/30 rounded">
                        <h4 className="font-semibold text-green-600 dark:text-green-400 mb-2">
                            Best Practice: Backend Integration
                        </h4>
                        <p className="text-sm">
                            Always generate tokens on your backend and verify them after authentication.
                            This ensures the biometric flow is secure and integrated with your auth system.
                        </p>
                    </div>

                    <div className="p-4 bg-[var(--tg-theme-secondary-bg-color)] rounded">
                        <h4 className="font-semibold mb-2">When Can You Open Settings?</h4>
                        <p className="text-sm text-[var(--tg-theme-hint-color)]">
                            The <code className="px-1 py-0.5 bg-[var(--tg-theme-bg-color)] rounded text-xs">openSettings()</code> method
                            only works when biometric access has been requested but denied. This opens the system settings
                            where users can manually enable biometric permissions for Telegram.
                        </p>
                    </div>
                </div>
            </DemoSection>
        </div>
    )
}
```

## /components/demos/ButtonsDemo.tsx

```tsx
// components/demos/ButtonsDemo.tsx

/**
 * Telegram Dev Kit - Copyright (c) 2025 Nikandr Surkov
 * 
 * Proprietary License - This code may ONLY be used if purchased from https://nikandr.com
 * Redistribution, reselling, or public publishing is strictly prohibited.
 * 
 * Full license and contact: https://nikandr.com
 */

'use client'

import { useState, useEffect } from 'react'
import { useTelegram } from '@/providers/TelegramProvider'
import DemoSection from '@/components/DemoSection'
import CodeBlock from '@/components/CodeBlock'

export default function ButtonsDemo() {
    const { webApp } = useTelegram()
    const [mainButtonClicks, setMainButtonClicks] = useState(0)
    const [isMainButtonVisible, setIsMainButtonVisible] = useState(true)
    const [isProgressVisible, setIsProgressVisible] = useState(false)
    const [isSettingsVisible, setIsSettingsVisible] = useState(false)
    const [isSecondaryVisible, setIsSecondaryVisible] = useState(true)
    const [isBackButtonVisible, setIsBackButtonVisible] = useState(true)
    const [secondaryPosition, setSecondaryPosition] = useState<'left' | 'right' | 'top' | 'bottom'>('bottom')

    useEffect(() => {
        if (!webApp) return

        // Setup Main Button
        webApp.MainButton.setParams({
            text: 'Click Me! ğŸ®',
            color: '#FF6B6B',
            has_shine_effect: true,
            is_visible: true,
        })

        const handleMainClick = () => {
            setMainButtonClicks(c => c + 1)
            webApp.HapticFeedback.impactOccurred('medium')
        }

        webApp.MainButton.onClick(handleMainClick)

        // Setup Secondary Button
        webApp.SecondaryButton.setParams({
            text: 'Secondary Action',
            is_visible: true,
        })

        // Setup Back Button
        webApp.BackButton.show()
        webApp.BackButton.onClick(() => {
            webApp.showAlert('Back button pressed!')
        })

        // Initialize states based on actual button visibility
        setIsSecondaryVisible(webApp.SecondaryButton.isVisible)
        setIsBackButtonVisible(webApp.BackButton.isVisible)

        return () => {
            webApp.MainButton.offClick(handleMainClick)
            webApp.MainButton.hide()
            webApp.SecondaryButton.hide()
            webApp.BackButton.hide()
        }
    }, [webApp])

    const toggleMainButton = () => {
        if (webApp?.MainButton.isVisible) {
            webApp?.MainButton.hide()
            setIsMainButtonVisible(false)
        } else {
            webApp?.MainButton.show()
            setIsMainButtonVisible(true)
        }
    }

    const toggleProgress = () => {
        if (webApp?.MainButton.isProgressVisible) {
            webApp?.MainButton.hideProgress()
            setIsProgressVisible(false)
        } else {
            webApp?.MainButton.showProgress()
            setIsProgressVisible(true)
        }
    }

    const changeSecondaryPosition = () => {
        const positions: Array<'left' | 'right' | 'top' | 'bottom'> = ['left', 'top', 'right', 'bottom']
        const currentIndex = positions.indexOf(secondaryPosition)
        const nextPosition = positions[(currentIndex + 1) % positions.length]
        if (webApp?.SecondaryButton) {
            webApp.SecondaryButton.position = nextPosition
            setSecondaryPosition(nextPosition)
        }
    }

    const toggleSettingsButton = () => {
        if (webApp?.SettingsButton.isVisible) {
            webApp.SettingsButton.hide()
            setIsSettingsVisible(false)
        } else {
            webApp?.SettingsButton.show()
            setIsSettingsVisible(true)
        }
    }

    const toggleSecondaryButton = () => {
        if (webApp?.SecondaryButton.isVisible) {
            webApp.SecondaryButton.hide()
            setIsSecondaryVisible(false)
        } else {
            webApp?.SecondaryButton.show()
            setIsSecondaryVisible(true)
        }
    }

    const toggleBackButton = () => {
        if (webApp?.BackButton.isVisible) {
            webApp.BackButton.hide()
            setIsBackButtonVisible(false)
        } else {
            webApp?.BackButton.show()
            setIsBackButtonVisible(true)
        }
    }

    return (
        <div className="space-y-6">
            <DemoSection title="ğŸ”˜ Main Button">
                <div className="space-y-4">
                    <div className="p-3 bg-[var(--tg-theme-secondary-bg-color)] rounded">
                        <p className="text-sm">Main button clicks: <span className="font-bold">{mainButtonClicks}</span></p>
                        <p className="text-sm">Visibility: <span className="font-bold">{isMainButtonVisible ? 'Visible' : 'Hidden'}</span></p>
                        <p className="text-sm">Progress: <span className="font-bold">{isProgressVisible ? 'Showing' : 'Hidden'}</span></p>
                    </div>

                    <div className="grid grid-cols-1 gap-3">
                        <button onClick={toggleMainButton} className="btn-primary w-full">
                            {isMainButtonVisible ? 'ğŸ™ˆ Hide' : 'ğŸ‘ï¸ Show'} Main Button
                        </button>

                        <button onClick={toggleProgress} className="btn-primary w-full">
                            {isProgressVisible ? 'â¸ï¸ Hide' : 'â–¶ï¸ Show'} Progress
                        </button>

                        <button
                            onClick={() => webApp?.MainButton.setText(`Clicks: ${mainButtonClicks}`)}
                            className="btn-primary w-full"
                        >
                            ğŸ“ Update Text to "Clicks: {mainButtonClicks}"
                        </button>

                        <button
                            onClick={() => {
                                webApp?.MainButton.setText('Loading...')
                                webApp?.MainButton.showProgress()
                                setIsProgressVisible(true)
                                setTimeout(() => {
                                    webApp?.MainButton.hideProgress()
                                    webApp?.MainButton.setText('Done! âœ…')
                                    setIsProgressVisible(false)
                                }, 2000)
                            }}
                            className="btn-primary w-full"
                        >
                            ğŸ¬ Demo Loading State (2s)
                        </button>
                    </div>
                </div>

                <CodeBlock language="typescript">
                    {`// Main Button setup
webApp.MainButton.setParams({
  text: 'Start Game',
  color: '#FF6B6B',
  has_shine_effect: true,
  is_visible: true
})

webApp.MainButton.onClick(() => {
  // Handle click
  startGame()
})

// Show progress
webApp.MainButton.showProgress()

// Update dynamically
webApp.MainButton.setText('Loading...')`}
                </CodeBlock>
            </DemoSection>

            <DemoSection title="ğŸ”² Secondary Button">
                <div className="space-y-4">
                    <div className="p-3 bg-[var(--tg-theme-secondary-bg-color)] rounded">
                        <p className="text-sm">Visibility: <span className="font-bold">{isSecondaryVisible ? 'Visible' : 'Hidden'}</span></p>
                        <p className="text-sm">Current position: <span className="font-bold">{secondaryPosition}</span></p>
                        <p className="text-xs text-[var(--tg-theme-hint-color)] mt-1">
                            Secondary button appears alongside the main button
                        </p>
                    </div>

                    <div className="grid grid-cols-1 gap-3">
                        <button onClick={changeSecondaryPosition} className="btn-primary w-full">
                            ğŸ”„ Change Position to{' '}
                            {secondaryPosition === 'bottom' ? 'Left' :
                                secondaryPosition === 'left' ? 'Top' :
                                    secondaryPosition === 'top' ? 'Right' : 'Bottom'}
                        </button>

                        <button
                            onClick={toggleSecondaryButton}
                            className="btn-primary w-full"
                        >
                            {isSecondaryVisible ? 'ğŸ™ˆ Hide' : 'ğŸ‘ï¸ Show'} Secondary Button
                        </button>
                    </div>
                </div>

                <CodeBlock language="typescript">
                    {`// Secondary Button with position
webApp.SecondaryButton.setParams({
  text: 'Options',
  is_visible: true
})

// Change position
webApp.SecondaryButton.position = 'left'

webApp.SecondaryButton.onClick(() => {
  showOptions()
})`}
                </CodeBlock>
            </DemoSection>

            <DemoSection title="â¬…ï¸ Navigation Buttons">
                <div className="space-y-4">
                    <div className="p-3 bg-[var(--tg-theme-secondary-bg-color)] rounded">
                        <p className="text-sm">Settings Button: <span className="font-bold">{isSettingsVisible ? 'Visible' : 'Hidden'}</span></p>
                        <p className="text-sm">Back Button: <span className="font-bold">{isBackButtonVisible ? 'Visible' : 'Hidden'}</span></p>
                        <p className="text-xs text-[var(--tg-theme-hint-color)] mt-2">
                            Navigation buttons appear in the Mini App header
                        </p>
                    </div>

                    <div className="grid grid-cols-1 gap-3">
                        <button
                            onClick={toggleSettingsButton}
                            className="btn-primary w-full"
                        >
                            {isSettingsVisible ? 'ğŸ™ˆ Hide' : 'âš™ï¸ Show'} Settings Button
                        </button>

                        <button
                            onClick={toggleBackButton}
                            className="btn-primary w-full"
                        >
                            {isBackButtonVisible ? 'ğŸ™ˆ Hide' : 'â¬…ï¸ Show'} Back Button
                        </button>
                    </div>
                </div>

                <CodeBlock language="typescript">
                    {`// Back Button
webApp.BackButton.show()
webApp.BackButton.onClick(() => {
  navigateBack()
})

// Settings Button  
webApp.SettingsButton.show()
webApp.SettingsButton.onClick(() => {
  openSettings()
})`}
                </CodeBlock>
            </DemoSection>

            <DemoSection title="ğŸ’¡ Button States Demo">
                <div className="space-y-4">
                    <p className="text-sm text-[var(--tg-theme-hint-color)]">
                        Try these button combinations to see how they work together:
                    </p>

                    <div className="grid grid-cols-1 gap-3">
                        <button
                            onClick={() => {
                                // Show loading state
                                webApp?.MainButton.show()
                                webApp?.MainButton.setText('Processing...')
                                webApp?.MainButton.showProgress()
                                webApp?.MainButton.disable()
                                setIsMainButtonVisible(true)
                                setIsProgressVisible(true)
                            }}
                            className="btn-secondary w-full"
                        >
                            ğŸ”„ Set Loading State
                        </button>

                        <button
                            onClick={() => {
                                // Show success state
                                webApp?.MainButton.show()
                                webApp?.MainButton.setText('Success! âœ…')
                                webApp?.MainButton.hideProgress()
                                webApp?.MainButton.enable()
                                webApp?.MainButton.setParams({ color: '#4CAF50' })
                                setIsMainButtonVisible(true)
                                setIsProgressVisible(false)
                            }}
                            className="btn-secondary w-full"
                        >
                            âœ… Set Success State
                        </button>

                        <button
                            onClick={() => {
                                // Reset to default
                                webApp?.MainButton.setParams({
                                    text: 'Click Me! ğŸ®',
                                    color: '#FF6B6B',
                                    has_shine_effect: true,
                                    is_visible: true,
                                })
                                webApp?.MainButton.hideProgress()
                                webApp?.MainButton.enable()
                                setIsMainButtonVisible(true)
                                setIsProgressVisible(false)
                            }}
                            className="btn-secondary w-full"
                        >
                            ğŸ”„ Reset to Default
                        </button>
                    </div>
                </div>
            </DemoSection>
        </div>
    )
}
```

## /components/demos/CoreApiDemo.tsx

```tsx
// components/demos/CoreApiDemo.tsx

/**
 * Telegram Dev Kit - Copyright (c) 2025 Nikandr Surkov
 * 
 * Proprietary License - This code may ONLY be used if purchased from https://nikandr.com
 * Redistribution, reselling, or public publishing is strictly prohibited.
 * 
 * Full license and contact: https://nikandr.com
 */

'use client'

import { useState, useEffect } from 'react'
import { useTelegram } from '@/providers/TelegramProvider'
import DemoSection from '@/components/DemoSection'
import CodeBlock from '@/components/CodeBlock'
import ColorPicker from '@/components/ColorPicker'

export default function CoreApiDemo() {
    const { webApp } = useTelegram()
    const [clipboardText, setClipboardText] = useState<string | null>(null)
    const [isClosingConfirmationEnabled, setIsClosingConfirmationEnabled] = useState(false)
    const [isFullscreen, setIsFullscreen] = useState(false)
    const [isExpanded, setIsExpanded] = useState(false)
    const [mediaPermissions, setMediaPermissions] = useState({
        video: '',
        audio: '',
        audioVideo: ''
    })

    // Add color states
    const [customColors, setCustomColors] = useState({
        header: webApp?.headerColor || '#000000',
        background: webApp?.backgroundColor || '#ffffff',
        bottomBar: webApp?.bottomBarColor || '#000000'
    })

    // Initialize states and listen for changes
    useEffect(() => {
        if (webApp) {
            // Initialize states
            setIsClosingConfirmationEnabled(webApp.isClosingConfirmationEnabled)
            setIsFullscreen(webApp.isFullscreen)
            setIsExpanded(webApp.isExpanded)

            // Listen for fullscreen changes
            const handleFullscreenChanged = () => {
                setIsFullscreen(webApp.isFullscreen)
            }

            webApp.onEvent('fullscreenChanged', handleFullscreenChanged)

            // Cleanup
            return () => {
                webApp.offEvent('fullscreenChanged', handleFullscreenChanged)
            }
        }
    }, [webApp])

    const toggleClosingConfirmation = () => {
        if (!webApp) return

        if (isClosingConfirmationEnabled) {
            webApp.disableClosingConfirmation()
            setIsClosingConfirmationEnabled(false)
        } else {
            webApp.enableClosingConfirmation()
            setIsClosingConfirmationEnabled(true)
        }
    }

    const toggleFullscreen = () => {
        if (!webApp) return

        if (isFullscreen) {
            webApp.exitFullscreen()
        } else {
            webApp.requestFullscreen()
        }
    }

    const expandApp = () => {
        if (!webApp) return
        webApp.expand()
        setIsExpanded(true)
    }

    const readClipboard = () => {
        // Check if webApp is available
        if (!webApp) {
            console.error('WebApp not available')
            return
        }

        // Check version support
        if (!webApp.isVersionAtLeast('6.9')) {
            webApp.showAlert('Clipboard API requires Telegram version 6.9 or higher. Your version: ' + webApp.version)
            webApp.HapticFeedback.notificationOccurred('error')
            return
        }

        try {
            webApp.readTextFromClipboard((text: string | null) => {
                console.log('Clipboard response:', text)

                // Update state with the clipboard content
                setClipboardText(text === null ? null : text)

                if (text !== null) {
                    // Successfully read clipboard
                    webApp.HapticFeedback.notificationOccurred('success')
                    if (text === '') {
                        webApp.showAlert('Clipboard is empty')
                    } else {
                        webApp.showAlert(`Clipboard content: ${text}`)
                    }
                } else {
                    // Failed to read clipboard
                    webApp.HapticFeedback.notificationOccurred('error')
                    webApp.showAlert('Failed to read clipboard. Please check permissions and try again.')
                }
            })
        } catch (error) {
            console.error('Clipboard read error:', error)
            webApp.HapticFeedback.notificationOccurred('error')
            webApp.showAlert('Clipboard API error. Please try again.')
        }
    }

    const requestWriteAccess = () => {
        webApp?.requestWriteAccess((granted: boolean) => {
            webApp.showAlert(`Write access ${granted ? 'granted' : 'denied'}`)
            webApp.HapticFeedback.notificationOccurred(granted ? 'success' : 'error')
        })
    }

    const requestContact = () => {
        webApp?.requestContact((sent: boolean, event?: any) => {
            webApp.showAlert(`Contact ${sent ? 'sent' : 'cancelled'}`)
            webApp.HapticFeedback.notificationOccurred(sent ? 'success' : 'error')
        })
    }

    const requestVideo = () => {
        if (navigator.mediaDevices && navigator.mediaDevices.getUserMedia) {
            navigator.mediaDevices.getUserMedia({ video: true })
                .then((stream) => {
                    // Important: Stop the stream immediately after getting permission
                    stream.getTracks().forEach(track => track.stop());

                    setMediaPermissions(prev => ({ ...prev, video: 'granted' }))
                    webApp?.HapticFeedback.notificationOccurred('success')
                    webApp?.showAlert('Video permission granted')
                })
                .catch((error) => {
                    console.log('Video permission denied:', error.name, error.message)
                    setMediaPermissions(prev => ({ ...prev, video: 'denied' }))
                    webApp?.HapticFeedback.notificationOccurred('error')

                    // Handle different error types
                    if (error.name === 'NotAllowedError' || error.name === 'PermissionDeniedError') {
                        webApp?.showAlert('Video permission denied by user')
                    } else if (error.name === 'NotFoundError') {
                        webApp?.showAlert('No video device found')
                    } else {
                        webApp?.showAlert('Video permission denied')
                    }
                })
        } else {
            webApp?.showAlert('Media devices not supported')
        }
    }

    const requestAudio = () => {
        if (navigator.mediaDevices && navigator.mediaDevices.getUserMedia) {
            navigator.mediaDevices.getUserMedia({ audio: true })
                .then((stream) => {
                    // Important: Stop the stream immediately after getting permission
                    stream.getTracks().forEach(track => track.stop());

                    setMediaPermissions(prev => ({ ...prev, audio: 'granted' }))
                    webApp?.HapticFeedback.notificationOccurred('success')
                    webApp?.showAlert('Audio permission granted')
                })
                .catch((error) => {
                    console.log('Audio permission denied:', error.name, error.message)
                    setMediaPermissions(prev => ({ ...prev, audio: 'denied' }))
                    webApp?.HapticFeedback.notificationOccurred('error')

                    // Handle different error types
                    if (error.name === 'NotAllowedError' || error.name === 'PermissionDeniedError') {
                        webApp?.showAlert('Audio permission denied by user')
                    } else if (error.name === 'NotFoundError') {
                        webApp?.showAlert('No audio device found')
                    } else {
                        webApp?.showAlert('Audio permission denied')
                    }
                })
        } else {
            webApp?.showAlert('Media devices not supported')
        }
    }

    const requestAudioVideo = () => {
        if (navigator.mediaDevices && navigator.mediaDevices.getUserMedia) {
            navigator.mediaDevices.getUserMedia({ audio: true, video: true })
                .then((stream) => {
                    // Important: Stop the stream immediately after getting permission
                    stream.getTracks().forEach(track => track.stop());

                    setMediaPermissions(prev => ({ ...prev, audioVideo: 'granted' }))
                    webApp?.HapticFeedback.notificationOccurred('success')
                    webApp?.showAlert('Audio and Video permissions granted')
                })
                .catch((error) => {
                    console.log('Audio/Video permission denied:', error.name, error.message)
                    setMediaPermissions(prev => ({ ...prev, audioVideo: 'denied' }))
                    webApp?.HapticFeedback.notificationOccurred('error')

                    // Handle different error types
                    if (error.name === 'NotAllowedError' || error.name === 'PermissionDeniedError') {
                        webApp?.showAlert('Audio and/or Video permissions denied by user')
                    } else if (error.name === 'NotFoundError') {
                        webApp?.showAlert('Audio and/or Video devices not found')
                    } else {
                        webApp?.showAlert('Audio and/or Video permissions denied')
                    }
                })
        } else {
            webApp?.showAlert('Media devices not supported')
        }
    }

    const versions = ['6.0', '6.1', '6.9', '7.0', '7.2', '7.7', '8.0']

    return (
        <div className="space-y-6">
            <DemoSection title="ğŸ“‹ WebApp Information">
                <div className="grid grid-cols-2 gap-2 text-sm">
                    <div>Version: <span className="font-semibold">{webApp?.version}</span></div>
                    <div>Platform: <span className="font-semibold">{webApp?.platform}</span></div>
                    <div>Color Scheme: <span className="font-semibold">{webApp?.colorScheme}</span></div>
                    <div>Is Expanded: <span className="font-semibold">{isExpanded ? 'Yes' : 'No'}</span></div>
                    <div>Is Active: <span className="font-semibold">{webApp?.isActive ? 'Yes' : 'No'}</span></div>
                    <div>Is Fullscreen: <span className="font-semibold">{isFullscreen ? 'Yes' : 'No'}</span></div>
                    <div>Closing Confirmation: <span className="font-semibold">{isClosingConfirmationEnabled ? 'Yes' : 'No'}</span></div>
                </div>

                <CodeBlock language="typescript">
                    {`// Access WebApp info
const { webApp } = useTelegram()
console.log(webApp.version)
console.log(webApp.platform)
console.log(webApp.colorScheme)
console.log(webApp.isExpanded)
console.log(webApp.isActive)
console.log(webApp.isFullscreen)
console.log(webApp.isClosingConfirmationEnabled)`}
                </CodeBlock>
            </DemoSection>

            <DemoSection title="ğŸ“ App Control">
                <div className="space-y-4">
                    <button
                        onClick={expandApp}
                        className="btn-primary w-full"
                        disabled={isExpanded}
                    >
                        {isExpanded ? 'âœ… Already Expanded' : 'ğŸ“ Expand WebApp'}
                    </button>

                    <button
                        onClick={toggleFullscreen}
                        className="btn-primary w-full"
                    >
                        {isFullscreen ? 'ğŸ”³ Exit Fullscreen' : 'ğŸ”² Enter Fullscreen'}
                    </button>

                    <button
                        onClick={toggleClosingConfirmation}
                        className="btn-primary w-full"
                    >
                        {isClosingConfirmationEnabled ? 'ğŸ”“ Disable' : 'ğŸ”’ Enable'} Closing Confirmation
                    </button>

                    <button
                        onClick={() => webApp?.close()}
                        className="btn-primary w-full bg-red-500"
                    >
                        âŒ Close App (Direct)
                    </button>

                    <div className="p-4 bg-[var(--tg-theme-secondary-bg-color)] rounded">
                        <h4 className="font-semibold mb-2">ğŸ“± Testing Closing Confirmation</h4>
                        <p className="text-sm text-[var(--tg-theme-hint-color)] mb-3">
                            The closing confirmation is currently:
                            <span className="font-bold ml-1">{isClosingConfirmationEnabled ? 'Enabled âœ…' : 'Disabled âŒ'}</span>
                        </p>
                        <p className="text-sm text-[var(--tg-theme-hint-color)] mb-2">
                            To test the closing confirmation:
                        </p>
                        <ul className="text-sm text-[var(--tg-theme-hint-color)] space-y-1 list-disc list-inside">
                            <li>Try to swipe down from the top of the screen</li>
                            <li>Or press the device's back button</li>
                            <li>Or click the X button in the Mini App header</li>
                        </ul>
                        <p className="text-sm text-[var(--tg-theme-hint-color)] mt-3">
                            <strong>Note:</strong> The "Close App" button above calls webApp.close() directly,
                            which bypasses the confirmation dialog.
                        </p>
                    </div>
                </div>

                <CodeBlock language="typescript">
                    {`// Expand app to full height
webApp.expand()

// Enter fullscreen mode
webApp.requestFullscreen()

// Exit fullscreen mode
webApp.exitFullscreen()

// Check fullscreen state
if (webApp.isFullscreen) {
  console.log('App is in fullscreen mode')
}

// Enable closing confirmation (for swipe/back button)
webApp.enableClosingConfirmation()

// Disable closing confirmation
webApp.disableClosingConfirmation()

// Check current state
if (webApp.isClosingConfirmationEnabled) {
  console.log('User will see confirmation on swipe/back')
}

// Direct close (no confirmation)
webApp.close()

// Listen for fullscreen changes
webApp.onEvent('fullscreenChanged', () => {
  console.log('Fullscreen:', webApp.isFullscreen)
})

// The confirmation only appears when:
// - User swipes down
// - User presses back button
// - User clicks X in header`}
                </CodeBlock>
            </DemoSection>

            <DemoSection title="ğŸ¨ Theme Management">
                <div className="space-y-4">
                    {/* Color Picker Section */}
                    <div className="p-4 bg-[var(--tg-theme-secondary-bg-color)] rounded-lg space-y-4">
                        <h4 className="font-semibold">Custom Color Picker</h4>

                        <ColorPicker
                            label="Header Color"
                            value={customColors.header}
                            presets={[
                                { label: 'Default (bg_color)', value: 'bg_color' },
                                { label: 'Secondary', value: 'secondary_bg_color' },
                            ]}
                            onChange={(color) => {
                                setCustomColors(prev => ({ ...prev, header: color }))
                                webApp?.setHeaderColor(color)
                            }}
                        />

                        <ColorPicker
                            label="Background Color"
                            value={customColors.background}
                            presets={[
                                { label: 'Default (bg_color)', value: 'bg_color' },
                                { label: 'Secondary', value: 'secondary_bg_color' },
                            ]}
                            onChange={(color) => {
                                setCustomColors(prev => ({ ...prev, background: color }))
                                webApp?.setBackgroundColor(color)
                            }}
                        />

                        <ColorPicker
                            label="Bottom Bar Color"
                            value={customColors.bottomBar}
                            presets={[
                                { label: 'Default (bg_color)', value: 'bg_color' },
                                { label: 'Secondary', value: 'secondary_bg_color' },
                                { label: 'Bottom Bar', value: 'bottom_bar_bg_color' },
                            ]}
                            onChange={(color) => {
                                setCustomColors(prev => ({ ...prev, bottomBar: color }))
                                webApp?.setBottomBarColor(color)
                            }}
                        />
                    </div>

                    {/* Quick Preset Buttons */}
                    <div className="space-y-3">
                        <h4 className="font-semibold">Quick Presets</h4>
                        <div className="grid grid-cols-2 gap-2">
                            <button
                                onClick={() => {
                                    webApp?.setHeaderColor('secondary_bg_color')
                                    webApp?.setBackgroundColor('bg_color')
                                    webApp?.setBottomBarColor('secondary_bg_color')

                                    // Update color pickers with actual theme colors
                                    setCustomColors({
                                        header: webApp?.themeParams.secondary_bg_color || '#f0f0f0',
                                        background: webApp?.themeParams.bg_color || '#ffffff',
                                        bottomBar: webApp?.themeParams.secondary_bg_color || '#f0f0f0'
                                    })
                                }}
                                className="btn-primary"
                            >
                                Default Theme
                            </button>
                            <button
                                onClick={() => {
                                    webApp?.setHeaderColor('#1a1a1a')
                                    webApp?.setBackgroundColor('#000000')
                                    webApp?.setBottomBarColor('#1a1a1a')
                                    setCustomColors({
                                        header: '#1a1a1a',
                                        background: '#000000',
                                        bottomBar: '#1a1a1a'
                                    })
                                }}
                                className="btn-primary"
                            >
                                Dark Theme
                            </button>
                            <button
                                onClick={() => {
                                    webApp?.setHeaderColor('#4CAF50')
                                    webApp?.setBackgroundColor('#E8F5E9')
                                    webApp?.setBottomBarColor('#4CAF50')
                                    setCustomColors({
                                        header: '#4CAF50',
                                        background: '#E8F5E9',
                                        bottomBar: '#4CAF50'
                                    })
                                }}
                                className="btn-primary"
                            >
                                Green Theme
                            </button>
                            <button
                                onClick={() => {
                                    webApp?.setHeaderColor('#2196F3')
                                    webApp?.setBackgroundColor('#E3F2FD')
                                    webApp?.setBottomBarColor('#2196F3')
                                    setCustomColors({
                                        header: '#2196F3',
                                        background: '#E3F2FD',
                                        bottomBar: '#2196F3'
                                    })
                                }}
                                className="btn-primary"
                            >
                                Blue Theme
                            </button>
                        </div>
                    </div>

                    {/* Current Theme Values */}
                    <div className="p-3 bg-[var(--tg-theme-secondary-bg-color)] rounded text-sm space-y-1">
                        <div className="font-semibold mb-2">Current Theme Values:</div>
                        <div className="grid grid-cols-2 gap-2 text-xs">
                            <div>bg_color: <span className="font-mono">{webApp?.themeParams.bg_color}</span></div>
                            <div>text_color: <span className="font-mono">{webApp?.themeParams.text_color}</span></div>
                            <div>hint_color: <span className="font-mono">{webApp?.themeParams.hint_color}</span></div>
                            <div>link_color: <span className="font-mono">{webApp?.themeParams.link_color}</span></div>
                            <div>button_color: <span className="font-mono">{webApp?.themeParams.button_color}</span></div>
                            <div>button_text_color: <span className="font-mono">{webApp?.themeParams.button_text_color}</span></div>
                        </div>
                    </div>
                </div>

                <CodeBlock language="typescript">
                    {`// Theme customization
webApp.setHeaderColor('#4CAF50')
webApp.setBackgroundColor('#E8F5E9')
webApp.setBottomBarColor('#4CAF50')

// Use theme variables
webApp.setHeaderColor('secondary_bg_color')
webApp.setBackgroundColor('bg_color')

// Access theme parameters
const theme = webApp.themeParams
console.log(theme.bg_color)
console.log(theme.button_color)`}
                </CodeBlock>
            </DemoSection>

            <DemoSection title="ğŸ” Permissions">
                <div className="space-y-4">
                    <div className="grid grid-cols-2 gap-2">
                        <button
                            onClick={readClipboard}
                            className="btn-primary"
                            disabled={!webApp?.isVersionAtLeast('6.9')}
                        >
                            Read Clipboard
                        </button>
                        <button onClick={requestWriteAccess} className="btn-primary">
                            Write Access
                        </button>
                    </div>

                    {!webApp?.isVersionAtLeast('6.9') && (
                        <div className="p-2 bg-yellow-500/20 rounded text-xs text-center">
                            Clipboard API requires version 6.9+
                        </div>
                    )}

                    {clipboardText !== null && (
                        <div className="p-3 bg-[var(--tg-theme-secondary-bg-color)] rounded">
                            <div className="font-semibold text-sm mb-1">Clipboard Content:</div>
                            <div className="font-mono text-sm break-all">
                                {clipboardText === '' ? '(clipboard is empty)' : clipboardText}
                            </div>
                        </div>
                    )}

                    <button onClick={requestContact} className="btn-primary w-full">
                        Request Contact
                    </button>

                    <div className="border-t pt-4 mt-4">
                        <h4 className="font-semibold mb-3">Media Permissions</h4>
                        <div className="grid grid-cols-3 gap-2">
                            <button onClick={requestVideo} className="btn-primary">
                                ğŸ“¹ Video
                            </button>
                            <button onClick={requestAudio} className="btn-primary">
                                ğŸ¤ Audio
                            </button>
                            <button onClick={requestAudioVideo} className="btn-primary">
                                ğŸ“¹+ğŸ¤ Both
                            </button>
                        </div>

                        {(mediaPermissions.video || mediaPermissions.audio || mediaPermissions.audioVideo) && (
                            <div className="mt-3 space-y-1 text-sm">
                                {mediaPermissions.video && (
                                    <div>Video: <span className={mediaPermissions.video === 'granted' ? 'text-green-500' : 'text-red-500'}>
                                        {mediaPermissions.video}
                                    </span></div>
                                )}
                                {mediaPermissions.audio && (
                                    <div>Audio: <span className={mediaPermissions.audio === 'granted' ? 'text-green-500' : 'text-red-500'}>
                                        {mediaPermissions.audio}
                                    </span></div>
                                )}
                                {mediaPermissions.audioVideo && (
                                    <div>Audio+Video: <span className={mediaPermissions.audioVideo === 'granted' ? 'text-green-500' : 'text-red-500'}>
                                        {mediaPermissions.audioVideo}
                                    </span></div>
                                )}
                            </div>
                        )}
                    </div>
                </div>

                <CodeBlock language="typescript">
                    {`// Request permissions
webApp.readTextFromClipboard((text) => {
  console.log('Clipboard text:', text)
})

webApp.requestWriteAccess((granted) => {
  if (granted) {
    // Can now write to messages
  }
})

webApp.requestContact((sent) => {
  if (sent) {
    // Contact shared with bot
  }
})

// Media permissions
navigator.mediaDevices.getUserMedia({ 
  video: true,
  audio: true 
}).then((stream) => {
  // Access granted
}).catch((err) => {
  // Access denied
})`}
                </CodeBlock>
            </DemoSection>

            <DemoSection title="ğŸ” Version Check">
                <div className="space-y-4">
                    <div className="p-4 bg-[var(--tg-theme-secondary-bg-color)] rounded-lg">
                        <h4 className="font-semibold mb-3">Current Version: {webApp?.version}</h4>
                        <div className="space-y-2">
                            {versions.map(version => {
                                const isSupported = webApp?.isVersionAtLeast(version) || false
                                return (
                                    <div key={version} className="flex items-center justify-between text-sm">
                                        <span>Version {version}</span>
                                        <span className={`font-semibold ${isSupported ? 'text-green-500' : 'text-red-500'}`}>
                                            {isSupported ? 'âœ… Supported' : 'âŒ Not Supported'}
                                        </span>
                                    </div>
                                )
                            })}
                        </div>
                    </div>

                    <div className="p-3 bg-blue-500/10 border border-blue-500/30 rounded">
                        <h4 className="font-semibold text-blue-600 dark:text-blue-400 mb-2">
                            Version Features Guide
                        </h4>
                        <ul className="text-sm space-y-1">
                            <li>â€¢ v6.0: Basic Mini App features</li>
                            <li>â€¢ v6.1: Cloud Storage, Haptic Feedback</li>
                            <li>â€¢ v6.9: QR Scanner, Clipboard API</li>
                            <li>â€¢ v7.0: Biometrics, Story Sharing</li>
                            <li>â€¢ v7.2: Secondary Button, Swipe Control</li>
                            <li>â€¢ v7.7: Home Screen, Emoji Status</li>
                            <li>â€¢ v8.0: Accelerometer, Gyroscope, Location</li>
                        </ul>
                    </div>
                </div>

                <CodeBlock language="typescript">
                    {`// Check version support before using features
if (webApp.isVersionAtLeast('7.0')) {
  // Safe to use biometrics
  webApp.BiometricManager.init()
}

if (webApp.isVersionAtLeast('6.9')) {
  // Safe to use QR scanner
  webApp.showScanQrPopup(...)
}

if (webApp.isVersionAtLeast('8.0')) {
  // Safe to use sensors
  webApp.Accelerometer.start()
  webApp.Gyroscope.start()
}

// Always check version for new features
const canUseBiometrics = webApp.isVersionAtLeast('7.0')
const canUseLocation = webApp.isVersionAtLeast('8.0')`}
                </CodeBlock>
            </DemoSection>
        </div>
    )
}
```

## /components/demos/EmojiStatusDemo.tsx

```tsx
// components/demos/EmojiStatusDemo.tsx

/**
 * Telegram Dev Kit - Copyright (c) 2025 Nikandr Surkov
 * 
 * Proprietary License - This code may ONLY be used if purchased from https://nikandr.com
 * Redistribution, reselling, or public publishing is strictly prohibited.
 * 
 * Full license and contact: https://nikandr.com
 */

'use client'

import { useState, useEffect } from 'react'
import { useTelegram } from '@/providers/TelegramProvider'
import DemoSection from '@/components/DemoSection'
import CodeBlock from '@/components/CodeBlock'

export default function EmojiStatusDemo() {
    const { webApp, user } = useTelegram()
    const [emojiId, setEmojiId] = useState('5000569394542078246')
    const [duration, setDuration] = useState(300)
    const [hasAccess, setHasAccess] = useState<boolean | null>(null)
    const [lastSetEmoji, setLastSetEmoji] = useState<string | null>(null)
    const [lastSetTime, setLastSetTime] = useState<Date | null>(null)
    const [lastSetDuration, setLastSetDuration] = useState<number>(300)

    // Fun emoji IDs for quick selection
    // These are actual custom emoji IDs from Telegram's emoji packs
    const popularEmojis = [
        { id: '5213305508034783384', name: 'ğŸ—¿ Moai', preview: 'ğŸ—¿' },
        { id: '5323753070247552140', name: 'ğŸ‘» Ghost', preview: 'ğŸ‘»' },
        { id: '5449505950283078474', name: 'â¤ï¸ Red Heart', preview: 'â¤ï¸' }
    ]

    // Load saved state from localStorage
    useEffect(() => {
        const savedEmoji = localStorage.getItem('lastSetEmoji')
        const savedTime = localStorage.getItem('lastSetEmojiTime')
        const savedDuration = localStorage.getItem('lastSetEmojiDuration')
        const savedAccess = localStorage.getItem('emojiStatusAccess')

        if (savedEmoji) setLastSetEmoji(savedEmoji)
        if (savedTime) setLastSetTime(new Date(savedTime))
        if (savedDuration) setLastSetDuration(parseInt(savedDuration))
        if (savedAccess) setHasAccess(savedAccess === 'true')
    }, [])

    const setEmojiStatus = () => {
        if (!webApp?.isVersionAtLeast('7.7')) {
            webApp?.showAlert('Emoji status requires Telegram version 7.7 or higher')
            return
        }

        console.log('Setting emoji status:', emojiId, 'duration:', duration)

        webApp?.setEmojiStatus(
            emojiId,
            duration > 0 ? { duration } : { duration: 0 }, // Explicitly set duration:0 for permanent
            (set: boolean) => {
                console.log('Emoji status set result:', set)
                webApp.HapticFeedback.notificationOccurred(set ? 'success' : 'error')

                if (set) {
                    setLastSetEmoji(emojiId)
                    setLastSetTime(new Date())
                    setLastSetDuration(duration)

                    // Save to localStorage
                    localStorage.setItem('lastSetEmoji', emojiId)
                    localStorage.setItem('lastSetEmojiTime', new Date().toISOString())
                    localStorage.setItem('lastSetEmojiDuration', duration.toString())

                    const selectedEmoji = popularEmojis.find(e => e.id === emojiId)
                    const emojiName = selectedEmoji ? selectedEmoji.name : 'Custom emoji'
                    webApp.showAlert(`${emojiName} status set! It will appear next to your name in chats.`)
                } else {
                    webApp.showAlert('Failed to set status. Make sure you have granted access.')
                }
            }
        )
    }

    const requestAccess = () => {
        console.log('Requesting emoji status access...')
        webApp?.requestEmojiStatusAccess((allowed: boolean) => {
            console.log('Emoji status access result:', allowed)
            setHasAccess(allowed)
            localStorage.setItem('emojiStatusAccess', allowed.toString())
            webApp.showAlert(`Emoji status access ${allowed ? 'granted' : 'denied'}`)

            if (allowed) {
                webApp.HapticFeedback.notificationOccurred('success')
            }
        })
    }

    const formatDuration = (seconds: number) => {
        if (seconds === 0) return 'Permanent'
        if (seconds < 60) return `${seconds} seconds`
        if (seconds < 3600) return `${Math.floor(seconds / 60)} minutes`
        if (seconds < 86400) return `${Math.floor(seconds / 3600)} hours`
        return `${Math.floor(seconds / 86400)} days`
    }

    const getTimeRemaining = () => {
        if (!lastSetTime) return null
        if (lastSetDuration === 0) return 'Permanent status'

        const elapsed = (new Date().getTime() - lastSetTime.getTime()) / 1000
        const remaining = lastSetDuration - elapsed

        if (remaining <= 0) return 'Expired'
        return `Expires in ${formatDuration(Math.floor(remaining))}`
    }

    // Check version support
    const supportsEmojiStatus = webApp?.isVersionAtLeast('7.7') ?? false

    return (
        <div className="space-y-6">
            <DemoSection title="ğŸ˜Š Emoji Status">
                <div className="space-y-4">
                    {/* Version check */}
                    {webApp && !supportsEmojiStatus && (
                        <div className="p-3 bg-yellow-500/20 border border-yellow-500/30 rounded-lg">
                            <p className="text-sm text-yellow-600 dark:text-yellow-400">
                                âš ï¸ Emoji status requires Telegram version 7.7 or higher.
                                Your version: {webApp.version}
                            </p>
                        </div>
                    )}

                    {/* User info and current status */}
                    <div className="p-4 bg-[var(--tg-theme-secondary-bg-color)] rounded-lg">
                        <h4 className="font-semibold mb-2">User Info</h4>
                        <div className="space-y-1 text-sm">
                            <p>Name: {user?.first_name} {user?.last_name || ''}</p>
                            <p>Premium: {user?.is_premium ? 'âœ… Yes' : 'âŒ No'}</p>
                            <p>Access Granted: {hasAccess === null ? 'â“ Unknown' : hasAccess ? 'âœ… Yes' : 'âŒ No'}</p>
                        </div>

                        {lastSetEmoji && (
                            <div className="mt-3 pt-3 border-t border-[var(--tg-theme-hint-color)]/20">
                                <p className="text-sm font-semibold">Last Set Status:</p>
                                <div className="flex items-center gap-2 mt-1">
                                    <span className="text-2xl">
                                        {popularEmojis.find(e => e.id === lastSetEmoji)?.preview || 'â“'}
                                    </span>
                                    <div>
                                        <p className="text-sm">
                                            {popularEmojis.find(e => e.id === lastSetEmoji)?.name || 'Custom Emoji'}
                                        </p>
                                        <p className="text-xs text-[var(--tg-theme-hint-color)]">
                                            {getTimeRemaining()}
                                        </p>
                                    </div>
                                </div>
                            </div>
                        )}
                    </div>

                    {/* Popular emojis - now in a grid */}
                    <div className="p-4 bg-[var(--tg-theme-secondary-bg-color)] rounded-lg">
                        <h4 className="font-semibold mb-3">Fun Status Emojis</h4>
                        <div className="grid grid-cols-3 gap-2">
                            {popularEmojis.map((emoji) => (
                                <button
                                    key={emoji.id}
                                    onClick={() => setEmojiId(emoji.id)}
                                    className={`p-3 rounded border transition-all ${emojiId === emoji.id
                                            ? 'border-[var(--tg-theme-button-color)] bg-[var(--tg-theme-button-color)]/10 scale-105'
                                            : 'border-[var(--tg-theme-hint-color)]/30 hover:border-[var(--tg-theme-hint-color)]/50'
                                        }`}
                                >
                                    <div className="text-2xl mb-1">{emoji.preview}</div>
                                    <div className="text-xs">{emoji.name.split(' ')[1]}</div>
                                </button>
                            ))}
                        </div>
                    </div>

                    {/* Custom emoji input */}
                    <div>
                        <label className="text-sm text-[var(--tg-theme-hint-color)]">Custom Emoji ID</label>
                        <input
                            type="text"
                            value={emojiId}
                            onChange={(e) => setEmojiId(e.target.value)}
                            placeholder="Enter custom emoji ID"
                            className="w-full p-3 mt-1 rounded bg-[var(--tg-theme-secondary-bg-color)] text-[var(--tg-theme-text-color)]"
                        />
                        <p className="text-xs text-[var(--tg-theme-hint-color)] mt-1">
                            Current: {popularEmojis.find(e => e.id === emojiId)?.name || 'Custom ID'}
                        </p>
                    </div>

                    {/* Duration selector */}
                    <div>
                        <label className="text-sm text-[var(--tg-theme-hint-color)]">
                            Duration: {formatDuration(duration)}
                        </label>
                        <div className="grid grid-cols-4 gap-2 mt-2">
                            <button
                                onClick={() => setDuration(300)}
                                className={`btn-secondary text-sm ${duration === 300 ? 'ring-2 ring-[var(--tg-theme-button-color)]' : ''}`}
                            >
                                5 min
                            </button>
                            <button
                                onClick={() => setDuration(3600)}
                                className={`btn-secondary text-sm ${duration === 3600 ? 'ring-2 ring-[var(--tg-theme-button-color)]' : ''}`}
                            >
                                1 hour
                            </button>
                            <button
                                onClick={() => setDuration(86400)}
                                className={`btn-secondary text-sm ${duration === 86400 ? 'ring-2 ring-[var(--tg-theme-button-color)]' : ''}`}
                            >
                                1 day
                            </button>
                            <button
                                onClick={() => setDuration(0)}
                                className={`btn-secondary text-sm ${duration === 0 ? 'ring-2 ring-[var(--tg-theme-button-color)]' : ''}`}
                            >
                                Forever
                            </button>
                        </div>
                        <input
                            type="range"
                            min="0"
                            max="604800"
                            step="300"
                            value={duration}
                            onChange={(e) => setDuration(parseInt(e.target.value))}
                            className="w-full mt-3"
                        />
                    </div>

                    {/* Action buttons */}
                    <div className="space-y-2">
                        {hasAccess !== true && (
                            <button
                                onClick={requestAccess}
                                className="btn-primary w-full"
                                disabled={!supportsEmojiStatus}
                            >
                                Request Emoji Status Access
                            </button>
                        )}

                        <button
                            onClick={setEmojiStatus}
                            className="btn-primary w-full"
                            disabled={!supportsEmojiStatus || !emojiId}
                        >
                            Set {popularEmojis.find(e => e.id === emojiId)?.preview || ''} Emoji Status
                        </button>
                    </div>

                    {/* Info box */}
                    <div className="p-3 bg-blue-500/10 border border-blue-500/30 rounded-lg">
                        <p className="text-sm text-blue-600 dark:text-blue-400">
                            ğŸ’¡ <strong>Note:</strong> Emoji status appears next to your name in chat lists
                            and messages. Premium users see custom emoji animations.
                        </p>
                    </div>
                </div>

                <CodeBlock language="typescript">
                    {`// Request emoji status access
webApp.requestEmojiStatusAccess((allowed) => {
  if (allowed) {
    // Can now set emoji status
  }
})

// Set emoji status with duration
webApp.setEmojiStatus(
  'custom_emoji_id',
  { duration: 300 }, // 5 minutes (0 for permanent)
  (success) => {
    console.log('Status set:', success)
  }
)`}
                </CodeBlock>
            </DemoSection>

            <DemoSection title="ğŸ“ Implementation Notes">
                <div className="space-y-3">
                    <div className="p-3 bg-[var(--tg-theme-secondary-bg-color)] rounded">
                        <h4 className="font-semibold">Finding Custom Emoji IDs</h4>
                        <p className="text-sm text-[var(--tg-theme-hint-color)] mt-1">
                            To get custom emoji IDs, you can use the Bot API's getCustomEmojiStickers
                            method or inspect emoji messages in your bot. Each custom emoji pack has
                            unique IDs for animated emojis.
                        </p>
                    </div>

                    <div className="p-3 bg-[var(--tg-theme-secondary-bg-color)] rounded">
                        <h4 className="font-semibold">Premium Features</h4>
                        <p className="text-sm text-[var(--tg-theme-hint-color)] mt-1">
                            Premium users can see animated custom emojis. Non-premium users will see
                            a static version or fallback emoji.
                        </p>
                    </div>
                </div>
            </DemoSection>
        </div>
    )
}
```

## /components/demos/FileOperationsDemo.tsx

```tsx
// components/demos/FileOperationsDemo.tsx

/**
 * Telegram Dev Kit - Copyright (c) 2025 Nikandr Surkov
 * 
 * Proprietary License - This code may ONLY be used if purchased from https://nikandr.com
 * Redistribution, reselling, or public publishing is strictly prohibited.
 * 
 * Full license and contact: https://nikandr.com
 */

'use client'

import { useTelegram } from '@/providers/TelegramProvider'
import DemoSection from '@/components/DemoSection'
import CodeBlock from '@/components/CodeBlock'

export default function FileOperationsDemo() {
    const { webApp } = useTelegram()

    const downloadFile = (url: string, filename: string) => {
        webApp?.downloadFile(
            { url, file_name: filename },
            (downloaded: boolean) => {
                webApp.HapticFeedback.notificationOccurred(downloaded ? 'success' : 'error')
                webApp.showAlert(downloaded ? 'Download started!' : 'Download declined')
            }
        )
    }

    const files = [
        {
            name: 'Sample Image',
            url: 'https://telegra.ph/file/5583ac37c90979f052b7b.png',
            filename: 'sample-image.png'
        },
        {
            name: 'Sample Video',
            url: 'https://telegra.ph/file/61f1dac694c3131a7b4ac.mp4',
            filename: 'sample-video.mp4'
        },
        {
            name: 'Sample PDF',
            url: 'https://pdfobject.com/pdf/sample.pdf',
            filename: 'sample-document.pdf'
        }
    ]

    return (
        <div className="space-y-6">
            <DemoSection title="ğŸ“¥ File Downloads">
                <div className="space-y-3">
                    {files.map((file, index) => (
                        <div
                            key={index}
                            className="flex items-center justify-between p-3 bg-[var(--tg-theme-secondary-bg-color)] rounded"
                        >
                            <span>{file.name}</span>
                            <button
                                onClick={() => downloadFile(file.url, file.filename)}
                                className="btn-primary px-4 py-2"
                            >
                                Download
                            </button>
                        </div>
                    ))}
                </div>

                <CodeBlock language="typescript">
                    {`// Download file
webApp.downloadFile({
  url: 'https://example.com/file.pdf',
  file_name: 'document.pdf'
}, (downloaded) => {
  if (downloaded) {
    console.log('Download started')
  }
})`}
                </CodeBlock>
            </DemoSection>
        </div>
    )
}
```

## /components/demos/GameFeaturesDemo.tsx

```tsx
// components/demos/GameFeaturesDemo.tsx

/**
 * Telegram Dev Kit - Copyright (c) 2025 Nikandr Surkov
 * 
 * Proprietary License - This code may ONLY be used if purchased from https://nikandr.com
 * Redistribution, reselling, or public publishing is strictly prohibited.
 * 
 * Full license and contact: https://nikandr.com
 */

'use client'

import { useState, useEffect } from 'react'
import { useTelegram } from '@/providers/TelegramProvider'
import DemoSection from '@/components/DemoSection'
import CodeBlock from '@/components/CodeBlock'

export default function GameFeaturesDemo() {
    const { webApp } = useTelegram()
    const [isFullscreen, setIsFullscreen] = useState(false)
    const [isOrientationLocked, setIsOrientationLocked] = useState(false)
    const [swipesEnabled, setSwipesEnabled] = useState(true)

    useEffect(() => {
        if (!webApp) return

        webApp.onEvent('fullscreenChanged', () => {
            setIsFullscreen(webApp.isFullscreen)
        })

        // Initialize location manager
        webApp.LocationManager.init()

        return () => {
            webApp.offEvent('fullscreenChanged', () => { })
        }
    }, [webApp])

    const toggleFullscreen = () => {
        if (webApp?.isFullscreen) {
            webApp?.exitFullscreen()
        } else {
            webApp?.requestFullscreen()
        }
    }

    const toggleOrientation = () => {
        if (webApp?.isOrientationLocked) {
            webApp?.unlockOrientation()
            setIsOrientationLocked(false)
        } else {
            webApp?.lockOrientation()
            setIsOrientationLocked(true)
        }
    }

    const toggleSwipes = () => {
        if (webApp?.isVerticalSwipesEnabled) {
            webApp?.disableVerticalSwipes()
            setSwipesEnabled(false)
        } else {
            webApp?.enableVerticalSwipes()
            setSwipesEnabled(true)
        }
    }

    return (
        <div className="space-y-6">
            <DemoSection title="ğŸ® Game Controls">
                <div className="space-y-4">
                    <button onClick={toggleFullscreen} className="btn-primary w-full">
                        {isFullscreen ? 'Exit' : 'Enter'} Fullscreen
                    </button>

                    <button onClick={toggleOrientation} className="btn-primary w-full">
                        {isOrientationLocked ? 'Unlock' : 'Lock'} Orientation
                    </button>

                    <button onClick={toggleSwipes} className="btn-primary w-full">
                        {swipesEnabled ? 'Disable' : 'Enable'} Vertical Swipes
                        {!swipesEnabled && ' (Good for games!)'}
                    </button>
                </div>

                <CodeBlock language="typescript">
                    {`// Fullscreen for immersive gaming
webApp.requestFullscreen()
webApp.onEvent('fullscreenChanged', () => {
  if (webApp.isFullscreen) {
    showGameUI()
  }
})

// Lock orientation for consistent gameplay
webApp.lockOrientation()

// Disable swipes for game controls
webApp.disableVerticalSwipes()`}
                </CodeBlock>
            </DemoSection>

            <DemoSection title="ğŸ¯ Mini Game Example">
                <div className="p-4 bg-[var(--tg-theme-secondary-bg-color)] rounded">
                    <TapGame />
                </div>
            </DemoSection>
        </div>
    )
}

// Mini tap game component
function TapGame() {
    const { webApp } = useTelegram()
    const [score, setScore] = useState(0)
    const [timeLeft, setTimeLeft] = useState(10)
    const [isPlaying, setIsPlaying] = useState(false)

    useEffect(() => {
        if (!isPlaying || timeLeft <= 0) return

        const timer = setTimeout(() => {
            setTimeLeft(timeLeft - 1)
            if (timeLeft === 1) {
                endGame()
            }
        }, 1000)

        return () => clearTimeout(timer)
    }, [isPlaying, timeLeft])

    const startGame = () => {
        setScore(0)
        setTimeLeft(10)
        setIsPlaying(true)
        webApp?.HapticFeedback.notificationOccurred('success')
    }

    const endGame = () => {
        setIsPlaying(false)
        webApp?.HapticFeedback.notificationOccurred('warning')
        webApp?.MainButton.setText(`Score: ${score}`)
        webApp?.MainButton.show()
    }

    const tap = () => {
        if (!isPlaying) return
        setScore(score + 1)
        webApp?.HapticFeedback.impactOccurred('light')
    }

    return (
        <div className="text-center space-y-4">
            <h3 className="text-xl font-bold">Tap Game</h3>

            {!isPlaying ? (
                <button onClick={startGame} className="btn-primary">
                    Start Game
                </button>
            ) : (
                <>
                    <div className="text-3xl font-bold">{timeLeft}s</div>
                    <div className="text-2xl">Score: {score}</div>
                    <button
                        onClick={tap}
                        className="w-32 h-32 bg-[var(--tg-theme-button-color)] rounded-full text-4xl animate-pulse"
                    >
                        ğŸ‘†
                    </button>
                </>
            )}
        </div>
    )
}
```

## /components/demos/HapticsDemo.tsx

```tsx
// components/demos/HapticsDemo.tsx

/**
 * Telegram Dev Kit - Copyright (c) 2025 Nikandr Surkov
 * 
 * Proprietary License - This code may ONLY be used if purchased from https://nikandr.com
 * Redistribution, reselling, or public publishing is strictly prohibited.
 * 
 * Full license and contact: https://nikandr.com
 */

'use client'

import { useTelegram } from '@/providers/TelegramProvider'
import DemoSection from '@/components/DemoSection'
import CodeBlock from '@/components/CodeBlock'

export default function HapticsDemo() {
    const { webApp } = useTelegram()

    const impactStyles = ['light', 'medium', 'heavy', 'rigid', 'soft'] as const
    const notificationTypes = ['error', 'success', 'warning'] as const

    return (
        <div className="space-y-6">
            <DemoSection title="ğŸ’¥ Impact Haptics">
                <div className="grid grid-cols-2 gap-2">
                    {impactStyles.map(style => (
                        <button
                            key={style}
                            onClick={() => webApp?.HapticFeedback.impactOccurred(style)}
                            className="btn-primary capitalize"
                        >
                            {style}
                        </button>
                    ))}
                </div>

                <CodeBlock language="typescript">
                    {`// Impact haptics for game events
webApp.HapticFeedback.impactOccurred('light')   // Tap
webApp.HapticFeedback.impactOccurred('medium')  // Button press
webApp.HapticFeedback.impactOccurred('heavy')   // Collision
webApp.HapticFeedback.impactOccurred('rigid')   // Hard stop
webApp.HapticFeedback.impactOccurred('soft')    // Soft bounce`}
                </CodeBlock>
            </DemoSection>

            <DemoSection title="ğŸ”” Notification Haptics">
                <div className="grid grid-cols-3 gap-2">
                    {notificationTypes.map(type => (
                        <button
                            key={type}
                            onClick={() => webApp?.HapticFeedback.notificationOccurred(type)}
                            className={`btn-primary capitalize ${type === 'error' ? 'bg-red-500' :
                                type === 'success' ? 'bg-green-500' :
                                    'bg-yellow-500'
                                }`}
                        >
                            {type}
                        </button>
                    ))}
                </div>

                <CodeBlock language="typescript">
                    {`// Notification haptics
webApp.HapticFeedback.notificationOccurred('success') // Level complete
webApp.HapticFeedback.notificationOccurred('error')   // Game over
webApp.HapticFeedback.notificationOccurred('warning') // Low health`}
                </CodeBlock>
            </DemoSection>

            <DemoSection title="ğŸ¯ Haptic Patterns">
                <div className="space-y-3">
                    <p className="text-sm text-[var(--tg-theme-hint-color)]">
                        For selection feedback, use light impact:
                    </p>

                    <button
                        onClick={() => webApp?.HapticFeedback.impactOccurred('light')}
                        className="btn-primary w-full"
                    >
                        Selection Feedback (Light Impact)
                    </button>

                    <div className="p-3 bg-[var(--tg-theme-secondary-bg-color)] rounded">
                        <p className="text-sm font-semibold mb-2">Common Patterns:</p>
                        <div className="space-y-2">
                            <button
                                onClick={() => {
                                    // Double tap pattern
                                    webApp?.HapticFeedback.impactOccurred('light')
                                    setTimeout(() => webApp?.HapticFeedback.impactOccurred('light'), 100)
                                }}
                                className="btn-secondary w-full text-sm"
                            >
                                Double Tap Pattern
                            </button>

                            <button
                                onClick={() => {
                                    // Success pattern
                                    webApp?.HapticFeedback.impactOccurred('medium')
                                    setTimeout(() => webApp?.HapticFeedback.notificationOccurred('success'), 200)
                                }}
                                className="btn-secondary w-full text-sm"
                            >
                                Success Action Pattern
                            </button>

                            <button
                                onClick={() => {
                                    // Error pattern
                                    webApp?.HapticFeedback.impactOccurred('heavy')
                                    setTimeout(() => webApp?.HapticFeedback.notificationOccurred('error'), 150)
                                }}
                                className="btn-secondary w-full text-sm"
                            >
                                Error Action Pattern
                            </button>
                        </div>
                    </div>
                </div>

                <CodeBlock language="typescript">
                    {`// Telegram WebApp only supports these haptic methods:

// 1. Impact haptics (5 styles)
webApp.HapticFeedback.impactOccurred('light')
webApp.HapticFeedback.impactOccurred('medium')
webApp.HapticFeedback.impactOccurred('heavy')
webApp.HapticFeedback.impactOccurred('rigid')
webApp.HapticFeedback.impactOccurred('soft')

// 2. Notification haptics (3 types)
webApp.HapticFeedback.notificationOccurred('error')
webApp.HapticFeedback.notificationOccurred('success')
webApp.HapticFeedback.notificationOccurred('warning')

// For selection feedback, use light impact:
items.forEach((item, index) => {
  item.addEventListener('click', () => {
    webApp.HapticFeedback.impactOccurred('light')
    selectItem(index)
  })
})`}
                </CodeBlock>
            </DemoSection>

            <DemoSection title="ğŸ® Game Examples">
                <div className="space-y-4 p-4 bg-[var(--tg-theme-secondary-bg-color)] rounded-lg">
                    <div>
                        <h4 className="font-semibold">Clicker Game</h4>
                        <p className="text-sm text-[var(--tg-theme-hint-color)]">
                            Light impact on each tap
                        </p>
                    </div>

                    <div>
                        <h4 className="font-semibold">Puzzle Game</h4>
                        <p className="text-sm text-[var(--tg-theme-hint-color)]">
                            Light impact when selecting/moving pieces
                        </p>
                    </div>

                    <div>
                        <h4 className="font-semibold">Action Game</h4>
                        <p className="text-sm text-[var(--tg-theme-hint-color)]">
                            Heavy impact for explosions, error notification for game over
                        </p>
                    </div>
                </div>
            </DemoSection>
        </div>
    )
}
```

## /components/demos/HomeScreenDemo.tsx

```tsx
// components/demos/HomeScreenDemo.tsx

/**
 * Telegram Dev Kit - Copyright (c) 2025 Nikandr Surkov
 * 
 * Proprietary License - This code may ONLY be used if purchased from https://nikandr.com
 * Redistribution, reselling, or public publishing is strictly prohibited.
 * 
 * Full license and contact: https://nikandr.com
 */

'use client'

import { useState, useEffect, useCallback } from 'react'
import { useTelegram } from '@/providers/TelegramProvider'
import DemoSection from '@/components/DemoSection'
import CodeBlock from '@/components/CodeBlock'

export default function HomeScreenDemo() {
    const { webApp } = useTelegram()
    const [status, setStatus] = useState<string>('checking')
    const [isAdded, setIsAdded] = useState(false)
    const [isChecking, setIsChecking] = useState(false)
    const [hasCheckedOnce, setHasCheckedOnce] = useState(false)

    // Use useCallback to memoize the function with proper dependencies
    const checkStatus = useCallback(() => {
        if (!webApp) {
            console.log('WebApp not available')
            return
        }

        // Prevent multiple simultaneous checks
        if (isChecking) {
            console.log('Already checking status...')
            return
        }

        setIsChecking(true)
        console.log('Checking home screen status...')

        // Set a timeout in case the callback never fires
        const timeoutId = setTimeout(() => {
            console.log('Status check timed out, assuming not added')
            setStatus('not-added')
            setIsChecking(false)
            setHasCheckedOnce(true)
        }, 3000) // 3 second timeout

        try {
            webApp.checkHomeScreenStatus((receivedStatus: string) => {
                clearTimeout(timeoutId)
                console.log('Home screen status received:', receivedStatus)
                setStatus(receivedStatus || 'not-added')
                setIsChecking(false)
                setHasCheckedOnce(true)
            })
        } catch (error) {
            clearTimeout(timeoutId)
            console.error('Error checking status:', error)
            setStatus('not-added')
            setIsChecking(false)
            setHasCheckedOnce(true)
        }
    }, [webApp, isChecking])

    useEffect(() => {
        if (!webApp) return

        const handleHomeScreenAdded = () => {
            setIsAdded(true)
            setStatus('added') // Update status immediately
            webApp.HapticFeedback.notificationOccurred('success')
            webApp.showAlert('Successfully added to home screen!')
        }

        webApp.onEvent('homeScreenAdded', handleHomeScreenAdded)

        // Check initial status after a small delay to ensure WebApp is fully initialized
        const timeoutId = setTimeout(() => {
            checkStatus()
        }, 500)

        return () => {
            webApp.offEvent('homeScreenAdded', handleHomeScreenAdded)
            clearTimeout(timeoutId)
        }
    }, [webApp]) // Remove checkStatus from deps to avoid re-running

    const addToHomeScreen = () => {
        if (!webApp) {
            console.log('WebApp not available')
            return
        }

        // Optimistically update UI
        setStatus('checking')
        webApp.addToHomeScreen()
    }

    const getStatusEmoji = () => {
        switch (status) {
            case 'added': return 'âœ…'
            case 'not-added': return 'â•'
            case 'unknown': return 'â“'
            case 'checking': return 'ğŸ”„'
            default: return 'â“'
        }
    }

    const getStatusDescription = () => {
        switch (status) {
            case 'added': return 'Mini App is on the home screen'
            case 'not-added': return 'Mini App can be added to home screen'
            case 'unknown': return 'Status cannot be determined'
            case 'checking': return 'Checking status...'
            default: return 'Status unknown'
        }
    }

    // Determine if version supports home screen
    const supportsHomeScreen = webApp?.isVersionAtLeast('7.7') ?? false

    return (
        <div className="space-y-6">
            <DemoSection title="ğŸ“± Home Screen Integration">
                <div className="space-y-4">
                    {/* Version check warning */}
                    {webApp && !supportsHomeScreen && (
                        <div className="p-3 bg-yellow-500/20 border border-yellow-500/30 rounded-lg">
                            <p className="text-sm text-yellow-600 dark:text-yellow-400">
                                âš ï¸ Home screen features require Telegram version 7.7 or higher.
                                Your version: {webApp.version}
                            </p>
                        </div>
                    )}

                    <div className="p-4 bg-[var(--tg-theme-secondary-bg-color)] rounded-lg">
                        <div className="flex items-center justify-between mb-2">
                            <span className="font-semibold">Status</span>
                            <span className="text-2xl">{getStatusEmoji()}</span>
                        </div>
                        <p className="text-sm text-[var(--tg-theme-hint-color)]">
                            {getStatusDescription()}
                        </p>
                        {status === 'checking' && isChecking && (
                            <p className="text-xs text-[var(--tg-theme-hint-color)] mt-2">
                                This may take a moment...
                            </p>
                        )}
                    </div>

                    <button
                        onClick={checkStatus}
                        className="btn-primary w-full"
                        disabled={isChecking || !supportsHomeScreen}
                    >
                        {isChecking ? 'Checking...' : 'Check Home Screen Status'}
                    </button>

                    <button
                        onClick={addToHomeScreen}
                        className="btn-primary w-full"
                        disabled={status === 'added' || !supportsHomeScreen || isChecking}
                    >
                        {status === 'added' ? 'Already Added' : 'Add to Home Screen'}
                    </button>

                    {/* Info box about the API behavior */}
                    {hasCheckedOnce && status === 'not-added' && (
                        <div className="p-3 bg-blue-500/10 border border-blue-500/30 rounded-lg">
                            <p className="text-sm text-blue-600 dark:text-blue-400">
                                ğŸ’¡ If the status check isn't working, try adding the app to your home screen
                                and then check the status again. The API works more reliably when the app
                                is already on the home screen.
                            </p>
                        </div>
                    )}

                    {isAdded && (
                        <div className="p-3 bg-green-500/20 rounded text-center">
                            <p className="text-sm font-semibold">ğŸ‰ Successfully Added!</p>
                            <p className="text-xs text-[var(--tg-theme-hint-color)] mt-1">
                                You can now launch this Mini App from your home screen
                            </p>
                        </div>
                    )}

                    {/* Debug info */}
                    <div className="p-3 bg-[var(--tg-theme-secondary-bg-color)] rounded text-xs font-mono">
                        <p className="font-bold mb-1">Debug Info:</p>
                        <p>WebApp Available: {webApp ? 'âœ…' : 'âŒ'}</p>
                        <p>Version: {webApp?.version || 'N/A'}</p>
                        <p>Platform: {webApp?.platform || 'N/A'}</p>
                        <p>Supports Home Screen: {supportsHomeScreen ? 'âœ…' : 'âŒ'}</p>
                        <p>Status: {status}</p>
                        <p>Is Checking: {isChecking ? 'Yes' : 'No'}</p>
                        <p>Has Checked Once: {hasCheckedOnce ? 'Yes' : 'No'}</p>
                    </div>
                </div>

                <CodeBlock language="typescript">
                    {`// Check if app is on home screen
// Note: This API may not respond when app is not on home screen
webApp.checkHomeScreenStatus((status) => {
  // status: 'added' | 'not-added' | 'unknown'
  // May not receive callback if not on home screen
  if (status === 'not-added') {
    showAddToHomePrompt()
  }
})

// Add to home screen
webApp.addToHomeScreen()

// Listen for successful addition
webApp.onEvent('homeScreenAdded', () => {
  console.log('App added to home screen!')
  // Update your UI immediately
  setStatus('added')
})`}
                </CodeBlock>
            </DemoSection>

            <DemoSection title="ğŸ’¡ Implementation Notes">
                <div className="space-y-3">
                    <div className="p-3 bg-[var(--tg-theme-secondary-bg-color)] rounded">
                        <h4 className="font-semibold">âš ï¸ API Limitations</h4>
                        <p className="text-sm text-[var(--tg-theme-hint-color)]">
                            The <code>checkHomeScreenStatus</code> API may not always respond when the app
                            is not on the home screen. Consider implementing a timeout and assuming "not-added"
                            if no response is received.
                        </p>
                    </div>

                    <div className="p-3 bg-[var(--tg-theme-secondary-bg-color)] rounded">
                        <h4 className="font-semibold">âœ… Best Practices</h4>
                        <ul className="text-sm text-[var(--tg-theme-hint-color)] space-y-1 mt-2">
                            <li>â€¢ Always listen for the <code>homeScreenAdded</code> event</li>
                            <li>â€¢ Implement timeouts for status checks</li>
                            <li>â€¢ Provide clear feedback to users</li>
                            <li>â€¢ Cache the status locally if needed</li>
                        </ul>
                    </div>
                </div>
            </DemoSection>

            <DemoSection title="ğŸ¯ Benefits">
                <div className="space-y-3">
                    <div className="p-3 bg-[var(--tg-theme-secondary-bg-color)] rounded">
                        <h4 className="font-semibold">ğŸš€ Quick Access</h4>
                        <p className="text-sm text-[var(--tg-theme-hint-color)]">
                            Launch your Mini App directly without opening Telegram
                        </p>
                    </div>

                    <div className="p-3 bg-[var(--tg-theme-secondary-bg-color)] rounded">
                        <h4 className="font-semibold">ğŸ“ˆ Better Retention</h4>
                        <p className="text-sm text-[var(--tg-theme-hint-color)]">
                            Users are more likely to return when the app is on their home screen
                        </p>
                    </div>

                    <div className="p-3 bg-[var(--tg-theme-secondary-bg-color)] rounded">
                        <h4 className="font-semibold">ğŸ”” Push Notifications</h4>
                        <p className="text-sm text-[var(--tg-theme-hint-color)]">
                            Enable direct notifications without going through Telegram
                        </p>
                    </div>
                </div>
            </DemoSection>
        </div>
    )
}
```

## /components/demos/InitDataDemo.tsx

```tsx
// components/demos/InitDataDemo.tsx

/**
 * Telegram Dev Kit - Copyright (c) 2025 Nikandr Surkov
 * 
 * Proprietary License - This code may ONLY be used if purchased from https://nikandr.com
 * Redistribution, reselling, or public publishing is strictly prohibited.
 * 
 * Full license and contact: https://nikandr.com
 */

'use client'

import { useState } from 'react'
import { useTelegram } from '@/providers/TelegramProvider'
import DemoSection from '@/components/DemoSection'
import CodeBlock from '@/components/CodeBlock'

export default function InitDataDemo() {
  const { webApp } = useTelegram()
  const initData = webApp?.initData || ''
  const initDataUnsafe = webApp?.initDataUnsafe || {}
  const [validationResult, setValidationResult] = useState<{
    isValid: boolean | null
    message: string
  }>({ isValid: null, message: '' })
  const [isValidating, setIsValidating] = useState(false)

  const validateInitData = async () => {
    if (!initData) {
      webApp?.showAlert('No init data available to validate')
      return
    }

    setIsValidating(true)
    try {
      const response = await fetch('/api/telegram/validate', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
        },
        body: JSON.stringify({ initData })
      })

      const result = await response.json()
      setValidationResult({
        isValid: result.valid,
        message: result.valid ? 'Init data is valid!' : 'Init data validation failed'
      })

      webApp?.HapticFeedback.notificationOccurred(result.valid ? 'success' : 'error')
    } catch (error) {
      setValidationResult({
        isValid: false,
        message: 'Error validating init data'
      })
      webApp?.HapticFeedback.notificationOccurred('error')
    } finally {
      setIsValidating(false)
    }
  }

  return (
    <div className="space-y-6">
      <DemoSection title="ğŸ” Init Data">
        <div className="space-y-4">
          <div className="p-3 bg-[var(--tg-theme-secondary-bg-color)] rounded">
            <h4 className="font-semibold mb-2">Raw Init Data</h4>
            <p className="text-xs break-all font-mono">
              {initData || 'No init data available'}
            </p>
          </div>

          <div className="p-3 bg-[var(--tg-theme-secondary-bg-color)] rounded">
            <h4 className="font-semibold mb-2">Parsed Data</h4>
            <pre className="text-xs overflow-auto">
              {JSON.stringify(initDataUnsafe, null, 2)}
            </pre>
          </div>

          <div className="space-y-3">
            <button
              onClick={validateInitData}
              disabled={!initData || isValidating}
              className="btn-primary w-full"
            >
              {isValidating ? 'Validating...' : 'Validate Init Data'}
            </button>

            {validationResult.isValid !== null && (
              <div className={`p-3 rounded text-sm ${validationResult.isValid
                  ? 'bg-green-500/20 text-green-600 dark:text-green-400'
                  : 'bg-red-500/20 text-red-600 dark:text-red-400'
                }`}>
                {validationResult.isValid ? 'âœ…' : 'âŒ'} {validationResult.message}
              </div>
            )}
          </div>
        </div>

        <CodeBlock language="bash">
          {`# Install the validation package
npm install @telegram-apps/init-data-node
# or
yarn add @telegram-apps/init-data-node`}
        </CodeBlock>

        <CodeBlock language="typescript">
          {`// === SIMPLE VALIDATION EXAMPLE ===

// 1. API Route: app/api/telegram/validate/route.ts
import { NextRequest, NextResponse } from 'next/server'
import { validate, parse } from '@telegram-apps/init-data-node'

export async function POST(request: NextRequest) {
  const { initData } = await request.json()
  const botToken = process.env.TELEGRAM_BOT_TOKEN!
  
  try {
    // Validate the init data (throws if invalid)
    validate(initData, botToken)
    
    // Parse to get user info
    const data = parse(initData)
    
    return NextResponse.json({ 
      valid: true, 
      user: data.user 
    })
  } catch (error) {
    return NextResponse.json({ 
      valid: false, 
      error: 'Invalid init data' 
    }, { status: 401 })
  }
}

// 2. Protected API Route: app/api/user/profile/route.ts
import { NextRequest, NextResponse } from 'next/server'
import { validate, parse } from '@telegram-apps/init-data-node'

export async function GET(request: NextRequest) {
  const initData = request.headers.get('X-Telegram-Init-Data')
  
  if (!initData) {
    return NextResponse.json({ error: 'No auth' }, { status: 401 })
  }
  
  try {
    validate(initData, process.env.TELEGRAM_BOT_TOKEN!)
    const { user } = parse(initData)
    
    // Fetch user data from your database
    const profile = await getUserProfile(user.id)
    
    return NextResponse.json({ profile })
  } catch {
    return NextResponse.json({ error: 'Invalid auth' }, { status: 401 })
  }
}

// 3. Client-side usage
const fetchProfile = async () => {
  const response = await fetch('/api/user/profile', {
    headers: {
      'X-Telegram-Init-Data': webApp.initData
    }
  })
  
  if (response.ok) {
    const data = await response.json()
    console.log('Profile:', data.profile)
  }
}`}
        </CodeBlock>

        <DemoSection title="ğŸ›¡ï¸ With Expiration Check">
          <CodeBlock language="typescript">
            {`// Add expiration check (optional but recommended)
import { validate, parse } from '@telegram-apps/init-data-node'

export async function validateWithExpiry(
  initData: string, 
  maxAge = 3600 // 1 hour default
) {
  const botToken = process.env.TELEGRAM_BOT_TOKEN!
  
  try {
    // This validates the hash
    validate(initData, botToken)
    
    // Parse and check auth_date
    const parsed = parse(initData)
    const authDate = parsed.authDate.getTime() / 1000
    const now = Date.now() / 1000
    
    if (now - authDate > maxAge) {
      throw new Error('Init data expired')
    }
    
    return { valid: true, data: parsed }
  } catch (error) {
    return { valid: false, error: error.message }
  }
}`}
          </CodeBlock>
        </DemoSection>

        <DemoSection title="ğŸ“ Environment Setup">
          <CodeBlock language="bash">
            {`# .env.local
TELEGRAM_BOT_TOKEN=123456789:ABCdefGHIjklMNOpqrsTUVwxyz

# Get your bot token from @BotFather in Telegram`}
          </CodeBlock>
        </DemoSection>
      </DemoSection>
    </div>
  )
}
```

## /components/demos/LinksDemo.tsx

```tsx
// components/demos/LinksDemo.tsx

/**
 * Telegram Dev Kit - Copyright (c) 2025 Nikandr Surkov
 * 
 * Proprietary License - This code may ONLY be used if purchased from https://nikandr.com
 * Redistribution, reselling, or public publishing is strictly prohibited.
 * 
 * Full license and contact: https://nikandr.com
 */

'use client'

import { useTelegram } from '@/providers/TelegramProvider'
import DemoSection from '@/components/DemoSection'
import CodeBlock from '@/components/CodeBlock'

export default function LinksDemo() {
    const { webApp } = useTelegram()

    const links = [
        {
            title: 'Regular Link',
            description: 'Opens inside webview',
            action: () => window.location.href = 'https://nikandr.com',
            code: `window.location.href = 'https://nikandr.com'`
        },
        {
            title: 'External Link (target="_blank")',
            description: 'Opens outside webview',
            action: () => {
                const a = document.createElement('a')
                a.href = 'https://nikandr.com'
                a.target = '_blank'
                a.click()
            },
            code: `<a href="https://nikandr.com" target="_blank">Open</a>`
        },
        {
            title: 'window.open() Link',
            description: 'Opens in external browser',
            action: () => window.open('https://nikandr.com'),
            code: `window.open('https://nikandr.com')`
        },
        {
            title: 'Telegram Link (t.me)',
            description: 'Opens inside Telegram app',
            action: () => webApp?.openTelegramLink('https://t.me/NikandrApps'),
            code: `webApp.openTelegramLink('https://t.me/NikandrApps')`
        },
        {
            title: 'Instant View Link',
            description: 'Opens with Telegram Instant View',
            action: () => webApp?.openLink('https://telegra.ph/api', { try_instant_view: true }),
            code: `webApp.openLink('https://telegra.ph/api', { try_instant_view: true })`
        },
        {
            title: 'Bot Direct Link',
            description: 'Opens bot with start parameter',
            action: () => webApp?.openTelegramLink('https://t.me/DurgerKingBot/menu'),
            code: `webApp.openTelegramLink('https://t.me/BotName/menu')`
        },
        {
            title: 'Channel Link',
            description: 'Opens Telegram channel',
            action: () => webApp?.openTelegramLink('https://t.me/NikandrApps'),
            code: `webApp.openTelegramLink('https://t.me/NikandrApps')`
        },
        {
            title: 'Sticker Pack',
            description: 'Add sticker pack',
            action: () => webApp?.openTelegramLink('https://t.me/addstickers/pumped_up'),
            code: `webApp.openTelegramLink('https://t.me/addstickers/pumped_up')`
        },
        {
            title: 'Share URL',
            description: 'Share URL via Telegram',
            action: () => webApp?.openTelegramLink(`https://t.me/share/url?url=${encodeURIComponent('https://example.com')}&text=${encodeURIComponent('Check this out!')}`),
            code: `webApp.openTelegramLink('https://t.me/share/url?url=...')`
        }
    ]

    const browserOptions = [
        { name: 'Chrome', value: 'chrome' as const },
        { name: 'Safari', value: 'safari' as const },
        { name: 'Firefox', value: 'firefox' as const },
        { name: 'Opera', value: 'opera' as const }
    ]

    return (
        <div className="space-y-6">
            <DemoSection title="ğŸ”— Link Types">
                <div className="space-y-3">
                    {links.map((link, index) => (
                        <div key={index} className="p-4 bg-[var(--tg-theme-secondary-bg-color)] rounded-lg">
                            <div className="flex justify-between items-start mb-2">
                                <div className="flex-1">
                                    <h4 className="font-semibold">{link.title}</h4>
                                    <p className="text-sm text-[var(--tg-theme-hint-color)]">{link.description}</p>
                                </div>
                                <button
                                    onClick={link.action}
                                    className="btn-primary px-4 py-2 ml-4"
                                >
                                    Open
                                </button>
                            </div>
                            <div className="mt-2 overflow-x-auto">
                                <code className="text-xs bg-black/10 dark:bg-white/10 px-2 py-1 rounded">
                                    {link.code}
                                </code>
                            </div>
                        </div>
                    ))}
                </div>
            </DemoSection>

            <DemoSection title="ğŸŒ Browser Selection">
                <div className="space-y-4">
                    <p className="text-sm text-[var(--tg-theme-hint-color)]">
                        Force links to open in specific browsers:
                    </p>
                    <div className="grid grid-cols-2 gap-2">
                        {browserOptions.map((browser) => (
                            <button
                                key={browser.value}
                                onClick={() => webApp?.openLink('https://nikandr.com', { try_browser: browser.value })}
                                className="btn-secondary"
                            >
                                Open in {browser.name}
                            </button>
                        ))}
                    </div>
                </div>

                <CodeBlock language="typescript">
                    {`// Force specific browser
webApp.openLink('https://example.com', {
  try_browser: 'chrome' // or 'safari', 'firefox', 'opera'
})

// Regular external link
webApp.openLink('https://example.com')

// Telegram links must use openTelegramLink
webApp.openTelegramLink('https://t.me/channelname')

// Share URL with text
const shareUrl = 'https://t.me/share/url?' + 
  'url=' + encodeURIComponent('https://myapp.com') +
  '&text=' + encodeURIComponent('Check out my score!')
  
webApp.openTelegramLink(shareUrl)`}
                </CodeBlock>
            </DemoSection>

        </div>
    )
}
```

## /components/demos/PaymentsDemo.tsx

```tsx
// components/demos/PaymentsDemo.tsx

/**
 * Telegram Dev Kit - Copyright (c) 2025 Nikandr Surkov
 * 
 * Proprietary License - This code may ONLY be used if purchased from https://nikandr.com
 * Redistribution, reselling, or public publishing is strictly prohibited.
 * 
 * Full license and contact: https://nikandr.com
 */

'use client'

import { useState } from 'react'
import { useTelegram } from '@/providers/TelegramProvider'
import DemoSection from '@/components/DemoSection'
import CodeBlock from '@/components/CodeBlock'

export default function PaymentsDemo() {
    const { webApp, user } = useTelegram()
    const [activeTab, setActiveTab] = useState<'overview' | 'implementation' | 'backend' | 'testing'>('overview')

    const tabs = [
        { id: 'overview' as const, label: 'Overview', icon: 'ğŸ“‹' },
        { id: 'implementation' as const, label: 'Implementation', icon: 'ğŸ”§' },
        { id: 'backend' as const, label: 'Backend Setup', icon: 'ğŸ–¥ï¸' },
        { id: 'testing' as const, label: 'Testing', icon: 'ğŸ§ª' }
    ]

    return (
        <div className="space-y-6 w-full">
            <DemoSection title="â­ Telegram Stars Payments">
                {/* Tab Navigation */}
                <div className="flex gap-2 overflow-x-auto pb-2 scrollbar-hide">
                    {tabs.map(tab => (
                        <button
                            key={tab.id}
                            onClick={() => setActiveTab(tab.id)}
                            className={`px-4 py-2 rounded-lg text-sm font-medium whitespace-nowrap transition-colors ${activeTab === tab.id
                                ? 'bg-[var(--tg-theme-button-color)] text-[var(--tg-theme-button-text-color)]'
                                : 'bg-[var(--tg-theme-secondary-bg-color)] text-[var(--tg-theme-text-color)]'
                                }`}
                        >
                            <span className="mr-1">{tab.icon}</span>
                            {tab.label}
                        </button>
                    ))}
                </div>

                {/* Tab Content - Removed overflow-hidden */}
                <div className="mt-6 w-full">
                    {activeTab === 'overview' && <OverviewTab user={user} />}
                    {activeTab === 'implementation' && <ImplementationTab />}
                    {activeTab === 'backend' && <BackendTab />}
                    {activeTab === 'testing' && <TestingTab />}
                </div>
            </DemoSection>
        </div>
    )
}

function OverviewTab({ user }: { user: any }) {
    return (
        <div className="space-y-6 w-full">
            {/* Key Points */}
            <div className="p-4 bg-yellow-500/10 border border-yellow-500/30 rounded-lg">
                <h3 className="font-semibold text-yellow-600 dark:text-yellow-400 mb-2">
                    âš ï¸ Important: Digital Goods Policy
                </h3>
                <p className="text-sm mb-3">
                    Due to App Store and Play Store policies, all digital goods and services
                    in Telegram Mini Apps must be sold exclusively using Telegram Stars.
                </p>
                <ul className="text-sm space-y-1">
                    <li>â€¢ <strong>Digital goods</strong>: Must use Stars (in-app items, subscriptions, features)</li>
                    <li>â€¢ <strong>Physical goods</strong>: Can use any payment provider</li>
                    <li>â€¢ <strong>Currency code</strong>: XTR (Telegram Stars)</li>
                </ul>
            </div>

            {/* What are Telegram Stars? */}
            <div className="space-y-4">
                <h3 className="text-lg font-semibold">What are Telegram Stars?</h3>
                <div className="p-4 bg-[var(--tg-theme-secondary-bg-color)] rounded-lg">
                    <p className="text-sm mb-3">
                        Telegram Stars are an in-app currency that users can purchase through:
                    </p>
                    <ul className="text-sm space-y-2">
                        <li className="flex items-start gap-2">
                            <span>ğŸ“±</span>
                            <div>
                                <strong>App Stores</strong>: Apple Pay, Google Pay
                                <p className="text-xs text-[var(--tg-theme-hint-color)]">
                                    Integrated with platform payment systems
                                </p>
                            </div>
                        </li>
                        <li className="flex items-start gap-2">
                            <span>ğŸ¤–</span>
                            <div>
                                <strong>@PremiumBot</strong>: Direct purchase from Telegram
                                <p className="text-xs text-[var(--tg-theme-hint-color)]">
                                    Alternative payment methods available
                                </p>
                            </div>
                        </li>
                    </ul>
                </div>
            </div>

            {/* Pricing Reference */}
            <div className="space-y-4">
                <h3 className="text-lg font-semibold">ğŸ’¸ Stars Pricing Reference</h3>
                <div className="grid grid-cols-2 gap-3">
                    {[
                        { stars: 50, price: '$0.99' },
                        { stars: 100, price: '$1.99' },
                        { stars: 250, price: '$4.99' },
                        { stars: 500, price: '$9.99' },
                        { stars: 1000, price: '$19.99' },
                        { stars: 2500, price: '$49.99' }
                    ].map(item => (
                        <div key={item.stars} className="p-3 bg-[var(--tg-theme-secondary-bg-color)] rounded">
                            <div className="flex justify-between items-center">
                                <span className="font-semibold">â­ {item.stars}</span>
                                <span className="text-sm text-[var(--tg-theme-hint-color)]">â‰ˆ {item.price}</span>
                            </div>
                        </div>
                    ))}
                </div>
                <p className="text-xs text-[var(--tg-theme-hint-color)]">
                    * Prices vary by region and may include VAT
                </p>
            </div>

            {/* Payment Flow */}
            <div className="space-y-4">
                <h3 className="text-lg font-semibold">ğŸ”„ Payment Flow</h3>
                <div className="space-y-3">
                    {[
                        { step: 1, title: 'Create Invoice', desc: 'Backend creates invoice via Bot API' },
                        { step: 2, title: 'Open Payment UI', desc: 'Mini App opens invoice in Telegram' },
                        { step: 3, title: 'User Pays', desc: 'User purchases Stars if needed and pays' },
                        { step: 4, title: 'Verify Payment', desc: 'Bot receives payment confirmation' },
                        { step: 5, title: 'Deliver Goods', desc: 'Grant access to digital content' }
                    ].map(item => (
                        <div key={item.step} className="flex gap-3">
                            <div className="w-8 h-8 bg-[var(--tg-theme-button-color)] text-[var(--tg-theme-button-text-color)] rounded-full flex items-center justify-center text-sm font-semibold flex-shrink-0">
                                {item.step}
                            </div>
                            <div className="flex-1 min-w-0">
                                <p className="font-semibold text-sm">{item.title}</p>
                                <p className="text-xs text-[var(--tg-theme-hint-color)]">{item.desc}</p>
                            </div>
                        </div>
                    ))}
                </div>
            </div>

            {/* New Features */}
            <div className="space-y-4">
                <h3 className="text-lg font-semibold">âœ¨ Latest Features</h3>
                <div className="grid gap-3">
                    <div className="p-4 bg-purple-500/10 border border-purple-500/30 rounded-lg">
                        <h4 className="font-semibold text-purple-600 dark:text-purple-400 mb-1">
                            ğŸ Gift System
                        </h4>
                        <p className="text-sm">
                            Send gifts to users using your Mini App's Stars balance for engagement and rewards
                        </p>
                    </div>
                    <div className="p-4 bg-blue-500/10 border border-blue-500/30 rounded-lg">
                        <h4 className="font-semibold text-blue-600 dark:text-blue-400 mb-1">
                            ğŸ”„ Subscriptions
                        </h4>
                        <p className="text-sm">
                            Implement recurring payments with multiple subscription tiers
                        </p>
                    </div>
                    <div className="p-4 bg-green-500/10 border border-green-500/30 rounded-lg">
                        <h4 className="font-semibold text-green-600 dark:text-green-400 mb-1">
                            ğŸ’° Affiliate Program
                        </h4>
                        <p className="text-sm">
                            Let users earn Stars by referring others (percentage of payments)
                        </p>
                    </div>
                </div>
            </div>
        </div>
    )
}

function ImplementationTab() {
    return (
        <div className="space-y-6 w-full">
            <h3 className="text-lg font-semibold">Frontend Implementation</h3>

            {/* Step 1: Install Dependencies */}
            <div className="space-y-3">
                <h4 className="font-semibold">Step 1: Install Dependencies</h4>
                <CodeBlock language="bash">
                    {`npm install @twa-dev/sdk
# or
yarn add @twa-dev/sdk`}
                </CodeBlock>
            </div>

            {/* Step 2: Create Invoice Request */}
            <div className="space-y-3">
                <h4 className="font-semibold">Step 2: Request Invoice from Backend</h4>
                <CodeBlock language="typescript">
                    {`// Frontend: Request invoice creation
async function purchaseItem(itemId: string, stars: number) {
  try {
    // Call your backend to create invoice
    const response = await fetch('/api/create-invoice', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json',
        'X-Telegram-Init-Data': webApp.initData // Send auth data
      },
      body: JSON.stringify({ itemId, stars })
    })
    
    if (!response.ok) {
      throw new Error('Failed to create invoice')
    }
    
    const { invoiceLink } = await response.json()
    
    // Open invoice in Telegram
    webApp.openInvoice(invoiceLink, (status) => {
      if (status === 'paid') {
        // Payment successful
        console.log('Payment completed!')
        // Update UI, grant access, etc.
      } else if (status === 'cancelled') {
        console.log('Payment cancelled')
      } else if (status === 'failed') {
        console.log('Payment failed')
      }
    })
  } catch (error) {
    console.error('Purchase error:', error)
  }
}`}
                </CodeBlock>
            </div>

            {/* Step 3: Handle Payment Status */}
            <div className="space-y-3">
                <h4 className="font-semibold">Step 3: Handle Payment Status</h4>
                <CodeBlock language="typescript">
                    {`// Complete payment handling example
import { useState } from 'react'
import WebApp from '@twa-dev/sdk'

function PaymentButton({ product }) {
  const [isLoading, setIsLoading] = useState(false)
  const [isPurchased, setIsPurchased] = useState(false)
  
  const handlePurchase = async () => {
    setIsLoading(true)
    
    try {
      // 1. Create invoice
      const response = await fetch('/api/create-invoice', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
          'X-Telegram-Init-Data': WebApp.initData
        },
        body: JSON.stringify({
          productId: product.id,
          stars: product.price
        })
      })
      
      const { invoiceLink } = await response.json()
      
      // 2. Open payment UI
      WebApp.openInvoice(invoiceLink, async (status) => {
        if (status === 'paid') {
          // 3. Verify payment on backend
          const verifyResponse = await fetch('/api/verify-payment', {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json',
              'X-Telegram-Init-Data': WebApp.initData
            },
            body: JSON.stringify({ productId: product.id })
          })
          
          if (verifyResponse.ok) {
            setIsPurchased(true)
            WebApp.showAlert('Purchase successful!')
          }
        }
        
        setIsLoading(false)
      })
    } catch (error) {
      setIsLoading(false)
      WebApp.showAlert('Purchase failed. Please try again.')
    }
  }
  
  return (
    <button
      onClick={handlePurchase}
      disabled={isLoading || isPurchased}
      className="btn-primary"
    >
      {isPurchased ? 'Purchased' : \`Buy for \${product.price} Stars\`}
    </button>
  )
}`}
                </CodeBlock>
            </div>

            {/* Best Practices */}
            <div className="space-y-3">
                <h4 className="font-semibold">Frontend Best Practices</h4>
                <div className="space-y-3">
                    <div className="p-3 bg-[var(--tg-theme-secondary-bg-color)] rounded">
                        <h5 className="font-semibold mb-1">ğŸ”’ Security</h5>
                        <ul className="text-sm text-[var(--tg-theme-hint-color)] space-y-1">
                            <li>â€¢ Always send initData to backend for validation</li>
                            <li>â€¢ Never trust client-side payment status</li>
                            <li>â€¢ Verify all payments on the backend</li>
                        </ul>
                    </div>

                    <div className="p-3 bg-[var(--tg-theme-secondary-bg-color)] rounded">
                        <h5 className="font-semibold mb-1">ğŸ¨ UI/UX</h5>
                        <ul className="text-sm text-[var(--tg-theme-hint-color)] space-y-1">
                            <li>â€¢ Show loading states during payment</li>
                            <li>â€¢ Disable buttons to prevent double-clicks</li>
                            <li>â€¢ Provide clear error messages</li>
                            <li>â€¢ Use haptic feedback for success/error</li>
                        </ul>
                    </div>

                    <div className="p-3 bg-[var(--tg-theme-secondary-bg-color)] rounded">
                        <h5 className="font-semibold mb-1">âš¡ Performance</h5>
                        <ul className="text-sm text-[var(--tg-theme-hint-color)] space-y-1">
                            <li>â€¢ Cache purchase status locally</li>
                            <li>â€¢ Implement optimistic UI updates</li>
                            <li>â€¢ Handle network errors gracefully</li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    )
}

function BackendTab() {
    return (
        <div className="space-y-6 w-full">
            <h3 className="text-lg font-semibold">Backend Setup</h3>

            {/* Bot Setup */}
            <div className="space-y-3">
                <h4 className="font-semibold">Step 1: Create Telegram Bot</h4>
                <div className="p-4 bg-[var(--tg-theme-secondary-bg-color)] rounded">
                    <ol className="text-sm space-y-2">
                        <li>1. Open <code className="px-1 py-0.5 bg-[var(--tg-theme-bg-color)] rounded">@BotFather</code> in Telegram</li>
                        <li>2. Send <code className="px-1 py-0.5 bg-[var(--tg-theme-bg-color)] rounded">/newbot</code> and follow instructions</li>
                        <li>3. Save your bot token securely</li>
                        <li>4. Enable inline mode if needed: <code className="px-1 py-0.5 bg-[var(--tg-theme-bg-color)] rounded">/setinline</code></li>
                    </ol>
                </div>
            </div>

            {/* Environment Variables */}
            <div className="space-y-3">
                <h4 className="font-semibold">Step 2: Environment Variables</h4>
                <CodeBlock language="bash">
                    {`# .env.local
TELEGRAM_BOT_TOKEN=123456789:ABCdefGHIjklMNOpqrsTUVwxyz
DATABASE_URL=your_database_connection_string
WEBHOOK_URL=https://yourdomain.com/api/telegram-webhook`}
                </CodeBlock>
            </div>

            {/* Create Invoice API */}
            <div className="space-y-3">
                <h4 className="font-semibold">Step 3: Create Invoice Endpoint</h4>
                <CodeBlock language="typescript">
                    {`// app/api/create-invoice/route.ts
import { NextRequest, NextResponse } from 'next/server'
import { validate, parse } from '@telegram-apps/init-data-node'

export async function POST(req: NextRequest) {
  try {
    // 1. Validate Telegram authentication
    const initData = req.headers.get('X-Telegram-Init-Data')
    if (!initData) {
      return NextResponse.json({ error: 'Unauthorized' }, { status: 401 })
    }

    const botToken = process.env.TELEGRAM_BOT_TOKEN!
    validate(initData, botToken)
    const { user } = parse(initData)

    // 2. Get product details
    const { productId, stars } = await req.json()
    
    // 3. Create unique payment ID
    const paymentId = \`\${user.id}_\${productId}_\${Date.now()}\`
    
    // 4. Store pending payment in database
    await db.payments.create({
      id: paymentId,
      userId: user.id,
      productId,
      stars,
      status: 'pending',
      createdAt: new Date()
    })

    // 5. Create invoice via Telegram Bot API
    const response = await fetch(
      \`https://api.telegram.org/bot\${botToken}/createInvoiceLink\`,
      {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({
          title: 'Premium Feature',
          description: 'Unlock premium features',
          payload: paymentId, // Important: use this to track payment
          provider_token: '', // Empty for Stars
          currency: 'XTR',    // Telegram Stars
          prices: [{ 
            label: 'Premium Feature', 
            amount: stars 
          }]
        })
      }
    )

    const data = await response.json()
    
    if (!data.ok) {
      throw new Error(data.description)
    }

    return NextResponse.json({ 
      invoiceLink: data.result,
      paymentId 
    })
  } catch (error) {
    console.error('Invoice creation error:', error)
    return NextResponse.json(
      { error: 'Failed to create invoice' },
      { status: 500 }
    )
  }
}`}
                </CodeBlock>
            </div>

            {/* Webhook Handler */}
            <div className="space-y-3">
                <h4 className="font-semibold">Step 4: Handle Payment Webhook</h4>
                <CodeBlock language="typescript">
                    {`// app/api/telegram-webhook/route.ts
import { NextRequest, NextResponse } from 'next/server'

export async function POST(req: NextRequest) {
  try {
    const update = await req.json()
    
    // Handle pre-checkout query
    if (update.pre_checkout_query) {
      const query = update.pre_checkout_query
      
      // Verify the payment is valid
      const payment = await db.payments.findUnique({
        where: { id: query.invoice_payload }
      })
      
      if (payment && payment.status === 'pending') {
        // Approve the payment
        await fetch(
          \`https://api.telegram.org/bot\${process.env.TELEGRAM_BOT_TOKEN}/answerPreCheckoutQuery\`,
          {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({
              pre_checkout_query_id: query.id,
              ok: true
            })
          }
        )
      } else {
        // Reject the payment
        await fetch(
          \`https://api.telegram.org/bot\${process.env.TELEGRAM_BOT_TOKEN}/answerPreCheckoutQuery\`,
          {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({
              pre_checkout_query_id: query.id,
              ok: false,
              error_message: 'Payment not found or already processed'
            })
          }
        )
      }
    }
    
    // Handle successful payment
    if (update.message?.successful_payment) {
      const payment = update.message.successful_payment
      
      // Update payment status
      await db.payments.update({
        where: { id: payment.invoice_payload },
        data: {
          status: 'completed',
          telegramPaymentChargeId: payment.telegram_payment_charge_id,
          completedAt: new Date()
        }
      })
      
      // Grant access to digital goods
      await grantUserAccess(payment.invoice_payload)
      
      // Send confirmation to user
      await fetch(
        \`https://api.telegram.org/bot\${process.env.TELEGRAM_BOT_TOKEN}/sendMessage\`,
        {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({
            chat_id: update.message.chat.id,
            text: 'âœ… Payment successful! Your purchase has been activated.'
          })
        }
      )
    }
    
    return NextResponse.json({ ok: true })
  } catch (error) {
    console.error('Webhook error:', error)
    return NextResponse.json({ ok: false }, { status: 500 })
  }
}`}
                </CodeBlock>
            </div>

            {/* Refund Implementation */}
            <div className="space-y-3">
                <h4 className="font-semibold">Step 5: Implement Refunds</h4>
                <CodeBlock language="typescript">
                    {`// app/api/refund/route.ts
export async function POST(req: NextRequest) {
  try {
    const { paymentId } = await req.json()
    
    // Get payment details
    const payment = await db.payments.findUnique({
      where: { id: paymentId }
    })
    
    if (!payment || payment.status !== 'completed') {
      return NextResponse.json(
        { error: 'Payment not found or not completed' },
        { status: 400 }
      )
    }
    
    // Call Telegram refund API
    const response = await fetch(
      \`https://api.telegram.org/bot\${process.env.TELEGRAM_BOT_TOKEN}/refundStarPayment\`,
      {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({
          user_id: payment.userId,
          telegram_payment_charge_id: payment.telegramPaymentChargeId
        })
      }
    )
    
    const result = await response.json()
    
    if (result.ok) {
      // Update payment status
      await db.payments.update({
        where: { id: paymentId },
        data: { 
          status: 'refunded',
          refundedAt: new Date()
        }
      })
      
      // Revoke access
      await revokeUserAccess(paymentId)
      
      return NextResponse.json({ success: true })
    } else {
      throw new Error(result.description)
    }
  } catch (error) {
    console.error('Refund error:', error)
    return NextResponse.json(
      { error: 'Failed to process refund' },
      { status: 500 }
    )
  }
}`}
                </CodeBlock>
            </div>

            {/* Database Schema */}
            <div className="space-y-3">
                <h4 className="font-semibold">Database Schema Example</h4>
                <CodeBlock language="typescript">
                    {`// Prisma schema example
model Payment {
  id                      String    @id @default(cuid())
  userId                  String
  productId               String
  stars                   Int
  status                  String    // pending, completed, refunded
  telegramPaymentChargeId String?
  createdAt               DateTime  @default(now())
  completedAt             DateTime?
  refundedAt              DateTime?
  
  @@index([userId])
  @@index([status])
}`}
                </CodeBlock>
            </div>
        </div>
    )
}

function TestingTab() {
    return (
        <div className="space-y-6 w-full">
            <h3 className="text-lg font-semibold">Testing Your Implementation</h3>

            {/* Recommended Testing Approach */}
            <div className="space-y-3">
                <h4 className="font-semibold">ğŸ’¡ Recommended Testing Strategy</h4>
                <div className="p-4 bg-green-500/10 border border-green-500/30 rounded-lg">
                    <h5 className="font-semibold text-green-600 dark:text-green-400 mb-2">
                        Test with Real Stars + Easy Refunds
                    </h5>
                    <p className="text-sm mb-3">
                        The most practical approach is to test with real Stars and implement a simple refund mechanism.
                        This gives you the real experience without losing money.
                    </p>
                    <ol className="text-sm space-y-2">
                        <li>ğŸ“± <strong>Buy minimal Stars</strong>: Purchase 50 Stars for ~$1</li>
                        <li>ğŸ§ª <strong>Test with 1-star payments</strong>: Minimize cost per test</li>
                        <li>ğŸ’¾ <strong>Save transaction IDs</strong>: Store them for easy refunds</li>
                        <li>â†©ï¸ <strong>Refund after testing</strong>: Get your Stars back</li>
                    </ol>
                </div>
            </div>

            {/* Quick Refund Implementation */}
            <div className="space-y-3">
                <h4 className="font-semibold">ğŸ”„ Implementing Test Refunds</h4>
                <p className="text-sm text-[var(--tg-theme-hint-color)] mb-3">
                    Add a simple refund mechanism to your bot for testing purposes:
                </p>

                <CodeBlock language="typescript">
                    {`// Simple refund command for testing
bot.command('refund_test', async (ctx) => {
  // Only allow for admin/testing accounts
  const testUserIds = [YOUR_TEST_USER_ID]
  if (!testUserIds.includes(ctx.from.id)) {
    return ctx.reply('This command is only for testing')
  }

  // Get recent test purchases
  const recentPurchases = await db.payments.findMany({
    where: {
      userId: ctx.from.id,
      status: 'completed',
      createdAt: {
        // Last 24 hours
        gte: new Date(Date.now() - 24 * 60 * 60 * 1000)
      }
    },
    orderBy: { createdAt: 'desc' },
    take: 5
  })

  if (recentPurchases.length === 0) {
    return ctx.reply('No recent purchases found')
  }

  // Create refund buttons
  const keyboard = {
    inline_keyboard: recentPurchases.map(purchase => [{
      text: \`Refund \${purchase.stars} â­ - \${
        new Date(purchase.createdAt).toLocaleTimeString()
      }\`,
      callback_data: \`refund_\${purchase.id}\`
    }])
  }

  ctx.reply('Select a purchase to refund:', { 
    reply_markup: keyboard 
  })
})

// Handle refund callback
bot.on('callback_query', async (ctx) => {
  const data = ctx.callbackQuery.data
  
  if (data?.startsWith('refund_')) {
    const paymentId = data.replace('refund_', '')
    const payment = await db.payments.findUnique({ 
      where: { id: paymentId } 
    })
    
    if (!payment) {
      return ctx.answerCallbackQuery('Payment not found')
    }

    try {
      // Process refund
      await ctx.api.refundStarPayment(
        payment.userId,
        payment.telegramPaymentChargeId
      )

      // Update database
      await db.payments.update({
        where: { id: paymentId },
        data: { status: 'refunded' }
      })

      ctx.answerCallbackQuery('âœ… Refunded successfully!')
      ctx.editMessageText('âœ… Refund processed!')
    } catch (error) {
      ctx.answerCallbackQuery('âŒ Refund failed')
    }
  }
})`}
                </CodeBlock>
            </div>

            {/* Testing Checklist */}
            <div className="space-y-3">
                <h4 className="font-semibold">âœ… Testing Checklist</h4>
                <div className="grid gap-2">
                    {[
                        { task: 'Create test product with 1 Star price', done: false },
                        { task: 'Implement refund command for test users', done: false },
                        { task: 'Test successful payment flow', done: false },
                        { task: 'Test cancelled payment handling', done: false },
                        { task: 'Test refund functionality', done: false },
                        { task: 'Verify webhook receives updates', done: false },
                        { task: 'Test duplicate payment prevention', done: false },
                        { task: 'Check error handling', done: false },
                        { task: 'Test with different user accounts', done: false },
                        { task: 'Verify database integrity', done: false }
                    ].map((item, index) => (
                        <label key={index} className="flex items-center gap-3 p-3 bg-[var(--tg-theme-secondary-bg-color)] rounded cursor-pointer hover:bg-opacity-80">
                            <input type="checkbox" className="w-4 h-4" />
                            <span className="text-sm flex-1">{item.task}</span>
                        </label>
                    ))}
                </div>
            </div>

            {/* Testing Tips */}
            <div className="space-y-3">
                <h4 className="font-semibold">ğŸ’¡ Testing Best Practices</h4>

                {/* Create Test Products */}
                <div className="space-y-2">
                    <h5 className="font-semibold">Create Test Products</h5>
                    <CodeBlock language="typescript">
                        {`// Add test products with minimal price
const TEST_PRODUCTS = [
  { 
    id: 'test_1star', 
    name: 'Test Item', 
    stars: 1 
  },
  { 
    id: 'test_feature', 
    name: 'Test Feature', 
    stars: 1 
  },
  { 
    id: 'test_premium', 
    name: 'Test Premium', 
    stars: 2 
  }
]

// Only show to test users
if (isTestUser(userId)) {
  products.push(...TEST_PRODUCTS)
}`}
                    </CodeBlock>
                </div>

                {/* Track Test Payments */}
                <div className="space-y-2">
                    <h5 className="font-semibold">Track Test Payments</h5>
                    <CodeBlock language="typescript">
                        {`// Add metadata to identify test payments
await db.payments.create({
  data: {
    userId,
    productId,
    stars,
    isTest: process.env.NODE_ENV !== 'production',
    metadata: {
      environment: process.env.NODE_ENV,
      testUser: isTestUser(userId)
    }
  }
})`}
                    </CodeBlock>
                </div>

                {/* Automated Test Cleanup */}
                <div className="space-y-2">
                    <h5 className="font-semibold">Automated Test Cleanup</h5>
                    <CodeBlock language="typescript">
                        {`// Daily cleanup of test purchases (optional)
async function cleanupTestPurchases() {
  const testPurchases = await db.payments.findMany({
    where: {
      isTest: true,
      status: 'completed',
      createdAt: { 
        lte: new Date(Date.now() - 24*60*60*1000) 
      }
    }
  })

  for (const purchase of testPurchases) {
    try {
      await bot.api.refundStarPayment(
        purchase.userId,
        purchase.telegramPaymentChargeId
      )
      
      await db.payments.update({
        where: { id: purchase.id },
        data: { status: 'auto_refunded' }
      })
    } catch (error) {
      console.error(
        'Auto-refund failed:', 
        purchase.id
      )
    }
  }
}`}
                    </CodeBlock>
                </div>
            </div>

            {/* Cost Analysis */}
            <div className="space-y-3">
                <h4 className="font-semibold">ğŸ’° Testing Cost Analysis</h4>
                <div className="p-4 bg-blue-500/10 border border-blue-500/30 rounded-lg">
                    <div className="grid grid-cols-2 gap-4 text-sm">
                        <div>
                            <p className="font-semibold">Initial Investment:</p>
                            <p className="text-2xl font-bold">$0.99</p>
                            <p className="text-xs text-[var(--tg-theme-hint-color)]">50 Stars minimum purchase</p>
                        </div>
                        <div>
                            <p className="font-semibold">Cost per Test:</p>
                            <p className="text-2xl font-bold">$0.02</p>
                            <p className="text-xs text-[var(--tg-theme-hint-color)]">1 Star â‰ˆ $0.02 (refundable)</p>
                        </div>
                    </div>
                    <p className="text-sm mt-4 text-center">
                        With refunds, your actual testing cost is <strong>$0</strong> ğŸ‰
                    </p>
                </div>
            </div>

            {/* Important Notes */}
            <div className="space-y-3">
                <h4 className="font-semibold">âš ï¸ Important Testing Notes</h4>
                <div className="space-y-3">
                    <div className="p-3 bg-yellow-500/10 border border-yellow-500/30 rounded">
                        <p className="text-sm font-semibold mb-1">Invoice Reusability</p>
                        <p className="text-xs">
                            Paid invoices remain valid and can be paid again. Always check in your database
                            if a user has already purchased an item before delivering goods.
                        </p>
                    </div>

                    <div className="p-3 bg-yellow-500/10 border border-yellow-500/30 rounded">
                        <p className="text-sm font-semibold mb-1">Transaction IDs</p>
                        <p className="text-xs">
                            Always store <code>telegram_payment_charge_id</code> from successful payments.
                            You need this for refunds.
                        </p>
                    </div>

                    <div className="p-3 bg-yellow-500/10 border border-yellow-500/30 rounded">
                        <p className="text-sm font-semibold mb-1">Withdrawal Period</p>
                        <p className="text-xs">
                            Remember: You can only withdraw Stars to crypto after 3 weeks.
                            But refunds to users can be processed immediately.
                        </p>
                    </div>
                </div>
            </div>

            {/* Production Transition */}
            <div className="space-y-3">
                <h4 className="font-semibold">ğŸš€ Transitioning to Production</h4>
                <div className="p-4 bg-green-500/10 border border-green-500/30 rounded-lg">
                    <p className="text-sm mb-3">Before going live:</p>
                    <ul className="text-sm space-y-2">
                        <li>âœ… Remove or restrict test commands</li>
                        <li>âœ… Disable automatic refunds</li>
                        <li>âœ… Remove test products</li>
                        <li>âœ… Set up proper monitoring</li>
                        <li>âœ… Prepare customer support flow</li>
                        <li>âœ… Document refund policy</li>
                        <li>âœ… Enable 2FA on bot account</li>
                    </ul>
                </div>
            </div>
        </div>
    )
}
```

## /components/demos/PopupsDemo.tsx

```tsx
// components/demos/PopupsDemo.tsx

/**
 * Telegram Dev Kit - Copyright (c) 2025 Nikandr Surkov
 * 
 * Proprietary License - This code may ONLY be used if purchased from https://nikandr.com
 * Redistribution, reselling, or public publishing is strictly prohibited.
 * 
 * Full license and contact: https://nikandr.com
 */

'use client'

import { useState } from 'react'
import { useTelegram } from '@/providers/TelegramProvider'
import DemoSection from '@/components/DemoSection'
import CodeBlock from '@/components/CodeBlock'

export default function PopupsDemo() {
    const { webApp } = useTelegram()
    const [isPopupOpen, setIsPopupOpen] = useState(false)

    // Helper function to safely show popup
    const safeShowPopup = (params: any, callback?: (buttonId: string | null) => void) => {
        if (isPopupOpen) {
            webApp?.showAlert('Please close the current popup first')
            return
        }

        setIsPopupOpen(true)
        webApp?.showPopup(params, (buttonId) => {
            setIsPopupOpen(false)
            if (callback) {
                // Wrap callback in try-catch to handle any errors
                try {
                    callback(buttonId)
                } catch (e) {
                    console.error('Error in popup callback:', e)
                    // Reset state if error occurs
                    setIsPopupOpen(false)
                }
            }
        })
    }

    const showBasicPopup = () => {
        safeShowPopup({
            title: 'Basic Popup',
            message: 'This is a simple popup message',
            buttons: [{ type: 'ok' }]
        }, (buttonId) => {
            console.log('Button pressed:', buttonId)
        })
    }

    const showMultiButtonPopup = () => {
        safeShowPopup({
            title: 'Save Changes?',
            message: 'You have unsaved changes. What would you like to do?',
            buttons: [
                { id: 'save', type: 'default', text: 'Save' },
                { id: 'discard', type: 'destructive', text: 'Discard' },
                { type: 'cancel' }
            ]
        }, (buttonId) => {
            // Use setTimeout to ensure popup is fully closed
            setTimeout(() => {
                // Reset popup state before showing alert
                setIsPopupOpen(false)
                switch (buttonId) {
                    case 'save':
                        console.log('Changes saved!')
                        webApp?.HapticFeedback.notificationOccurred('success')
                        break
                    case 'discard':
                        console.log('Changes discarded')
                        webApp?.HapticFeedback.notificationOccurred('warning')
                        break
                    default:
                        console.log('Cancelled')
                }
            }, 100)
        })
    }

    const showDestructivePopup = () => {
        safeShowPopup({
            title: 'Delete Account',
            message: 'Are you sure you want to delete your account? This action cannot be undone.',
            buttons: [
                { id: 'delete', type: 'destructive', text: 'Delete Account' },
                { type: 'cancel', text: 'Keep Account' }
            ]
        }, (buttonId) => {
            if (buttonId === 'delete') {
                setTimeout(() => {
                    setIsPopupOpen(false)
                    webApp?.HapticFeedback.notificationOccurred('warning')
                    console.log('Account deletion initiated')
                }, 100)
            }
        })
    }

    const showGameOverPopup = () => {
        safeShowPopup({
            title: 'ğŸ® Game Over!',
            message: 'You scored 1,234 points!\n\nThat\'s a new high score! ğŸ‰',
            buttons: [
                { id: 'replay', type: 'default', text: 'ğŸ”„ Play Again' },
                { id: 'share', type: 'default', text: 'ğŸ“¤ Share Score' },
                { type: 'close', text: 'Exit' }
            ]
        }, (buttonId) => {
            // Use setTimeout to ensure actions happen after popup closes
            setTimeout(() => {
                setIsPopupOpen(false)
                switch (buttonId) {
                    case 'replay':
                        console.log('Starting new game...')
                        webApp?.HapticFeedback.notificationOccurred('success')
                        break
                    case 'share':
                        // Don't try switchInlineQuery unless we're sure it's available
                        if (webApp?.initDataUnsafe?.query_id) {
                            try {
                                webApp.switchInlineQuery('I just scored 1,234 points! Can you beat me?', ['users'])
                            } catch (e) {
                                console.error('Inline query error:', e)
                                // Fallback to URL sharing
                                webApp?.openTelegramLink(`https://t.me/share/url?url=${encodeURIComponent('https://t.me/nikandrsurkov_bot')}&text=${encodeURIComponent('I just scored 1,234 points! Can you beat me?')}`)
                            }
                        } else {
                            // Direct fallback to URL sharing
                            webApp?.openTelegramLink(`https://t.me/share/url?url=${encodeURIComponent('https://t.me/nikandrsurkov_bot')}&text=${encodeURIComponent('I just scored 1,234 points! Can you beat me?')}`)
                        }
                        break
                    default:
                        console.log('Game closed')
                }
            }, 100)
        })
    }

    const showGameMenuPopup = () => {
        safeShowPopup({
            title: 'ğŸ® Game Menu',
            message: 'What would you like to do?',
            buttons: [
                { id: 'continue', type: 'default', text: 'Continue Playing' },
                { id: 'options', type: 'default', text: 'Game Options' },
                { id: 'quit', type: 'destructive', text: 'Quit Game' }
            ]
        }, (buttonId) => {
            setTimeout(() => {
                setIsPopupOpen(false)
                switch (buttonId) {
                    case 'continue':
                        console.log('Resuming game...')
                        webApp?.HapticFeedback.notificationOccurred('success')
                        break
                    case 'options':
                        // Add delay before showing next popup
                        setTimeout(() => {
                            showOptionsPopup()
                        }, 200)
                        break
                    case 'quit':
                        // Use setTimeout for confirm dialog too
                        setTimeout(() => {
                            webApp?.showConfirm('Are you sure you want to quit?', (confirmed) => {
                                if (confirmed) {
                                    webApp?.close()
                                }
                            })
                        }, 100)
                        break
                }
            }, 100)
        })
    }

    const showOptionsPopup = () => {
        safeShowPopup({
            title: 'âš™ï¸ Game Options',
            message: 'Select an option:',
            buttons: [
                { id: 'sound', type: 'default', text: 'ğŸ”Š Sound Settings' },
                { id: 'controls', type: 'default', text: 'ğŸ® Controls' },
                { type: 'cancel', text: 'Back' }
            ]
        }, (buttonId) => {
            setTimeout(() => {
                setIsPopupOpen(false)

                // Use a single alert to confirm the action
                if (buttonId === 'sound') {
                    setTimeout(() => {
                        webApp?.showAlert(
                            'ğŸ”Š Sound Settings\n\n' +
                            'Master Volume: 80%\n' +
                            'Effects: ON\n' +
                            'Music: ON\n\n' +
                            '(In a real app, this would open a settings screen)'
                        )
                    }, 200)
                } else if (buttonId === 'controls') {
                    setTimeout(() => {
                        webApp?.showAlert(
                            'ğŸ® Control Settings\n\n' +
                            'Current: Touch Controls\n' +
                            'Available: Swipe, Tilt\n\n' +
                            '(In a real app, this would open a controls screen)'
                        )
                    }, 200)
                }
            }, 100)
        })
    }

    const compareAlerts = () => {
        // First show native alert
        alert('This is a native JavaScript alert')

        // Then show Telegram alert
        setTimeout(() => {
            webApp?.showAlert('This is a Telegram WebApp alert - much better styled!')
        }, 100)
    }

    const compareConfirms = () => {
        // First show native confirm
        const nativeResult = confirm('Native confirm: Continue?')
        console.log('Native result:', nativeResult)

        // Then show Telegram confirm
        setTimeout(() => {
            webApp?.showConfirm('Telegram confirm: Continue?', (result) => {
                // Log result instead of showing another alert
                console.log(`Telegram confirm result: ${result ? 'Yes' : 'No'}`)
                webApp?.HapticFeedback.notificationOccurred(result ? 'success' : 'warning')
            })
        }, 100)
    }

    // Test inline query availability
    const testInlineQuery = () => {
        safeShowPopup({
            title: 'ğŸ“¤ Test Inline Query',
            message: 'This will test if inline mode is available',
            buttons: [
                { id: 'test', type: 'default', text: 'Test Inline' },
                { id: 'share', type: 'default', text: 'Alternative Share' },
                { type: 'cancel' }
            ]
        }, (buttonId) => {
            setTimeout(() => {
                setIsPopupOpen(false)
                if (buttonId === 'test') {
                    // Check if inline query is available before trying to use it
                    if (webApp?.initDataUnsafe?.query_id) {
                        try {
                            webApp.switchInlineQuery('Test message', ['users'])
                        } catch (e) {
                            console.error('Inline query error:', e)
                            // Delay the alert to avoid popup conflict
                            setTimeout(() => {
                                webApp.showAlert('Inline mode error. Please check if inline mode is enabled for this bot.')
                            }, 100)
                        }
                    } else {
                        // Don't try to call switchInlineQuery if we know it's not available
                        setTimeout(() => {
                            webApp?.showAlert(
                                'Inline mode is not available in this context.\n\n' +
                                'To enable inline mode:\n' +
                                '1. Go to @BotFather\n' +
                                '2. Send /setinline\n' +
                                '3. Select your bot\n' +
                                '4. Set placeholder text\n\n' +
                                'Note: Inline mode only works when the Mini App is opened from an inline query.'
                            )
                        }, 100)
                    }
                } else if (buttonId === 'share') {
                    // Alternative sharing via URL
                    webApp?.openTelegramLink(`https://t.me/share/url?url=${encodeURIComponent('https://t.me/nikandrsurkov_bot')}&text=${encodeURIComponent('Check out this awesome Mini App!')}`)
                }
            }, 100)
        })
    }

    return (
        <div className="space-y-6">
            <DemoSection title="ğŸ”” Popup Types">
                <div className="space-y-3">
                    <button onClick={showBasicPopup} className="btn-primary w-full">
                        Basic Popup (OK button)
                    </button>

                    <button onClick={showMultiButtonPopup} className="btn-primary w-full">
                        Multi-Button Popup (3 buttons)
                    </button>

                    <button onClick={showDestructivePopup} className="btn-primary w-full">
                        Destructive Action Popup
                    </button>

                    <button onClick={showGameOverPopup} className="btn-primary w-full">
                        Game Over Popup (with Share)
                    </button>

                    <button onClick={showGameMenuPopup} className="btn-primary w-full">
                        Game Menu Popup
                    </button>

                    <button onClick={testInlineQuery} className="btn-primary w-full">
                        Test Inline Query
                    </button>
                </div>

                <CodeBlock language="typescript">
                    {`// Safe popup handling - avoid nested popups!
const [isPopupOpen, setIsPopupOpen] = useState(false)

function safeShowPopup(params, callback) {
  if (isPopupOpen) return
  
  setIsPopupOpen(true)
  webApp.showPopup(params, (buttonId) => {
    setIsPopupOpen(false)
    
    // Important: Use console.log instead of showAlert
    // inside popup callbacks to avoid conflicts
    setTimeout(() => {
      try {
        callback(buttonId)
      } catch (e) {
        console.error('Popup callback error:', e)
      }
    }, 100)
  })
}

// Never call showAlert inside a popup callback!
// Use console.log or haptic feedback instead:
webApp.HapticFeedback.notificationOccurred('success')

// If you must show an alert after a popup, delay it:
setTimeout(() => {
  webApp.showAlert('Action completed!')
}, 200)`}
                </CodeBlock>
            </DemoSection>

            <DemoSection title="ğŸ†š Native vs Telegram Alerts">
                <div className="space-y-3">
                    <button onClick={compareAlerts} className="btn-secondary w-full">
                        Compare alert() vs showAlert()
                    </button>

                    <button onClick={compareConfirms} className="btn-secondary w-full">
                        Compare confirm() vs showConfirm()
                    </button>

                    <div className="p-3 bg-[var(--tg-theme-secondary-bg-color)] rounded text-sm">
                        <p className="font-semibold mb-2">Why use Telegram popups?</p>
                        <ul className="space-y-1 text-[var(--tg-theme-hint-color)]">
                            <li>â€¢ Consistent styling with Telegram UI</li>
                            <li>â€¢ Better mobile experience</li>
                            <li>â€¢ Non-blocking (doesn't freeze the app)</li>
                            <li>â€¢ Supports multiple buttons and types</li>
                            <li>â€¢ Proper theme support</li>
                        </ul>
                    </div>
                </div>
            </DemoSection>

            <DemoSection title="âš ï¸ Important: Avoid Nested Popups">
                <div className="p-4 bg-red-500/10 border border-red-500/30 rounded-lg">
                    <h4 className="font-semibold text-red-600 dark:text-red-400 mb-2">
                        Common Popup Mistakes
                    </h4>
                    <ul className="text-sm space-y-1">
                        <li>âŒ Don't call showAlert() inside popup callbacks</li>
                        <li>âŒ Don't call showPopup() immediately after another popup</li>
                        <li>âŒ Don't call showConfirm() inside popup callbacks</li>
                        <li>âœ… Use console.log() for debugging in callbacks</li>
                        <li>âœ… Use haptic feedback for user feedback</li>
                        <li>âœ… Add delays between consecutive popups (200ms+)</li>
                        <li>âœ… Reset state properly after each popup</li>
                    </ul>
                </div>
            </DemoSection>

            <DemoSection title="âš ï¸ Handling Inline Mode">
                <div className="space-y-3">
                    <div className="p-4 bg-yellow-500/10 border border-yellow-500/30 rounded-lg">
                        <h4 className="font-semibold text-yellow-600 dark:text-yellow-400 mb-2">
                            Inline Mode Alternative
                        </h4>
                        <p className="text-sm mb-3">
                            If inline mode is disabled, use the share URL method instead:
                        </p>
                        <div className="space-y-2">
                            <button
                                onClick={() => {
                                    const shareUrl = `https://t.me/share/url?url=${encodeURIComponent('https://t.me/nikandrsurkov_bot')}&text=${encodeURIComponent('Check out my score: 1000 points! ğŸ®')}`
                                    webApp?.openTelegramLink(shareUrl)
                                }}
                                className="btn-secondary w-full text-sm"
                            >
                                Share via URL (Always Works)
                            </button>

                            <button
                                onClick={() => {
                                    webApp?.showAlert(
                                        'To enable inline mode:\n\n' +
                                        '1. Go to @BotFather\n' +
                                        '2. Send /setinline\n' +
                                        '3. Select your bot\n' +
                                        '4. Set placeholder text like "Search..."\n\n' +
                                        'Then inline queries will work!'
                                    )
                                }}
                                className="btn-secondary w-full text-sm"
                            >
                                How to Enable Inline Mode
                            </button>
                        </div>
                    </div>

                    <CodeBlock language="typescript">
                        {`// Always-working share implementation
function shareScore(score) {
  // Method 1: Try inline query (if enabled)
  const useInline = () => {
    // Check if query_id exists first
    if (!webApp?.initDataUnsafe?.query_id) {
      return false
    }
    
    try {
      webApp.switchInlineQuery(
        \`My score: \${score} points!\`,
        ['users', 'groups']
      )
      return true
    } catch (e) {
      return false
    }
  }
  
  // Method 2: Fallback to share URL
  const useShareUrl = () => {
    const text = \`I scored \${score} points! Can you beat me?\`
    const url = 'https://t.me/yourbotname'
    const shareLink = 
      'https://t.me/share/url?' +
      'url=' + encodeURIComponent(url) +
      '&text=' + encodeURIComponent(text)
    
    webApp.openTelegramLink(shareLink)
  }
  
  // Try inline first, fallback to URL
  if (!useInline()) {
    useShareUrl()
  }
}`}
                    </CodeBlock>
                </div>
            </DemoSection>

            <DemoSection title="ğŸ“‹ Common Use Cases">
                <div className="grid grid-cols-1 gap-3">
                    <button
                        onClick={() => {
                            safeShowPopup({
                                title: 'ğŸ† Achievement Unlocked!',
                                message: 'Speed Demon\nComplete level in under 30 seconds',
                                buttons: [{ type: 'ok', text: 'Awesome!' }]
                            }, () => {
                                console.log('Achievement acknowledged')
                                webApp?.HapticFeedback.notificationOccurred('success')
                            })
                        }}
                        className="btn-secondary"
                    >
                        Simple Achievement
                    </button>

                    <button
                        onClick={() => {
                            safeShowPopup({
                                title: 'ğŸ’° Purchase Gems',
                                message: 'Select a package:',
                                buttons: [
                                    { id: 'small', type: 'default', text: '100 ğŸ’ - $0.99' },
                                    { id: 'large', type: 'default', text: '500 ğŸ’ - $3.99' },
                                    { type: 'cancel' }
                                ]
                            }, (buttonId) => {
                                setTimeout(() => {
                                    setIsPopupOpen(false)
                                    if (buttonId && buttonId !== 'cancel') {
                                        console.log(`Selected package: ${buttonId}`)
                                        webApp?.HapticFeedback.notificationOccurred('success')
                                        // Navigate to payment page instead of showing alert
                                    }
                                }, 100)
                            })
                        }}
                        className="btn-secondary"
                    >
                        In-App Purchase
                    </button>

                    <button
                        onClick={() => {
                            const shareText = 'Join me in this awesome game!'
                            const botUrl = 'https://t.me/nikandrsurkov_bot'
                            webApp?.openTelegramLink(
                                `https://t.me/share/url?url=${encodeURIComponent(botUrl)}&text=${encodeURIComponent(shareText)}`
                            )
                        }}
                        className="btn-secondary"
                    >
                        Direct Share (No Inline Needed)
                    </button>
                </div>
            </DemoSection>
        </div>
    )
}
```

## /components/demos/QRScannerDemo.tsx

```tsx
// components/demos/QRScannerDemo.tsx

/**
 * Telegram Dev Kit - Copyright (c) 2025 Nikandr Surkov
 * 
 * Proprietary License - This code may ONLY be used if purchased from https://nikandr.com
 * Redistribution, reselling, or public publishing is strictly prohibited.
 * 
 * Full license and contact: https://nikandr.com
 */

'use client'

import { useState } from 'react'
import { useTelegram } from '@/providers/TelegramProvider'
import DemoSection from '@/components/DemoSection'
import CodeBlock from '@/components/CodeBlock'
import QRCode from 'react-qr-code'

export default function QRScannerDemo() {
    const { webApp } = useTelegram()
    const [scanHistory, setScanHistory] = useState<Array<{
        text: string
        timestamp: Date
        type: string
    }>>([])

    const scanQRCode = () => {
        webApp?.showScanQrPopup(
            { text: 'Scan any QR code' },
            (text: string) => {
                // Detect QR code type
                const type = detectQRType(text)

                // Add to history
                setScanHistory(prev => [{
                    text,
                    timestamp: new Date(),
                    type
                }, ...prev.slice(0, 4)]) // Keep last 5 scans

                // Handle based on type with delay to avoid popup conflicts
                setTimeout(() => {
                    handleQRResult(text, type)
                }, 100)

                // Return true to close scanner
                return true
            }
        )
    }

    const scanQRCodeLinksOnly = () => {
        webApp?.showScanQrPopup(
            { text: 'Scan a QR code containing a URL' },
            (text: string) => {
                // Check if it's a valid URL
                const lowerText = text.toLowerCase()
                if (lowerText.startsWith('http://') || lowerText.startsWith('https://')) {
                    webApp.HapticFeedback.notificationOccurred('success')

                    // Add to history
                    setScanHistory(prev => [{
                        text,
                        timestamp: new Date(),
                        type: 'URL'
                    }, ...prev.slice(0, 4)])

                    // Ask user if they want to open the link with proper delay
                    setTimeout(() => {
                        webApp.showConfirm(
                            `Open this link?\n\n${text}`,
                            (confirmed) => {
                                if (confirmed) {
                                    webApp.openLink(text)
                                }
                            }
                        )
                    }, 100) // Increased delay for safety

                    return true
                } else {
                    // Not a URL, keep scanner open
                    // Only use haptic feedback, no alert while scanner is open
                    webApp.HapticFeedback.notificationOccurred('error')
                    return false
                }
            }
        )
    }

    const scanGameCode = () => {
        webApp?.showScanQrPopup(
            { text: 'Scan game bonus code' },
            (text: string) => {
                // Check if it's a valid game code format
                if (text.match(/^BONUS-[A-Z0-9]{6}$/)) {
                    webApp.HapticFeedback.notificationOccurred('success')

                    setScanHistory(prev => [{
                        text,
                        timestamp: new Date(),
                        type: 'Game Code'
                    }, ...prev.slice(0, 4)])

                    // Delay the success alert to avoid popup conflict
                    setTimeout(() => {
                        webApp.showAlert(`ğŸ‰ Bonus code activated!\n\nYou received 100 coins!`)
                    }, 100)

                    return true
                } else {
                    // Invalid code - use haptic feedback only
                    // Don't show alert while scanner is still open
                    webApp.HapticFeedback.notificationOccurred('error')

                    // Optionally, you could show a toast or update UI state
                    // to indicate invalid code without using popups

                    return false // Keep scanner open
                }
            }
        )
    }

    const detectQRType = (text: string): string => {
        const lowerText = text.toLowerCase()

        // URL detection
        if (lowerText.startsWith('http://') || lowerText.startsWith('https://')) {
            return 'URL'
        }

        // Email detection
        if (lowerText.startsWith('mailto:') || text.includes('@')) {
            return 'Email'
        }

        // Phone detection
        if (lowerText.startsWith('tel:') || text.match(/^\+?[\d\s\-\(\)]+$/)) {
            return 'Phone'
        }

        // WiFi detection
        if (lowerText.startsWith('wifi:')) {
            return 'WiFi'
        }

        // Telegram link detection
        if (lowerText.includes('t.me/') || lowerText.includes('telegram.me/')) {
            return 'Telegram'
        }

        // Game code detection
        if (text.match(/^BONUS-[A-Z0-9]{6}$/)) {
            return 'Game Code'
        }

        // vCard detection
        if (lowerText.startsWith('begin:vcard')) {
            return 'Contact'
        }

        // SMS detection
        if (lowerText.startsWith('sms:') || lowerText.startsWith('smsto:')) {
            return 'SMS'
        }

        // Default
        return 'Text'
    }

    const handleQRResult = (text: string, type: string) => {
        // Haptic feedback first (doesn't conflict with popups)
        webApp?.HapticFeedback.notificationOccurred('success')

        switch (type) {
            case 'URL':
                webApp?.showConfirm(
                    `Open this link?\n\n${text}`,
                    (confirmed) => {
                        if (confirmed) {
                            webApp.openLink(text)
                        }
                    }
                )
                break

            case 'Telegram':
                webApp?.showConfirm(
                    `Open in Telegram?\n\n${text}`,
                    (confirmed) => {
                        if (confirmed) {
                            webApp.openTelegramLink(text)
                        }
                    }
                )
                break

            case 'Email':
                const email = text.replace('mailto:', '')
                webApp?.showAlert(`Email address:\n${email}`)
                break

            case 'Phone':
                const phone = text.replace('tel:', '')
                webApp?.showAlert(`Phone number:\n${phone}`)
                break

            case 'WiFi':
                webApp?.showAlert('WiFi network detected!\n\n' + parseWiFiQR(text))
                break

            case 'Game Code':
                // Already handled in scanGameCode with proper delay
                break

            default:
                webApp?.showAlert(`Scanned ${type}:\n\n${text}`)
        }
    }

    const parseWiFiQR = (text: string): string => {
        // Basic WiFi QR code parser
        const parts = text.split(';')
        let result = ''

        parts.forEach(part => {
            if (part.startsWith('S:')) {
                result += `Network: ${part.substring(2)}\n`
            } else if (part.startsWith('T:')) {
                result += `Security: ${part.substring(2)}\n`
            } else if (part.startsWith('P:')) {
                result += `Password: ${part.substring(2)}\n`
            }
        })

        return result || text
    }

    const clearHistory = () => {
        setScanHistory([])
        webApp?.HapticFeedback.notificationOccurred('success')
    }

    // Check version support
    const supportsQRScanner = webApp?.isVersionAtLeast('6.9') ?? false

    return (
        <div className="space-y-6">
            <DemoSection title="ğŸ“· QR Code Scanner">
                <div className="space-y-4">
                    {/* Version check */}
                    {webApp && !supportsQRScanner && (
                        <div className="p-3 bg-yellow-500/20 border border-yellow-500/30 rounded-lg">
                            <p className="text-sm text-yellow-600 dark:text-yellow-400">
                                âš ï¸ QR Scanner requires Telegram version 6.9 or higher.
                                Your version: {webApp.version}
                            </p>
                        </div>
                    )}

                    {/* Main scanner buttons */}
                    <div className="space-y-3">
                        <button
                            onClick={scanQRCode}
                            className="btn-primary w-full"
                            disabled={!supportsQRScanner}
                        >
                            ğŸ“· Scan Any QR Code
                        </button>

                        <button
                            onClick={scanQRCodeLinksOnly}
                            className="btn-primary w-full"
                            disabled={!supportsQRScanner}
                        >
                            ğŸ”— Scan URLs Only
                        </button>

                        <button
                            onClick={scanGameCode}
                            className="btn-primary w-full"
                            disabled={!supportsQRScanner}
                        >
                            ğŸ® Scan Game Bonus Code
                        </button>
                    </div>

                    {/* Info box */}
                    <div className="p-3 bg-blue-500/10 border border-blue-500/30 rounded-lg">
                        <p className="text-sm text-blue-600 dark:text-blue-400">
                            ğŸ’¡ <strong>Tip:</strong> The QR scanner can detect different types of QR codes
                            and handle them appropriately. Try scanning URLs, phone numbers, WiFi credentials,
                            or game bonus codes!
                        </p>
                    </div>
                </div>

                <CodeBlock language="typescript">
                    {`// Basic QR scanner
webApp.showScanQrPopup({
  text: 'Scan any QR code'
}, (text) => {
  console.log('Scanned:', text)
  
  // Delay any popups to avoid conflicts
  setTimeout(() => {
    handleScannedData(text)
  }, 100)
  
  // Return true to close scanner
  return true
})

// URL-only scanner with validation
webApp.showScanQrPopup({
  text: 'Scan a URL'
}, (text) => {
  if (text.startsWith('http://') || text.startsWith('https://')) {
    // Valid URL - close scanner first
    setTimeout(() => {
      webApp.openLink(text)
    }, 100)
    return true // Close scanner
  } else {
    // Invalid, keep scanner open
    // Use haptic feedback instead of alert
    webApp.HapticFeedback.notificationOccurred('error')
    return false
  }
})

// Game code scanner with format validation
webApp.showScanQrPopup({
  text: 'Scan bonus code'
}, (text) => {
  if (text.match(/^BONUS-[A-Z0-9]{6}$/)) {
    // Valid code - close scanner first
    setTimeout(() => {
      activateBonusCode(text)
      webApp.showAlert('Code activated!')
    }, 100)
    return true
  } else {
    // Don't show alert while scanner is open!
    webApp.HapticFeedback.notificationOccurred('error')
    return false // Keep scanner open
  }
})

// Best practice: Never show popups when returning false
// Always add delays when showing popups after returning true`}
                </CodeBlock>
            </DemoSection>

            <DemoSection title="ğŸ“‹ Scan History">
                <div className="space-y-3">
                    {scanHistory.length > 0 ? (
                        <>
                            <div className="flex justify-between items-center">
                                <h4 className="font-semibold">Recent Scans</h4>
                                <button
                                    onClick={clearHistory}
                                    className="text-sm text-[var(--tg-theme-hint-color)] hover:text-[var(--tg-theme-text-color)]"
                                >
                                    Clear History
                                </button>
                            </div>

                            {scanHistory.map((scan, index) => (
                                <div
                                    key={index}
                                    className="p-3 bg-[var(--tg-theme-secondary-bg-color)] rounded"
                                >
                                    <div className="flex justify-between items-start mb-1">
                                        <span className="font-semibold text-sm">{scan.type}</span>
                                        <span className="text-xs text-[var(--tg-theme-hint-color)]">
                                            {scan.timestamp.toLocaleTimeString()}
                                        </span>
                                    </div>
                                    <div className="text-sm break-all text-[var(--tg-theme-hint-color)]">
                                        {scan.text}
                                    </div>
                                </div>
                            ))}
                        </>
                    ) : (
                        <p className="text-center text-[var(--tg-theme-hint-color)]">
                            No QR codes scanned yet
                        </p>
                    )}
                </div>
            </DemoSection>

            <DemoSection title="ğŸ¯ QR Code Types">
                <div className="grid grid-cols-2 gap-3">
                    <div className="p-3 bg-[var(--tg-theme-secondary-bg-color)] rounded">
                        <div className="font-semibold mb-1">ğŸ”— URLs</div>
                        <div className="text-sm text-[var(--tg-theme-hint-color)]">
                            Website links, deep links
                        </div>
                    </div>

                    <div className="p-3 bg-[var(--tg-theme-secondary-bg-color)] rounded">
                        <div className="font-semibold mb-1">ğŸ“± Contact Info</div>
                        <div className="text-sm text-[var(--tg-theme-hint-color)]">
                            Phone, email, vCard
                        </div>
                    </div>

                    <div className="p-3 bg-[var(--tg-theme-secondary-bg-color)] rounded">
                        <div className="font-semibold mb-1">ğŸ“¶ WiFi</div>
                        <div className="text-sm text-[var(--tg-theme-hint-color)]">
                            Network credentials
                        </div>
                    </div>

                    <div className="p-3 bg-[var(--tg-theme-secondary-bg-color)] rounded">
                        <div className="font-semibold mb-1">ğŸ® Game Codes</div>
                        <div className="text-sm text-[var(--tg-theme-hint-color)]">
                            Bonus codes, unlocks
                        </div>
                    </div>
                </div>
            </DemoSection>

            <DemoSection title="ğŸ’¡ Use Cases">
                <div className="space-y-3">
                    <div className="p-3 bg-[var(--tg-theme-secondary-bg-color)] rounded">
                        <h4 className="font-semibold">ğŸ® Gaming</h4>
                        <ul className="text-sm text-[var(--tg-theme-hint-color)] mt-1 space-y-1">
                            <li>â€¢ Unlock bonus levels or items</li>
                            <li>â€¢ Share game rooms or lobbies</li>
                            <li>â€¢ Redeem promotional codes</li>
                            <li>â€¢ Transfer items between players</li>
                        </ul>
                    </div>

                    <div className="p-3 bg-[var(--tg-theme-secondary-bg-color)] rounded">
                        <h4 className="font-semibold">ğŸ›ï¸ E-commerce</h4>
                        <ul className="text-sm text-[var(--tg-theme-hint-color)] mt-1 space-y-1">
                            <li>â€¢ Quick product lookup</li>
                            <li>â€¢ Apply discount codes</li>
                            <li>â€¢ Track shipments</li>
                            <li>â€¢ Verify authenticity</li>
                        </ul>
                    </div>

                    <div className="p-3 bg-[var(--tg-theme-secondary-bg-color)] rounded">
                        <h4 className="font-semibold">ğŸ« Events</h4>
                        <ul className="text-sm text-[var(--tg-theme-hint-color)] mt-1 space-y-1">
                            <li>â€¢ Check-in attendees</li>
                            <li>â€¢ Validate tickets</li>
                            <li>â€¢ Share contact info</li>
                            <li>â€¢ Access event WiFi</li>
                        </ul>
                    </div>
                </div>
            </DemoSection>

            <DemoSection title="ğŸ² Sample QR Codes">
                <div className="space-y-3">
                    <p className="text-sm text-[var(--tg-theme-hint-color)]">
                        Try scanning these sample codes to test the scanner:
                    </p>

                    <div className="grid grid-cols-2 gap-3">
                        <div className="p-3 bg-[var(--tg-theme-secondary-bg-color)] rounded">
                            <div className="bg-white p-2 rounded mb-2">
                                <QRCode
                                    value="BONUS-ABC123"
                                    size={100}
                                    style={{ height: "auto", maxWidth: "100%", width: "100%" }}
                                />
                            </div>
                            <div className="text-xs font-mono text-center">BONUS-ABC123</div>
                            <div className="text-xs text-[var(--tg-theme-hint-color)] text-center">Game Code</div>
                        </div>

                        <div className="p-3 bg-[var(--tg-theme-secondary-bg-color)] rounded">
                            <div className="bg-white p-2 rounded mb-2">
                                <QRCode
                                    value="https://nikandr.com"
                                    size={100}
                                    style={{ height: "auto", maxWidth: "100%", width: "100%" }}
                                />
                            </div>
                            <div className="text-xs font-mono text-center">nikandr.com</div>
                            <div className="text-xs text-[var(--tg-theme-hint-color)] text-center">URL</div>
                        </div>

                        <div className="p-3 bg-[var(--tg-theme-secondary-bg-color)] rounded">
                            <div className="bg-white p-2 rounded mb-2">
                                <QRCode
                                    value="tel:+1234567890"
                                    size={100}
                                    style={{ height: "auto", maxWidth: "100%", width: "100%" }}
                                />
                            </div>
                            <div className="text-xs font-mono text-center">+1234567890</div>
                            <div className="text-xs text-[var(--tg-theme-hint-color)] text-center">Phone</div>
                        </div>

                        <div className="p-3 bg-[var(--tg-theme-secondary-bg-color)] rounded">
                            <div className="bg-white p-2 rounded mb-2">
                                <QRCode
                                    value="mailto:test@example.com"
                                    size={100}
                                    style={{ height: "auto", maxWidth: "100%", width: "100%" }}
                                />
                            </div>
                            <div className="text-xs font-mono text-center">test@example.com</div>
                            <div className="text-xs text-[var(--tg-theme-hint-color)] text-center">Email</div>
                        </div>
                    </div>

                    {/* Add more complex examples */}
                    <div className="grid grid-cols-2 gap-3 mt-3">
                        <div className="p-3 bg-[var(--tg-theme-secondary-bg-color)] rounded">
                            <div className="bg-white p-2 rounded mb-2">
                                <QRCode
                                    value="WIFI:T:WPA;S:MyNetwork;P:MyPassword;;"
                                    size={100}
                                    style={{ height: "auto", maxWidth: "100%", width: "100%" }}
                                />
                            </div>
                            <div className="text-xs font-mono text-center">WiFi Network</div>
                            <div className="text-xs text-[var(--tg-theme-hint-color)] text-center">Connect to WiFi</div>
                        </div>

                        <div className="p-3 bg-[var(--tg-theme-secondary-bg-color)] rounded">
                            <div className="bg-white p-2 rounded mb-2">
                                <QRCode
                                    value="https://t.me/NikandrApps"
                                    size={100}
                                    style={{ height: "auto", maxWidth: "100%", width: "100%" }}
                                />
                            </div>
                            <div className="text-xs font-mono text-center">@NikandrApps</div>
                            <div className="text-xs text-[var(--tg-theme-hint-color)] text-center">Telegram Link</div>
                        </div>
                    </div>
                </div>
            </DemoSection>
        </div>
    )
}
```

## /components/demos/SensorsDemo.tsx

```tsx
// components/demos/SensorsDemo.tsx

/**
 * Telegram Dev Kit - Copyright (c) 2025 Nikandr Surkov
 * 
 * Proprietary License - This code may ONLY be used if purchased from https://nikandr.com
 * Redistribution, reselling, or public publishing is strictly prohibited.
 * 
 * Full license and contact: https://nikandr.com
 */

'use client'

import { useState, useEffect } from 'react'
import { useTelegram } from '@/providers/TelegramProvider'
import DemoSection from '@/components/DemoSection'
import CodeBlock from '@/components/CodeBlock'
import type { LocationData } from '@/types/telegram'

export default function SensorsDemo() {
    const { webApp } = useTelegram()
    const [accelerometer, setAccelerometer] = useState({ x: 0, y: 0, z: 0 })
    const [gyroscope, setGyroscope] = useState({ x: 0, y: 0, z: 0 })
    const [orientation, setOrientation] = useState({ alpha: 0, beta: 0, gamma: 0 })
    const [locationData, setLocationData] = useState<LocationData | null>(null)

    // Track sensor states
    const [isAccelerometerStarted, setIsAccelerometerStarted] = useState(false)
    const [isGyroscopeStarted, setIsGyroscopeStarted] = useState(false)
    const [isOrientationStarted, setIsOrientationStarted] = useState(false)

    useEffect(() => {
        if (!webApp) return

        // Initialize states
        setIsAccelerometerStarted(webApp.Accelerometer?.isStarted || false)
        setIsGyroscopeStarted(webApp.Gyroscope?.isStarted || false)
        setIsOrientationStarted(webApp.DeviceOrientation?.isStarted || false)

        // Initialize location manager
        webApp.LocationManager?.init()

        // Accelerometer
        const handleAccelerometerChange = () => {
            setAccelerometer({
                x: webApp.Accelerometer.x,
                y: webApp.Accelerometer.y,
                z: webApp.Accelerometer.z
            })
        }

        // Gyroscope
        const handleGyroscopeChange = () => {
            setGyroscope({
                x: webApp.Gyroscope.x,
                y: webApp.Gyroscope.y,
                z: webApp.Gyroscope.z
            })
        }

        // Device Orientation
        const handleOrientationChange = () => {
            setOrientation({
                alpha: webApp.DeviceOrientation.alpha,
                beta: webApp.DeviceOrientation.beta,
                gamma: webApp.DeviceOrientation.gamma
            })
        }

        webApp.onEvent('accelerometerChanged', handleAccelerometerChange)
        webApp.onEvent('gyroscopeChanged', handleGyroscopeChange)
        webApp.onEvent('deviceOrientationChanged', handleOrientationChange)

        // Cleanup
        return () => {
            webApp.offEvent('accelerometerChanged', handleAccelerometerChange)
            webApp.offEvent('gyroscopeChanged', handleGyroscopeChange)
            webApp.offEvent('deviceOrientationChanged', handleOrientationChange)
        }
    }, [webApp])

    const toggleAccelerometer = () => {
        if (webApp?.Accelerometer.isStarted) {
            webApp.Accelerometer.stop()
            setIsAccelerometerStarted(false)
            // Reset values when stopped
            setAccelerometer({ x: 0, y: 0, z: 0 })
        } else {
            webApp?.Accelerometer.start({ refresh_rate: 60 })
            setIsAccelerometerStarted(true)
        }
    }

    const toggleGyroscope = () => {
        if (webApp?.Gyroscope.isStarted) {
            webApp.Gyroscope.stop()
            setIsGyroscopeStarted(false)
            // Reset values when stopped
            setGyroscope({ x: 0, y: 0, z: 0 })
        } else {
            webApp?.Gyroscope.start({ refresh_rate: 60 })
            setIsGyroscopeStarted(true)
        }
    }

    const toggleOrientation = () => {
        if (webApp?.DeviceOrientation.isStarted) {
            webApp.DeviceOrientation.stop()
            setIsOrientationStarted(false)
            // Reset values when stopped
            setOrientation({ alpha: 0, beta: 0, gamma: 0 })
        } else {
            webApp?.DeviceOrientation.start({ refresh_rate: 60 })
            setIsOrientationStarted(true)
        }
    }

    const getLocation = () => {
        webApp?.LocationManager.getLocation((location: LocationData | null) => {
            if (location) {
                setLocationData(location)
                webApp.HapticFeedback.notificationOccurred('success')
            } else {
                webApp.showAlert('Location access denied')
            }
        })
    }

    return (
        <div className="space-y-6">
            <div className="p-3 bg-blue-500/10 border border-blue-500/30 rounded-lg">
                <p className="text-sm text-blue-600 dark:text-blue-400">
                    ğŸ’¡ <strong>Note:</strong> Sensors require Telegram v8.0+ and device permission.
                    Move your device to see values change.
                </p>
            </div>

            <DemoSection title="ğŸ“Š Accelerometer">
                <div className="space-y-4">
                    <button onClick={toggleAccelerometer} className="btn-primary w-full">
                        {isAccelerometerStarted ? 'â¹ï¸ Stop' : 'â–¶ï¸ Start'} Accelerometer
                    </button>

                    <div className="p-4 bg-[var(--tg-theme-secondary-bg-color)] rounded-lg font-mono text-sm">
                        <div className={!isAccelerometerStarted ? 'opacity-50' : ''}>
                            <div>X: {accelerometer.x.toFixed(3)}</div>
                            <div>Y: {accelerometer.y.toFixed(3)}</div>
                            <div>Z: {accelerometer.z.toFixed(3)}</div>
                        </div>
                        {!isAccelerometerStarted && (
                            <p className="text-xs text-[var(--tg-theme-hint-color)] mt-2">
                                Press Start to begin reading sensor data
                            </p>
                        )}
                    </div>
                </div>

                <CodeBlock language="typescript">
                    {`// Accelerometer for motion controls
webApp.Accelerometer.start({ refresh_rate: 60 })

webApp.onEvent('accelerometerChanged', () => {
  const { x, y, z } = webApp.Accelerometer
  
  // Use for tilt controls
  player.velocity.x = x * sensitivity
  player.velocity.y = y * sensitivity
})`}
                </CodeBlock>
            </DemoSection>

            <DemoSection title="ğŸŒ€ Gyroscope">
                <div className="space-y-4">
                    <button onClick={toggleGyroscope} className="btn-primary w-full">
                        {isGyroscopeStarted ? 'â¹ï¸ Stop' : 'â–¶ï¸ Start'} Gyroscope
                    </button>

                    <div className="p-4 bg-[var(--tg-theme-secondary-bg-color)] rounded-lg font-mono text-sm">
                        <div className={!isGyroscopeStarted ? 'opacity-50' : ''}>
                            <div>X: {gyroscope.x.toFixed(3)}</div>
                            <div>Y: {gyroscope.y.toFixed(3)}</div>
                            <div>Z: {gyroscope.z.toFixed(3)}</div>
                        </div>
                        {!isGyroscopeStarted && (
                            <p className="text-xs text-[var(--tg-theme-hint-color)] mt-2">
                                Press Start to begin reading sensor data
                            </p>
                        )}
                    </div>
                </div>

                <CodeBlock language="typescript">
                    {`// Gyroscope for rotation
webApp.Gyroscope.start({ refresh_rate: 60 })

webApp.onEvent('gyroscopeChanged', () => {
  const { x, y, z } = webApp.Gyroscope
  
  // Use for 3D rotation
  camera.rotation.x += x * deltaTime
  camera.rotation.y += y * deltaTime
})`}
                </CodeBlock>
            </DemoSection>

            <DemoSection title="ğŸ“ Device Orientation">
                <div className="space-y-4">
                    <button onClick={toggleOrientation} className="btn-primary w-full">
                        {isOrientationStarted ? 'â¹ï¸ Stop' : 'â–¶ï¸ Start'} Orientation
                    </button>

                    <div className="p-4 bg-[var(--tg-theme-secondary-bg-color)] rounded-lg font-mono text-sm">
                        <div className={!isOrientationStarted ? 'opacity-50' : ''}>
                            <div>Alpha: {orientation.alpha.toFixed(1)}Â°</div>
                            <div>Beta: {orientation.beta.toFixed(1)}Â°</div>
                            <div>Gamma: {orientation.gamma.toFixed(1)}Â°</div>
                        </div>
                        {!isOrientationStarted && (
                            <p className="text-xs text-[var(--tg-theme-hint-color)] mt-2">
                                Press Start to begin reading sensor data
                            </p>
                        )}
                    </div>
                </div>

                <CodeBlock language="typescript">
                    {`// Device orientation for AR/VR
webApp.DeviceOrientation.start({ 
  refresh_rate: 60,
  need_absolute: true 
})

webApp.onEvent('deviceOrientationChanged', () => {
  const { alpha, beta, gamma } = webApp.DeviceOrientation
  
  // Use for AR camera view
  arCamera.setRotation(alpha, beta, gamma)
})`}
                </CodeBlock>
            </DemoSection>

            <DemoSection title="ğŸ“ Location">
                <div className="space-y-4">
                    <button onClick={getLocation} className="btn-primary w-full">
                        Get Current Location
                    </button>

                    {locationData && (
                        <div className="p-3 bg-[var(--tg-theme-secondary-bg-color)] rounded text-sm">
                            <div className="grid grid-cols-2 gap-2">
                                <div>
                                    <span className="text-[var(--tg-theme-hint-color)]">Latitude:</span>
                                    <div className="font-mono">{locationData.latitude.toFixed(6)}Â°</div>
                                </div>
                                <div>
                                    <span className="text-[var(--tg-theme-hint-color)]">Longitude:</span>
                                    <div className="font-mono">{locationData.longitude.toFixed(6)}Â°</div>
                                </div>
                                {locationData.altitude !== undefined && (
                                    <div>
                                        <span className="text-[var(--tg-theme-hint-color)]">Altitude:</span>
                                        <div className="font-mono">{locationData.altitude.toFixed(2)}m</div>
                                    </div>
                                )}
                                {locationData.speed !== undefined && (
                                    <div>
                                        <span className="text-[var(--tg-theme-hint-color)]">Speed:</span>
                                        <div className="font-mono">{locationData.speed.toFixed(2)}m/s</div>
                                    </div>
                                )}
                                {locationData.horizontal_accuracy !== undefined && (
                                    <div>
                                        <span className="text-[var(--tg-theme-hint-color)]">Accuracy:</span>
                                        <div className="font-mono">Â±{locationData.horizontal_accuracy.toFixed(0)}m</div>
                                    </div>
                                )}
                            </div>
                        </div>
                    )}

                    <div className="p-3 bg-[var(--tg-theme-secondary-bg-color)] rounded">
                        <p className="text-sm text-[var(--tg-theme-hint-color)]">
                            Location data can be used for:
                        </p>
                        <ul className="text-sm mt-2 space-y-1">
                            <li>â€¢ Location-based games (AR, geocaching)</li>
                            <li>â€¢ Finding nearby players or items</li>
                            <li>â€¢ Weather-based game mechanics</li>
                            <li>â€¢ Distance tracking and achievements</li>
                        </ul>
                    </div>
                </div>

                <CodeBlock language="typescript">
                    {`// Initialize location manager
webApp.LocationManager.init()

// Get one-time location
webApp.LocationManager.getLocation((location) => {
  if (location) {
    console.log('User location:', {
      lat: location.latitude,
      lng: location.longitude,
      accuracy: location.horizontal_accuracy
    })
    
    // Use for location-based features
    findNearbyPlayers(location)
    loadLocalWeather(location)
  } else {
    console.log('Location access denied')
  }
})

// Check permission status
if (webApp.LocationManager.isLocationAvailable) {
  // Location services are available
  if (webApp.LocationManager.isAccessGranted) {
    // Permission already granted
    getLocation()
  }
}`}
                </CodeBlock>
            </DemoSection>
        </div>
    )
}
```

## /components/demos/ShareStoryDemo.tsx

```tsx
// components/demos/ShareStoryDemo.tsx

/**
 * Telegram Dev Kit - Copyright (c) 2025 Nikandr Surkov
 * 
 * Proprietary License - This code may ONLY be used if purchased from https://nikandr.com
 * Redistribution, reselling, or public publishing is strictly prohibited.
 * 
 * Full license and contact: https://nikandr.com
 */

'use client'

import { useState } from 'react'
import { useTelegram } from '@/providers/TelegramProvider'
import DemoSection from '@/components/DemoSection'
import CodeBlock from '@/components/CodeBlock'

export default function ShareStoryDemo() {
    const { webApp } = useTelegram()
    const [customUrl, setCustomUrl] = useState('https://telegra.ph/file/5583ac37c90979f052b7b.png')
    const [storyText, setStoryText] = useState('Check out my achievement! ğŸ®')
    const [widgetUrl, setWidgetUrl] = useState('https://t.me/nikandrsurkov_bot')
    const [widgetName, setWidgetName] = useState('Play Game')

    const sharePresets = [
        {
            title: 'Game Score',
            image: 'https://telegra.ph/file/5583ac37c90979f052b7b.png',
            text: 'ğŸ® I just scored 10,000 points!',
            widget: { url: 'https://t.me/nikandrsurkov_bot', name: 'Beat my score!' }
        },
        {
            title: 'Achievement',
            image: 'https://telegra.ph/file/5583ac37c90979f052b7b.png',
            text: 'ğŸ† Level 100 Completed!',
            widget: { url: 'https://t.me/nikandrsurkov_bot', name: 'Play Now' }
        },
        {
            title: 'Video Moment',
            video: 'https://telegra.ph/file/61f1dac694c3131a7b4ac.mp4',
            text: 'ğŸ¬ Epic gameplay moment!',
            widget: { url: 'https://t.me/nikandrsurkov_bot', name: 'Watch More' }
        }
    ]

    const shareBasicImage = () => {
        webApp?.shareToStory('https://telegra.ph/file/5583ac37c90979f052b7b.png')
    }

    const shareImageWithText = () => {
        webApp?.shareToStory(
            'https://telegra.ph/file/5583ac37c90979f052b7b.png',
            { text: storyText }
        )
    }

    const shareWithWidget = () => {
        webApp?.shareToStory(
            customUrl,
            {
                text: storyText,
                widget_link: {
                    url: widgetUrl,
                    name: widgetName
                }
            }
        )
    }

    const shareVideo = () => {
        webApp?.shareToStory(
            'https://telegra.ph/file/61f1dac694c3131a7b4ac.mp4',
            {
                text: 'ğŸ¥ Amazing gameplay footage!',
                widget_link: {
                    url: 'https://t.me/nikandrsurkov_bot',
                    name: 'Watch Full Video'
                }
            }
        )
    }

    return (
        <div className="space-y-6">
            <DemoSection title="ğŸ“¸ Share to Story">
                <div className="space-y-4">
                    <div className="p-4 bg-[var(--tg-theme-secondary-bg-color)] rounded-lg">
                        <h4 className="font-semibold mb-3">Quick Share Options</h4>

                        <div className="space-y-2">
                            <button onClick={shareBasicImage} className="btn-primary w-full">
                                Share Basic Image
                            </button>

                            <button onClick={shareImageWithText} className="btn-primary w-full">
                                Share Image with Caption
                            </button>

                            <button onClick={shareVideo} className="btn-primary w-full">
                                Share Video Story
                            </button>
                        </div>
                    </div>

                    <div className="p-4 bg-[var(--tg-theme-secondary-bg-color)] rounded-lg">
                        <h4 className="font-semibold mb-3">Custom Story Builder</h4>

                        <div className="space-y-3">
                            <div>
                                <label className="text-sm text-[var(--tg-theme-hint-color)]">Media URL</label>
                                <input
                                    type="text"
                                    value={customUrl}
                                    onChange={(e) => setCustomUrl(e.target.value)}
                                    className="w-full p-2 mt-1 rounded bg-[var(--tg-theme-bg-color)] text-[var(--tg-theme-text-color)]"
                                    placeholder="Image or video URL"
                                />
                            </div>

                            <div>
                                <label className="text-sm text-[var(--tg-theme-hint-color)]">Caption Text</label>
                                <input
                                    type="text"
                                    value={storyText}
                                    onChange={(e) => setStoryText(e.target.value)}
                                    className="w-full p-2 mt-1 rounded bg-[var(--tg-theme-bg-color)] text-[var(--tg-theme-text-color)]"
                                    placeholder="Story caption"
                                />
                            </div>

                            <div>
                                <label className="text-sm text-[var(--tg-theme-hint-color)]">Widget Link URL</label>
                                <input
                                    type="text"
                                    value={widgetUrl}
                                    onChange={(e) => setWidgetUrl(e.target.value)}
                                    className="w-full p-2 mt-1 rounded bg-[var(--tg-theme-bg-color)] text-[var(--tg-theme-text-color)]"
                                    placeholder="Link URL"
                                />
                            </div>

                            <div>
                                <label className="text-sm text-[var(--tg-theme-hint-color)]">Widget Button Text</label>
                                <input
                                    type="text"
                                    value={widgetName}
                                    onChange={(e) => setWidgetName(e.target.value)}
                                    className="w-full p-2 mt-1 rounded bg-[var(--tg-theme-bg-color)] text-[var(--tg-theme-text-color)]"
                                    placeholder="Button text"
                                />
                            </div>

                            <button onClick={shareWithWidget} className="btn-primary w-full">
                                Share Custom Story
                            </button>
                        </div>
                    </div>
                </div>

                <CodeBlock language="typescript">
                    {`// Basic image share
webApp.shareToStory('https://example.com/image.png')

// With caption
webApp.shareToStory(imageUrl, {
  text: 'Check out my score! ğŸ®'
})

// With interactive widget
webApp.shareToStory(mediaUrl, {
  text: 'Level completed! ğŸ†',
  widget_link: {
    url: 'https://t.me/yourgamebot',
    name: 'Play Now'
  }
})

// Video story
webApp.shareToStory('https://example.com/video.mp4', {
  text: 'Epic moment! ğŸ¥',
  widget_link: {
    url: 'https://t.me/yourgamebot/replay',
    name: 'Watch Replay'
  }
})`}
                </CodeBlock>
            </DemoSection>

            <DemoSection title="ğŸ® Game Integration Examples">
                <div className="space-y-3">
                    {sharePresets.map((preset, index) => (
                        <div
                            key={index}
                            className="p-3 bg-[var(--tg-theme-secondary-bg-color)] rounded flex justify-between items-center"
                        >
                            <div>
                                <div className="font-semibold">{preset.title}</div>
                                <div className="text-sm text-[var(--tg-theme-hint-color)]">{preset.text}</div>
                            </div>
                            <button
                                onClick={() => {
                                    const mediaUrl = preset.image || preset.video || ''
                                    webApp?.shareToStory(mediaUrl, {
                                        text: preset.text,
                                        widget_link: preset.widget
                                    })
                                }}
                                className="btn-primary px-4 py-2"
                            >
                                Share
                            </button>
                        </div>
                    ))}
                </div>
            </DemoSection>

            <DemoSection title="ğŸ’¡ Best Practices">
                <div className="space-y-3">
                    <div className="p-3 bg-[var(--tg-theme-secondary-bg-color)] rounded">
                        <h4 className="font-semibold">ğŸ“ Media Requirements</h4>
                        <ul className="text-sm text-[var(--tg-theme-hint-color)] mt-1 space-y-1">
                            <li>â€¢ Images: 1080x1920px (9:16 ratio)</li>
                            <li>â€¢ Videos: Max 30 seconds, MP4 format</li>
                            <li>â€¢ File size: Under 50MB</li>
                        </ul>
                    </div>

                    <div className="p-3 bg-[var(--tg-theme-secondary-bg-color)] rounded">
                        <h4 className="font-semibold">âœ¨ Engagement Tips</h4>
                        <ul className="text-sm text-[var(--tg-theme-hint-color)] mt-1 space-y-1">
                            <li>â€¢ Use eye-catching visuals</li>
                            <li>â€¢ Add compelling call-to-action</li>
                            <li>â€¢ Include game achievements or scores</li>
                            <li>â€¢ Make widget links contextual</li>
                        </ul>
                    </div>
                </div>
            </DemoSection>
        </div>
    )
}
```

## /components/demos/StorageDemo.tsx

```tsx
// components/demos/StorageDemo.tsx

/**
 * Telegram Dev Kit - Copyright (c) 2025 Nikandr Surkov
 * 
 * Proprietary License - This code may ONLY be used if purchased from https://nikandr.com
 * Redistribution, reselling, or public publishing is strictly prohibited.
 * 
 * Full license and contact: https://nikandr.com
 */

'use client'

import { useState, useEffect } from 'react'
import { useTelegram } from '@/providers/TelegramProvider'
import DemoSection from '@/components/DemoSection'
import CodeBlock from '@/components/CodeBlock'

interface GameData {
    level: number
    score: number
    achievements: string[]
}

export default function StorageDemo() {
    const { webApp } = useTelegram()
    const [gameData, setGameData] = useState<GameData>({
        level: 1,
        score: 0,
        achievements: []
    })
    const [savedKeys, setSavedKeys] = useState<string[]>([])
    const [loading, setLoading] = useState(false)

    const loadGameData = async () => {
        setLoading(true)
        webApp?.CloudStorage.getItem('gameData', (err, value) => {
            if (!err && value) {
                setGameData(JSON.parse(value))
            }
            setLoading(false)
        })
    }

    const saveGameData = async () => {
        const data = JSON.stringify(gameData)
        webApp?.CloudStorage.setItem('gameData', data, (err, stored) => {
            if (stored) {
                webApp.showAlert('Game saved!')
                webApp.HapticFeedback.notificationOccurred('success')
            }
        })
    }

    const loadAllKeys = () => {
        webApp?.CloudStorage.getKeys((err, keys) => {
            if (!err && keys) {
                setSavedKeys(keys)
            }
        })
    }

    useEffect(() => {
        if (webApp) {
            loadGameData()
            loadAllKeys()
        }
    }, [webApp])

    return (
        <div className="space-y-6">
            <DemoSection title="ğŸ’¾ Cloud Storage">
                <div className="space-y-4">
                    <div className="p-4 bg-[var(--tg-theme-secondary-bg-color)] rounded-lg">
                        <h4 className="font-semibold mb-2">Game Data</h4>
                        <div className="space-y-1 text-sm">
                            <div>Level: {gameData.level}</div>
                            <div>Score: {gameData.score}</div>
                            <div>Achievements: {gameData.achievements.join(', ') || 'None'}</div>
                        </div>
                    </div>

                    <div className="grid grid-cols-2 gap-2">
                        <button
                            onClick={() => setGameData(d => ({ ...d, level: d.level + 1 }))}
                            className="btn-primary"
                        >
                            Level Up
                        </button>

                        <button
                            onClick={() => setGameData(d => ({ ...d, score: d.score + 100 }))}
                            className="btn-primary"
                        >
                            Add Score
                        </button>
                    </div>

                    <button onClick={saveGameData} className="btn-primary w-full">
                        Save Game
                    </button>

                    <button onClick={loadGameData} className="btn-primary w-full" disabled={loading}>
                        {loading ? 'Loading...' : 'Load Game'}
                    </button>
                </div>

                <CodeBlock language="typescript">
                    {`// Save game data
const gameData = {
  level: 5,
  score: 1000,
  achievements: ['first_win', 'speed_run']
}

webApp.CloudStorage.setItem(
  'gameData', 
  JSON.stringify(gameData),
  (err, stored) => {
    if (stored) {
      console.log('Game saved!')
    }
  }
)

// Load game data
webApp.CloudStorage.getItem('gameData', (err, value) => {
  if (!err && value) {
    const gameData = JSON.parse(value)
    restoreGameState(gameData)
  }
})

// Get all saved keys
webApp.CloudStorage.getKeys((err, keys) => {
  console.log('Saved keys:', keys)
})`}
                </CodeBlock>
            </DemoSection>

            <DemoSection title="ğŸ”‘ Saved Keys">
                <div className="space-y-2">
                    {savedKeys.length > 0 ? (
                        savedKeys.map(key => (
                            <div key={key} className="p-2 bg-[var(--tg-theme-secondary-bg-color)] rounded">
                                {key}
                            </div>
                        ))
                    ) : (
                        <p className="text-[var(--tg-theme-hint-color)]">No saved data</p>
                    )}
                </div>
            </DemoSection>
        </div>
    )
}
```

## /hooks/useCloudStorage.ts

```ts
// hooks/useCloudStorage.ts

/**
 * Telegram Dev Kit - Copyright (c) 2025 Nikandr Surkov
 * 
 * Proprietary License - This code may ONLY be used if purchased from https://nikandr.com
 * Redistribution, reselling, or public publishing is strictly prohibited.
 * 
 * Full license and contact: https://nikandr.com
 */

import { useState, useCallback } from 'react'
import { useTelegram } from '@/providers/TelegramProvider'

export function useCloudStorage() {
    const { webApp } = useTelegram()
    const [loading, setLoading] = useState(false)
    const [error, setError] = useState<string | null>(null)

    const setItem = useCallback(async (key: string, value: string): Promise<boolean> => {
        setLoading(true)
        setError(null)

        return new Promise((resolve) => {
            webApp?.CloudStorage.setItem(key, value, (err, stored) => {
                setLoading(false)
                if (err) {
                    setError(err.message)
                    resolve(false)
                } else {
                    resolve(stored || false)
                }
            })
        })
    }, [webApp])

    const getItem = useCallback(async (key: string): Promise<string | null> => {
        setLoading(true)
        setError(null)

        return new Promise((resolve) => {
            webApp?.CloudStorage.getItem(key, (err, value) => {
                setLoading(false)
                if (err) {
                    setError(err.message)
                    resolve(null)
                } else {
                    resolve(value || null)
                }
            })
        })
    }, [webApp])

    const removeItem = useCallback(async (key: string): Promise<boolean> => {
        setLoading(true)
        setError(null)

        return new Promise((resolve) => {
            webApp?.CloudStorage.removeItem(key, (err, removed) => {
                setLoading(false)
                if (err) {
                    setError(err.message)
                    resolve(false)
                } else {
                    resolve(removed || false)
                }
            })
        })
    }, [webApp])

    const getKeys = useCallback(async (): Promise<string[]> => {
        setLoading(true)
        setError(null)

        return new Promise((resolve) => {
            webApp?.CloudStorage.getKeys((err, keys) => {
                setLoading(false)
                if (err) {
                    setError(err.message)
                    resolve([])
                } else {
                    resolve(keys || [])
                }
            })
        })
    }, [webApp])

    return {
        setItem,
        getItem,
        removeItem,
        getKeys,
        loading,
        error
    }
}
```

## /hooks/useHaptic.ts

```ts
// hooks/useHaptic.ts

/**
 * Telegram Dev Kit - Copyright (c) 2025 Nikandr Surkov
 * 
 * Proprietary License - This code may ONLY be used if purchased from https://nikandr.com
 * Redistribution, reselling, or public publishing is strictly prohibited.
 * 
 * Full license and contact: https://nikandr.com
 */

import { useTelegram } from '@/providers/TelegramProvider'

export function useHaptic() {
    const { webApp } = useTelegram()

    const impact = (style: 'light' | 'medium' | 'heavy' | 'rigid' | 'soft' = 'light') => {
        webApp?.HapticFeedback.impactOccurred(style)
    }

    const notification = (type: 'error' | 'success' | 'warning') => {
        webApp?.HapticFeedback.notificationOccurred(type)
    }

    const selection = () => {
        webApp?.HapticFeedback.selectionChanged()
    }

    return { impact, notification, selection }
}
```

## /next-env.d.ts

```ts
/// <reference types="next" />
/// <reference types="next/image-types/global" />

// NOTE: This file should not be edited
// see https://nextjs.org/docs/app/api-reference/config/typescript for more information.

```

## /next.config.ts

```ts
import type { NextConfig } from "next";

const nextConfig: NextConfig = {
  /* config options here */
};

export default nextConfig;

```

## /package.json

```json
{
  "name": "telekit",
  "version": "0.1.0",
  "private": true,
  "scripts": {
    "dev": "next dev",
    "build": "next build",
    "start": "next start",
    "lint": "next lint"
  },
  "dependencies": {
    "@telegram-apps/init-data-node": "^2.0.10",
    "@types/react-syntax-highlighter": "^15.5.13",
    "@vercel/analytics": "^1.5.0",
    "clsx": "^2.1.1",
    "framer-motion": "^12.19.2",
    "lucide-react": "^0.525.0",
    "lz-string": "^1.5.0",
    "next": "15.3.4",
    "prettier": "^3.6.2",
    "prettier-plugin-tailwindcss": "^0.6.13",
    "prism-react-renderer": "^2.4.1",
    "react": "^19.0.0",
    "react-dom": "^19.0.0",
    "react-qr-code": "^2.0.16",
    "react-syntax-highlighter": "^15.6.1",
    "react-use": "^17.6.0",
    "shiki": "^3.7.0",
    "sonner": "^2.0.5",
    "zustand": "^5.0.6"
  },
  "devDependencies": {
    "@tailwindcss/postcss": "^4",
    "@types/node": "^20",
    "@types/react": "^19",
    "@types/react-dom": "^19",
    "tailwindcss": "^4",
    "typescript": "^5"
  }
}

```

## /providers/TelegramProvider.tsx

```tsx
// providers/TelegramProvider.tsx

/**
 * Telegram Dev Kit - Copyright (c) 2025 Nikandr Surkov
 * 
 * Proprietary License - This code may ONLY be used if purchased from https://nikandr.com
 * Redistribution, reselling, or public publishing is strictly prohibited.
 * 
 * Full license and contact: https://nikandr.com
 */

'use client'

import { createContext, useContext, useEffect, useState, ReactNode } from 'react'
import { useTelegramStore } from '@/store/telegram'
import { TelegramWebApp, WebAppUser } from '@/types/telegram'

interface TelegramContextType {
    webApp: TelegramWebApp | null
    user: WebAppUser | null
    isReady: boolean
}

const TelegramContext = createContext<TelegramContextType>({
    webApp: null,
    user: null,
    isReady: false,
})

export function TelegramProvider({ children }: { children: ReactNode }) {
    const [isReady, setIsReady] = useState(false)
    const [webApp, setWebAppState] = useState<TelegramWebApp | null>(null)
    const [user, setUserState] = useState<WebAppUser | null>(null)
    const { setWebApp, setUser, setTheme } = useTelegramStore()

    useEffect(() => {
        // Only access window in useEffect to ensure it runs on client side
        if (typeof window !== 'undefined' && window.Telegram?.WebApp) {
            const tgWebApp = window.Telegram.WebApp

            // Initialize WebApp
            tgWebApp.ready()
            tgWebApp.expand()

            // Set theme class
            document.documentElement.className = tgWebApp.colorScheme

            // Store in local state
            setWebAppState(tgWebApp)
            setUserState(tgWebApp.initDataUnsafe.user || null)

            // Store in Zustand
            setWebApp(tgWebApp)
            setUser(tgWebApp.initDataUnsafe.user || null)
            setTheme(tgWebApp.themeParams)

            // Listen to theme changes
            tgWebApp.onEvent('themeChanged', () => {
                document.documentElement.className = tgWebApp.colorScheme
                setTheme(tgWebApp.themeParams)
            })

            setIsReady(true)
        }
    }, [setWebApp, setUser, setTheme])

    const value = {
        webApp,
        user,
        isReady,
    }

    return (
        <TelegramContext.Provider value={value}>
            {children}
        </TelegramContext.Provider>
    )
}

export const useTelegram = () => {
    const context = useContext(TelegramContext)
    if (!context) {
        throw new Error('useTelegram must be used within TelegramProvider')
    }
    return context
}
```

## /store/telegram.ts

```ts
// store/telegram.ts

/**
 * Telegram Dev Kit - Copyright (c) 2025 Nikandr Surkov
 * 
 * Proprietary License - This code may ONLY be used if purchased from https://nikandr.com
 * Redistribution, reselling, or public publishing is strictly prohibited.
 * 
 * Full license and contact: https://nikandr.com
 */

import { TelegramWebApp, ThemeParams, WebAppUser } from '@/types/telegram'
import { create } from 'zustand'

interface TelegramStore {
    webApp: TelegramWebApp | null
    user: WebAppUser | null
    theme: ThemeParams | null
    setWebApp: (webApp: TelegramWebApp) => void
    setUser: (user: WebAppUser | null) => void
    setTheme: (theme: ThemeParams) => void
}

export const useTelegramStore = create<TelegramStore>((set) => ({
    webApp: null,
    user: null,
    theme: null,
    setWebApp: (webApp) => set({ webApp }),
    setUser: (user) => set({ user }),
    setTheme: (theme) => set({ theme }),
}))
```

## /tsconfig.json

```json
{
  "compilerOptions": {
    "target": "ES2017",
    "lib": ["dom", "dom.iterable", "esnext"],
    "allowJs": true,
    "skipLibCheck": true,
    "strict": true,
    "noEmit": true,
    "esModuleInterop": true,
    "module": "esnext",
    "moduleResolution": "bundler",
    "resolveJsonModule": true,
    "isolatedModules": true,
    "jsx": "preserve",
    "incremental": true,
    "plugins": [
      {
        "name": "next"
      }
    ],
    "paths": {
      "@/*": ["./*"]
    }
  },
  "include": ["next-env.d.ts", "**/*.ts", "**/*.tsx", ".next/types/**/*.ts"],
  "exclude": ["node_modules"]
}

```

## /types/telegram.d.ts

```ts
// types/telegram.d.ts

/**
 * Telegram Dev Kit - Copyright (c) 2025 Nikandr Surkov
 * 
 * Proprietary License - This code may ONLY be used if purchased from https://nikandr.com
 * Redistribution, reselling, or public publishing is strictly prohibited.
 * 
 * Full license and contact: https://nikandr.com
 */

export interface TelegramWebApp {
    initData: string;
    initDataUnsafe: WebAppInitData;
    version: string;
    platform: string;
    colorScheme: 'light' | 'dark';
    themeParams: ThemeParams;
    isExpanded: boolean;
    viewportHeight: number;
    viewportStableHeight: number;
    headerColor: string;
    backgroundColor: string;
    bottomBarColor: string;
    isClosingConfirmationEnabled: boolean;
    isVerticalSwipesEnabled: boolean;
    isActive: boolean;
    isFullscreen: boolean;
    isOrientationLocked: boolean;

    MainButton: MainButton;
    SecondaryButton: SecondaryButton;
    BackButton: BackButton;
    SettingsButton: SettingsButton;
    HapticFeedback: HapticFeedback;
    CloudStorage: CloudStorage;
    BiometricManager: BiometricManager;
    Accelerometer: Accelerometer;
    DeviceOrientation: DeviceOrientation;
    Gyroscope: Gyroscope;
    LocationManager: LocationManager;

    // Methods
    ready(): void;
    expand(): void;
    close(): void;
    enableClosingConfirmation(): void;
    disableClosingConfirmation(): void;
    enableVerticalSwipes(): void;
    disableVerticalSwipes(): void;
    setHeaderColor(color: string): void;
    setBackgroundColor(color: string): void;
    setBottomBarColor(color: string): void;
    requestFullscreen(): void;
    exitFullscreen(): void;
    lockOrientation(): void;
    unlockOrientation(): void;
    requestWriteAccess(callback?: (granted: boolean) => void): void;
    requestContact(callback?: (sent: boolean, event?: any) => void): void;
    readTextFromClipboard(callback?: (text: string | null) => void): void;
    shareToStory(mediaUrl: string, params?: ShareStoryParams): void;
    downloadFile(params: DownloadFileParams, callback?: (downloaded: boolean) => void): void;
    addToHomeScreen(): void;
    checkHomeScreenStatus(callback?: (status: string) => void): void;
    openLink(url: string, options?: OpenLinkOptions): void;
    openTelegramLink(url: string, options?: any): void;
    openInvoice(url: string, callback?: (status: string) => void): void;
    showPopup(params: PopupParams, callback?: (buttonId: string | null) => void): void;
    showAlert(message: string, callback?: () => void): void;
    showConfirm(message: string, callback?: (confirmed: boolean) => void): void;
    showScanQrPopup(params?: ScanQrPopupParams, callback?: (text: string) => boolean | void): void;
    isVersionAtLeast(version: string): boolean;
    setEmojiStatus(customEmojiId: string, params?: EmojiStatusParams, callback?: (set: boolean) => void): void;
    requestEmojiStatusAccess(callback?: (allowed: boolean) => void): void;
    sendData(data: string): void;
    switchInlineQuery(query: string, chooseChatTypes?: ChatType[]): void;
    invokeCustomMethod(method: string, params?: any, callback?: (err: string | null, result?: any) => void): void;

    onEvent(eventType: string, eventHandler: () => void): void;
    offEvent(eventType: string, eventHandler: () => void): void;
}

export interface WebAppInitData {
    query_id?: string;
    user?: WebAppUser;
    receiver?: WebAppUser;
    chat?: WebAppChat;
    chat_type?: string;
    chat_instance?: string;
    start_param?: string;
    can_send_after?: number;
    auth_date?: number;
    hash?: string;
}

export interface WebAppUser {
    id: number;
    is_bot?: boolean;
    first_name: string;
    last_name?: string;
    username?: string;
    language_code?: string;
    is_premium?: boolean;
    photo_url?: string;
}

export interface WebAppChat {
    id: number;
    type: string;
    title: string;
    username?: string;
    photo_url?: string;
}

export interface ThemeParams {
    bg_color: string;
    text_color: string;
    hint_color: string;
    link_color: string;
    button_color: string;
    button_text_color: string;
    secondary_bg_color: string;
    header_bg_color: string;
    accent_text_color: string;
    section_bg_color: string;
    section_header_text_color: string;
    subtitle_text_color: string;
    destructive_text_color: string;
}

export interface MainButton {
    text: string;
    color: string;
    textColor: string;
    isVisible: boolean;
    isActive: boolean;
    isProgressVisible: boolean;
    hasShineEffect: boolean;

    setText(text: string): MainButton;
    onClick(callback: () => void): MainButton;
    offClick(callback: () => void): MainButton;
    show(): MainButton;
    hide(): MainButton;
    enable(): MainButton;
    disable(): MainButton;
    showProgress(leaveActive?: boolean): MainButton;
    hideProgress(): MainButton;
    setParams(params: MainButtonParams): MainButton;
}

export interface MainButtonParams {
    text?: string;
    color?: string;
    text_color?: string;
    has_shine_effect?: boolean;
    is_active?: boolean;
    is_visible?: boolean;
}

export interface SecondaryButton extends MainButton {
    position: 'left' | 'right' | 'top' | 'bottom';
}

export interface BackButton {
    isVisible: boolean;

    onClick(callback: () => void): BackButton;
    offClick(callback: () => void): BackButton;
    show(): BackButton;
    hide(): BackButton;
}

export interface SettingsButton {
    isVisible: boolean;

    onClick(callback: () => void): SettingsButton;
    offClick(callback: () => void): SettingsButton;
    show(): SettingsButton;
    hide(): SettingsButton;
}

export interface HapticFeedback {
    impactOccurred(style: 'light' | 'medium' | 'heavy' | 'rigid' | 'soft'): void;
    notificationOccurred(type: 'error' | 'success' | 'warning'): void;
    selectionChanged(): void;
}

export interface CloudStorage {
    setItem(key: string, value: string, callback?: (err: Error | null, stored?: boolean) => void): void;
    getItem(key: string, callback?: (err: Error | null, value?: string) => void): void;
    getItems(keys: string[], callback?: (err: Error | null, values?: Record<string, string>) => void): void;
    removeItem(key: string, callback?: (err: Error | null, removed?: boolean) => void): void;
    removeItems(keys: string[], callback?: (err: Error | null, removed?: boolean) => void): void;
    getKeys(callback?: (err: Error | null, keys?: string[]) => void): void;
}

export interface BiometricManager {
    isInited: boolean;
    isBiometricAvailable: boolean;
    biometricType: 'finger' | 'face' | 'unknown';
    isAccessRequested: boolean;
    isAccessGranted: boolean;
    isBiometricTokenSaved: boolean;
    deviceId: string;

    init(callback?: () => void): void;
    requestAccess(params: BiometricRequestAccessParams, callback?: (granted: boolean) => void): void;
    authenticate(params: BiometricAuthenticateParams, callback?: (success: boolean, token?: string) => void): void;
    updateBiometricToken(token: string, callback?: (updated: boolean) => void): void;
    openSettings(): void;
}

export interface BiometricRequestAccessParams {
    reason?: string;
}

export interface BiometricAuthenticateParams {
    reason?: string;
}

export interface Accelerometer {
    isStarted: boolean;
    x: number;
    y: number;
    z: number;

    start(params?: { refresh_rate?: number }): void;
    stop(): void;
}

export interface DeviceOrientation {
    isStarted: boolean;
    absolute: boolean;
    alpha: number;
    beta: number;
    gamma: number;

    start(params?: { refresh_rate?: number; need_absolute?: boolean }): void;
    stop(): void;
}

export interface Gyroscope {
    isStarted: boolean;
    x: number;
    y: number;
    z: number;

    start(params?: { refresh_rate?: number }): void;
    stop(): void;
}

export interface LocationManager {
    isInited: boolean;
    isLocationAvailable: boolean;
    isAccessRequested: boolean;
    isAccessGranted: boolean;

    init(callback?: () => void): void;
    getLocation(callback?: (location: LocationData | null) => void): void;
    openSettings(): void;
}

export interface LocationData {
    latitude: number;
    longitude: number;
    altitude?: number;
    course?: number;
    speed?: number;
    horizontal_accuracy?: number;
    vertical_accuracy?: number;
    course_accuracy?: number;
    speed_accuracy?: number;
}

export interface ShareStoryParams {
    text?: string;
    widget_link?: {
        url: string;
        name?: string;
    };
}

export interface DownloadFileParams {
    url: string;
    file_name: string;
}

export interface OpenLinkOptions {
    try_browser?: 'google-chrome' | 'chrome' | 'firefox' | 'safari' | 'opera';
    try_instant_view?: boolean;
}

export interface PopupParams {
    title?: string;
    message: string;
    buttons?: PopupButton[];
}

export interface PopupButton {
    id?: string;
    type?: 'default' | 'ok' | 'close' | 'cancel' | 'destructive';
    text?: string;
}

export interface ScanQrPopupParams {
    text?: string;
}

export interface EmojiStatusParams {
    duration?: number;
}

export type ChatType = 'users' | 'bots' | 'groups' | 'channels';

declare global {
    interface Window {
        Telegram?: {
            WebApp: TelegramWebApp;
        };
    }
}
```

## /utils/telegram.ts

```ts
// utils/telegram.ts

/**
 * Telegram Dev Kit - Copyright (c) 2025 Nikandr Surkov
 * 
 * Proprietary License - This code may ONLY be used if purchased from https://nikandr.com
 * Redistribution, reselling, or public publishing is strictly prohibited.
 * 
 * Full license and contact: https://nikandr.com
 */

export function validateInitData(initData: string, botToken: string): boolean {
    // This should be done on your backend
    // Example implementation for reference only
    const urlParams = new URLSearchParams(initData)
    const hash = urlParams.get('hash')
    urlParams.delete('hash')

    // Sort parameters
    const params = Array.from(urlParams.entries())
        .sort(([a], [b]) => a.localeCompare(b))
        .map(([key, value]) => `${key}=${value}`)
        .join('\n')

    // In production, verify hash on backend with bot token
    return true // Placeholder
}

export function formatTelegramDate(timestamp: number): string {
    return new Date(timestamp * 1000).toLocaleString()
}

export function isDesktop(platform: string): boolean {
    return ['macos', 'windows', 'linux'].includes(platform.toLowerCase())
}

export function isMobile(platform: string): boolean {
    return ['ios', 'android'].includes(platform.toLowerCase())
}
```

